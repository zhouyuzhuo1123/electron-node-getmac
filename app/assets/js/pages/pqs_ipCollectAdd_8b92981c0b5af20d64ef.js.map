{"version":3,"sources":["webpack:///assets/js/pages/pqs_ipCollectAdd_8b92981c0b5af20d64ef.js","webpack:///./src/js/pages/pqs/ipCollectAdd.js","webpack:///./src/js/utils/reloadfetch.js?f547"],"names":["webpackJsonp","647","module","exports","__webpack_require__","$","i18next","notie","reloadfetch","app","util","ipCollectAddCtrl","page","undefined","selectRow","selectRowData","initTable","table","supplierText","tableAllDataFirst","undoInfByStation","undoCountAll","tableCountAll","stationOccupy","beforeInit","document","off","_this","this","getLoginUser","data","userCode","done","init","setBreadcrumb","t","translate","$undoCount","$allCount","$productmark","$lotBarCodeInput","onload","productmark","lotBarCodeInputEvent","loadPage","focus","removeSubmitEvent","scrollY","height","$table","DataTable","serverSide","paging","searching","order","dom","columns","name","orderable","render","type","row","keypartCode","className","supplierCode","lotNum","rowCallback","find","on","e","hasClass","parent","text","draw","statusEcodeOld","statusEcode","rowIndex","index","tableRow","toArray","splice","tableDataFirst","length","push","unshift","clear","undoCount","children","removeClass","rows","add","countChange","undoInfByStationCheck","stationCode","alternateRelation","keypartAlternateGroup","alternateForGroup","count","invalidFlag","maxCount","idx","alternateGroup","every","rowIdx","tableLoop","rowLoop","invalid","stopPropagation","addClass","hideFliterByStation","val","initData","myApp","pickerModal","css","pickermodalclose","saveToTable","statusEcodeNew","rowData","materialSupplierCondition","tableData","scrollTop","toUpperCase","next","subAssemblyFlag","judgeMaterialSupplierCondition","response","request","url","serviceCode","siteCode","materialCode","success","rightCode","div","parents","station","attr","d","total","keyup","event","reg","test","value","replace","keyCode","productNum","empty","select","loadTableByProductNum","notify","createTable","list","dataLength","First","first","alert","stationIndex","addSubmitEvent","keypartCount","i","quantity","j","keypart","extend","doneCount","isGroup","parseInt","key","validCount","node","undoInfByStationRender","services","message","fail","html","htmlTpl","tpl","Template7","compile","stationHtmlArray","extClass","stationHtmlString","join","resolveLotBarCode","code","barcode","dealKeypartCode","returnData","rowSelect","rowSelectMatch","rowMatchData","valid","contentMsg","lotBarCode","remove","ListRender","renderData","supplierLabel","supplierList","tplManager","fromSupplierCode","headerEvent","submitConfirm","showPreloader","param","saveDataSuccess","error","hidePreloader","setTimeout","createUser","modifyUser","tableDataI","notNullFlag","hasOwnProperty","indexOf","keyNew","confirm","inputSelector","querySelector","call","666","appConfig","fetch","reloadhttp","sessionStorage","getItem","baseEnv","callback","get","getUserAllModuleMenus"],"mappings":"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","file":"assets/js/pages/pqs_ipCollectAdd_8b92981c0b5af20d64ef.js","sourcesContent":["webpackJsonp([7],{\n\n/***/ 647:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, i18next, notie) {\n\nvar reloadfetch = __webpack_require__(666);\nvar app = __webpack_require__(77);\nvar util = __webpack_require__(34);\nvar ipCollectAddCtrl = {\n\tpage: undefined,\n\tselectRow: null,\n\tselectRowData: null,\n\tinitTable: null,\n\ttable: null,\n\tsupplierText: null,\n\ttableAllDataFirst: undefined,\n\tundoInfByStation: undefined,\n\tundoCountAll: undefined,\n\ttableCountAll: undefined,\n\tstationOccupy: undefined,\n\tbeforeInit: function beforeInit() {\n\t\t$(document).off(\"keydown\");\n\t\tvar _this = this;\n\t\treloadfetch.getLoginUser(function (data) {\n\t\t\t_this.userCode = data.data.userCode;\n\t\t}).done(function () {\n\t\t\t_this.init();\n\t\t});\n\t},\n\tinit: function init() {\n\t\tvar _this = this;\n\t\tutil.setBreadcrumb([i18next.t(\"KEYPART.T.MENU_ADDITIONAL\")]);\n\t\tutil.translate(_this.page);\n\t\tthis.$undoCount = $(\"#currentNum\", this.page);\n\t\tthis.$allCount = $(\"#allNum\", this.page);\n\t\tthis.$productmark = $(\"#productmark\", this.page);\n\t\tthis.$lotBarCodeInput = $(\"#lotBarCodeInput\", this.page);\n\n\t\tthis.onload();\n\t\tthis.productmark();\n\t\tthis.lotBarCodeInputEvent();\n\t\tthis.loadPage();\n\t},\n\tloadPage: function loadPage() {\n\t\tvar _this = this;\n\n\t\t$('#productmark').focus();\n\t\t_this.removeSubmitEvent();\n\t\tvar scrollY = _this.page.height - 158 - 30;\n\t\t_this.$table = $('.table-panel table', _this.page);\n\t\t_this.table = $('.table-panel table', _this.page).DataTable({\n\t\t\t\"serverSide\": false,\n\t\t\t\"paging\": false,\n\t\t\t\"searching\": false,\n\t\t\t\"scrollY\": scrollY,\n\t\t\t\"order\": [],\n\t\t\t\"data\": [],\n\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\n\t\t\t\"columns\": [{\n\t\t\t\t\"data\": \"keypartCode\",\n\t\t\t\t\"name\": \"keypartCode\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<span class=\"ipCollect-component-value\">' + row.keypartCode + '</span>';\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t\"className\": \"supplierCode\",\n\t\t\t\t\"data\": \"supplierCode\",\n\t\t\t\t\"name\": \"supplierCode\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-supplier-value ipCollect-open-picker\">' + (row.supplierCode || \"\") + '</a>';\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t\"className\": \"supplierCode\",\n\t\t\t\t\"data\": \"lotNum\",\n\t\t\t\t\"name\": \"lotNum\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-batch-value  ipCollect-open-picker\">' + (row.lotNum || \"\") + '</a>';\n\t\t\t\t}\n\n\t\t\t}, {\n\t\t\t\t\"data\": \"keypartText\",\n\t\t\t\t\"name\": \"keypartText\",\n\t\t\t\t\"orderable\": false\n\t\t\t}, {\n\t\t\t\t\"data\": \"supplierText\",\n\t\t\t\t\"name\": \"supplierText\",\n\t\t\t\t\"orderable\": false\n\t\t\t}, {\n\t\t\t\t\"name\": \"remove\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render() {\n\t\t\t\t\treturn \"<button class='cancel' >\" + i18next.t('KEYPART.B.REPEAL') + \"</button>\";\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"rowCallback\": function rowCallback(row, data) {\n\t\t\t\t$(row).find(\"td:last-child button\").on(\"click\", function (e) {\n\t\t\t\t\t_this.selectRow = _this.table.row(row);\n\t\t\t\t\tvar data = _this.selectRow.data();\n\t\t\t\t\tif (!$(row).hasClass('invalid')) {\n\t\t\t\t\t\tif ($(this).parent().parent().find(\"td:eq(1) a\").text() || $(this).parent().parent().find(\"td:eq(2) a\").text()) {\n\t\t\t\t\t\t\tdata[\"lotBarCode\"] = \"\";\n\t\t\t\t\t\t\tdata[\"lotNum\"] = \"\";\n\t\t\t\t\t\t\tdata[\"supplierCode\"] = \"\";\n\t\t\t\t\t\t\tdata[\"supplierText\"] = \"\";\n\n\t\t\t\t\t\t\t_this.table.row(row).data(data).draw();\n\t\t\t\t\t\t\tvar statusEcodeOld = data.statusEcode;\n\t\t\t\t\t\t\tdata.statusEcode = 0;\n\n\t\t\t\t\t\t\tvar rowIndex = _this.selectRow.index();\n\t\t\t\t\t\t\tvar tableRow = _this.table.data().toArray();\n\t\t\t\t\t\t\ttableRow.splice(rowIndex, 1);\n\n\t\t\t\t\t\t\tvar tableDataFirst = tableRow.length > 1 ? tableRow[0] : undefined;\n\t\t\t\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\t\t\t\ttableRow.splice(0, 1);\n\t\t\t\t\t\t\t\ttableRow.push(tableDataFirst);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttableRow.unshift(data);\n\t\t\t\t\t\t\t_this.table.clear();\n\n\t\t\t\t\t\t\t_this.undoCount++;\n\n\t\t\t\t\t\t\t$(row).children().removeClass('error');\n\t\t\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\n\t\t\t\t\t\t\t_this.table.rows.add(tableRow).draw();\n\t\t\t\t\t\t\tvar countChange;\n\t\t\t\t\t\t\tif (statusEcodeOld > 0) {\n\t\t\t\t\t\t\t\tcountChange = -1;\n\t\t\t\t\t\t\t\t_this.undoInfByStationCheck(data.stationCode, -1);\n\t\t\t\t\t\t\t\tif (_this.stationOccupy) {\n\t\t\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[_this.stationOccupy].undoCount);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcountChange = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\n\t\t\t\t\t\t\tif (countChange != 0) {\n\t\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\n\t\t\t\t\t\t\t\tvar stationCode = data.stationCode;\n\t\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode] && _this.alternateRelation[stationCode][keypartCode]) {\n\t\t\t\t\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[stationCode][keypartCode].alternateForGroup;\n\t\t\t\t\t\t\t\t\t_this.alternateRelation[stationCode][keypartAlternateGroup].count += countChange;\n\t\t\t\t\t\t\t\t\tvar invalidFlag;\n\t\t\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode][keypartAlternateGroup].count >= _this.alternateRelation[stationCode][keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\t\t\t\t\tinvalidFlag = true;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tinvalidFlag = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t_this.table.rows(function (idx, data) {\n\t\t\t\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.stationCode === stationCode && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\n\t\t\t\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\t\t\t\td.invalid = invalidFlag;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (data.statusEcode == \"2\") {\n\t\t\t\t\t$(row).children().addClass('error');\n\t\t\t\t\t$(row).children('td').children('button').addClass('delBtn');\n\t\t\t\t} else {\n\t\t\t\t\t$(row).children().removeClass('error');\n\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\n\t\t\t\t}\n\n\t\t\t\tif (data.invalid == true) {\n\t\t\t\t\t$(row).addClass(\"invalid\");\n\t\t\t\t} else {\n\t\t\t\t\t$(row).removeClass(\"invalid\");\n\t\t\t\t}\n\n\t\t\t\tif (data.hideFliterByStation === true) {\n\t\t\t\t\t$(row).addClass(\"hideFliterByStation\");\n\t\t\t\t} else {\n\t\t\t\t\t$(row).removeClass(\"hideFliterByStation\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(\"tbody\", _this.$table).on(\"click\", \"tr:not(.invalid)\", function () {\n\t\t\t_this.selectRow = _this.table.row(this);\n\t\t\tvar data = _this.selectRow.data();\n\t\t\t$(\"#ipCollect-component\", _this.page).val(data[\"keypartCode\"]);\n\t\t\t$(\"#ipCollect-batchNumber\", _this.page).val(data[\"lotNum\"]);\n\t\t\t$(\"#ipCollect-supplier\", _this.page).val(data[\"supplierCode\"]);\n\t\t\t_this.initData();\n\t\t\tmyApp.pickerModal($(\".picker-modal\", _this.page));\n\t\t\t$('.masked').css('display', 'block');\n\t\t});\n\n\t\t$('.masked').on('click', function () {\n\t\t\t$(this).css('display', 'none');\n\t\t});\n\n\t\t$('.close-picker').on('click', function () {\n\t\t\t_this.pickermodalclose('#lotBarCodeInput');\n\t\t});\n\n\t\t$('.ipCollect-confirm').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t\tvar rowData = _this.selectRow.data();\n\t\t\tvar rowIndex = _this.selectRow.index();\n\t\t\tvar statusEcodeOld = rowData.statusEcode;\n\t\t\tvar statusEcodeNew;\n\t\t\tvar countChange;\n\t\t\trowData.supplierCode = $('input:radio[name=\"provider\"]:checked').val() || \"\";\n\t\t\trowData.lotNum = $(\"#ipCollect-batchNumber\").val().toUpperCase() || \"\";\n\t\t\trowData.supplierText = $('input:radio[name=\"provider\"]:checked').next().children('span').text() || \"\";\n\t\t\tvar materialSupplierCondition;\n\t\t\tif (rowData.subAssemblyFlag != 1 && rowData.supplierCode !== \"\") {\n\t\t\t\tvar judgeMaterialSupplierCondition = function judgeMaterialSupplierCondition(response) {\n\t\t\t\t\tif (response.data == true) {\n\t\t\t\t\t\tmaterialSupplierCondition = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmaterialSupplierCondition = false;\n\t\t\t\t\t}\n\t\t\t\t\tsaveToTable();\n\t\t\t\t};\n\n\t\t\t\tapp.request({\n\t\t\t\t\turl: \"restful/service/execute\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART011\",\n\t\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\t\tmaterialCode: _this.selectRow.data().keypartCode,\n\t\t\t\t\t\tsupplierCode: rowData.supplierCode\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\t\tutil.rightCode(response, judgeMaterialSupplierCondition);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (rowData.subAssemblyFlag == 1 && rowData.supplierCode !== \"\") {\n\t\t\t\tmaterialSupplierCondition = true;\n\t\t\t\tsaveToTable();\n\t\t\t} else {\n\t\t\t\tmaterialSupplierCondition = false;\n\t\t\t\tsaveToTable();\n\t\t\t}\n\n\t\t\tfunction saveToTable() {\n\t\t\t\tif (rowData.supplierCode === \"\" && rowData.lotNum === \"\") {\n\t\t\t\t\tstatusEcodeNew = 0;\n\t\t\t\t} else if (rowData.supplierCode !== \"\" && materialSupplierCondition == true && rowData.lotNum !== \"\") {\n\t\t\t\t\tstatusEcodeNew = 1;\n\t\t\t\t} else {\n\t\t\t\t\tstatusEcodeNew = 2;\n\t\t\t\t}\n\n\t\t\t\tif ((statusEcodeOld == 0 || !statusEcodeOld || statusEcodeOld == \"\") && statusEcodeNew > 0) {\n\t\t\t\t\tcountChange = 1;\n\t\t\t\t} else if (statusEcodeOld > 0 && statusEcodeNew == 0) {\n\t\t\t\t\tcountChange = -1;\n\t\t\t\t} else {\n\t\t\t\t\tcountChange = 0;\n\t\t\t\t}\n\t\t\t\trowData.statusEcode = statusEcodeNew;\n\n\t\t\t\t_this.table.row(rowIndex).data(rowData).draw();\n\n\t\t\t\tvar tableData = _this.table.data().toArray();\n\t\t\t\ttableData.splice(rowIndex, 1);\n\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\ttableData.splice(0, 1);\n\t\t\t\t\ttableData.push(tableDataFirst);\n\t\t\t\t}\n\t\t\t\ttableData.unshift(rowData);\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(tableData).draw();\n\t\t\t\t_this.$table.parent().scrollTop(0);\n\n\t\t\t\t_this.undoCount -= countChange;\n\n\n\t\t\t\tvar keypartCode = rowData.keypartCode;\n\t\t\t\tvar stationCode = rowData.stationCode;\n\t\t\t\t_this.undoInfByStationCheck(stationCode, countChange);\n\t\t\t\tif (_this.stationOccupy) {\n\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[_this.stationOccupy].undoCount);\n\t\t\t\t} else {\n\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t\t}\n\t\t\t\tif (_this.alternateRelation[stationCode] && _this.alternateRelation[stationCode][keypartCode]) {\n\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[stationCode][keypartCode].alternateForGroup;\n\t\t\t\t\t_this.alternateRelation[stationCode][keypartAlternateGroup].count += countChange;\n\t\t\t\t\tvar invalidFlag;\n\t\t\t\t\tif (_this.alternateRelation[stationCode][keypartAlternateGroup].count >= _this.alternateRelation[stationCode][keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\tinvalidFlag = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinvalidFlag = false;\n\t\t\t\t\t}\n\t\t\t\t\t_this.table.rows(function (idx, data) {\n\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.stationCode === stationCode && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t}).every(function () {\n\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\td.invalid = invalidFlag;\n\t\t\t\t\t});\n\t\t\t\t\t_this.table.draw();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$('.boxPage').on('click', '.box', function () {\n\t\t\tvar div = $(this);\n\t\t\tif (!div.hasClass('focusGray')) {\n\t\t\t\tdiv.parents().find('div.focusGray').removeClass('focusGray');\n\t\t\t\tdiv.addClass('focusGray');\n\t\t\t\tvar station = div.attr('station');\n\t\t\t\tif (station) {\n\t\t\t\t\t_this.stationOccupy = station;\n\t\t\t\t\t_this.table.rows().every(function () {\n\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\tif (d.stationCode === station) {\n\t\t\t\t\t\t\td.hideFliterByStation = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\td.hideFliterByStation = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t_this.$allCount.text(_this.undoInfByStation[station].total);\n\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[station].undoCount);\n\t\t\t\t} else {\n\t\t\t\t\t_this.stationOccupy = false;\n\t\t\t\t\t_this.table.rows().every(function () {\n\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\td.hideFliterByStation = false;\n\t\t\t\t\t});\n\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t_this.$allCount.text(_this.tableCountAll);\n\t\t\t\t\t_this.$undoCount.text(_this.undoCountAll);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tonload: function onload() {\n\t\t$('.ipCollect-cancel').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t});\n\t},\n\tproductmark: function productmark() {\n\t\tvar _this = this;\n\t\tvar $productmark = $(\"#productmark\", _this.page);\n\t\t$productmark.keyup(function (event) {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t\tif (event.keyCode == 13) {\n\t\t\t\tvar productNum = $productmark.val();\n\t\t\t\t$('#ipCollectAdd-querySiteRender').empty();\n\t\t\t\t$('.stationNum').text(\"\");\n\n\t\t\t\tif (productNum) {\n\t\t\t\t\t$productmark.focus().select();\n\t\t\t\t\t_this.loadTableByProductNum();\n\t\t\t\t} else {\n\t\t\t\t\tutil.notify({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_PRODUCT_NO_NOT_BE_NULL\")\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t$productmark.focus();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tvar $ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\n\t\t$ipCollectBatchNumber.keyup(function () {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t});\n\t},\n\tloadTableByProductNum: function loadTableByProductNum() {\n\t\tvar _this = this;\n\t\tgetListDataFromServer();\n\n\t\tfunction getListDataFromServer() {\n\t\t\tutil.services({\n\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART003',\n\t\t\t\tdata: {\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART003',\n\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\tproductNum: _this.$productmark.val().toUpperCase()\n\t\t\t\t},\n\t\t\t\tmessage: \"正在获取扫描清单\"\n\t\t\t}).done(function (response) {\n\t\t\t\t_this.tableAllDataFirst = response.data.first;\n\t\t\t\tutil.rightCode(response, createTable);\n\t\t\t}).fail(function () {\n\t\t\t\tnotie.alert({ type: \"3\", text: \"解析失败！\" });\n\t\t\t\t_this.$productmark.focus().select();\n\t\t\t});\n\t\t}\n\n\t\tfunction createTable(response) {\n\n\t\t\tvar data = response.data.list;\n\t\t\tvar dataLength = data.length;\n\t\t\t_this.First = response.data.first;\n\t\t\tif (dataLength <= 0) {\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttype: \"3\",\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_RECORDLIST_IS_EMPTY\")\n\t\t\t\t});\n\t\t\t\t_this.table.clear().draw();\n\t\t\t\t_this.$productmark.focus().select();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t_this.undoInfByStation = {};\n\t\t\tvar stationIndex = 0;\n\t\t\t_this.addSubmitEvent();\n\t\t\tif (_this.First) {\n\t\t\t\tvar list = [];\n\t\t\t\tvar keypartCount = 0;\n\t\t\t\t_this.alternateRelation = {};\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tvar quantity = data[i].quantity;\n\t\t\t\t\tfor (var j = 0; j < quantity; j++) {\n\t\t\t\t\t\tvar keypart = {};\n\t\t\t\t\t\tkeypart = $.extend(keypart, data[i]);\n\t\t\t\t\t\tkeypart.supplierCode = \"\";\n\t\t\t\t\t\tkeypart.lotNum = \"\";\n\t\t\t\t\t\tlist.push(keypart);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!_this.undoInfByStation[data[i].stationCode]) {\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode] = {\n\t\t\t\t\t\t\tstationCode: data[i].stationCode,\n\t\t\t\t\t\t\tstationIndex: stationIndex,\n\t\t\t\t\t\t\tdoneCount: 0,\n\t\t\t\t\t\t\ttotal: 0\n\t\t\t\t\t\t};\n\t\t\t\t\t\tstationIndex++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data[i].alternateGroup) {\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].stationCode]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode] = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].keypartCode] = {\n\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].stationCode][data[i].alternateGroup]) {\n\t\t\t\t\t\t\tif (quantity > _this.alternateRelation[data[i].stationCode][data[i].alternateGroup].maxCount) {\n\t\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup].maxCount = quantity;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup] = {\n\t\t\t\t\t\t\t\tisGroup: true,\n\t\t\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\t\t\tmaxCount: quantity\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tkeypartCount += parseInt(quantity);\n\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode].total += parseInt(quantity);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var stationCode in _this.alternateRelation) {\n\t\t\t\t\tfor (var key in _this.alternateRelation[stationCode]) {\n\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].isGroup) {\n\t\t\t\t\t\t\tkeypartCount += parseInt(_this.alternateRelation[stationCode][key].maxCount);\n\t\t\t\t\t\t\t_this.undoInfByStation[stationCode].total += parseInt(_this.alternateRelation[stationCode][key].maxCount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$allCount.text(keypartCount);\n\t\t\t\t_this.$undoCount.text(keypartCount);\n\n\t\t\t\t_this.undoCount = keypartCount;\n\t\t\t\t_this.tableCountAll = keypartCount;\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(list).draw();\n\t\t\t\t_this.$lotBarCodeInput.focus();\n\t\t\t} else {\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(data).draw();\n\t\t\t\tvar keypartCount = 0;\n\t\t\t\tvar validCount = 0;\n\t\t\t\t_this.alternateRelation = {};\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tif (!_this.undoInfByStation[data[i].stationCode]) {\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode] = {\n\t\t\t\t\t\t\tstationCode: data[i].stationCode,\n\t\t\t\t\t\t\tstationIndex: stationIndex,\n\t\t\t\t\t\t\tdoneCount: 0,\n\t\t\t\t\t\t\ttotal: 0\n\t\t\t\t\t\t};\n\t\t\t\t\t\tstationIndex++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\n\t\t\t\t\t\tvalidCount++;\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode].doneCount++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data[i].alternateGroup) {\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].stationCode]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode] = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].stationCode][data[i].keypartCode]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].keypartCode].maxCount += 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].keypartCode] = {\n\t\t\t\t\t\t\t\tmaxCount: 1,\n\t\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].stationCode][data[i].alternateGroup]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup] = {\n\t\t\t\t\t\t\t\tisGroup: true,\n\t\t\t\t\t\t\t\tmaxCount: 0,\n\t\t\t\t\t\t\t\tcount: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup].count++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tkeypartCount++;\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode].total++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var stationCode in _this.alternateRelation) {\n\t\t\t\t\tfor (var key in _this.alternateRelation[stationCode]) {\n\t\t\t\t\t\tif (!_this.alternateRelation[stationCode][key].isGroup) {\n\t\t\t\t\t\t\tvar alternateForGroup = _this.alternateRelation[stationCode][key].alternateForGroup;\n\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].maxCount > _this.alternateRelation[stationCode][alternateForGroup].maxCount) {\n\t\t\t\t\t\t\t\t_this.alternateRelation[stationCode][alternateForGroup].maxCount = _this.alternateRelation[stationCode][key].maxCount;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var stationCode in _this.alternateRelation) {\n\t\t\t\t\tfor (var key in _this.alternateRelation[stationCode]) {\n\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].isGroup) {\n\t\t\t\t\t\t\tkeypartCount += _this.alternateRelation[stationCode][key].maxCount;\n\n\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].count >= _this.alternateRelation[stationCode][key].maxCount) {\n\t\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\t\t\treturn data.alternateGroup === key && data.stationCode === stationCode && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\n\t\t\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\t\t\td.invalid = true;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t_this.undoInfByStation[stationCode].total += parseInt(_this.alternateRelation[stationCode][key].maxCount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.table.draw();\n\t\t\t\t_this.$allCount.text(keypartCount);\n\t\t\t\t_this.tableCountAll = keypartCount;\n\t\t\t\t_this.undoCount = keypartCount - validCount;\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t}\n\t\t\t_this.undoInfByStationRender();\n\t\t}\n\t\t$('#lotBarCodeInput').focus().select();\n\t},\n\tundoInfByStationRender: function undoInfByStationRender() {\n\t\tvar _this = this;\n\t\t_this.undoCountAll = _this.undoCount;\n\t\t$(\".ipCollectAdd-Query-site-allnum .stationNum\").html(_this.undoCountAll);\n\t\tif (_this.undoCountAll <= 0) {\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").addClass(\"limegreen\");\n\t\t} else {\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").removeClass(\"limegreen\");\n\t\t}\n\n\t\tvar htmlTpl = $(\"#ipCollectAdd-countInfSiteTpl\").html();\n\t\tvar tpl = Template7.compile(htmlTpl);\n\t\tvar stationHtmlArray = [];\n\t\tfor (var stationCode in _this.undoInfByStation) {\n\t\t\t_this.undoInfByStation[stationCode].undoCount = _this.undoInfByStation[stationCode].total - _this.undoInfByStation[stationCode].doneCount;\n\t\t\tif (_this.undoInfByStation[stationCode].undoCount <= 0) {\n\t\t\t\t_this.undoInfByStation[stationCode].extClass = \"limegreen\";\n\t\t\t}\n\t\t\tstationHtmlArray[_this.undoInfByStation[stationCode].stationIndex] = tpl(_this.undoInfByStation[stationCode]);\n\t\t};\n\t\tvar stationHtmlString = stationHtmlArray.join(\"\");\n\t\t$(\"#ipCollectAdd-querySiteRender\").html(stationHtmlString);\n\t},\n\tundoInfByStationCheck: function undoInfByStationCheck(stationCode, countChange) {\n\t\tvar _this = this;\n\t\t_this.undoCountAll -= countChange;\n\t\t$(\".ipCollectAdd-Query-site-allnum .stationNum\").html(_this.undoCountAll);\n\t\tif (_this.undoCountAll <= 0) {\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").addClass(\"limegreen\");\n\t\t} else {\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").removeClass(\"limegreen\");\n\t\t}\n\n\t\t_this.undoInfByStation[stationCode].doneCount += countChange;\n\t\t_this.undoInfByStation[stationCode].undoCount -= countChange;\n\n\t\t$(\"[station=\" + stationCode + \"] \" + \"span\").html(_this.undoInfByStation[stationCode].undoCount);\n\t\tif (_this.undoInfByStation[stationCode].undoCount <= 0) {\n\t\t\t$(\"[station=\" + stationCode + \"]\").addClass(\"limegreen\");\n\t\t} else {\n\t\t\t$(\"[station=\" + stationCode + \"]\").removeClass(\"limegreen\");\n\t\t}\n\t},\n\tlotBarCodeInputEvent: function lotBarCodeInputEvent() {\n\t\tvar _this = this;\n\t\tvar $lotBarCodeInput = $(\"#lotBarCodeInput\", _this.page);\n\t\t$lotBarCodeInput.keyup(function (event) {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t\tif (event.keyCode == 13) {\n\t\t\t\tvar lotBarCode = $lotBarCodeInput.val();\n\t\t\t\tif (lotBarCode) {\n\t\t\t\t\t$lotBarCodeInput.focus().select();\n\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\tresolveLotBarCode(lotBarCode);\n\t\t\t\t} else {\n\t\t\t\t\tutil.notify({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_NOT_BE_NULL\")\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t$lotBarCodeInput.focus();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfunction resolveLotBarCode(code) {\n\t\t\tutil.services({\n\t\t\t\turl: 'restful/service/execute',\n\t\t\t\tdata: {\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART002',\n\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\tbarcode: code.toUpperCase()\n\t\t\t\t},\n\t\t\t\tmessage: \"请求中\"\n\t\t\t}).done(function (response) {\n\t\t\t\tutil.rightCode(response, dealKeypartCode);\n\t\t\t}).fail(function () {\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ERROR\", {\n\t\t\t\t\t\tlength: code.length\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t});\n\t\t}\n\n\t\tfunction dealKeypartCode(response) {\n\t\t\tvar returnData = response.data;\n\t\t\tvar keypartCode = returnData.materialCode;\n\n\t\t\tvar keypartAlternateGroup;\n\t\t\tif (_this.alternateRelation[keypartCode]) {\n\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\n\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\")\n\t\t\t\t\t});\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar rowSelect = _this.table.row(function (idx, data) {\n\t\t\t\treturn data.keypartCode === keypartCode && data.invalid != true && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t});\n\n\t\t\tvar rowSelectMatch = _this.table.row(function (idx, data, node) {\n\t\t\t\treturn data.keypartCode === keypartCode && (data.statusEcode == 1 || data.statusEcode == 2) ? true : false;\n\t\t\t});\n\n\t\t\tvar rowData = rowSelect.data();\n\t\t\tvar rowMatchData = rowSelectMatch.data();\n\t\t\tif (rowData) {\n\t\t\t\trowData.supplierCode = returnData.supplierCode;\n\t\t\t\trowData.lotNum = returnData.lotNum;\n\t\t\t\trowData.supplierText = returnData.supplierText;\n\t\t\t\tif (returnData.valid) {\n\t\t\t\t\trowData.statusEcode = 1;\n\t\t\t\t} else {\n\t\t\t\t\trowData.statusEcode = 2;\n\t\t\t\t}\n\n\t\t\t\tvar rowIndex = rowSelect.index();\n\t\t\t\tvar tableData = _this.table.data().toArray();\n\t\t\t\ttableData.splice(rowIndex, 1);\n\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\ttableData.splice(0, 1);\n\t\t\t\t\ttableData.push(tableDataFirst);\n\t\t\t\t}\n\t\t\t\ttableData.unshift(rowData);\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(tableData).draw();\n\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ANALYSE_SUCCESS\")\n\t\t\t\t});\n\t\t\t\t_this.undoCount--;\n\t\t\t\tvar stationCode = rowData.stationCode;\n\t\t\t\t_this.undoInfByStationCheck(stationCode, 1);\n\t\t\t\tif (_this.stationOccupy) {\n\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[_this.stationOccupy].undoCount);\n\t\t\t\t} else {\n\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t\t}\n\t\t\t\tvar keypartAlternateGroup;\n\t\t\t\tif (_this.alternateRelation[stationCode] && _this.alternateRelation[stationCode][keypartCode]) {\n\t\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[stationCode][keypartCode].alternateForGroup;\n\t\t\t\t}\n\n\t\t\t\tif (keypartAlternateGroup) {\n\t\t\t\t\t_this.alternateRelation[stationCode][keypartAlternateGroup].count++;\n\t\t\t\t\tif (_this.alternateRelation[stationCode][keypartAlternateGroup].count >= _this.alternateRelation[stationCode][keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\t_this.table.rows(function (idx, data) {\n\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.stationCode === stationCode && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t}).every(function () {\n\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\td.invalid = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus();\n\t\t\t} else {\n\n\t\t\t\tvar contentMsg = i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\");\n\t\t\t\tif (rowMatchData) {\n\t\t\t\t\tcontentMsg = \"重复扫描！\";\n\t\t\t\t}\n\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\ttext: contentMsg\n\t\t\t\t});\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t}\n\t\t}\n\t},\n\tinitData: function initData() {\n\t\tvar _this = this;\n\t\tvar rowData = _this.selectRow.data();\n\t\t$(\"#supplierListRender\", _this.page).on('click', '.content label', function () {\n\t\t\t$(\".batch-input\").focus();\n\t\t});\n\t\tapp.request({\n\t\t\turl: \"restful/service/execute\",\n\t\t\tdata: {\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART006\",\n\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\tmaterialCode: rowData.keypartCode\n\t\t\t},\n\t\t\tsuccess: function success(response) {\n\t\t\t\tutil.rightCode(response, ListRender);\n\t\t\t}\n\t\t});\n\n\t\tfunction ListRender(response) {\n\t\t\tvar renderData = {\n\t\t\t\tsupplierLabel: i18next.t(\"KEYPART.T.SUPPLIER\"),\n\t\t\t\tsupplierList: response.data\n\t\t\t};\n\t\t\tutil.tplManager(\"supplierListTpl\", renderData, \"supplierListRender\");\n\n\t\t\tvar fromSupplierCode = rowData.supplierCode;\n\t\t\tif (fromSupplierCode) {\n\t\t\t\t$(\"input[name='provider'][value=\" + fromSupplierCode + \"]\").attr(\"checked\", true);\n\t\t\t}\n\t\t}\n\t},\n\theaderEvent: function headerEvent() {\n\t\tvar _this = this;\n\t\t$('.head-confirm').on('click', function () {\n\t\t\tsaveDataToServer();\n\t\t\tfunction saveDataToServer() {\n\t\t\t\tvar param = {\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART015\",\n\t\t\t\t\tsiteCode: app.siteCode,\n\n\t\t\t\t\tproductNum: _this.$productmark.val().toUpperCase(),\n\t\t\t\t\tcreateUser: _this.userCode,\n\t\t\t\t\tmodifyUser: _this.userCode,\n\t\t\t\t\tsubAssemblyFlag: 0\n\t\t\t\t};\n\t\t\t\tvar tableData = _this.table.data();\n\t\t\t\tvar dataLength = tableData.length;\n\t\t\t\tif (dataLength <= 0) {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_NO_DATA_TO_SUBMIT\")\n\t\t\t\t\t});\n\t\t\t\t\t_this.$productmark.focus().select();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tvar tableDataI = tableData[i];\n\n\t\t\t\t\tif (tableDataI.notNullFlag == 1 && tableDataI.invalid != true && tableDataI.statusEcode != 1 && tableDataI.statusEcode != 2) {\n\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_HAVE_NOT_NULL_DATA_SUBMIT\", {\n\t\t\t\t\t\t\t\tkeypartCode: tableDataI.keypartCode\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var key in tableDataI) {\n\t\t\t\t\t\tif (tableDataI.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tif ([\"createDate\", \"createDateTime\", \"modifyDate\", \"modifyDateTime\", \"invalid\", \"hideFliterByStation\"].indexOf(key) < 0) {\n\t\t\t\t\t\t\t\tvar keyNew = \"items[\" + i + \"].\" + key;\n\t\t\t\t\t\t\t\tif (key == \"statusEcode\" && (tableDataI[key] == \"\" || tableDataI[key] == null || !tableDataI[key])) {\n\t\t\t\t\t\t\t\t\tparam[keyNew] = 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tparam[keyNew] = tableDataI[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (_this.undoCount > 0) {\n\t\t\t\t\tmyApp.confirm('数据录入不完整，确定要提交？', function () {\n\t\t\t\t\t\tsubmitConfirm();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsubmitConfirm();\n\t\t\t\t}\n\n\t\t\t\tfunction submitConfirm() {\n\t\t\t\t\tmyApp.showPreloader(\"数据保存中...\");\n\t\t\t\t\tapp.request({\n\t\t\t\t\t\turl: 'restful/service/execute',\n\t\t\t\t\t\tdata: param,\n\t\t\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\t\t\tutil.rightCode(response, saveDataSuccess);\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: function error() {\n\t\t\t\t\t\t\tmyApp.hidePreloader();\n\t\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_FAILURE\")\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction saveDataSuccess() {\n\t\t\t\t\tmyApp.hidePreloader();\n\t\t\t\t\tutil.notify({\n\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_SUCCESS\")\n\t\t\t\t\t});\n\t\t\t\t\t_this.removeSubmitEvent();\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\t}, 3000);\n\t\t\t\t\t_this.table.clear().draw();\n\t\t\t\t\t_this.$allCount.text(0);\n\t\t\t\t\t_this.$undoCount.text(0);\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\n\t\t\t\t\t_this.$productmark.val(\"\").focus();\n\t\t\t\t\t$('#ipCollectAdd-querySiteRender').empty();\n\t\t\t\t\t$('.stationNum').text(\"\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\taddSubmitEvent: function addSubmitEvent() {\n\t\t$('.head-confirm').css('background', '#00adee');\n\t\tthis.headerEvent();\n\t},\n\tremoveSubmitEvent: function removeSubmitEvent() {\n\t\t$('.head-confirm').off();\n\t\t$('.head-confirm').css('background', '#CCC');\n\t},\n\tpickermodalclose: function pickermodalclose(inputSelector) {\n\t\tinputSelector && document.querySelector(inputSelector) && document.querySelector(inputSelector).focus();\n\t}\n};\n\nmodule.exports = ipCollectAddCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(37), __webpack_require__(36)))\n\n/***/ }),\n\n/***/ 666:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(appConfig) {\n\nvar fetch = __webpack_require__(34);\nvar access_token = sessionStorage.getItem(\"access_token\");\nvar requestApi = appConfig.baseEnv;\n\nvar reloadhttp = {\n    getLoginUser: function getLoginUser(callback) {\n        return fetch.get('restful/user/getLoginUser', {}, '', callback);\n    },\n    getUserAllModuleMenus: function getUserAllModuleMenus(callback) {}\n};\nmodule.exports = reloadhttp;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(29)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/pqs_ipCollectAdd_8b92981c0b5af20d64ef.js","/*\r\n * @name: \\pcs\\ipCollect.js\r\n * @url: http://git.evun.cn/GMES/GMES_CLIENT_PAD\r\n * @author: EVUN前端组\r\n * @modify: kelichao\r\n * @update: 2017-06-13\r\n * @decript: 关重件补录 LB37724SXHX680029\r\n */\r\n\r\nvar reloadfetch = require('reloadfetch');\r\nvar app = require('app');\r\nvar util = require('util');\r\nvar ipCollectAddCtrl = {\r\n\tpage: undefined,\r\n\tselectRow: null,\r\n\tselectRowData: null,\r\n\tinitTable: null,\r\n\ttable: null,\r\n\tsupplierText: null,\r\n\ttableAllDataFirst: undefined,\r\n\tundoInfByStation: undefined,\r\n\tundoCountAll: undefined,\r\n\ttableCountAll: undefined,\r\n\tstationOccupy: undefined,\r\n\tbeforeInit: function () {\r\n\t\t$(document).off(\"keydown\");\r\n\t\tvar _this = this;\r\n\t\treloadfetch.getLoginUser(function (data) {\r\n\t\t\t_this.userCode = data.data.userCode;\r\n\t\t}).done(function () {\r\n\t\t\t_this.init();\r\n\t\t});\r\n\t},\r\n\tinit: function () { //init初始化\r\n\t\tvar _this = this;\r\n\t\tutil.setBreadcrumb([i18next.t(\"KEYPART.T.MENU_ADDITIONAL\")]);// 关重件采集补录\r\n\t\tutil.translate(_this.page);\r\n\t\tthis.$undoCount = $(\"#currentNum\", this.page);\r\n\t\tthis.$allCount = $(\"#allNum\", this.page);\r\n\t\tthis.$productmark = $(\"#productmark\", this.page);\r\n\t\tthis.$lotBarCodeInput = $(\"#lotBarCodeInput\", this.page);\r\n\r\n\t\tthis.onload();\r\n\t\tthis.productmark();\r\n\t\tthis.lotBarCodeInputEvent();\r\n\t\tthis.loadPage();\r\n\t},\r\n\tloadPage: function () {\r\n\t\tvar _this = this;\r\n\t\t//初始化光标显示在产品标识中\r\n\t\t$('#productmark').focus();\r\n\t\t_this.removeSubmitEvent();\r\n\t\tvar scrollY = (_this.page.height - 158 - 30);\r\n\t\t_this.$table = $('.table-panel table', _this.page);\r\n\t\t_this.table = $('.table-panel table', _this.page).DataTable({\r\n\t\t\t\"serverSide\": false,\r\n\t\t\t\"paging\": false, //分页效果取消\r\n\t\t\t\"searching\": false, //查找效果取消\r\n\t\t\t\"scrollY\": scrollY, // 滚动高度为零\r\n\t\t\t\"order\": [],\r\n\t\t\t\"data\": [],\r\n\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\r\n\t\t\t\"columns\": [{\r\n\t\t\t\t\"data\": \"keypartCode\",\r\n\t\t\t\t\"name\": \"keypartCode\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function (data, type, row) {\r\n\t\t\t\t\treturn '<span class=\"ipCollect-component-value\">' + row.keypartCode + '</span>';\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t\"className\": \"supplierCode\",\r\n\t\t\t\t\"data\": \"supplierCode\",\r\n\t\t\t\t\"name\": \"supplierCode\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function (data, type, row) {\r\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-supplier-value ipCollect-open-picker\">' + (row.supplierCode || \"\") + '</a>';\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t\"className\": \"supplierCode\",\r\n\t\t\t\t\"data\": \"lotNum\",\r\n\t\t\t\t\"name\": \"lotNum\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function (data, type, row) {\r\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-batch-value  ipCollect-open-picker\">' + (row.lotNum || \"\") + '</a>';\r\n\t\t\t\t}\r\n\r\n\t\t\t}, {\r\n\t\t\t\t\"data\": \"keypartText\",\r\n\t\t\t\t\"name\": \"keypartText\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t}, {\r\n\t\t\t\t\"data\": \"supplierText\",\r\n\t\t\t\t\"name\": \"supplierText\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t}, {\r\n\t\t\t\t\"name\": \"remove\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function () {\r\n\t\t\t\t\treturn \"<button class='cancel' >\" + i18next.t('KEYPART.B.REPEAL') + \"</button>\";\r\n\t\t\t\t}\r\n\t\t\t}],\r\n\t\t\t\"rowCallback\": function (row, data) {\r\n\t\t\t\t$(row).find(\"td:last-child button\").on(\"click\", function (e) {\r\n\t\t\t\t\t_this.selectRow = _this.table.row(row);\r\n\t\t\t\t\tvar data = _this.selectRow.data();\r\n\t\t\t\t\tif (!$(row).hasClass('invalid')) {\r\n\t\t\t\t\t\tif ($(this).parent().parent().find(\"td:eq(1) a\").text() || $(this).parent().parent().find(\"td:eq(2) a\").text()) {\r\n\t\t\t\t\t\t\tdata[\"lotBarCode\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"lotNum\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"supplierCode\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"supplierText\"] = \"\";\r\n\t\t\t\t\t\t\t//重新渲染数据让移除按钮可用\r\n\t\t\t\t\t\t\t_this.table.row(row).data(data).draw();\r\n\t\t\t\t\t\t\tvar statusEcodeOld = data.statusEcode;\r\n\t\t\t\t\t\t\tdata.statusEcode = 0;\r\n\t\t\t\t\t\t\t//填入最后一行\r\n\t\t\t\t\t\t\tvar rowIndex = _this.selectRow.index();\r\n\t\t\t\t\t\t\tvar tableRow = _this.table.data().toArray();\r\n\t\t\t\t\t\t\ttableRow.splice(rowIndex, 1);\r\n\t\t\t\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\t\t\t\tvar tableDataFirst = tableRow.length > 1 ? tableRow[0] : undefined;\r\n\t\t\t\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\t\t\t\ttableRow.splice(0, 1);\r\n\t\t\t\t\t\t\t\ttableRow.push(tableDataFirst);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// tableRow.push(data);\r\n\t\t\t\t\t\t\ttableRow.unshift(data);\r\n\t\t\t\t\t\t\t_this.table.clear();\r\n\r\n\t\t\t\t\t\t\t_this.undoCount++;\r\n\t\t\t\t\t\t\t// _this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t\t\t\t$(row).children().removeClass('error');\r\n\t\t\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn'); //加类判断删除条目\r\n\t\t\t\t\t\t\t_this.table.rows.add(tableRow).draw();\r\n\t\t\t\t\t\t\tvar countChange; //已采数量改变标记\r\n\t\t\t\t\t\t\tif (statusEcodeOld > 0) {\r\n\t\t\t\t\t\t\t\tcountChange = -1;\r\n\t\t\t\t\t\t\t\t_this.undoInfByStationCheck(data.stationCode, -1);\t// 站点数量统计检查\r\n\t\t\t\t\t\t\t\tif (_this.stationOccupy) {\r\n\t\t\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[_this.stationOccupy].undoCount);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcountChange = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\r\n\t\t\t\t\t\t\tif (countChange != 0) {\r\n\t\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\r\n\t\t\t\t\t\t\t\tvar stationCode = data.stationCode;\r\n\t\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode] && _this.alternateRelation[stationCode][keypartCode]) {\r\n\t\t\t\t\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[stationCode][keypartCode].alternateForGroup;\r\n\t\t\t\t\t\t\t\t\t_this.alternateRelation[stationCode][keypartAlternateGroup].count += countChange;\r\n\t\t\t\t\t\t\t\t\tvar invalidFlag;\r\n\t\t\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode][keypartAlternateGroup].count >= _this.alternateRelation[stationCode][keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\t\t\t\t\tinvalidFlag = true;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tinvalidFlag = false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t_this.table.rows(function (idx, data) {\r\n\t\t\t\t\t\t\t\t\t\treturn (data.alternateGroup === keypartAlternateGroup) && (data.stationCode === stationCode) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\r\n\t\t\t\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\t\t\t\td.invalid = invalidFlag;\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (data.statusEcode == \"2\") {\r\n\t\t\t\t\t$(row).children().addClass('error');\r\n\t\t\t\t\t$(row).children('td').children('button').addClass('delBtn'); //加类判断删除条目\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(row).children().removeClass('error');\r\n\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn'); //加类判断删除条目\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (data.invalid == true) {\r\n\t\t\t\t\t$(row).addClass(\"invalid\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(row).removeClass(\"invalid\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (data.hideFliterByStation === true) {\r\n\t\t\t\t\t$(row).addClass(\"hideFliterByStation\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(row).removeClass(\"hideFliterByStation\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// 点击一行，从下侧弹出可修改的弹出框\r\n\t\t$(\"tbody\", _this.$table).on(\"click\", \"tr:not(.invalid)\", function () {\r\n\t\t\t_this.selectRow = _this.table.row(this);\r\n\t\t\tvar data = _this.selectRow.data();\r\n\t\t\t$(\"#ipCollect-component\", _this.page).val(data[\"keypartCode\"]);\r\n\t\t\t$(\"#ipCollect-batchNumber\", _this.page).val(data[\"lotNum\"]);\r\n\t\t\t$(\"#ipCollect-supplier\", _this.page).val(data[\"supplierCode\"]);\r\n\t\t\t_this.initData();\r\n\t\t\tmyApp.pickerModal($(\".picker-modal\", _this.page));\r\n\t\t\t$('.masked').css('display', 'block'); //确认按钮隐藏遮罩层\r\n\r\n\t\t});\r\n\r\n\t\t//点击罩层触发\r\n\t\t$('.masked').on('click', function () {\r\n\t\t\t$(this).css('display', 'none');\r\n\t\t});\r\n\r\n\t\t$('.close-picker').on('click', function () {\r\n\t\t\t_this.pickermodalclose('#lotBarCodeInput');\r\n\t\t});\r\n\r\n\t\t//点击确认按钮回显数据\r\n\t\t$('.ipCollect-confirm').on('click', function () {\r\n\t\t\t$('.masked').css('display', 'none'); //确认按钮隐藏遮罩层\r\n\t\t\tvar rowData = _this.selectRow.data();\r\n\t\t\tvar rowIndex = _this.selectRow.index();\r\n\t\t\tvar statusEcodeOld = rowData.statusEcode;\r\n\t\t\tvar statusEcodeNew;\r\n\t\t\tvar countChange; //已采数量改变标记\r\n\t\t\trowData.supplierCode = $('input:radio[name=\"provider\"]:checked').val() || \"\";\r\n\t\t\trowData.lotNum = $(\"#ipCollect-batchNumber\").val().toUpperCase() || \"\";\r\n\t\t\trowData.supplierText = $('input:radio[name=\"provider\"]:checked').next().children('span').text() || \"\";\r\n\t\t\tvar materialSupplierCondition;\r\n\t\t\tif (rowData.subAssemblyFlag != 1 && rowData.supplierCode !== \"\") { //分装标识为0，且供应商不为空，\r\n\t\t\t\tapp.request({\r\n\t\t\t\t\turl: \"restful/service/execute\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART011\",\r\n\t\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\t\tmaterialCode: _this.selectRow.data().keypartCode,\r\n\t\t\t\t\t\tsupplierCode: rowData.supplierCode\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\t\tutil.rightCode(response, judgeMaterialSupplierCondition);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfunction judgeMaterialSupplierCondition(response) {\r\n\t\t\t\t\tif (response.data == true) {\r\n\t\t\t\t\t\tmaterialSupplierCondition = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaterialSupplierCondition = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsaveToTable();\r\n\t\t\t\t}\r\n\t\t\t} else if (rowData.subAssemblyFlag == 1 && rowData.supplierCode !== \"\") {\r\n\t\t\t\tmaterialSupplierCondition = true;\r\n\t\t\t\tsaveToTable();\r\n\t\t\t} else {\r\n\t\t\t\tmaterialSupplierCondition = false;\r\n\t\t\t\tsaveToTable();\r\n\t\t\t}\r\n\r\n\t\t\tfunction saveToTable() {\r\n\t\t\t\tif (rowData.supplierCode === \"\" && rowData.lotNum === \"\") { //供应商和批次条码都为空，为未采，状态0\r\n\t\t\t\t\tstatusEcodeNew = 0;\r\n\t\t\t\t} else if (rowData.supplierCode !== \"\" && materialSupplierCondition == true && rowData.lotNum !== \"\") { //供应商和批次条码都不为空，为已采正常，状态1\r\n\t\t\t\t\tstatusEcodeNew = 1;\r\n\t\t\t\t} else { //供应商和批次条码有一个为空，为已采异常，状态2\r\n\t\t\t\t\tstatusEcodeNew = 2;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ((statusEcodeOld == 0 || !statusEcodeOld || statusEcodeOld == \"\") && statusEcodeNew > 0) {\r\n\t\t\t\t\tcountChange = 1;\r\n\t\t\t\t} else if (statusEcodeOld > 0 && statusEcodeNew == 0) {\r\n\t\t\t\t\tcountChange = -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcountChange = 0;\r\n\t\t\t\t}\r\n\t\t\t\trowData.statusEcode = statusEcodeNew;\r\n\r\n\t\t\t\t_this.table.row(rowIndex).data(rowData).draw();\r\n\r\n\t\t\t\t//填充的行换到第一行\r\n\t\t\t\tvar tableData = _this.table.data().toArray();\r\n\t\t\t\ttableData.splice(rowIndex, 1);\r\n\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\r\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\ttableData.splice(0, 1);\r\n\t\t\t\t\ttableData.push(tableDataFirst);\r\n\t\t\t\t}\r\n\t\t\t\ttableData.unshift(rowData);\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(tableData).draw();\r\n\t\t\t\t_this.$table.parent().scrollTop(0);\r\n\r\n\t\t\t\t_this.undoCount -= countChange;\r\n\t\t\t\t// _this.$undoCount.text(_this.undoCount);\r\n\r\n\t\t\t\tvar keypartCode = rowData.keypartCode;\r\n\t\t\t\tvar stationCode = rowData.stationCode;\r\n\t\t\t\t_this.undoInfByStationCheck(stationCode, countChange);\t// 站点数量统计检查\r\n\t\t\t\tif (_this.stationOccupy) {\r\n\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[_this.stationOccupy].undoCount);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t}\r\n\t\t\t\tif (_this.alternateRelation[stationCode] && _this.alternateRelation[stationCode][keypartCode]) {\r\n\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[stationCode][keypartCode].alternateForGroup;\r\n\t\t\t\t\t_this.alternateRelation[stationCode][keypartAlternateGroup].count += countChange;\r\n\t\t\t\t\tvar invalidFlag;\r\n\t\t\t\t\tif (_this.alternateRelation[stationCode][keypartAlternateGroup].count >= _this.alternateRelation[stationCode][keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\tinvalidFlag = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tinvalidFlag = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_this.table.rows(function (idx, data) {\r\n\t\t\t\t\t\treturn (data.alternateGroup === keypartAlternateGroup) && (data.stationCode === stationCode) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t}).every(function () {\r\n\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\td.invalid = invalidFlag;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//站点统计数据过滤的渲染\r\n\t\t$('.boxPage').on('click', '.box', function () {\r\n\t\t\tvar div = $(this);\r\n\t\t\tif (!div.hasClass('focusGray')) {\r\n\t\t\t\tdiv.parents().find('div.focusGray').removeClass('focusGray');\r\n\t\t\t\tdiv.addClass('focusGray');\r\n\t\t\t\tvar station = div.attr('station');\r\n\t\t\t\tif (station) {\r\n\t\t\t\t\t_this.stationOccupy = station;\r\n\t\t\t\t\t_this.table.rows().every(function () {\r\n\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\tif (d.stationCode === station) {\r\n\t\t\t\t\t\t\td.hideFliterByStation = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\td.hideFliterByStation = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t_this.$allCount.text(_this.undoInfByStation[station].total);\r\n\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[station].undoCount);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_this.stationOccupy = false;\r\n\t\t\t\t\t_this.table.rows().every(function () {\r\n\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\td.hideFliterByStation = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t_this.$allCount.text(_this.tableCountAll);\r\n\t\t\t\t\t_this.$undoCount.text(_this.undoCountAll);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tonload: function () {\r\n\t\t$('.ipCollect-cancel').on('click', function () {\r\n\t\t\t$('.masked').css('display', 'none'); //取消按钮隐藏遮罩层\r\n\t\t});\r\n\t},\r\n\tproductmark: function () {\r\n\t\tvar _this = this;\r\n\t\tvar $productmark = $(\"#productmark\", _this.page);\r\n\t\t$productmark.keyup(function (event) {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif (reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t\tif (event.keyCode == 13) {\r\n\t\t\t\tvar productNum = $productmark.val();\r\n\t\t\t\t$('#ipCollectAdd-querySiteRender').empty();\r\n\t\t\t\t$('.stationNum').text(\"\");\r\n\r\n\t\t\t\tif (productNum) {\r\n\t\t\t\t\t$productmark.focus().select();\r\n\t\t\t\t\t_this.loadTableByProductNum();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutil.notify({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"产品标识不能为空\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_PRODUCT_NO_NOT_BE_NULL\")\r\n\t\t\t\t\t}, function () {\r\n\t\t\t\t\t\t$productmark.focus();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar $ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\r\n\t\t$ipCollectBatchNumber.keyup(function () {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif (reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tloadTableByProductNum: function () {\r\n\t\tvar _this = this;\r\n\t\tgetListDataFromServer();\r\n\r\n\t\t// 根据产品标识号获取扫描清单\r\n\t\tfunction getListDataFromServer() {\r\n\t\t\tutil.services({\r\n\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART003',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART003',\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\tproductNum: _this.$productmark.val().toUpperCase()\r\n\t\t\t\t},\r\n\t\t\t\tmessage: \"正在获取扫描清单\"\r\n\t\t\t})\r\n\t\t\t\t.done(function (response) {\r\n\t\t\t\t\t_this.tableAllDataFirst = response.data.first;\r\n\t\t\t\t\tutil.rightCode(response, createTable);\r\n\t\t\t\t})\r\n\t\t\t\t.fail(function () {\r\n\t\t\t\t\tnotie.alert({ type: \"3\", text: \"解析失败！\" });\r\n\t\t\t\t\t_this.$productmark.focus().select();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction createTable(response) {\r\n\r\n\t\t\tvar data = response.data.list;\r\n\t\t\tvar dataLength = data.length;\r\n\t\t\t_this.First = response.data.first;\r\n\t\t\tif (dataLength <= 0) {\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_RECORDLIST_IS_EMPTY\")\r\n\t\t\t\t});\r\n\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\t_this.$productmark.focus().select();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t_this.undoInfByStation = {}; //加载数据时，初始化一个空的各站点数量统计关系，\r\n\t\t\tvar stationIndex = 0;\t//站点序号\r\n\t\t\t_this.addSubmitEvent();\r\n\t\t\tif (_this.First) {\r\n\t\t\t\tvar list = [];\r\n\t\t\t\tvar keypartCount = 0;\r\n\t\t\t\t_this.alternateRelation = {}; //加载数据时，初始化一个空的替代组关系对象，\r\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\tvar quantity = data[i].quantity;\r\n\t\t\t\t\tfor (var j = 0; j < quantity; j++) {\r\n\t\t\t\t\t\tvar keypart = {};\r\n\t\t\t\t\t\tkeypart = $.extend(keypart, data[i]);\r\n\t\t\t\t\t\tkeypart.supplierCode = \"\";\r\n\t\t\t\t\t\tkeypart.lotNum = \"\";\r\n\t\t\t\t\t\tlist.push(keypart);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 如果没有在关重件分站点数量统计关系中没有该站点的信息，则初始化一个\r\n\t\t\t\t\tif (!_this.undoInfByStation[data[i].stationCode]) {\r\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode] = {\r\n\t\t\t\t\t\t\tstationCode: data[i].stationCode,\r\n\t\t\t\t\t\t\tstationIndex: stationIndex,\r\n\t\t\t\t\t\t\tdoneCount: 0,\r\n\t\t\t\t\t\t\ttotal: 0\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tstationIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//如果此关重件有替代组，进行\r\n\t\t\t\t\tif (data[i].alternateGroup) {\r\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].stationCode]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 替代关系数量对象示例见页末\r\n\t\t\t\t\t\t// 有替代组的组件在替代组关系中维护关系对象，扫描数量中替代组只计算最大的一个，所以等维护好替代组关系之后再计算\r\n\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].keypartCode] = { //替代组关系中，维护一个关重件对象\r\n\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t// 如果已有关重件替代组，其数量取其中关重件数量最大的一个\r\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].stationCode][data[i].alternateGroup]) {\r\n\t\t\t\t\t\t\tif (quantity > _this.alternateRelation[data[i].stationCode][data[i].alternateGroup].maxCount) {\r\n\t\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup].maxCount = quantity;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else { // 如果没有关重件替代组，则新维护一个替代组对象\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup] = {\r\n\t\t\t\t\t\t\t\tisGroup: true,\r\n\t\t\t\t\t\t\t\tcount: 0,\r\n\t\t\t\t\t\t\t\tmaxCount: quantity\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 没有替代组的组件直接计算在扫描数量中\r\n\t\t\t\t\t\tkeypartCount += parseInt(quantity);\r\n\r\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode].total += parseInt(quantity);\t//无替代组关系，则将直接将该组件数量加到该站点统计数量上\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 关重件替代组数量加到扫描清单数量中去\r\n\t\t\t\tfor (var stationCode in _this.alternateRelation) {\r\n\t\t\t\t\tfor (var key in _this.alternateRelation[stationCode]) {\r\n\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].isGroup) {\r\n\t\t\t\t\t\t\tkeypartCount += parseInt(_this.alternateRelation[stationCode][key].maxCount);\r\n\t\t\t\t\t\t\t_this.undoInfByStation[stationCode].total += parseInt(_this.alternateRelation[stationCode][key].maxCount);\t//有替代组关系，则将直接将该替代组最大数量加到该站点统计数量上\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$allCount.text(keypartCount);\r\n\t\t\t\t_this.$undoCount.text(keypartCount);\r\n\r\n\t\t\t\t_this.undoCount = keypartCount;\r\n\t\t\t\t_this.tableCountAll = keypartCount;\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(list).draw();\r\n\t\t\t\t_this.$lotBarCodeInput.focus();\r\n\t\t\t} else {\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(data).draw();\r\n\t\t\t\tvar keypartCount = 0;\r\n\t\t\t\tvar validCount = 0; //扫描清单已扫数量\r\n\t\t\t\t_this.alternateRelation = {}; //加载数据时，初始化一个空的替代组关系对象，\r\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\t// 如果没有在关重件分站点数量统计关系中没有该站点的信息，则初始化一个\r\n\t\t\t\t\tif (!_this.undoInfByStation[data[i].stationCode]) {\r\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode] = {\r\n\t\t\t\t\t\t\tstationCode: data[i].stationCode,\r\n\t\t\t\t\t\t\tstationIndex: stationIndex,\r\n\t\t\t\t\t\t\tdoneCount: 0,\r\n\t\t\t\t\t\t\ttotal: 0\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tstationIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 扫描清单已扫数量计数\r\n\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\r\n\t\t\t\t\t\tvalidCount++;\r\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode].doneCount++;\t//已扫数量加到关重件分站点数量统计关系中该站点已扫数量上\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//如果此关重件有替代组，进行\r\n\t\t\t\t\tif (data[i].alternateGroup) {\r\n\t\t\t\t\t\t// 替代关系数量对象示例见页末\r\n\t\t\t\t\t\t// 有替代组的组件在替代组关系中维护关系对象，扫描数量中替代组只计算最大的一个，所以等维护好替代组关系之后再计算\r\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].stationCode]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 替代组关系中已有此关重件对象则计数统计\r\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].stationCode][data[i].keypartCode]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].keypartCode].maxCount += 1;\r\n\t\t\t\t\t\t} else { //替代组关系中没有此关重件对象则新维护一个关重件对象\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].keypartCode] = {\r\n\t\t\t\t\t\t\t\tmaxCount: 1,\r\n\t\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 如果没有关重件替代组，则新维护一个替代组对象，此最大数量取其中关重件数量中最大的一个，所以需要到维护好关重件对象再比较赋值\r\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].stationCode][data[i].alternateGroup]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup] = {\r\n\t\t\t\t\t\t\t\tisGroup: true,\r\n\t\t\t\t\t\t\t\tmaxCount: 0,\r\n\t\t\t\t\t\t\t\tcount: 0\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 替代组中已扫数量统计\r\n\t\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].stationCode][data[i].alternateGroup].count++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 没有替代组的组件直接计算在扫描数量中\r\n\t\t\t\t\t\tkeypartCount++;\r\n\t\t\t\t\t\t_this.undoInfByStation[data[i].stationCode].total++;\t//无替代组关系，则将直接将该组件数量加到该站点统计数量上\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 遍历替代组关系中关重件对象，设置关重件对象中数量最大值为替代组对象数量\r\n\t\t\t\tfor (var stationCode in _this.alternateRelation) {\r\n\t\t\t\t\tfor (var key in _this.alternateRelation[stationCode]) {\r\n\t\t\t\t\t\tif (!_this.alternateRelation[stationCode][key].isGroup) {\r\n\t\t\t\t\t\t\tvar alternateForGroup = _this.alternateRelation[stationCode][key].alternateForGroup;\r\n\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].maxCount > _this.alternateRelation[stationCode][alternateForGroup].maxCount) {\r\n\t\t\t\t\t\t\t\t_this.alternateRelation[stationCode][alternateForGroup].maxCount = _this.alternateRelation[stationCode][key].maxCount;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var stationCode in _this.alternateRelation) {\r\n\t\t\t\t\tfor (var key in _this.alternateRelation[stationCode]) {\r\n\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].isGroup) {\r\n\t\t\t\t\t\t\t// 关重件替代组数量加到扫描清单数量中去\r\n\t\t\t\t\t\t\tkeypartCount += _this.alternateRelation[stationCode][key].maxCount;\r\n\t\t\t\t\t\t\t// 如果该替代组数量已满，则将表格中其他未扫的关重件及替代组的扫描清单处置为灰色\r\n\t\t\t\t\t\t\tif (_this.alternateRelation[stationCode][key].count >= _this.alternateRelation[stationCode][key].maxCount) {\r\n\t\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\r\n\t\t\t\t\t\t\t\t\treturn (data.alternateGroup === key) && (data.stationCode === stationCode) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\r\n\t\t\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\t\t\td.invalid = true;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t_this.undoInfByStation[stationCode].total += parseInt(_this.alternateRelation[stationCode][key].maxCount);\t//有替代组关系，则将直接将该替代组最大数量加到该站点统计数量上\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.table.draw();\r\n\t\t\t\t_this.$allCount.text(keypartCount);\r\n\t\t\t\t_this.tableCountAll = keypartCount;\r\n\t\t\t\t_this.undoCount = keypartCount - validCount;\r\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t}\r\n\t\t\t_this.undoInfByStationRender();\r\n\t\t}\r\n\t\t$('#lotBarCodeInput').focus().select();\r\n\t},\r\n\tundoInfByStationRender: function () {\r\n\t\tvar _this = this;\r\n\t\t_this.undoCountAll = _this.undoCount;\r\n\t\t$(\".ipCollectAdd-Query-site-allnum .stationNum\").html(_this.undoCountAll);\r\n\t\tif (_this.undoCountAll <= 0) {\r\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").addClass(\"limegreen\");\r\n\t\t} else {\r\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").removeClass(\"limegreen\")\r\n\t\t}\r\n\r\n\t\tvar htmlTpl = $(\"#ipCollectAdd-countInfSiteTpl\").html();\r\n\t\tvar tpl = Template7.compile(htmlTpl);\r\n\t\tvar stationHtmlArray = [];\r\n\t\tfor (var stationCode in _this.undoInfByStation) {\r\n\t\t\t_this.undoInfByStation[stationCode].undoCount = _this.undoInfByStation[stationCode].total - _this.undoInfByStation[stationCode].doneCount;\r\n\t\t\tif (_this.undoInfByStation[stationCode].undoCount <= 0) {\r\n\t\t\t\t_this.undoInfByStation[stationCode].extClass = \"limegreen\";\r\n\t\t\t}\r\n\t\t\tstationHtmlArray[_this.undoInfByStation[stationCode].stationIndex] = tpl(_this.undoInfByStation[stationCode]);\r\n\t\t};\r\n\t\tvar stationHtmlString = stationHtmlArray.join(\"\");\r\n\t\t$(\"#ipCollectAdd-querySiteRender\").html(stationHtmlString);\r\n\t},\r\n\tundoInfByStationCheck: function (stationCode, countChange) {\r\n\t\tvar _this = this;\r\n\t\t_this.undoCountAll -= countChange;\r\n\t\t$(\".ipCollectAdd-Query-site-allnum .stationNum\").html(_this.undoCountAll);\r\n\t\tif (_this.undoCountAll <= 0) {\r\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").addClass(\"limegreen\");\r\n\t\t} else {\r\n\t\t\t$(\".ipCollectAdd-Query-site-allnum\").removeClass(\"limegreen\")\r\n\t\t}\r\n\r\n\t\t_this.undoInfByStation[stationCode].doneCount += countChange;\r\n\t\t_this.undoInfByStation[stationCode].undoCount -= countChange;\r\n\r\n\t\t$(\"[station=\" + stationCode + \"] \" + \"span\").html(_this.undoInfByStation[stationCode].undoCount);\r\n\t\tif (_this.undoInfByStation[stationCode].undoCount <= 0) {\r\n\t\t\t$(\"[station=\" + stationCode + \"]\").addClass(\"limegreen\");\r\n\t\t} else {\r\n\t\t\t$(\"[station=\" + stationCode + \"]\").removeClass(\"limegreen\");\r\n\t\t}\r\n\t},\r\n\tlotBarCodeInputEvent: function () {\r\n\t\tvar _this = this;\r\n\t\tvar $lotBarCodeInput = $(\"#lotBarCodeInput\", _this.page);\r\n\t\t$lotBarCodeInput.keyup(function (event) {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif (reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t\tif (event.keyCode == 13) {\r\n\t\t\t\tvar lotBarCode = $lotBarCodeInput.val();\r\n\t\t\t\tif (lotBarCode) {\r\n\t\t\t\t\t$lotBarCodeInput.focus().select();\r\n\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\tresolveLotBarCode(lotBarCode);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutil.notify({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"批次条码不能为空\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_NOT_BE_NULL\")\r\n\t\t\t\t\t}, function () {\r\n\t\t\t\t\t\t$lotBarCodeInput.focus();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction resolveLotBarCode(code) {\r\n\t\t\tutil.services({\r\n\t\t\t\turl: 'restful/service/execute',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART002',\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\tbarcode: code.toUpperCase()\r\n\t\t\t\t},\r\n\t\t\t\tmessage: \"请求中\"\r\n\t\t\t})\r\n\t\t\t.done(function (response) {\r\n\t\t\t\t\tutil.rightCode(response, dealKeypartCode);\r\n\t\t\t\t})\r\n\t\t\t.fail(function () {\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t// 批次条码没有按照{{length}}位的规则解析！\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ERROR\", {\r\n\t\t\t\t\t\tlength: code.length\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t});\r\n\t\t}\r\n\t\t// 根据返回的条码解析结果进行处理-数据填充，表格滚动，采集信息栏更新\r\n\t\tfunction dealKeypartCode(response) {\r\n\t\t\t// 根据条码解析结果进行处理\r\n\t\t\tvar returnData = response.data;\r\n\t\t\tvar keypartCode = returnData.materialCode;\r\n\t\t\t// 如果是有替代组的关重件或者替代组，则标记，并检查有替代组的关重件的已扫的关重件和替代组的数量已满，则提示，并退出\r\n\t\t\tvar keypartAlternateGroup;\r\n\t\t\tif (_this.alternateRelation[keypartCode]) {\r\n\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\r\n\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"无匹配数据！\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 根据返回的关重件物料编码选到对应的关重件\r\n\t\t\tvar rowSelect = _this.table.row(function (idx, data) {\r\n\t\t\t\treturn data.keypartCode === keypartCode && data.invalid != true && data.statusEcode != 1 && data.statusEcode != 2 ?\r\n\t\t\t\t\ttrue : false;\r\n\t\t\t});\r\n\r\n\t\t\tvar rowSelectMatch = _this.table.row(function (idx, data, node) {\r\n\t\t\t\treturn data.keypartCode === keypartCode && (data.statusEcode == 1 || data.statusEcode == 2) ?\r\n\t\t\t\t\ttrue : false;\r\n\t\t\t});\r\n\r\n\t\t\tvar rowData = rowSelect.data();\r\n\t\t\tvar rowMatchData = rowSelectMatch.data();\r\n\t\t\tif (rowData) {\r\n\t\t\t\t// 将对应的关重件的供应商和批次进行填充\r\n\t\t\t\trowData.supplierCode = returnData.supplierCode;\r\n\t\t\t\trowData.lotNum = returnData.lotNum;\r\n\t\t\t\trowData.supplierText = returnData.supplierText;\r\n\t\t\t\tif (returnData.valid) {\r\n\t\t\t\t\trowData.statusEcode = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trowData.statusEcode = 2;\r\n\t\t\t\t}\r\n\t\t\t\t//填充的行换到第一行\r\n\t\t\t\tvar rowIndex = rowSelect.index();\r\n\t\t\t\tvar tableData = _this.table.data().toArray();\r\n\t\t\t\ttableData.splice(rowIndex, 1);\r\n\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\r\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\ttableData.splice(0, 1);\r\n\t\t\t\t\ttableData.push(tableDataFirst);\r\n\t\t\t\t}\r\n\t\t\t\ttableData.unshift(rowData);\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(tableData).draw();\r\n\t\t\t\t// _this.$table.parent().scrollTop(0);\r\n\r\n\t\t\t\t// 扫描成功的提示扫描数据成功\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\t// text: \"扫描数据成功\"\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ANALYSE_SUCCESS\")\r\n\t\t\t\t});\r\n\t\t\t\t_this.undoCount--;\r\n\t\t\t\tvar stationCode = rowData.stationCode;\r\n\t\t\t\t_this.undoInfByStationCheck(stationCode, 1);\r\n\t\t\t\tif (_this.stationOccupy) {\r\n\t\t\t\t\t_this.$undoCount.text(_this.undoInfByStation[_this.stationOccupy].undoCount);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t}\r\n\t\t\t\tvar keypartAlternateGroup;\r\n\t\t\t\tif (_this.alternateRelation[stationCode] && _this.alternateRelation[stationCode][keypartCode]) {\r\n\t\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[stationCode][keypartCode].alternateForGroup;\r\n\t\t\t\t}\r\n\t\t\t\t// 如果是替代组或有替代组的关重件，则增加替代组关系表中关重件的已扫计数，如果数量已满，则将表格中其他未扫的关重件及替代组的扫描清单处置为灰色\r\n\t\t\t\tif (keypartAlternateGroup) {\r\n\t\t\t\t\t_this.alternateRelation[stationCode][keypartAlternateGroup].count++;\r\n\t\t\t\t\tif (_this.alternateRelation[stationCode][keypartAlternateGroup].count >= _this.alternateRelation[stationCode][keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\t_this.table.rows(function (idx, data) {\r\n\t\t\t\t\t\t\treturn (data.alternateGroup === keypartAlternateGroup) && (data.stationCode === stationCode) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t}).every(function () {\r\n\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\td.invalid = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus(); // 批次条码解析正常，批次条码清空\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar contentMsg = i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\");\r\n\t\t\t\tif (rowMatchData) {\r\n\t\t\t\t\tcontentMsg = \"重复扫描！\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t// text: \"无匹配数据！\"\r\n\t\t\t\t\ttext: contentMsg\r\n\t\t\t\t});\r\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t},\r\n\tinitData: function () {\r\n\t\tvar _this = this;\r\n\t\tvar rowData = _this.selectRow.data();\r\n\t\t$(\"#supplierListRender\", _this.page).on('click', '.content label', function () {\r\n\t\t\t$(\".batch-input\").focus();\r\n\t\t});\r\n\t\tapp.request({\r\n\t\t\turl: \"restful/service/execute\",\r\n\t\t\tdata: {\r\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART006\",\r\n\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\tmaterialCode: rowData.keypartCode\r\n\t\t\t},\r\n\t\t\tsuccess: function (response) {\r\n\t\t\t\tutil.rightCode(response, ListRender);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction ListRender(response) {\r\n\t\t\tvar renderData = {\r\n\t\t\t\t// supplierLabel: \"供应商\",\r\n\t\t\t\tsupplierLabel: i18next.t(\"KEYPART.T.SUPPLIER\"),\r\n\t\t\t\tsupplierList: response.data\r\n\t\t\t};\r\n\t\t\tutil.tplManager(\"supplierListTpl\", renderData, \"supplierListRender\");\r\n\t\t\t// 如果供应商列表中有上个页面传过来的供应商，则该供应商默认选中\r\n\t\t\tvar fromSupplierCode = rowData.supplierCode;\r\n\t\t\tif (fromSupplierCode) {\r\n\t\t\t\t$(\"input[name='provider'][value=\" + fromSupplierCode + \"]\").attr(\"checked\", true);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\theaderEvent: function () {\r\n\t\tvar _this = this;\r\n\t\t$('.head-confirm').on('click', function () {\r\n\t\t\tsaveDataToServer();\r\n\t\t\tfunction saveDataToServer() {\r\n\t\t\t\t// 按接口格式生成需要的参数\r\n\t\t\t\tvar param = {\r\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART015\",\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\t// stationCode: _this.station.stationCode,\r\n\t\t\t\t\tproductNum: _this.$productmark.val().toUpperCase(),\r\n\t\t\t\t\tcreateUser: _this.userCode,\r\n\t\t\t\t\tmodifyUser: _this.userCode,\r\n\t\t\t\t\tsubAssemblyFlag: 0\r\n\t\t\t\t};\r\n\t\t\t\tvar tableData = _this.table.data();\r\n\t\t\t\tvar dataLength = tableData.length;\r\n\t\t\t\tif (dataLength <= 0) {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"无提交数据！\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_NO_DATA_TO_SUBMIT\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.$productmark.focus().select();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\tvar tableDataI = tableData[i];\r\n\r\n\t\t\t\t\t// if(tableDataI.notNullFlag == 1 && tableDataI.invalid != true && (tableDataI.statusEcode == \"\" || tableDataI.statusEcode == null || !(tableDataI.statusEcode))) {\r\n\t\t\t\t\tif ((tableDataI.notNullFlag == 1) && (tableDataI.invalid != true) && (tableDataI.statusEcode != 1) && (tableDataI.statusEcode != 2)) {\r\n\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t\t// text: \"XXX 数据不能为空\"\r\n\t\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_HAVE_NOT_NULL_DATA_SUBMIT\", {\r\n\t\t\t\t\t\t\t\tkeypartCode: tableDataI.keypartCode\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (var key in tableDataI) {\r\n\t\t\t\t\t\tif (tableDataI.hasOwnProperty(key)) {\r\n\t\t\t\t\t\t\tif ([\"createDate\", \"createDateTime\", \"modifyDate\", \"modifyDateTime\", \"invalid\", \"hideFliterByStation\"].indexOf(key) < 0) {\r\n\t\t\t\t\t\t\t\tvar keyNew = \"items[\" + i + \"].\" + key;\r\n\t\t\t\t\t\t\t\tif (key == \"statusEcode\" && (tableDataI[key] == \"\" || tableDataI[key] == null || !(tableDataI[key]))) {\r\n\t\t\t\t\t\t\t\t\tparam[keyNew] = 0;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tparam[keyNew] = tableDataI[key];\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (_this.undoCount > 0) {\r\n\t\t\t\t\tmyApp.confirm('数据录入不完整，确定要提交？', function () {\r\n\t\t\t\t\t\tsubmitConfirm();\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsubmitConfirm();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction submitConfirm() {\r\n\t\t\t\t\t// // 接入数据\r\n\t\t\t\t\tmyApp.showPreloader(\"数据保存中...\");\r\n\t\t\t\t\tapp.request({\r\n\t\t\t\t\t\turl: 'restful/service/execute',\r\n\t\t\t\t\t\tdata: param,\r\n\t\t\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\t\t\tutil.rightCode(response, saveDataSuccess);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function () {\r\n\t\t\t\t\t\t\tmyApp.hidePreloader();\r\n\t\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t\t\t// text: \"保存数据失败\"\r\n\t\t\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_FAILURE\")\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction saveDataSuccess() {\r\n\t\t\t\t\tmyApp.hidePreloader();\r\n\t\t\t\t\tutil.notify({\r\n\t\t\t\t\t\t// text: \"保存数据成功\"\r\n\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_SUCCESS\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.removeSubmitEvent();\r\n\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\t}, 3000);\r\n\t\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\t\t_this.$allCount.text(0);\r\n\t\t\t\t\t_this.$undoCount.text(0);\r\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\r\n\t\t\t\t\t_this.$productmark.val(\"\").focus();\r\n\t\t\t\t\t$('#ipCollectAdd-querySiteRender').empty();\r\n\t\t\t\t\t$('.stationNum').text(\"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\taddSubmitEvent: function () {\r\n\t\t$('.head-confirm').css('background', '#00adee');\r\n\t\tthis.headerEvent();\r\n\t},\r\n\tremoveSubmitEvent: function () {\r\n\t\t$('.head-confirm').off();\r\n\t\t$('.head-confirm').css('background', '#CCC');\r\n\t},\r\n\tpickermodalclose: function (inputSelector) {\r\n\t\tinputSelector && document.querySelector(inputSelector) && document.querySelector(inputSelector).focus();\r\n\t}\r\n};\r\n\r\nmodule.exports = ipCollectAddCtrl;\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/pqs/ipCollectAdd.js","var fetch = require('./util');\r\nvar access_token=sessionStorage.getItem(\"access_token\");\r\nvar requestApi = appConfig.baseEnv;\r\n\r\nvar reloadhttp = {\r\n    getLoginUser:function(callback){\r\n        return fetch.get('restful/user/getLoginUser',{},'',callback);\r\n    },\r\n    getUserAllModuleMenus:function(callback){\r\n\r\n    }\r\n};\r\nmodule.exports = reloadhttp;\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/utils/reloadfetch.js"],"sourceRoot":""}