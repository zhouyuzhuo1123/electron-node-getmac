webpackJsonp([23],{638:function(e,t,n){"use strict";(function(t,u){var i=n(38),o=function(e){return e&&e.__esModule?e:{default:e}}(i),s=n(78),c=n(34),a=n(35),r=a.getSiteCode(),d=".u-queuingSure",l={moduleConfig:{configCodes:[],rowNum:"",stationCode:"",title:""}},g={config:{siteCode:r,pageNum:0,getNum:8,urlDetail:"GMES-CLIENT-PCS0011",urlHistory:"GMES-CLIENT-PCS0012",urlSure:"GMES-CLIENT-PCS0013"},data:{productionQueues:[{configEnums:[],productNum:"--",productId:"--",carDescription:"--",remarkremark:"--"}],dln:"--",lsn:"--"},send:{configEnums:[{configCode:"YB",configText:"",valueText:"",fileName:""},{configCode:"ZYB",configText:"",valueText:"",fileName:""}]},init:function(){this.config.pageNum=0,c.translate(this.page),c.setZoom(this.page),this.initData(),this.initEvent(),this.remoteKey()},initEvent:function(){var e=this;new s.View({initialize:function(){},current:t("#queuingMultipleIndication"),events:{".u-quePage a:eq(0)":"prevPage",".u-quePage a:eq(1)":"nextPage",".u-refresh":"refresh",".u-queuingSure:not(.u-queue-disabled)":"sure",".m-product-table tbody tr:has(input[type=checkbox])":"selectTr"},eventsFunction:{selectTr:function(n){var u=t(this),i=u.find("input[type=checkbox]");u.addClass("u-selected").siblings().removeClass("u-selected"),t(".m-sure-cont a").removeClass("u-selected"),!0===i.is(":checked")?(i.attr("checked",!1),u.removeClass("checked-tr")):(i.attr("checked",!0),u.addClass("checked-tr")),e.setSureStatus()},prevPage:function(){e.setPageAndRender(-1)},nextPage:function(){e.setPageAndRender(1)},refresh:function(){e.setPageAndRender(!0)},sure:function(){var n,u=[],i={siteCode:e.config.siteCode,productNum:""};t.extend(i,l.moduleConfig);var s=e.getCheckedArr();t.each(s,function(e,n){var o=t.extend({},i);o.productNum=t(n).find(".productNum").attr("data"),o.productionSeqNum=t(n).find(".productId").attr("data"),u.push(o)}),n={subassemblyOnlinesJson:(0,o.default)(u)},c.service(e.config.urlSure,n,"正在确认...").done(function(){e.initData()})}}})},selectItem:function(e){var n=t(".u-selected").index(".can-select"),u=t(".can-select").length,i=n+e;i>=u&&(i=0),t(".u-selected").removeClass("u-selected"),t(".can-select").eq(i).addClass("u-selected")},remoteKey:function(){var e=this,n={38:function(){e.selectItem(-1)},40:function(){e.selectItem(1)},37:function(){return s.throttle(function(){t(".u-quePage a:eq(0)").trigger("click")})}(),39:function(){return s.throttle(function(){t(".u-quePage a:eq(1)").trigger("click")})}(),13:function(){t(".u-selected").trigger("click")}};t(document).on("keydown",function(e){n[e.keyCode]&&n[e.keyCode]()})},setSureStatus:function(){this.getCheckedArr().length>0?t(d).removeClass("u-queue-disabled"):t(d).addClass("u-queue-disabled")},getCheckedArr:function(){return t(".m-product-table tr input[type=checkbox]:checked").parents("tr")},setPageNum:function(e){!0===e?this.config.pageNum=0:this.config.pageNum+=e,t(".u-queue-now").html(this.config.pageNum)},setPageAndRender:function(e){var n=this;this.setPageNum(e),this.getTableData(l.moduleConfig).then(function(){n.setSureStatus()}),t(".can-select").removeClass("u-selected"),t(".u-refresh").addClass("u-selected")},initData:function(){var e=this;a.getSysModuleConfig("PCS","QUEUING_MULTIPLE_INDICATION").done(function(t){c.proConfig(t,function(t){l.moduleConfig=t,e.setPageAndRender(0)})})},getTableData:function(e){var n=this,u=this.config.pageNum>=0?this.config.urlDetail:this.config.urlHistory,i={pageNum:this.config.pageNum,getNum:this.config.getNum,siteCode:this.config.siteCode,stNum:2,num:l.moduleConfig.rowNum};return e=t.extend(e,i),c.service(u,e,"正在加载中").done(function(e){n.ajaxSucc(e)})},setTotalAndHis:function(e){var n=e.dln,u=e.lsn;t.isNumeric(n)&&(n>0&&n--,t(".u-queue-total").html(n),t(".u-queue-history").html(-u))},ajaxSucc:function(e){var n=this;s.triggerSuccessEvun({response:e,haveData:function(e){var u=e.productionQueues||e.subassemblyOnlineDTOs;if(0!==u.length){var i={};u=u.map(function(e){return e.productId=e.productId||e.productionSeqNum,e}),n.setTotalAndHis(e),i.item=u,i.canCheckFlag=0===n.config.pageNum,c.tplManager("queuingMultipleTpl",i,"m-product-tobdy")}else n.setTotalAndHis(e),t(".m-product-table tbody").html("<tr><td colspan='4'>暂无数据</td></tr>")},noData:function(){u.alert({type:"1",text:"请求错误 "+e.errorMessage})}})}};e.exports=g}).call(t,n(4),n(36))}});
//# sourceMappingURL=pcs_queuingMultipleIndication_6bba4719c797e0a5f56e.js.map