{"version":3,"sources":["webpack:///assets/js/pages/pqs_keyComponentsOfPackagingMakeup_fb6c5cbc594fb2e2d94b.js","webpack:///./src/js/pages/pqs/keyComponentsOfPackagingMakeup.js","webpack:///./src/js/utils/reloadfetch.js"],"names":["webpackJsonp","650","module","exports","__webpack_require__","$","i18next","app","notie","util","keyComponentsOfPackagingMakeupCtrl","selectRow","selectRowData","initTable","page","undefined","$undoCount","$allCount","undoCount","table","printBtnUnable","recordStationCode","init","_this","this","translate","$productmark","$lotBarCodeInput","$printBtn","loadPage","setBreadcrumb","t","addClass","productmark","lotBarCodeInputEvent","printBtnEvent","focus","removeSubmitEvent","scrollY","height","$table","DataTable","serverSide","paging","searching","order","data","dom","columns","name","orderable","render","type","row","keypartCode","className","supplierCode","lotNum","rowCallback","index","find","on","e","hasClass","parent","text","statusEcodeOld","statusEcode","rowIndex","tableRow","toArray","splice","tableDataFirst","length","push","unshift","clear","children","removeClass","rows","add","draw","countChange","alternateRelation","keypartAlternateGroup","alternateForGroup","count","invalidFlag","maxCount","idx","node","alternateGroup","every","rowIdx","tableLoop","rowLoop","invalid","stopPropagation","val","initData","myApp","pickerModal","css","pickermodalclose","pickerAndMaskedEvent","saveToTable","statusEcodeNew","rowData","materialSupplierCondition","tableData","scrollTop","nodes","to$","toUpperCase","supplierText","next","subAssemblyFlag","judgeMaterialSupplierCondition","response","request","url","serviceCode","siteCode","materialCode","success","rightCode","click","alert","subAssemblyNum","trim","stationCode","keyPartCode","returnCode","console","log","error","loadTableByProductNum","createTable","list","First","first","dataLength","addSubmitEvent","keypartCount","i","quantity","j","keypart","extend","isGroup","parseInt","key","validCount","subAssemblyBarcode","select","keyup","event","reg","test","value","replace","keyCode","notify","resolveLotBarCode","code","barcode","dealKeypartCode","returnData","rowSelect","rowSelectMatch","rowMatchData","valid","contentMsg","lotBarCode","remove","query","ListRender","renderData","supplierLabel","supplierList","tplManager","fromSupplierCode","attr","headerEvent","submitConfirm","showPreloader","param","saveDataSuccess","hidePreloader","setTimeout","createUser","userCode","modifyUser","tableDataI","notNullFlag","hasOwnProperty","indexOf","keyNew","confirm","currentRowData","supplier","batch","off","inputSelector","document","querySelector","call","666","appConfig","fetch","reloadhttp","sessionStorage","getItem","baseEnv","getLoginUser","callback","get","getUserAllModuleMenus"],"mappings":"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","file":"assets/js/pages/pqs_keyComponentsOfPackagingMakeup_fb6c5cbc594fb2e2d94b.js","sourcesContent":["webpackJsonp([5],{\n\n/***/ 650:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, i18next, app, notie) {\n\nvar security = __webpack_require__(35);\nvar util = __webpack_require__(34);\nvar reloadfetch = __webpack_require__(666);\nvar keyComponentsOfPackagingMakeupCtrl = {\n\tselectRow: null,\n\tselectRowData: null,\n\tinitTable: null,\n\tpage: undefined,\n\t$undoCount: undefined,\n\t$allCount: undefined,\n\tundoCount: 0,\n\ttable: null,\n\tprintBtnUnable: true,\n\trecordStationCode: undefined,\n\tinit: function init() {\n\t\tvar _this = this;\n\t\tutil.translate(_this.page);\n\t\tthis.$undoCount = $(\"#currentNum\", this.page);\n\t\tthis.$allCount = $(\"#allNum\", this.page);\n\t\tthis.$productmark = $(\"#productmark\", this.page);\n\t\tthis.$lotBarCodeInput = $(\"#lotBarCodeInput\", this.page);\n\t\tthis.$printBtn = $(\"#printBtn\", this.page);\n\n\t\t_this.loadPage();\n\t\tutil.setBreadcrumb([i18next.t(\"KEYPART.T.MENU_SUBASSEMBLY_ADDITIONAL\")]);\n\n\t\t_this.printBtnUnable = true;\n\t\t_this.$printBtn.addClass(\"btnDisabled\");\n\t\tthis.productmark();\n\t\tthis.lotBarCodeInputEvent();\n\n\t\tthis.printBtnEvent();\n\t},\n\tloadPage: function loadPage() {\n\t\tvar _this = this;\n\n\t\t$('#productmark').focus();\n\t\t_this.removeSubmitEvent();\n\n\t\tvar scrollY = this.page.height - 158 - 53;\n\t\t_this.$table = $('.table-panel table', _this.page);\n\t\t_this.table = $('#myTable', _this.page).DataTable({\n\t\t\t\"serverSide\": false,\n\t\t\t\"paging\": false,\n\t\t\t\"searching\": false,\n\t\t\t\"scrollY\": scrollY,\n\t\t\t\"order\": [],\n\t\t\t\"data\": [],\n\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\n\t\t\t\"columns\": [{\n\t\t\t\t\"data\": \"keypartCode\",\n\t\t\t\t\"name\": \"keypartCode\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<span class=\"ipCollect-component-value\">' + row.keypartCode + '</span>';\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t\"className\": \"supplierCode\",\n\t\t\t\t\"data\": \"supplierCode\",\n\t\t\t\t\"name\": \"supplierCode\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-supplier-value ipCollect-open-picker\">' + (row.supplierCode || \"\") + '</a>';\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t\"className\": \"supplierCode\",\n\t\t\t\t\"data\": \"lotNum\",\n\t\t\t\t\"name\": \"lotNum\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-batch-value  ipCollect-open-picker\">' + (row.lotNum || \"\") + '</a>';\n\t\t\t\t}\n\n\t\t\t}, {\n\t\t\t\t\"data\": \"keypartText\",\n\t\t\t\t\"name\": \"keypartText\",\n\t\t\t\t\"orderable\": false\n\n\t\t\t}, {\n\t\t\t\t\"data\": \"supplierText\",\n\t\t\t\t\"name\": \"supplierText\",\n\t\t\t\t\"orderable\": false\n\t\t\t}, {\n\t\t\t\t\"name\": \"remove\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn \"<button class='cancel' >\" + i18next.t('KEYPART.B.REPEAL') + \"</button>\";\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"rowCallback\": function rowCallback(row, data, index) {\n\t\t\t\t$(row).find(\"td:last-child button\").on(\"click\", function (e) {\n\t\t\t\t\t_this.selectRow = _this.table.row(row);\n\t\t\t\t\tvar data = _this.selectRow.data();\n\t\t\t\t\tif (!$(row).hasClass('invalid')) {\n\t\t\t\t\t\tif ($(this).parent().parent().find(\"td:eq(1) a\").text() || $(this).parent().parent().find(\"td:eq(2) a\").text()) {\n\t\t\t\t\t\t\tdata[\"lotBarCode\"] = \"\";\n\t\t\t\t\t\t\tdata[\"lotNum\"] = \"\";\n\t\t\t\t\t\t\tdata[\"supplierCode\"] = \"\";\n\t\t\t\t\t\t\tdata[\"supplierText\"] = \"\";\n\t\t\t\t\t\t\tvar statusEcodeOld = data.statusEcode;\n\t\t\t\t\t\t\tdata.statusEcode = 0;\n\n\t\t\t\t\t\t\tvar rowIndex = _this.selectRow.index();\n\t\t\t\t\t\t\tvar tableRow = _this.table.data().toArray();\n\t\t\t\t\t\t\ttableRow.splice(rowIndex, 1);\n\n\t\t\t\t\t\t\tvar tableDataFirst = tableRow.length > 1 ? tableRow[0] : undefined;\n\t\t\t\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\t\t\t\ttableRow.splice(0, 1);\n\t\t\t\t\t\t\t\ttableRow.push(tableDataFirst);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttableRow.unshift(data);\n\n\t\t\t\t\t\t\t_this.table.clear();\n\n\t\t\t\t\t\t\t_this.undoCount++;\n\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t\t\t\t\t$(row).children().removeClass('error');\n\t\t\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\n\t\t\t\t\t\t\t_this.table.rows.add(tableRow).draw();\n\n\t\t\t\t\t\t\tvar countChange;\n\t\t\t\t\t\t\tif (statusEcodeOld > 0) {\n\t\t\t\t\t\t\t\tcountChange = -1;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcountChange = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\n\t\t\t\t\t\t\tif (_this.alternateRelation[keypartCode]) {\n\t\t\t\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\n\t\t\t\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\n\t\t\t\t\t\t\t\tvar invalidFlag;\n\t\t\t\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\t\t\t\tinvalidFlag = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tinvalidFlag = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\n\t\t\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\t\t\td.invalid = invalidFlag;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t});\n\t\t\t\tif (data.statusEcode == \"2\") {\n\t\t\t\t\t$(row).children().addClass('error');\n\t\t\t\t\t$(row).children('td').children('button').addClass('delBtn');\n\t\t\t\t} else {\n\t\t\t\t\t$(row).children().removeClass('error');\n\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\n\t\t\t\t}\n\n\t\t\t\tif (data.invalid == true) {\n\t\t\t\t\t$(row).addClass(\"invalid\");\n\t\t\t\t} else {\n\t\t\t\t\t$(row).removeClass(\"invalid\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(\"tbody\", _this.$table).on(\"click\", \"tr:not(.invalid)\", function () {\n\t\t\t_this.selectRow = _this.table.row(this);\n\t\t\tvar data = _this.selectRow.data();\n\t\t\t$(\"#kcopc-component\", _this.page).val(data[\"keypartCode\"]);\n\t\t\t$(\"#kcopc-batchNumber\", _this.page).val(data[\"lotNum\"]);\n\t\t\t$(\"#ipCollect-supplier\", _this.page).val(data[\"supplierCode\"]);\n\t\t\t_this.initData();\n\t\t\tmyApp.pickerModal($(\".picker-modal\", _this.page));\n\t\t\t$('.masked').css('display', 'block');\n\t\t});\n\n\t\t$('.masked').on('click', function () {\n\t\t\t$(this).css('display', 'none');\n\t\t});\n\t\t$('.close-picker').on('click', function (e) {\n\t\t\t_this.pickermodalclose('#lotBarCodeInput');\n\t\t});\n\t\t$('#myTable').on('init.dt', function () {\n\t\t\t_this.pickerAndMaskedEvent();\n\t\t});\n\n\t\t$('.ipCollect-confirm').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t\tvar rowData = _this.selectRow.data();\n\t\t\tvar rowIndex = _this.selectRow.index();\n\t\t\tvar statusEcodeOld = rowData.statusEcode;\n\t\t\tvar statusEcodeNew;\n\t\t\tvar countChange;\n\t\t\trowData.supplierCode = $('input:radio[name=\"provider\"]:checked').val() || \"\";\n\t\t\trowData.lotNum = $(\"#ipCollect-batchNumber\").val().toUpperCase() || \"\";\n\t\t\trowData.supplierText = $('input:radio[name=\"provider\"]:checked').next().children('span').text() || \"\";\n\t\t\tvar materialSupplierCondition;\n\t\t\tif (rowData.subAssemblyFlag != 1 && rowData.supplierCode !== \"\") {\n\t\t\t\tvar judgeMaterialSupplierCondition = function judgeMaterialSupplierCondition(response) {\n\t\t\t\t\tif (response.data == true) {\n\t\t\t\t\t\tmaterialSupplierCondition = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmaterialSupplierCondition = false;\n\t\t\t\t\t}\n\t\t\t\t\tsaveToTable();\n\t\t\t\t};\n\n\t\t\t\tapp.request({\n\t\t\t\t\turl: \"restful/service/execute\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART011\",\n\t\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\t\tmaterialCode: _this.selectRow.data().keypartCode,\n\t\t\t\t\t\tsupplierCode: rowData.supplierCode\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\t\tutil.rightCode(response, judgeMaterialSupplierCondition);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (rowData.subAssemblyFlag == 1 && rowData.supplierCode !== \"\") {\n\t\t\t\tmaterialSupplierCondition = true;\n\t\t\t\tsaveToTable();\n\t\t\t} else {\n\t\t\t\tmaterialSupplierCondition = false;\n\t\t\t\tsaveToTable();\n\t\t\t}\n\n\t\t\tfunction saveToTable() {\n\t\t\t\tif (rowData.supplierCode === \"\" && rowData.lotNum === \"\") {\n\t\t\t\t\tstatusEcodeNew = 0;\n\t\t\t\t} else if (rowData.supplierCode !== \"\" && materialSupplierCondition == true && rowData.lotNum !== \"\") {\n\t\t\t\t\tstatusEcodeNew = 1;\n\t\t\t\t} else {\n\t\t\t\t\tstatusEcodeNew = 2;\n\t\t\t\t}\n\n\t\t\t\tif ((statusEcodeOld == 0 || !statusEcodeOld || statusEcodeOld == \"\") && statusEcodeNew > 0) {\n\t\t\t\t\tcountChange = 1;\n\t\t\t\t} else if (statusEcodeOld > 0 && statusEcodeNew == 0) {\n\t\t\t\t\tcountChange = -1;\n\t\t\t\t} else {\n\t\t\t\t\tcountChange = 0;\n\t\t\t\t}\n\t\t\t\trowData.statusEcode = statusEcodeNew;\n\n\t\t\t\t_this.table.row(rowIndex).data(rowData).draw();\n\n\t\t\t\tvar tableData = _this.table.data().toArray();\n\t\t\t\ttableData.splice(rowIndex, 1);\n\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\ttableData.splice(0, 1);\n\t\t\t\t\ttableData.push(tableDataFirst);\n\t\t\t\t}\n\t\t\t\ttableData.unshift(rowData);\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(tableData).draw();\n\t\t\t\t_this.$table.parent().scrollTop(0);\n\n\t\t\t\t_this.undoCount -= countChange;\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\n\t\t\t\tvar keypartCode = rowData.keypartCode;\n\t\t\t\tif (_this.alternateRelation[keypartCode]) {\n\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\n\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t}).nodes().to$().addClass(\"invalid\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t}).nodes().to$().removeClass(\"invalid\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$('.close-picker').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t});\n\t},\n\n\tprintBtnEvent: function printBtnEvent() {\n\t\tvar _this = this;\n\t\t_this.$printBtn.click(function () {\n\t\t\tif (_this.printBtnUnable) {\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttext: \"打印占用中或无站点信息！\"\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar subAssemblyNum = $.trim(_this.$productmark.val());\n\t\t\tif (subAssemblyNum != \"\") {\n\t\t\t\t_this.printBtnUnable = true;\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\n\t\t\t\tapp.request({\n\t\t\t\t\turl: \"restful/service/execute\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART017\",\n\t\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\t\tstationCode: _this.recordStationCode,\n\t\t\t\t\t\tkeyPartCode: subAssemblyNum.toUpperCase()\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\t\t_this.printBtnUnable = false;\n\t\t\t\t\t\t_this.$printBtn.removeClass(\"btnDisabled\");\n\n\t\t\t\t\t\tif (response.returnCode == \"0\") {\n\t\t\t\t\t\t\tconsole.log(subAssemblyNum + \" 打印成功！\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnotie.alert({\n\n\t\t\t\t\t\t\t\ttext: \"打印失败\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\terror: function error() {\n\t\t\t\t\t\t_this.printBtnUnable = false;\n\t\t\t\t\t\t_this.$printBtn.removeClass(\"btnDisabled\");\n\n\t\t\t\t\t\tnotie.alert({\n\n\t\t\t\t\t\t\ttext: \"打印失败\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_SUBASSEMBLY_BARCODE_NO_NOT_BE_NULL\")\n\t\t\t\t});\n\t\t\t\t_this.$productmark.focus();\n\t\t\t}\n\t\t});\n\t},\n\tloadTableByProductNum: function loadTableByProductNum() {\n\t\tvar _this = this;\n\t\tapp.request({\n\t\t\turl: 'restful/service/execute',\n\t\t\tdata: {\n\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART012',\n\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\tsubAssemblyBarcode: _this.$productmark.val().toUpperCase()\n\t\t\t},\n\t\t\tsuccess: function success(response) {\n\t\t\t\tutil.rightCode(response, createTable);\n\t\t\t},\n\t\t\terror: function error() {\n\t\t\t\tnotie.alert({\n\n\t\t\t\t\ttext: \"解析失败\"\n\t\t\t\t});\n\t\t\t\t_this.printBtnUnable = true;\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\n\t\t\t\t_this.$productmark.focus().select();\n\t\t\t}\n\t\t});\n\t\tfunction createTable(response) {\n\t\t\tvar data = response.data.list;\n\t\t\t_this.First = response.data.first;\n\t\t\tvar dataLength = data.length;\n\t\t\tif (dataLength <= 0) {\n\t\t\t\tnotie.alert({\n\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_RECORDLIST_IS_EMPTY\")\n\t\t\t\t});\n\t\t\t\t_this.printBtnUnable = true;\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\n\t\t\t\t_this.table.clear().draw();\n\t\t\t\t_this.$productmark.val(\"\").focus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t_this.addSubmitEvent();\n\t\t\t_this.recordStationCode = data[0].stationCode;\n\t\t\tif (!_this.recordStationCode || _this.recordStationCode === \"\") {\n\t\t\t\t_this.printBtnUnable = true;\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\n\t\t\t} else {\n\t\t\t\t_this.printBtnUnable = false;\n\t\t\t\t_this.$printBtn.removeClass(\"btnDisabled\");\n\t\t\t}\n\t\t\tif (_this.First) {\n\t\t\t\tvar list = [];\n\t\t\t\tvar keypartCount = 0;\n\t\t\t\t_this.alternateRelation = {};\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tvar quantity = data[i].quantity;\n\t\t\t\t\tfor (var j = 0; j < quantity; j++) {\n\t\t\t\t\t\tvar keypart = {};\n\t\t\t\t\t\tkeypart = $.extend(keypart, data[i]);\n\t\t\t\t\t\tkeypart.supplierCode = \"\";\n\t\t\t\t\t\tkeypart.lotNum = \"\";\n\t\t\t\t\t\tlist.push(keypart);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data[i].alternateGroup) {\n\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = {\n\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].alternateGroup]) {\n\t\t\t\t\t\t\tif (quantity > _this.alternateRelation[data[i].alternateGroup].maxCount) {\n\t\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].maxCount = quantity;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\n\t\t\t\t\t\t\t\tisGroup: true,\n\t\t\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\t\t\tmaxCount: quantity\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tkeypartCount += parseInt(quantity);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var key in _this.alternateRelation) {\n\t\t\t\t\tif (_this.alternateRelation[key].isGroup) {\n\t\t\t\t\t\tkeypartCount += parseInt(_this.alternateRelation[key].maxCount);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$allCount.text(keypartCount);\n\t\t\t\t_this.$undoCount.text(keypartCount);\n\n\t\t\t\t_this.undoCount = keypartCount;\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(list).draw();\n\t\t\t\t_this.$lotBarCodeInput.focus();\n\t\t\t} else {\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(data).draw();\n\t\t\t\tvar keypartCount = 0;\n\t\t\t\tvar validCount = 0;\n\t\t\t\t_this.alternateRelation = {};\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\n\t\t\t\t\t\tvalidCount++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data[i].alternateGroup) {\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].keypartCode]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode].maxCount += 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = {\n\t\t\t\t\t\t\t\tmaxCount: 1,\n\t\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].alternateGroup]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\n\t\t\t\t\t\t\t\tisGroup: true,\n\t\t\t\t\t\t\t\tmaxCount: 0,\n\t\t\t\t\t\t\t\tcount: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].count++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tkeypartCount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var key in _this.alternateRelation) {\n\t\t\t\t\tif (!_this.alternateRelation[key].isGroup) {\n\t\t\t\t\t\tvar alternateForGroup = _this.alternateRelation[key].alternateForGroup;\n\t\t\t\t\t\tif (_this.alternateRelation[key].maxCount > _this.alternateRelation[alternateForGroup].maxCount) {\n\t\t\t\t\t\t\t_this.alternateRelation[alternateForGroup].maxCount = _this.alternateRelation[key].maxCount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var key in _this.alternateRelation) {\n\t\t\t\t\tif (_this.alternateRelation[key].isGroup) {\n\t\t\t\t\t\tkeypartCount += _this.alternateRelation[key].maxCount;\n\n\t\t\t\t\t\tif (_this.alternateRelation[key].count >= _this.alternateRelation[key].maxCount) {\n\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\t\treturn data.alternateGroup === key && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\n\t\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\t\td.invalid = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$allCount.text(keypartCount);\n\t\t\t\t_this.undoCount = keypartCount - validCount;\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t}\n\t\t\t$(\"#lotBarCodeInput\", _this.page).focus();\n\t\t};\n\t},\n\tproductmark: function productmark() {\n\t\tvar _this = this;\n\t\tvar $productmark = $(\"#productmark\", _this.page);\n\t\t$productmark.keyup(function (event) {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t\tif (event.keyCode == 13) {\n\t\t\t\tvar productNum = $productmark.val();\n\t\t\t\tif (productNum) {\n\t\t\t\t\t$productmark.focus().select();\n\t\t\t\t\t_this.loadTableByProductNum();\n\t\t\t\t} else {\n\t\t\t\t\tutil.notify({\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_SUBASSEMBLY_BARCODE_NO_NOT_BE_NULL\")\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t$productmark.focus();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tvar $ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\n\t\t$ipCollectBatchNumber.keyup(function (e) {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t});\n\t},\n\tlotBarCodeInputEvent: function lotBarCodeInputEvent() {\n\t\tvar _this = this;\n\t\tvar $lotBarCodeInput = $(\"#lotBarCodeInput\", _this.page);\n\t\t$lotBarCodeInput.keyup(function (event) {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t\tif (event.keyCode == 13) {\n\t\t\t\tvar lotBarCode = $lotBarCodeInput.val();\n\t\t\t\tif (lotBarCode) {\n\t\t\t\t\t$lotBarCodeInput.focus().select();\n\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\tresolveLotBarCode(lotBarCode);\n\t\t\t\t} else {\n\t\t\t\t\tutil.notify({\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_NOT_BE_NULL\")\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t$lotBarCodeInput.focus();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfunction resolveLotBarCode(code) {\n\t\t\tapp.request({\n\t\t\t\turl: 'restful/service/execute',\n\t\t\t\tdata: {\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART002',\n\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\tbarcode: code.toUpperCase()\n\t\t\t\t},\n\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\tutil.rightCode(response, dealKeypartCode);\n\t\t\t\t},\n\t\t\t\terror: function error() {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ERROR\", {\n\t\t\t\t\t\t\tlength: code.length\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction dealKeypartCode(response) {\n\t\t\tvar returnData = response.data;\n\t\t\tvar keypartCode = returnData.materialCode;\n\n\t\t\tvar keypartAlternateGroup;\n\t\t\tif (_this.alternateRelation[keypartCode]) {\n\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\n\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\tnotie.alert({\n\n\t\t\t\t\t\ttext: \"组件数量已满！\"\n\t\t\t\t\t});\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar rowSelect = _this.table.row(function (idx, data, node) {\n\t\t\t\treturn data.keypartCode === keypartCode && data.invalid != true && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t});\n\t\t\tvar rowSelectMatch = _this.table.row(function (idx, data, node) {\n\t\t\t\treturn data.keypartCode === keypartCode && (data.statusEcode == 1 || data.statusEcode == 2) ? true : false;\n\t\t\t});\n\n\t\t\tvar rowData = rowSelect.data();\n\t\t\tvar rowMatchData = rowSelectMatch.data();\n\t\t\tif (rowData) {\n\t\t\t\trowData.supplierCode = returnData.supplierCode;\n\t\t\t\trowData.lotNum = returnData.lotNum;\n\t\t\t\trowData.supplierText = returnData.supplierText;\n\t\t\t\tif (returnData.valid) {\n\t\t\t\t\trowData.statusEcode = 1;\n\t\t\t\t} else {\n\t\t\t\t\trowData.statusEcode = 2;\n\t\t\t\t}\n\n\t\t\t\tvar rowIndex = rowSelect.index();\n\t\t\t\tvar tableData = _this.table.data().toArray();\n\t\t\t\ttableData.splice(rowIndex, 1);\n\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\ttableData.splice(0, 1);\n\t\t\t\t\ttableData.push(tableDataFirst);\n\t\t\t\t}\n\t\t\t\ttableData.unshift(rowData);\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(tableData).draw();\n\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ANALYSE_SUCCESS\")\n\t\t\t\t});\n\n\t\t\t\t_this.undoCount--;\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\n\t\t\t\tif (keypartAlternateGroup) {\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count++;\n\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\n\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\td.invalid = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus();\n\t\t\t} else {\n\t\t\t\tvar contentMsg = i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\");\n\t\t\t\tif (rowMatchData) {\n\t\t\t\t\tcontentMsg = \"重复扫描！\";\n\t\t\t\t}\n\t\t\t\tnotie.alert({\n\n\t\t\t\t\ttext: contentMsg\n\t\t\t\t});\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t}\n\t\t}\n\t},\n\tinitData: function initData(query) {\n\t\tvar _this = this;\n\t\tvar rowData = _this.selectRow.data();\n\t\t$(\"#supplierListRender\", _this.page).on('click', '.content label', function () {\n\t\t\t$(\".batch-input\").focus();\n\t\t});\n\t\tapp.request({\n\t\t\turl: \"restful/service/execute\",\n\t\t\tdata: {\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART006\",\n\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\tmaterialCode: rowData.keypartCode\n\t\t\t},\n\t\t\tsuccess: function success(response) {\n\t\t\t\tutil.rightCode(response, ListRender);\n\t\t\t}\n\t\t});\n\n\t\tfunction ListRender(response) {\n\t\t\tvar renderData = {\n\t\t\t\tsupplierLabel: i18next.t(\"KEYPART.T.SUPPLIER\"),\n\t\t\t\tsupplierList: response.data\n\t\t\t};\n\t\t\tapp.tplManager(\"supplierListTpl\", renderData, \"supplierListRender\");\n\n\t\t\tvar fromSupplierCode = rowData.supplierCode;\n\t\t\tif (fromSupplierCode) {\n\t\t\t\t$(\"input[name='provider'][value=\" + fromSupplierCode + \"]\").attr(\"checked\", true);\n\t\t\t}\n\t\t}\n\t},\n\theaderEvent: function headerEvent() {\n\t\tvar _this = this;\n\t\t$('.head-confirm').on('click', function () {\n\t\t\tsaveDataToServer();\n\t\t\tfunction saveDataToServer() {\n\t\t\t\tvar param = {\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART016\",\n\t\t\t\t\tsiteCode: app.siteCode,\n\n\t\t\t\t\tsubAssemblyBarcode: _this.$productmark.val().toUpperCase(),\n\t\t\t\t\tcreateUser: _this.userCode,\n\t\t\t\t\tmodifyUser: _this.userCode,\n\t\t\t\t\tsubAssemblyFlag: 1\n\t\t\t\t};\n\t\t\t\tvar tableData = _this.table.data();\n\t\t\t\tvar dataLength = tableData.length;\n\n\t\t\t\tif (dataLength <= 0) {\n\t\t\t\t\tnotie.alert({\n\n\t\t\t\t\t\ttext: \"无提交数据！\"\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tvar tableDataI = tableData[i];\n\n\t\t\t\t\tif (tableDataI.notNullFlag == 1 && tableDataI.invalid != true && tableDataI.statusEcode != 1 && tableDataI.statusEcode != 2) {\n\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_HAVE_NOT_NULL_DATA_SUBMIT\", {\n\t\t\t\t\t\t\t\tkeypartCode: tableDataI.keypartCode\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var key in tableDataI) {\n\t\t\t\t\t\tif (tableDataI.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tif ([\"createDate\", \"createDateTime\", \"modifyDate\", \"modifyDateTime\", \"invalid\"].indexOf(key) < 0) {\n\t\t\t\t\t\t\t\tvar keyNew = \"items[\" + i + \"].\" + key;\n\t\t\t\t\t\t\t\tif (key == \"statusEcode\" && (tableDataI[key] == \"\" || tableDataI[key] == null || !tableDataI[key])) {\n\t\t\t\t\t\t\t\t\tparam[keyNew] = 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tparam[keyNew] = tableDataI[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (_this.undoCount > 0) {\n\t\t\t\t\tmyApp.confirm('数据录入不完整，确定要提交？', function () {\n\t\t\t\t\t\tsubmitConfirm();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsubmitConfirm();\n\t\t\t\t}\n\n\t\t\t\tfunction submitConfirm() {\n\t\t\t\t\tmyApp.showPreloader(\"数据保存中...\");\n\t\t\t\t\tapp.request({\n\t\t\t\t\t\turl: 'restful/service/execute',\n\t\t\t\t\t\tdata: param,\n\t\t\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\t\t\tutil.rightCode(response, saveDataSuccess);\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: function error() {\n\t\t\t\t\t\t\tmyApp.hidePreloader();\n\t\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_FAILURE\")\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tfunction saveDataSuccess() {\n\t\t\t\t\tmyApp.hidePreloader();\n\t\t\t\t\tutil.notify({\n\t\t\t\t\t\ttext: \"保存数据成功\"\n\t\t\t\t\t});\n\t\t\t\t\t_this.removeSubmitEvent();\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\t}, 3000);\n\t\t\t\t\t_this.table.clear().draw();\n\t\t\t\t\t_this.$allCount.text(0);\n\t\t\t\t\t_this.$undoCount.text(0);\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\n\t\t\t\t\t_this.$productmark.val(\"\").focus();\n\t\t\t\t};\n\t\t\t};\n\t\t});\n\t},\n\tpickerAndMaskedEvent: function pickerAndMaskedEvent() {\n\t\tvar _this = this;\n\n\t\t$(\".cancel\").on('click', function () {\n\t\t\tvar currentRowData = _this.table.row($(this).parent().parent()).data();\n\t\t\tcurrentRowData.supplier = \"\";\n\t\t\tcurrentRowData.batch = \"\";\n\t\t\t_this.table.row($(this).parent().parent()).data(currentRowData);\n\t\t\t$(this).addClass('error');\n\t\t});\n\n\t\t$('.close-picker').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t});\n\t},\n\taddSubmitEvent: function addSubmitEvent() {\n\t\t$('.head-confirm').css('background', '#00adee');\n\t\tthis.headerEvent();\n\t},\n\tremoveSubmitEvent: function removeSubmitEvent() {\n\t\t$('.head-confirm').off();\n\t\t$('.head-confirm').css('background', '#CCC');\n\t},\n\tpickermodalclose: function pickermodalclose(inputSelector) {\n\t\tinputSelector && document.querySelector(inputSelector) && document.querySelector(inputSelector).focus();\n\t}\n};\n\nmodule.exports = keyComponentsOfPackagingMakeupCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(37), __webpack_require__(77), __webpack_require__(36)))\n\n/***/ }),\n\n/***/ 666:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(appConfig) {\n\nvar fetch = __webpack_require__(34);\nvar access_token = sessionStorage.getItem(\"access_token\");\nvar requestApi = appConfig.baseEnv;\n\nvar reloadhttp = {\n    getLoginUser: function getLoginUser(callback) {\n        return fetch.get('restful/user/getLoginUser', {}, '', callback);\n    },\n    getUserAllModuleMenus: function getUserAllModuleMenus(callback) {}\n};\nmodule.exports = reloadhttp;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(29)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/pqs_keyComponentsOfPackagingMakeup_fb6c5cbc594fb2e2d94b.js","var security = require(\"security\");\r\nvar util = require('util');\r\nvar reloadfetch = require('reloadfetch');\r\nvar keyComponentsOfPackagingMakeupCtrl = {\r\n\tselectRow: null,\r\n\tselectRowData: null,\r\n\tinitTable: null,\r\n\tpage: undefined,\r\n\t$undoCount: undefined,\r\n\t$allCount: undefined,\r\n\tundoCount: 0,\r\n\ttable: null,\r\n\tprintBtnUnable: true,\r\n\trecordStationCode: undefined,\r\n\tinit: function() { //init初始化\r\n\t\tvar _this = this;\r\n\t\tutil.translate(_this.page);\r\n\t\tthis.$undoCount = $(\"#currentNum\", this.page);\r\n\t\tthis.$allCount = $(\"#allNum\", this.page);\r\n\t\tthis.$productmark = $(\"#productmark\", this.page);\r\n\t\tthis.$lotBarCodeInput = $(\"#lotBarCodeInput\", this.page);\r\n\t\tthis.$printBtn = $(\"#printBtn\",this.page);\r\n\r\n\t//\t_this.userCode = security.getUserProfile().userCode; //获得用户信息\r\n\r\n\t\t_this.loadPage();\r\n\t\tutil.setBreadcrumb([i18next.t(\"KEYPART.T.MENU_SUBASSEMBLY_ADDITIONAL\")]);\r\n\r\n\t\t_this.printBtnUnable = true;\t// 初始化时，打印按钮不可用\r\n\t\t_this.$printBtn.addClass(\"btnDisabled\");\r\n\t\tthis.productmark();\r\n\t\tthis.lotBarCodeInputEvent();\r\n\t\t//this.headerEvent();\r\n\t\tthis.printBtnEvent();      //初始化时，打印按钮事件\r\n\t},\r\n\tloadPage: function() {\r\n\t\tvar _this = this;\r\n\t\t//初始化光标显示在产品标识中\r\n\t\t$('#productmark').focus();\r\n\t\t_this.removeSubmitEvent()\r\n\t\t//表格加载\r\n\t\tvar scrollY = (this.page.height - 158 - 53);\r\n\t\t_this.$table = $('.table-panel table', _this.page);\r\n\t\t_this.table = $('#myTable', _this.page).DataTable({\r\n\t\t\t\"serverSide\": false,\r\n\t\t\t\"paging\": false, //分页效果取消\r\n\t\t\t\"searching\": false, //查找效果取消\r\n\t\t\t\"scrollY\": scrollY, // 滚动高度为零\r\n\t\t\t\"order\": [],\r\n\t\t\t\"data\": [],\r\n\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\r\n\t\t\t\"columns\": [{\r\n\t\t\t\t\"data\": \"keypartCode\",\r\n\t\t\t\t\"name\": \"keypartCode\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function(data, type, row) {\r\n\t\t\t\t\treturn '<span class=\"ipCollect-component-value\">' + row.keypartCode + '</span>';\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t\"className\": \"supplierCode\",\r\n\t\t\t\t\"data\": \"supplierCode\",\r\n\t\t\t\t\"name\": \"supplierCode\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function(data, type, row) {\r\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-supplier-value ipCollect-open-picker\">' + (row.supplierCode || \"\") + '</a>';\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t\"className\": \"supplierCode\",\r\n\t\t\t\t\"data\": \"lotNum\",\r\n\t\t\t\t\"name\": \"lotNum\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function(data, type, row) {\r\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-batch-value  ipCollect-open-picker\">' + (row.lotNum || \"\") + '</a>';\r\n\t\t\t\t}\r\n\r\n\t\t\t}, {\r\n\t\t\t\t\"data\": \"keypartText\",\r\n\t\t\t\t\"name\": \"keypartText\",\r\n\t\t\t\t\"orderable\": false,\r\n\r\n\t\t\t}, {\r\n\t\t\t\t\"data\": \"supplierText\",\r\n\t\t\t\t\"name\": \"supplierText\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t}, {\r\n\t\t\t\t\"name\": \"remove\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function(data, type, row) {\r\n\t\t\t\t\treturn \"<button class='cancel' >\" + i18next.t('KEYPART.B.REPEAL') + \"</button>\";\r\n\t\t\t\t},\r\n\t\t\t}],\r\n\t\t\t\"rowCallback\": function(row, data, index) {\r\n\t\t\t\t$(row).find(\"td:last-child button\").on(\"click\", function(e) {\r\n\t\t\t\t\t_this.selectRow = _this.table.row(row);\r\n\t\t\t\t\tvar data = _this.selectRow.data();\r\n\t\t\t\t\tif(!$(row).hasClass('invalid')) {\r\n\t\t\t\t\t\tif($(this).parent().parent().find(\"td:eq(1) a\").text() || $(this).parent().parent().find(\"td:eq(2) a\").text()) {\r\n\t\t\t\t\t\t\tdata[\"lotBarCode\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"lotNum\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"supplierCode\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"supplierText\"] = \"\";\r\n\t\t\t\t\t\t\tvar statusEcodeOld = data.statusEcode;\r\n\t\t\t\t\t\t\tdata.statusEcode = 0;\r\n\t\t\t\t\t\t\t//填入最后一行\r\n\t\t\t\t\t\t\tvar rowIndex = _this.selectRow.index();\r\n\t\t\t\t\t\t\tvar tableRow = _this.table.data().toArray();\r\n\t\t\t\t\t\t\ttableRow.splice(rowIndex, 1);\r\n\t\t\t\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\t\t\t\tvar tableDataFirst = tableRow.length > 1 ? tableRow[0] : undefined;\r\n\t\t\t\t\t\t\tif(tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\t\t\t\ttableRow.splice(0, 1);\r\n\t\t\t\t\t\t\t\ttableRow.push(tableDataFirst);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttableRow.unshift(data);\r\n\t\t\t\t\t\t\t// tableRow.push(data);\r\n\t\t\t\t\t\t\t_this.table.clear();\r\n\r\n\t\t\t\t\t\t\t_this.undoCount++;\r\n\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t\t\t\t$(row).children().removeClass('error')\r\n\t\t\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn') //加类判断删除条目\r\n\t\t\t\t\t\t\t_this.table.rows.add(tableRow).draw();\r\n\r\n\t\t\t\t\t\t\tvar countChange; //已采数量改变标记\r\n\t\t\t\t\t\t\tif(statusEcodeOld > 0) {\r\n\t\t\t\t\t\t\t\tcountChange = -1;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcountChange = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\r\n\t\t\t\t\t\t\tif(_this.alternateRelation[keypartCode]) {\r\n\t\t\t\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\r\n\t\t\t\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\r\n\t\t\t\t\t\t\t\tvar invalidFlag;\r\n\t\t\t\t\t\t\t\tif(_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\t\t\t\tinvalidFlag = true;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinvalidFlag = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t_this.table.rows(function(idx, data, node) {\r\n\t\t\t\t\t\t\t\t\treturn(data.alternateGroup === keypartAlternateGroup) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t\t\t}).every(function(rowIdx, tableLoop, rowLoop) {\r\n\t\t\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\t\t\td.invalid = invalidFlag;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\te.stopPropagation()\r\n\r\n\t\t\t\t});\r\n\t\t\t\tif(data.statusEcode == \"2\") {\r\n\t\t\t\t\t$(row).children().addClass('error');\r\n\t\t\t\t\t$(row).children('td').children('button').addClass('delBtn');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(row).children().removeClass('error');\r\n\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(data.invalid == true) {\r\n\t\t\t\t\t$(row).addClass(\"invalid\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(row).removeClass(\"invalid\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t});\r\n\t\t// 点击一行，从下侧弹出可修改的弹出框\r\n\t\t$(\"tbody\", _this.$table).on(\"click\", \"tr:not(.invalid)\", function() {\r\n\t\t\t_this.selectRow = _this.table.row(this);\r\n\t\t\tvar data = _this.selectRow.data();\r\n\t\t\t$(\"#kcopc-component\", _this.page).val(data[\"keypartCode\"]);\r\n\t\t\t$(\"#kcopc-batchNumber\", _this.page).val(data[\"lotNum\"]);\r\n\t\t\t$(\"#ipCollect-supplier\", _this.page).val(data[\"supplierCode\"]);\r\n\t\t\t_this.initData();\r\n\t\t\tmyApp.pickerModal($(\".picker-modal\", _this.page));\r\n\t\t\t$('.masked').css('display', 'block'); //确认按钮隐藏遮罩层\r\n\t\t});\r\n\t\t//点击罩层触发\r\n\t\t$('.masked').on('click', function() {\r\n\t\t\t$(this).css('display', 'none');\r\n\t\t});\r\n\t\t$('.close-picker').on('click',function(e){\r\n        \t_this.pickermodalclose('#lotBarCodeInput')\r\n        })\r\n\t\t$('#myTable').on('init.dt', function() {\r\n\t\t\t_this.pickerAndMaskedEvent();\r\n\t\t});\r\n\r\n\t\t$('.ipCollect-confirm').on('click', function() {\r\n\t\t\t$('.masked').css('display', 'none'); //确认按钮隐藏遮罩层\r\n\t\t\tvar rowData = _this.selectRow.data();\r\n\t\t\tvar rowIndex = _this.selectRow.index()\r\n\t\t\tvar statusEcodeOld = rowData.statusEcode;\r\n\t\t\tvar statusEcodeNew;\r\n\t\t\tvar countChange; //已采数量改变标记\r\n\t\t\trowData.supplierCode = $('input:radio[name=\"provider\"]:checked').val() || \"\";\r\n\t\t\trowData.lotNum = $(\"#ipCollect-batchNumber\").val().toUpperCase() || \"\";\r\n\t\t\trowData.supplierText = $('input:radio[name=\"provider\"]:checked').next().children('span').text() || \"\";\r\n\t\t\tvar materialSupplierCondition;\r\n\t\t\tif(rowData.subAssemblyFlag != 1 && rowData.supplierCode !== \"\") { //分装标识为0，且供应商不为空，\r\n\t\t\t\tapp.request({\r\n\t\t\t\t\turl: \"restful/service/execute\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART011\",\r\n\t\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\t\tmaterialCode: _this.selectRow.data().keypartCode,\r\n\t\t\t\t\t\tsupplierCode: rowData.supplierCode\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function(response) {\r\n\t\t\t\t\t\tutil.rightCode(response, judgeMaterialSupplierCondition);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfunction judgeMaterialSupplierCondition(response) {\r\n\t\t\t\t\tif(response.data == true) {\r\n\t\t\t\t\t\tmaterialSupplierCondition = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaterialSupplierCondition = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsaveToTable();\r\n\t\t\t\t}\r\n\t\t\t} else if(rowData.subAssemblyFlag == 1 && rowData.supplierCode !== \"\") {\r\n\t\t\t\tmaterialSupplierCondition = true;\r\n\t\t\t\tsaveToTable();\r\n\t\t\t} else {\r\n\t\t\t\tmaterialSupplierCondition = false;\r\n\t\t\t\tsaveToTable();\r\n\t\t\t}\r\n\r\n\t\t\tfunction saveToTable() {\r\n\t\t\t\tif(rowData.supplierCode === \"\" && rowData.lotNum === \"\") { //供应商和批次条码都为空，为未采，状态0\r\n\t\t\t\t\tstatusEcodeNew = 0;\r\n\t\t\t\t} else if(rowData.supplierCode !== \"\" && materialSupplierCondition == true && rowData.lotNum !== \"\") { //供应商和批次条码都不为空，为已采正常，状态1\r\n\t\t\t\t\tstatusEcodeNew = 1;\r\n\t\t\t\t} else { //供应商和批次条码有一个为空，为已采异常，状态2\r\n\t\t\t\t\tstatusEcodeNew = 2;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif((statusEcodeOld == 0 || !statusEcodeOld || statusEcodeOld == \"\") && statusEcodeNew > 0) {\r\n\t\t\t\t\tcountChange = 1;\r\n\t\t\t\t} else if(statusEcodeOld > 0 && statusEcodeNew == 0) {\r\n\t\t\t\t\tcountChange = -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcountChange = 0;\r\n\t\t\t\t}\r\n\t\t\t\trowData.statusEcode = statusEcodeNew;\r\n\r\n\t\t\t\t_this.table.row(rowIndex).data(rowData).draw();\r\n\r\n\t\t\t\t//填充的行换到第一行\r\n\t\t\t\tvar tableData = _this.table.data().toArray();\r\n\t\t\t\ttableData.splice(rowIndex, 1);\r\n\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\r\n\t\t\t\tif(tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\ttableData.splice(0, 1);\r\n\t\t\t\t\ttableData.push(tableDataFirst);\r\n\t\t\t\t}\r\n\t\t\t\ttableData.unshift(rowData);\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(tableData).draw();\r\n\t\t\t\t_this.$table.parent().scrollTop(0);\r\n\r\n\t\t\t\t_this.undoCount -= countChange;\r\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\r\n\t\t\t\tvar keypartCode = rowData.keypartCode;\r\n\t\t\t\tif(_this.alternateRelation[keypartCode]) {\r\n\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\r\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\r\n\t\t\t\t\tif(_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\t_this.table.rows(function(idx, data, node) {\r\n\t\t\t\t\t\t\treturn(data.alternateGroup === keypartAlternateGroup) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t}).nodes().to$().addClass(\"invalid\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_this.table.rows(function(idx, data, node) {\r\n\t\t\t\t\t\t\treturn(data.alternateGroup === keypartAlternateGroup) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t}).nodes().to$().removeClass(\"invalid\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//确认隐藏遮罩层\r\n\t\t$('.close-picker').on('click', function() {\r\n\t\t\t$('.masked').css('display', 'none');\r\n\t\t})\r\n\t},\r\n\t// 分总成条码打印按钮\r\n\tprintBtnEvent: function () {\r\n\t\tvar _this = this;\r\n\t\t_this.$printBtn.click(function () {\r\n\t\t\tif(_this.printBtnUnable) {\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\ttext: \"打印占用中或无站点信息！\"\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar subAssemblyNum = $.trim(_this.$productmark.val());\r\n\t\t\tif(subAssemblyNum != \"\"){\r\n\t\t\t\t_this.printBtnUnable = true;\r\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\r\n\t\t\t\tapp.request({\r\n\t\t\t\t\turl:\"restful/service/execute\",\r\n\t\t\t\t\tdata : {\r\n\t\t\t\t\t\tserviceCode : \"GMES-CLIENT-KEYPART017\",\r\n\t\t\t\t\t\tsiteCode: app.siteCode,\r\n                        stationCode: _this.recordStationCode,\r\n\t\t\t\t\t\tkeyPartCode: subAssemblyNum.toUpperCase()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess : function(response){\r\n\t\t\t\t\t\t_this.printBtnUnable = false;\r\n\t\t\t\t\t\t_this.$printBtn.removeClass(\"btnDisabled\");\r\n\r\n\t\t\t\t\t\tif(response.returnCode == \"0\"){\r\n\t\t\t\t\t\t\tconsole.log(subAssemblyNum + \" 打印成功！\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t// console.log(subAssemblyNum + \" 打印失败！\");\r\n\t\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\ttext: \"打印失败\"\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function () {\r\n\t\t\t\t\t\t_this.printBtnUnable = false;\r\n\t\t\t\t\t\t_this.$printBtn.removeClass(\"btnDisabled\");\r\n\t\t\t\t\t\t// console.log(subAssemblyNum + \" 打印失败！\");\r\n\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\ttext: \"打印失败\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\r\n\t\t\t\t\t// text: \"分总成条码不能为空！\"\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_SUBASSEMBLY_BARCODE_NO_NOT_BE_NULL\")\r\n\t\t\t\t});\r\n\t\t\t\t_this.$productmark.focus();\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tloadTableByProductNum: function() {\r\n\t\tvar _this = this;\r\n\t\tapp.request({\r\n\t\t\turl: 'restful/service/execute',\r\n\t\t\tdata: {\r\n\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART012',\r\n\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\tsubAssemblyBarcode: _this.$productmark.val().toUpperCase()\r\n\t\t\t},\r\n\t\t\tsuccess: function(response) {\r\n\t\t\t\tutil.rightCode(response, createTable);\r\n\t\t\t},\r\n\t\t\terror : function () {\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\r\n\t\t\t\t\ttext: \"解析失败\"\r\n\t\t\t\t});\r\n\t\t\t\t_this.printBtnUnable = true;\t// 解析失败时，打印按钮不可用\r\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\r\n\t\t\t\t_this.$productmark.focus().select();\r\n\t\t\t}\r\n\t\t});\r\n\t\tfunction createTable(response) {\r\n\t\t\tvar data = response.data.list;\r\n\t\t\t_this.First = response.data.first;\r\n\t\t\tvar dataLength = data.length;\r\n\t\t\tif(dataLength <= 0) {\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_RECORDLIST_IS_EMPTY\")\r\n\t\t\t\t});\r\n\t\t\t\t_this.printBtnUnable = true;\t// 解析失败时，打印按钮不可用\r\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\r\n\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\t_this.$productmark.val(\"\").focus();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t_this.addSubmitEvent()\r\n\t\t\t_this.recordStationCode = data[0].stationCode;\r\n\t\t\tif(!_this.recordStationCode || _this.recordStationCode === \"\") {\r\n\t\t\t\t_this.printBtnUnable = true;        // 没有stationCode时，打印按钮不可用\r\n\t\t\t\t_this.$printBtn.addClass(\"btnDisabled\");\r\n\t\t\t} else {\r\n\t\t\t\t_this.printBtnUnable = false;        // 有stationCode时，打印按钮可用\r\n\t\t\t\t_this.$printBtn.removeClass(\"btnDisabled\");\r\n\t\t\t}\r\n\t\t\tif(_this.First) {\r\n\t\t\t\tvar list = [];\r\n\t\t\t\tvar keypartCount = 0;\r\n\t\t\t\t_this.alternateRelation = {}; //加载数据时，初始化一个空的替代组关系对象，\r\n\t\t\t\tfor(var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\tvar quantity = data[i].quantity;\r\n\t\t\t\t\tfor(var j = 0; j < quantity; j++) {\r\n\t\t\t\t\t\tvar keypart = {};\r\n\t\t\t\t\t\tkeypart = $.extend(keypart, data[i]);\r\n\t\t\t\t\t\tkeypart.supplierCode = \"\";\r\n\t\t\t\t\t\tkeypart.lotNum = \"\";\r\n\t\t\t\t\t\tlist.push(keypart);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//如果此关重件有替代组，进行\r\n\t\t\t\t\tif(data[i].alternateGroup) {\r\n\t\t\t\t\t\t// 替代关系数量对象示例见页末\r\n\t\t\t\t\t\t// 有替代组的组件在替代组关系中维护关系对象，扫描数量中替代组只计算最大的一个，所以等维护好替代组关系之后再计算\r\n\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = { //替代组关系中，维护一个关重件对象\r\n\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t// 如果已有关重件替代组，其数量取其中关重件数量最大的一个\r\n\t\t\t\t\t\tif(_this.alternateRelation[data[i].alternateGroup]) {\r\n\t\t\t\t\t\t\tif(quantity > _this.alternateRelation[data[i].alternateGroup].maxCount) {\r\n\t\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].maxCount = quantity\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else { // 如果没有关重件替代组，则新维护一个替代组对象\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\r\n\t\t\t\t\t\t\t\tisGroup: true,\r\n\t\t\t\t\t\t\t\tcount: 0,\r\n\t\t\t\t\t\t\t\tmaxCount: quantity\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 没有替代组的组件直接计算在扫描数量中\r\n\t\t\t\t\t\tkeypartCount += parseInt(quantity);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 关重件替代组数量加到扫描清单数量中去\r\n\t\t\t\tfor(var key in _this.alternateRelation) {\r\n\t\t\t\t\tif(_this.alternateRelation[key].isGroup) {\r\n\t\t\t\t\t\tkeypartCount += parseInt(_this.alternateRelation[key].maxCount);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$allCount.text(keypartCount);\r\n\t\t\t\t_this.$undoCount.text(keypartCount);\r\n\r\n\t\t\t\t_this.undoCount = keypartCount;\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(list).draw();\r\n\t\t\t\t_this.$lotBarCodeInput.focus();\r\n\t\t\t} else {\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(data).draw();\r\n\t\t\t\tvar keypartCount = 0;\r\n\t\t\t\tvar validCount = 0; //扫描清单已扫数量\r\n\t\t\t\t_this.alternateRelation = {}; //加载数据时，初始化一个空的替代组关系对象，\r\n\t\t\t\tfor(var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\t// 扫描清单已扫数量计数\r\n\t\t\t\t\tif(data[i].statusEcode == 1 || data[i].statusEcode == 2) {\r\n\t\t\t\t\t\tvalidCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//如果此关重件有替代组，进行\r\n\t\t\t\t\tif(data[i].alternateGroup) {\r\n\t\t\t\t\t\t// 替代关系数量对象示例见页末\r\n\t\t\t\t\t\t// 有替代组的组件在替代组关系中维护关系对象，扫描数量中替代组只计算最大的一个，所以等维护好替代组关系之后再计算\r\n\r\n\t\t\t\t\t\t// 替代组关系中已有此关重件对象则计数统计\r\n\t\t\t\t\t\tif(_this.alternateRelation[data[i].keypartCode]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode].maxCount += 1;\r\n\t\t\t\t\t\t} else { //替代组关系中没有此关重件对象则新维护一个关重件对象\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = {\r\n\t\t\t\t\t\t\t\tmaxCount: 1,\r\n\t\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 如果没有关重件替代组，则新维护一个替代组对象，此最大数量取其中关重件数量中最大的一个，所以需要到维护好关重件对象再比较赋值\r\n\t\t\t\t\t\tif(!_this.alternateRelation[data[i].alternateGroup]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\r\n\t\t\t\t\t\t\t\tisGroup: true,\r\n\t\t\t\t\t\t\t\tmaxCount: 0,\r\n\t\t\t\t\t\t\t\tcount: 0\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 替代组中已扫数量统计\r\n\t\t\t\t\t\tif(data[i].statusEcode == 1 || data[i].statusEcode == 2) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].count++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 没有替代组的组件直接计算在扫描数量中\r\n\t\t\t\t\t\tkeypartCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 遍历替代组关系中关重件对象，设置关重件对象中数量最大值为替代组对象数量\r\n\t\t\t\tfor(var key in _this.alternateRelation) {\r\n\t\t\t\t\tif(!_this.alternateRelation[key].isGroup) {\r\n\t\t\t\t\t\tvar alternateForGroup = _this.alternateRelation[key].alternateForGroup;\r\n\t\t\t\t\t\tif(_this.alternateRelation[key].maxCount > _this.alternateRelation[alternateForGroup].maxCount) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[alternateForGroup].maxCount = _this.alternateRelation[key].maxCount;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var key in _this.alternateRelation) {\r\n\t\t\t\t\tif(_this.alternateRelation[key].isGroup) {\r\n\t\t\t\t\t\t// 关重件替代组数量加到扫描清单数量中去\r\n\t\t\t\t\t\tkeypartCount += _this.alternateRelation[key].maxCount;\r\n\t\t\t\t\t\t// 如果该替代组数量已满，则将表格中其他未扫的关重件及替代组的扫描清单处置为灰色\r\n\t\t\t\t\t\tif(_this.alternateRelation[key].count >= _this.alternateRelation[key].maxCount) {\r\n\t\t\t\t\t\t\t_this.table.rows(function(idx, data, node) {\r\n\t\t\t\t\t\t\t\treturn(data.alternateGroup === key) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t\t}).every(function(rowIdx, tableLoop, rowLoop) {\r\n\t\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\t\td.invalid = true;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$allCount.text(keypartCount);\r\n\t\t\t\t_this.undoCount = keypartCount - validCount;\r\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t}\r\n\t\t\t$(\"#lotBarCodeInput\", _this.page).focus();\r\n\t\t};\r\n\t},\r\n\tproductmark: function() {\r\n\t\tvar _this = this;\r\n\t\tvar $productmark = $(\"#productmark\", _this.page);\r\n\t\t$productmark.keyup(function(event) {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif(reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t\tif(event.keyCode == 13) {\r\n\t\t\t\tvar productNum = $productmark.val();\r\n\t\t\t\tif(productNum) {\r\n\t\t\t\t\t$productmark.focus().select();\r\n\t\t\t\t\t_this.loadTableByProductNum();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutil.notify({\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// text: \"分总成条码不能为空\"\r\n                        text: i18next.t(\"KEYPART.T.MSG_SUBASSEMBLY_BARCODE_NO_NOT_BE_NULL\")\r\n\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\t$productmark.focus();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar $ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\r\n\t\t$ipCollectBatchNumber.keyup(function(e) {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif(reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tlotBarCodeInputEvent: function() {\r\n\t\tvar _this = this;\r\n\t\tvar $lotBarCodeInput = $(\"#lotBarCodeInput\", _this.page);\r\n\t\t$lotBarCodeInput.keyup(function(event) {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif(reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t\tif(event.keyCode == 13) {\r\n\t\t\t\tvar lotBarCode = $lotBarCodeInput.val();\r\n\t\t\t\tif(lotBarCode) {\r\n\t\t\t\t\t$lotBarCodeInput.focus().select();\r\n\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\tresolveLotBarCode(lotBarCode);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutil.notify({\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// text: \"批次条码不能为空\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_NOT_BE_NULL\")\r\n\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\t$lotBarCodeInput.focus();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction resolveLotBarCode(code) {\r\n\t\t\tapp.request({\r\n\t\t\t\turl: 'restful/service/execute',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART002',\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\tbarcode: code.toUpperCase()\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function(response) {\r\n\t\t\t\t\tutil.rightCode(response, dealKeypartCode);\r\n\t\t\t\t},\r\n\t\t\t\terror: function() {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// text: \"批次条码没有按照{{length}}位的规则解析！\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ERROR\", {\r\n\t\t\t\t\t\t\tlength: code.length\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t// 根据返回的条码解析结果进行处理-数据填充，表格滚动，采集信息栏更新\r\n\t\tfunction dealKeypartCode(response) {\r\n\t\t\t// 根据条码解析结果进行处理\r\n\t\t\tvar returnData = response.data;\r\n\t\t\tvar keypartCode = returnData.materialCode;\r\n\t\t\t// 如果是有替代组的关重件或者替代组，则标记，并检查有替代组的关重件的已扫的关重件和替代组的数量已满，则提示，并退出\r\n\t\t\tvar keypartAlternateGroup;\r\n\t\t\tif(_this.alternateRelation[keypartCode]) {\r\n\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\r\n\t\t\t\tif(_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\ttext: \"组件数量已满！\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 根据返回的关重件物料编码选到对应的关重件\r\n\t\t\tvar rowSelect = _this.table.row(function(idx, data, node) {\r\n\t\t\t\treturn data.keypartCode === keypartCode && data.invalid != true && data.statusEcode != 1 && data.statusEcode != 2 ?\r\n\t\t\t\t\ttrue : false;\r\n\t\t\t});\r\n\t\t\tvar rowSelectMatch = _this.table.row(function(idx, data, node) {\r\n\t\t\t\treturn data.keypartCode === keypartCode && (data.statusEcode == 1 || data.statusEcode == 2) ?\r\n\t\t\t\t\ttrue : false;\r\n\t\t\t});\r\n\r\n\t\t\tvar rowData = rowSelect.data();\r\n\t\t\tvar rowMatchData = rowSelectMatch.data();\r\n\t\t\tif(rowData) {\r\n\t\t\t\t// 将对应的关重件的供应商和批次进行填充\r\n\t\t\t\trowData.supplierCode = returnData.supplierCode;\r\n\t\t\t\trowData.lotNum = returnData.lotNum;\r\n\t\t\t\trowData.supplierText = returnData.supplierText;\r\n\t\t\t\tif(returnData.valid) {\r\n\t\t\t\t\trowData.statusEcode = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trowData.statusEcode = 2;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar rowIndex = rowSelect.index();\r\n\t\t\t\tvar tableData = _this.table.data().toArray();\r\n\t\t\t\ttableData.splice(rowIndex, 1);\r\n\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\r\n\t\t\t\tif(tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\ttableData.splice(0, 1);\r\n\t\t\t\t\ttableData.push(tableDataFirst);\r\n\t\t\t\t}\r\n\t\t\t\ttableData.unshift(rowData);\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(tableData).draw();\r\n\t\t\t\t// _this.$table.parent().scrollTop(0);\r\n\t\t\t\t// 扫描成功的提示扫描数据成功\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\t// text: \"扫描数据成功\"\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ANALYSE_SUCCESS\")\r\n\t\t\t\t});\r\n\t\t\t\t// 当前采集信息栏数据进行更新\r\n\t\t\t\t_this.undoCount--;\r\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t// 如果是替代组或有替代组的关重件，则增加替代组关系表中关重件的已扫计数，如果数量已满，则将表格中其他未扫的关重件及替代组的扫描清单处置为灰色\r\n\t\t\t\tif(keypartAlternateGroup) {\r\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count++;\r\n\t\t\t\t\tif(_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\t_this.table.rows(function(idx, data, node) {\r\n\t\t\t\t\t\t\treturn(data.alternateGroup === keypartAlternateGroup) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t}).every(function(rowIdx, tableLoop, rowLoop) {\r\n\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\td.invalid = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus();\r\n\t\t\t} else {\r\n\t\t\t\tvar contentMsg = i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\");\r\n\t\t\t\tif(rowMatchData){\r\n\t\t\t\t\tcontentMsg = \"重复扫描！\"\r\n\t\t\t\t}\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\r\n\t\t\t\t\ttext: contentMsg\r\n\t\t\t\t});\r\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tinitData: function(query) {\r\n\t\tvar _this = this;\r\n\t\tvar rowData = _this.selectRow.data();\r\n\t\t$(\"#supplierListRender\", _this.page).on('click', '.content label', function() {\r\n\t\t\t$(\".batch-input\").focus();\r\n\t\t});\r\n\t\tapp.request({\r\n\t\t\turl: \"restful/service/execute\",\r\n\t\t\tdata: {\r\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART006\",\r\n\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\tmaterialCode: rowData.keypartCode\r\n\t\t\t},\r\n\t\t\tsuccess: function(response) {\r\n\t\t\t\tutil.rightCode(response, ListRender);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction ListRender(response) {\r\n\t\t\tvar renderData = {\r\n\t\t\t\t// supplierLabel: \"供应商\",\r\n\t\t\t\tsupplierLabel: i18next.t(\"KEYPART.T.SUPPLIER\"),\r\n\t\t\t\tsupplierList: response.data\r\n\t\t\t};\r\n\t\t\tapp.tplManager(\"supplierListTpl\", renderData, \"supplierListRender\");\r\n\t\t\t// 如果供应商列表中有上个页面传过来的供应商，则该供应商默认选中\r\n\t\t\t          var fromSupplierCode = rowData.supplierCode;\r\n\t\t\t          if(fromSupplierCode){\r\n\t\t\t              $(\"input[name='provider'][value=\" + fromSupplierCode + \"]\").attr(\"checked\",true);\r\n\t\t\t          }\r\n\t\t}\r\n\t},\r\n\theaderEvent: function() {\r\n\t\tvar _this = this;\r\n\t\t$('.head-confirm').on('click', function() {\r\n\t\t\tsaveDataToServer();\r\n\t\t\tfunction saveDataToServer() {\r\n\t\t\t\t// 按接口格式生成需要的参数\r\n\t\t\t\tvar param = {\r\n\t\t\t\t\t//分装采集补录的接口换成16\r\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART016\",\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\t// stationCode: _this.station.stationCode,\r\n\t\t\t\t\tsubAssemblyBarcode: _this.$productmark.val().toUpperCase(),\r\n\t\t\t\t\tcreateUser: _this.userCode,\r\n\t\t\t\t\tmodifyUser: _this.userCode,\r\n\t\t\t\t\tsubAssemblyFlag: 1\r\n\t\t\t\t};\r\n\t\t\t\tvar tableData = _this.table.data();\r\n\t\t\t\tvar dataLength = tableData.length;\r\n\r\n\t\t\t\tif(dataLength <= 0) {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\ttext: \"无提交数据！\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// _this.$productmark.val(\"\").focus();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\tvar tableDataI = tableData[i];\r\n\t\t\t\t\t// if(tableDataI.notNullFlag == 1 && tableDataI.invalid != true && (tableDataI.statusEcode == \"\" || tableDataI.statusEcode == null || !(tableDataI.statusEcode))) {\r\n\t\t\t\t\tif((tableDataI.notNullFlag == 1) && (tableDataI.invalid != true) && (tableDataI.statusEcode != 1) && (tableDataI.statusEcode != 2)) {\r\n\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// text: \"XXX 数据不能为空\"\r\n\t\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_HAVE_NOT_NULL_DATA_SUBMIT\", {\r\n\t\t\t\t\t\t\t\tkeypartCode: tableDataI.keypartCode\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(var key in tableDataI) {\r\n\t\t\t\t\t\tif(tableDataI.hasOwnProperty(key)) {\r\n\t\t\t\t\t\t\tif([\"createDate\", \"createDateTime\", \"modifyDate\", \"modifyDateTime\", \"invalid\"].indexOf(key) < 0) {\r\n\t\t\t\t\t\t\t\tvar keyNew = \"items[\" + i + \"].\" + key;\r\n\t\t\t\t\t\t\t\tif(key == \"statusEcode\" && (tableDataI[key] == \"\" || tableDataI[key] == null || !(tableDataI[key]))) {\r\n\t\t\t\t\t\t\t\t\tparam[keyNew] = 0;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tparam[keyNew] = tableDataI[key];\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 接入数据\r\n\t\t\t\tif(_this.undoCount > 0) {\r\n\t\t\t\t\tmyApp.confirm('数据录入不完整，确定要提交？', function() {\r\n\t\t\t\t\t\tsubmitConfirm();\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsubmitConfirm();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction submitConfirm() {\r\n\t\t\t\t\t// // 接入数据\r\n\t\t\t\t\tmyApp.showPreloader(\"数据保存中...\");\r\n\t\t\t\t\tapp.request({\r\n\t\t\t\t\t\turl: 'restful/service/execute',\r\n\t\t\t\t\t\tdata: param,\r\n\t\t\t\t\t\tsuccess: function(response) {\r\n\t\t\t\t\t\t\tutil.rightCode(response, saveDataSuccess);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function() {\r\n\t\t\t\t\t\t\tmyApp.hidePreloader();\r\n\t\t\t\t\t\t\tnotie.alert({\r\n//\t\t\t\t\t\t\t\ttext: \"保存数据失败\"\r\n\t\t\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_FAILURE\")\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfunction saveDataSuccess() {\r\n\t\t\t\t\tmyApp.hidePreloader();\r\n\t\t\t\t\tutil.notify({\r\n\t\t\t\t\t\ttext: \"保存数据成功\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.removeSubmitEvent()\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\t}, 3000);\r\n\t\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\t\t_this.$allCount.text(0);\r\n\t\t\t\t\t_this.$undoCount.text(0);\r\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\r\n\t\t\t\t\t_this.$productmark.val(\"\").focus();\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t});\r\n\t},\r\n\tpickerAndMaskedEvent: function() {\r\n\t\tvar _this = this;\r\n        // 撤销键\r\n\t\t$(\".cancel\").on('click', function() {\r\n\t\t\t\tvar currentRowData = _this.table.row($(this).parent().parent()).data();\r\n\t\t\t\tcurrentRowData.supplier = \"\";\r\n\t\t\t\tcurrentRowData.batch = \"\";\r\n\t\t\t\t_this.table.row($(this).parent().parent()).data(currentRowData);\r\n\t\t\t\t$(this).addClass('error');\r\n\t\t});\r\n        //确认隐藏遮罩层\r\n\t\t$('.close-picker').on('click', function() {\r\n\t\t\t$('.masked').css('display', 'none');\r\n\t\t});\r\n\t},\r\n\taddSubmitEvent:function(){\r\n\t\t$('.head-confirm').css('background','#00adee')\r\n\t\tthis.headerEvent()\r\n\t},\r\n\tremoveSubmitEvent:function(){\r\n\t\t$('.head-confirm').off();\r\n\t\t$('.head-confirm').css('background','#CCC');\r\n\t},\r\n\tpickermodalclose:function(inputSelector){\r\n\t\tinputSelector && document.querySelector(inputSelector) && document.querySelector(inputSelector).focus()\r\n\t}\r\n};\r\n\r\n\r\n\r\n/*myApp.onPageInit('keyComponentsOfPackagingMakeup', function(page) {\r\n\t$(document).off(\"keydown\");\r\n\tkeyComponentsOfPackagingMakeup.beforeInit($(page.container));\r\n});*/\r\n\r\n\r\nmodule.exports = keyComponentsOfPackagingMakeupCtrl\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/pqs/keyComponentsOfPackagingMakeup.js","var fetch = require('./util');\r\nvar access_token=sessionStorage.getItem(\"access_token\");\r\nvar requestApi = appConfig.baseEnv;\r\n\r\nvar reloadhttp = {\r\n    getLoginUser:function(callback){\r\n        return fetch.get('restful/user/getLoginUser',{},'',callback);\r\n    },\r\n    getUserAllModuleMenus:function(callback){\r\n\r\n    }\r\n};\r\nmodule.exports = reloadhttp;\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/utils/reloadfetch.js"],"sourceRoot":""}