{"version":3,"sources":["webpack:///assets/js/pages/andon_andonMonitoring_50ecbebebf2a953d76eb.js","webpack:///./src/js/pages/andon/andonMonitoring.js"],"names":["webpackJsonp","620","module","exports","__webpack_require__","$","i18next","security","mqttLib","util","andonMonitoringViewCtrl","STATE_TOUCH","STATE_NORMAL","page","undefined","station","timer","andonTypeCode","allAndons","dataTable","queryParam","serviceCode","statusECode","typeCode","init","document","off","translate","_this","this","setBreadcrumb","t","loadPage","subscribeMessageTopic","topic","getSiteCode","subscribe","registerMessageHandler","message","Sweet","mainView","router","refreshPage","service","response","andons","data","andonTypes","triggerCount","each","index","item","andonType","push","groupAndons","group","totalAndon","normalColor","touchColor","typeText","tplManager","myApp","swiper","pagination","nextButton","prevButton","event","scrollY","height","order","ajax","param","columns","orderable","render","type","row","meta","name","width","statusText","bgColor","time","Math","abs","getServerDateTime","switchOnDateTime","value","theTime","parseInt","theTimeMinute","theTimeHour","hour","minute","second","getzf","num","tmpDate","Date","year","getFullYear","mathon","getMonth","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","on","e","el","target","tagName","parents","attr","reload","andonTriggerTimeSync","config","array","groupLength","newArray","length","slice","calTypeOnNums","typeAndonds","colWidth","hasExist","i","floor","groupAndonsByType","newAndons","call"],"mappings":"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","file":"assets/js/pages/andon_andonMonitoring_50ecbebebf2a953d76eb.js","sourcesContent":["webpackJsonp([35],{\n\n/***/ 620:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, i18next) {\n\nvar security = __webpack_require__(35);\nvar mqttLib = __webpack_require__(53);\nvar util = __webpack_require__(34);\n\nvar andonMonitoringViewCtrl = {\n    STATE_TOUCH: 1,\n    STATE_NORMAL: 3,\n    page: undefined,\n    station: undefined,\n    timer: undefined,\n    andonTypeCode: null,\n    allAndons: null,\n    dataTable: undefined,\n    queryParam: {\n        serviceCode: \"GMES-CLIENT-ANDON005\",\n        statusECode: \"1\",\n        typeCode: \"\"\n    },\n    init: function init() {\n        $(document).off(\"keydown\");\n        util.translate('.page[data-page=\"andonMonitoring\"]');\n        var _this = this;\n        util.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONMONITORING\")]);\n\n        _this.loadPage();\n        _this.subscribeMessageTopic();\n    },\n    subscribeMessageTopic: function subscribeMessageTopic() {\n        var _this = this;\n        var topic = \"business/andon/status/\" + security.getSiteCode() + \"/+\";\n        mqttLib.subscribe(topic);\n        mqttLib.registerMessageHandler(topic, \"andonMonitoring.andonMonitoringMessageHandler\", function (message) {\n            Sweet.mainView.router.refreshPage();\n        });\n    },\n    loadPage: function loadPage(station) {\n        var _this = this;\n        util.service(\"GMES-CLIENT-ANDON011\", {}, null, function (response) {\n            var andons = response.data;\n            var andonTypes = [];\n            var triggerCount = 0;\n            $.each(andons, function (index, item) {\n                triggerCount += item.triggerCount;\n                if (item.andonType.andonTypeCode != \"LSANDON\") {\n                    andonTypes.push(item);\n                }\n            });\n\n            var groupAndons = _this.group(andonTypes, 3);\n            var totalAndon = {\n                statusECode: triggerCount == 0 ? _this.STATE_NORMAL : _this.STATE_TOUCH,\n                triggerCount: triggerCount,\n                normalColor: \"linear-gradient(to bottom, #00FF00, #13a834)\",\n                touchColor: \"#ed5565\",\n                typeText: i18next.t(\"ANDON.T.ALL\")\n            };\n\n            util.tplManager(\"andonTotalTpl\", totalAndon, \"andonTotalRender\");\n            util.tplManager(\"andonMonitoringTypeSwiperTpl\", groupAndons, \"andonMonitoringTypeSwiperRender\");\n\n            var andonSwiper = myApp.swiper($('.swiper-container', _this.page), {\n                pagination: $('.swiper-pagination', _this.page),\n                nextButton: $('.swiper-button-next', _this.page),\n                prevButton: $('.swiper-button-prev', _this.page)\n            });\n\n            _this.event();\n        });\n\n        var dataStartIndex = 0;\n        var scrollY = this.page.height - 220 - 43 - 53;\n        this.dataTable = util.dataTable($('.table-panel table', this.page), {\n\n            scrollY: scrollY,\n            \"order\": [],\n            \"ajax\": {\n                serviceCode: \"GMES-CLIENT-ANDON005\",\n\n                param: function param() {\n                    return _this.queryParam;\n                }\n            },\n            \"columns\": [{\n                \"data\": \"id\",\n                \"orderable\": false,\n                \"render\": function render(data, type, row, meta) {\n                    return meta[\"settings\"][\"_iDisplayStart\"] + meta.row + 1;\n                }\n            }, {\n                \"data\": \"workCenterText\",\n                \"name\": \"workCenterText\"\n            }, {\n                \"data\": \"stationText\",\n                \"name\": \"stationText\"\n            }, {\n                \"data\": \"typeText\",\n                \"name\": \"typeText\"\n            }, {\n                \"name\": \"statusECode\",\n                \"width\": \"55px\",\n                \"render\": function render(data, type, row) {\n                    var statusText;\n                    var bgColor;\n                    switch (row.statusECode) {\n                        case \"1\":\n                            {\n                                statusText = i18next.t(\"ANDON.T.STATUS_TOUCH\");\n                                bgColor = \"#ef5362\";\n                                break;\n                            }\n                        case \"3\":\n                            {\n                                statusText = i18next.t(\"ANDON.T.STATUS_CLOSE\");\n                                bgColor = \"#ffce54\";\n                                break;\n                            }\n                        default:\n                            statusText = \"确认\";\n                            bgColor = \"#27c24c\";\n                    }\n                    return '<span style=\"padding:5px 15px;color:#fff;background:' + bgColor + ';border-radius:15px;\">' + statusText + '</span>';\n                }\n            }, {\n                \"name\": \"triggerTime\",\n                \"orderable\": false,\n                \"render\": function render(data, type, row) {\n                    var time = Math.abs(security.getServerDateTime() - row.switchOnDateTime) / 1000;\n                    return formatSeconds(time);\n\n                    function formatSeconds(value) {\n                        var theTime = parseInt(value);\n                        var theTimeMinute = 0;\n                        var theTimeHour = 0;\n                        if (theTime > 60) {\n                            theTimeMinute = parseInt(theTime / 60);\n                            theTime = parseInt(theTime % 60);\n                            if (theTimeMinute > 60) {\n                                theTimeHour = parseInt(theTimeMinute / 60);\n                                theTimeMinute = parseInt(theTimeMinute % 60);\n                            }\n                        }\n                        var result = i18next.t(\"COMMON.T.TIME\", {\n                            hour: parseInt(theTimeHour),\n                            minute: parseInt(theTimeMinute),\n                            second: parseInt(theTime)\n                        });\n                        return result;\n                    }\n                }\n            }, {\n                \"data\": \"switchOnDateTime\",\n                \"name\": \"switchOnDateTime\",\n                \"render\": function render(data, type, row) {\n                    return formatDate(data);\n\n                    function formatDate(time) {\n                        var tmpDate = new Date(time);\n                        var year = tmpDate.getFullYear();\n                        var mathon = tmpDate.getMonth() + 1;\n                        var day = tmpDate.getDate();\n                        var hours = tmpDate.getHours();\n                        var minutes = tmpDate.getMinutes();\n                        var seconds = tmpDate.getSeconds();\n                        return year + '-' + getzf(mathon) + '-' + getzf(day) + ' ' + getzf(hours) + ':' + getzf(minutes) + ':' + getzf(seconds);\n\n                        function getzf(num) {\n                            if (parseInt(num) < 10) {\n                                num = '0' + num;\n                            }\n                            return num;\n                        }\n                    }\n                }\n            }, {\n                \"data\": \"switchOnUser\",\n                \"name\": \"switchOnUser\"\n            }, {\n                \"data\": \"memo\",\n                \"name\": \"memo\"\n            }]\n        });\n    },\n\n    event: function event() {\n        var _this = this;\n\n        $(\"a[type='andonType']\", this.page).on(\"click\", function (e) {\n\n            var __this = _this;\n            var el = $(e.target);\n            if (e.target.tagName != \"A\") {\n                el = el.parents(\"a\");\n            }\n\n            _this.queryParam.typeCode = $(el).attr(\"andonTypeCode\");\n            _this.dataTable.ajax.reload();\n        });\n    },\n    andonTriggerTimeSync: function andonTriggerTimeSync() {},\n    render: function render(config) {},\n    group: function group(array, groupLength) {\n        var index = 0;\n        var newArray = { \"groupAndons\": [] };\n        while (index < array.length) {\n            newArray.groupAndons.push(array.slice(index, index += groupLength));\n        }\n        return newArray;\n    },\n\n    calTypeOnNums: function calTypeOnNums(andons) {\n        var typeAndonds = [{ andonTypeCode: null, typeText: \"总\", num: 0, colWidth: null }];\n\n        $.each(andons, function () {\n            if (this.andonTypeCode) {\n                typeAndonds[0].num++;\n                var hasExist = false;\n                for (var i = 0; i < typeAndonds.length; i++) {\n                    if (typeAndonds[i].andonTypeCode == this.andonTypeCode) {\n                        typeAndonds[i].num++;\n                        hasExist = true;\n                        break;\n                    }\n                }\n                if (!hasExist) typeAndonds.push({\n                    andonTypeCode: this.andonTypeCode,\n                    typeText: this.typeText,\n                    num: 1,\n                    colWidth: null\n                });\n            }\n        });\n\n        var colWidth = Math.floor(100 / typeAndonds.length);\n        $.each(typeAndonds, function () {\n            this.colWidth = colWidth;\n        });\n        return typeAndonds;\n    },\n\n    groupAndonsByType: function groupAndonsByType(andons, andonTypeCode) {\n        var newAndons = [];\n        $.each(andons, function () {\n            if (this.andonTypeCode == andonTypeCode) {\n                newAndons.push(this);\n            }\n        });\n        return newAndons;\n    }\n};\n\nmodule.exports = andonMonitoringViewCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(37)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/andon_andonMonitoring_50ecbebebf2a953d76eb.js","var security = require(\"security\");\r\nvar mqttLib = require(\"mqttLib\");\r\nvar util = require('util');\r\n/**\r\n * Created by Administrator on 2016/12/28.\r\n */\r\nvar andonMonitoringViewCtrl = {\r\n    STATE_TOUCH : 1,\r\n    STATE_NORMAL : 3,\r\n    page: undefined,\r\n    station : undefined,\r\n    timer: undefined,\r\n    andonTypeCode: null,\r\n    allAndons: null,\r\n    dataTable : undefined,\r\n    queryParam : {\r\n        serviceCode :  \"GMES-CLIENT-ANDON005\",\r\n        statusECode: \"1\",\r\n        typeCode : \"\"\r\n    },\r\n    init: function () {\r\n        $(document).off(\"keydown\");     \r\n        util.translate('.page[data-page=\"andonMonitoring\"]');\r\n        var _this = this;\r\n        util.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONMONITORING\")]);\r\n        //_this.station = station;\r\n        _this.loadPage();\r\n        _this.subscribeMessageTopic();\r\n    },\r\n    subscribeMessageTopic : function(){\r\n        var _this = this;\r\n        var topic = \"business/andon/status/\"+security.getSiteCode()+\"/+\";\r\n        mqttLib.subscribe(topic);\r\n        mqttLib.registerMessageHandler(topic,\"andonMonitoring.andonMonitoringMessageHandler\",function(message){\r\n            Sweet.mainView.router.refreshPage();\r\n        })\r\n    },   \r\n    loadPage: function (station) {\r\n        var _this = this;\r\n        util.service(\"GMES-CLIENT-ANDON011\",{},null,function (response) {  \r\n            var andons = response.data;\r\n            var andonTypes = [];\r\n            var triggerCount = 0;\r\n            $.each(andons,function(index,item){\r\n                triggerCount += item.triggerCount;\r\n                 if(item.andonType.andonTypeCode!=\"LSANDON\"){\r\n                    //非拉绳andon\r\n                    andonTypes.push(item);\r\n                }\r\n            })\r\n\r\n            var groupAndons = _this.group(andonTypes, 3);\r\n            var totalAndon = {\r\n                statusECode : triggerCount == 0 ? _this.STATE_NORMAL:_this.STATE_TOUCH,\r\n                triggerCount : triggerCount,\r\n                normalColor : \"linear-gradient(to bottom, #00FF00, #13a834)\",\r\n                touchColor : \"#ed5565\",\r\n                typeText : i18next.t(\"ANDON.T.ALL\")\r\n            }\r\n\r\n            util.tplManager(\"andonTotalTpl\", totalAndon, \"andonTotalRender\");\r\n            util.tplManager(\"andonMonitoringTypeSwiperTpl\", groupAndons, \"andonMonitoringTypeSwiperRender\");\r\n            /*var andonSwiper = myApp.swiper('#andonMonitoringTypeSwiper', {\r\n                pagination:'#andonMonitoringSwiperPg'\r\n            });*/\r\n            var andonSwiper = myApp.swiper($('.swiper-container',_this.page), {\r\n                pagination: $('.swiper-pagination',_this.page),\r\n                nextButton: $('.swiper-button-next',_this.page),\r\n                prevButton: $('.swiper-button-prev',_this.page),\r\n            }); \r\n    \r\n            _this.event();\r\n        })\r\n\r\n        //表格加载\r\n        var dataStartIndex = 0;\r\n        var scrollY = (this.page.height-220-43-53);\r\n        this.dataTable = util.dataTable($('.table-panel table', this.page),{\r\n        \t\r\n            scrollY: scrollY,\r\n            \"order\" : [],\r\n            \"ajax\" : {\r\n            \tserviceCode :  \"GMES-CLIENT-ANDON005\",\r\n                //url : \"restful/service/execute\",\r\n            \tparam : function(){\r\n            \t\treturn _this.queryParam;\r\n            \t}\r\n            },\r\n             \"columns\": [\r\n                {\r\n                    \"data\": \"id\",\r\n                    \"orderable\" : false,\r\n                    \"render\": function ( data, type, row,meta  ) {\r\n                        return meta[\"settings\"][\"_iDisplayStart\"] + meta.row+1\r\n                    }\r\n                },\r\n                {\r\n                    \"data\": \"workCenterText\",\r\n                    \"name\": \"workCenterText\"\r\n                },\r\n                {\r\n                    \"data\": \"stationText\",\r\n                    \"name\": \"stationText\"\r\n                },\r\n                {\r\n                    \"data\": \"typeText\",\r\n                    \"name\": \"typeText\"\r\n                },\r\n                {\r\n                    \"name\": \"statusECode\",\r\n                    \"width\" : \"55px\",\r\n                    \"render\": function ( data, type, row ) {\r\n                        var statusText;\r\n                        var bgColor;\r\n                        switch(row.statusECode){\r\n                            case \"1\":{\r\n                                statusText = i18next.t(\"ANDON.T.STATUS_TOUCH\");\r\n                                bgColor = \"#ef5362\";\r\n                                break;\r\n                            }\r\n                            case \"3\":{\r\n                                statusText = i18next.t(\"ANDON.T.STATUS_CLOSE\");\r\n                                bgColor = \"#ffce54\";\r\n                                break;\r\n                            }\r\n                            default:\r\n                                statusText = \"确认\";\r\n                                bgColor = \"#27c24c\";\r\n                        }\r\n                        return  '<span style=\"padding:5px 15px;color:#fff;background:' + bgColor + ';border-radius:15px;\">' + statusText + '</span>';\r\n                    }\r\n                },\r\n                {\r\n                    \"name\": \"triggerTime\",\r\n                    \"orderable\" : false,\r\n                    \"render\": function ( data, type, row ) {\r\n                        var time = Math.abs(security.getServerDateTime() - row.switchOnDateTime)/1000;\r\n                        return formatSeconds(time);\r\n                        //将秒数换成时分秒格式\r\n                        function formatSeconds(value) {\r\n                            var theTime = parseInt(value);// 秒\r\n                            var theTimeMinute = 0;// 分\r\n                            var theTimeHour = 0;// 小时\r\n                            if(theTime > 60) {\r\n                                theTimeMinute = parseInt(theTime/60);\r\n                                theTime = parseInt(theTime%60);\r\n                                if(theTimeMinute > 60) {\r\n                                    theTimeHour = parseInt(theTimeMinute/60);\r\n                                    theTimeMinute = parseInt(theTimeMinute%60);\r\n                                }\r\n                            }\r\n                            var result = i18next.t(\"COMMON.T.TIME\",{\r\n                                hour : parseInt(theTimeHour),\r\n                                minute : parseInt(theTimeMinute),\r\n                                second : parseInt(theTime)\r\n                            })\r\n                            return result;\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    \"data\": \"switchOnDateTime\",\r\n                    \"name\": \"switchOnDateTime\",\r\n                    \"render\": function ( data, type, row ) {\r\n                        return formatDate(data);\r\n                        //将秒数换成日期格式 YY-MM-DD hh:mm:ss\r\n                        function formatDate(time) {\r\n                            var tmpDate=new Date(time);\r\n                            var year = tmpDate.getFullYear();\r\n                            var mathon = tmpDate.getMonth() + 1;\r\n                            var day = tmpDate.getDate();\r\n                            var hours = tmpDate.getHours();\r\n                            var minutes = tmpDate.getMinutes();\r\n                            var seconds = tmpDate.getSeconds();\r\n                            return year + '-' + getzf(mathon) + '-' + getzf(day) + ' ' + getzf(hours) + ':' + getzf(minutes) + ':' +getzf(seconds);\r\n                            //补0操作\r\n                            function getzf(num){\r\n                                if(parseInt(num) < 10){\r\n                                    num = '0'+num;\r\n                                }\r\n                                return num;\r\n                            }\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    \"data\": \"switchOnUser\",\r\n                    \"name\": \"switchOnUser\"\r\n                },\r\n                {\r\n                    \"data\": \"memo\",\r\n                    \"name\": \"memo\"\r\n                }\r\n            ]\r\n        });\r\n    },\r\n    //为每个暗灯块增加点击事件\r\n    event: function () {\r\n        var _this = this;\r\n\r\n        $(\"a[type='andonType']\",this.page).on(\"click\", function (e) {\r\n        \t\r\n            var __this = _this;\r\n            var el = $(e.target);\r\n            if (e.target.tagName != \"A\") {\r\n                el = el.parents(\"a\");\r\n            }\r\n            \r\n            _this.queryParam.typeCode = $(el).attr(\"andonTypeCode\");\r\n            _this.dataTable.ajax.reload();\r\n        });\r\n\r\n      /*  timerManager.register({\r\n                \"group\" : \"andomMonitoring\",\r\n                \"name\" : \"andonTriggerTimeSync\",\r\n                \"intervalTime\" : 1000,\r\n                \"fun\" : function(){\r\n                    _this.andonTriggerTimeSync();\r\n                },\r\n                \"replace\" : true\r\n            });*/\r\n    },\r\n    andonTriggerTimeSync : function(){\r\n        //console.log(this.dataTable.getData());\r\n    },\r\n    render: function (config) {\r\n\r\n\r\n    },\r\n    group : function(array, groupLength) {\r\n        var index = 0;\r\n        var newArray = {\"groupAndons\":[]};\r\n        while(index < array.length) {\r\n            newArray.groupAndons.push(array.slice(index, index += groupLength));\r\n        }\r\n        return newArray;\r\n    },\r\n    //根据andonTypeCode分组，并求出每组数量\r\n    calTypeOnNums: function (andons) {\r\n        var typeAndonds = [\r\n            {andonTypeCode: null, typeText: \"总\", num: 0, colWidth: null}\r\n        ]\r\n        // var typeOnNums = {all: 0, zl: 0, sb: 0, wl: 0};\r\n        $.each(andons, function () {\r\n            if (this.andonTypeCode) {\r\n                typeAndonds[0].num++;//总数+1\r\n                var hasExist = false;\r\n                for (var i = 0; i < typeAndonds.length; i++) {\r\n                    if (typeAndonds[i].andonTypeCode == this.andonTypeCode) {\r\n                        typeAndonds[i].num++;\r\n                        hasExist = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!hasExist)\r\n                    typeAndonds.push({\r\n                        andonTypeCode: this.andonTypeCode,\r\n                        typeText: this.typeText,\r\n                        num: 1,\r\n                        colWidth: null\r\n                    });\r\n            }\r\n        })\r\n\r\n        var colWidth = Math.floor(100 / typeAndonds.length);\r\n        $.each(typeAndonds, function () {\r\n            this.colWidth = colWidth;\r\n        })\r\n        return typeAndonds;\r\n    },\r\n    //根据点击的暗灯类型从总数据中筛选出对应类型的暗灯记录\r\n    groupAndonsByType: function (andons, andonTypeCode) {\r\n        var newAndons = [];\r\n        $.each(andons, function () {\r\n            if (this.andonTypeCode == andonTypeCode) {\r\n                newAndons.push(this);\r\n            }\r\n        })\r\n        return newAndons;\r\n    }\r\n}\r\n\r\n/*myApp.onPageInit('andonMonitoring', function (page) {\r\n    $(document).off(\"keydown\");\t\t// 别的页面去除主页的菜单快捷键\r\n        util.translate('.page[data-page=\"andonMonitoring\"]');\r\n        andonMonitoringView.init($(page.container));\r\n });*/\r\nmodule.exports = andonMonitoringViewCtrl\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/andon/andonMonitoring.js"],"sourceRoot":""}