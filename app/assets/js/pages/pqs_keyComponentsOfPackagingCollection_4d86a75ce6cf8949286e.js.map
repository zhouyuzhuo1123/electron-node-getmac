{"version":3,"sources":["webpack:///assets/js/pages/pqs_keyComponentsOfPackagingCollection_4d86a75ce6cf8949286e.js","webpack:///./src/js/pages/pqs/keyComponentsOfPackagingCollection.js"],"names":["webpackJsonp","649","module","exports","__webpack_require__","$","i18next","app","notie","security","util","keyComponentsOfPackagingCollectionCtrl","selectRow","selectRowData","initTable","page","undefined","table","userCode","stationPage","subAssemblyBarcodeShouldPrint","init","_this","this","translate","lotBarCodeInputEvent","headerEvent","$undoCount","$allCount","$productmark","$lotBarCodeInput","$midInput","$ipCollectBatchNumber","isUniqueOperableStation","station","confirmStationType","response","data","attr","force","type","text","t","Sweet","mainView","router","load","url","loadPageAgain","loadPage","setBreadcrumb","stationCode","service","serviceCode","siteCode","done","rightCode","dealProductNumAndsubCode","productNum","substr","length","val","subAssemblyBarcode","removeAttr","focus","loadTableByProductNum","alert","rowNum","scrollY","height","$table","DataTable","serverSide","paging","searching","order","dom","columns","name","orderable","render","row","keypartCode","className","supplierCode","lotNum","rowCallback","find","on","e","hasClass","parent","draw","statusEcodeOld","statusEcode","rowIndex","index","tableRow","toArray","splice","tableDataFirst","push","unshift","clear","undoCount","children","removeClass","rows","add","countChange","alternateRelation","keypartAlternateGroup","alternateForGroup","count","invalidFlag","maxCount","idx","node","alternateGroup","every","rowIdx","tableLoop","rowLoop","invalid","stopPropagation","addClass","pickerAndMaskedEvent","css","initData","myApp","pickerModal","pickermodalclose","saveToTable","statusEcodeNew","rowData","materialSupplierCondition","tableData","scrollTop","toUpperCase","supplierText","next","subAssemblyFlag","judgeMaterialSupplierCondition","materialCode","keyup","event","reg","test","value","replace","keyCode","currentTarget","setAttribute","createSelectTable","remove","sScrollY","columnDefs","searchable","targets","ordering","meta","parseInt","parents","subAssemblyBarcodeSelected","productmark","request","getSiteCode","success","click","select","notify","createTable","First","first","list","dataLength","emptySave","keypartCount","i","quantity","j","keypart","extend","isGroup","key","validCount","resolveLotBarCode","code","barcode","dealKeypartCode","error","returnData","rowSelect","rowSelectMatch","rowMatchData","valid","contentMsg","lotBarCode","ListRender","renderData","supplierLabel","supplierList","tplManager","fromSupplierCode","submitConfirm","showPreloader","param","saveDataSuccess","hidePreloader","modal","title","buttons","onClick","bold","printData","keyPartCode","subAssemblyNum","returnCode","console","log","trim","createUser","modifyUser","statusECode","tableDataI","notNullFlag","hasOwnProperty","indexOf","keyNew","confirm","emptyNormalFlag","errorMessage","inputSelector","document","querySelector","call"],"mappings":"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","file":"assets/js/pages/pqs_keyComponentsOfPackagingCollection_4d86a75ce6cf8949286e.js","sourcesContent":["webpackJsonp([14],{\n\n/***/ 649:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, i18next, app, notie) {\n\nvar security = __webpack_require__(35);\nvar util = __webpack_require__(34);\n\nvar keyComponentsOfPackagingCollectionCtrl = {\n\tselectRow: null,\n\tselectRowData: null,\n\tinitTable: null,\n\tpage: undefined,\n\ttable: null,\n\tuserCode: null,\n\tstationPage: undefined,\n\tsubAssemblyBarcodeShouldPrint: undefined,\n\tinit: function init() {\n\t\tvar _this = this;\n\t\tif (_this.initTable) {\n\t\t\t_this.initTable = undefined;\n\t\t}\n\t\tutil.translate(_this.page);\n\t\tthis.lotBarCodeInputEvent();\n\t\tthis.headerEvent();\n\n\t\tthis.$undoCount = $(\"#currentNum\", this.page);\n\t\tthis.$allCount = $(\"#allNum\", this.page);\n\t\tthis.$productmark = $(\"#productmark\", this.page);\n\t\tthis.$lotBarCodeInput = $(\"#lotBarCodeInput\", this.page);\n\t\tthis.$midInput = $(\".midInput\", this.page);\n\t\tthis.$ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\n\n\t\tsecurity.isUniqueOperableStation(function (station) {\n\t\t\t_this.stationPage = station;\n\t\t\t_this.station = station;\n\t\t\t_this.loadPage();\n\t\t\tutil.setBreadcrumb([i18next.t(\"KEYPART.T.MENU_SUBASSEMBLY_COLLECT\") + \"(\" + _this.station.stationCode + \"\" + \")\"]);\n\n\t\t\tutil.service(\"GMES-CLIENT-KEYPART014\", {\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART014\",\n\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\tstationCode: _this.station.stationCode\n\t\t\t}).done(function (response) {\n\t\t\t\tutil.rightCode(response, confirmStationType);\n\t\t\t});\n\n\t\t\tfunction confirmStationType(response) {\n\t\t\t\tif (response.data != true) {\n\t\t\t\t\t_this.$productmark.attr(\"disabled\", \"disabled\");\n\t\t\t\t\t_this.$midInput.attr(\"disabled\", \"disabled\");\n\t\t\t\t\t_this.$lotBarCodeInput.attr(\"disabled\", \"disabled\");\n\t\t\t\t\t$('#select').attr(\"disabled\", \"disabled\");\n\t\t\t\t\t$('.head-confirm').attr(\"disabled\", \"disabled\");\n\t\t\t\t\tnotie.force({\n\t\t\t\t\t\ttype: \"3\",\n\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_INVALID_PERMISSIONS\") }, function () {\n\t\t\t\t\t\tSweet.mainView.router.load({\n\t\t\t\t\t\t\turl: \"views/index.html\"\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t_this.loadPageAgain();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tloadPageAgain: function loadPageAgain() {\n\t\tvar _this = this;\n\n\t\tutil.service('GMES-CLIENT-KEYPART005', {\n\t\t\tsiteCode: app.siteCode,\n\t\t\tstationCode: _this.station.stationCode,\n\t\t\trowNum: \"500\"\n\t\t}).done(function (response) {\n\t\t\tutil.rightCode(response, dealProductNumAndsubCode);\n\t\t});\n\n\t\tfunction dealProductNumAndsubCode(response) {\n\t\t\tvar data = response.data;\n\n\t\t\tvar vin_six = data.productNum.substr(data.productNum.length - 6);\n\t\t\tvar productNum = data.productNum;\n\t\t\t_this.$productmark.val(productNum);\n\n\t\t\tif (data.subAssemblyBarcode) {\n\t\t\t\t_this.subAssemblyBarcodeShouldPrint = true;\n\t\t\t\t_this.$midInput.val(data.subAssemblyBarcode).attr(\"disabled\", \"disabled\");\n\t\t\t} else {\n\t\t\t\t_this.subAssemblyBarcodeShouldPrint = false;\n\t\t\t\t_this.$midInput.val(\"\").removeAttr(\"disabled\").focus();\n\t\t\t}\n\n\t\t\tif (!data.productNum || data.productNum === \"\") {\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttype: \"3\",\n\t\t\t\t\ttext: \"产品标识为空！\"\n\t\t\t\t});\n\t\t\t\t_this.$lotBarCodeInput.attr(\"disabled\", \"disabled\");\n\t\t\t} else {\n\t\t\t\t_this.$lotBarCodeInput.removeAttr(\"disabled\");\n\n\t\t\t\t_this.loadTableByProductNum();\n\t\t\t}\n\t\t}\n\t},\n\tloadPage: function loadPage() {\n\t\tvar _this = this;\n\n\t\t$('#productmark').focus();\n\n\t\tvar scrollY = this.page.height - 158 - 53;\n\t\t_this.$table = $('.table-panel table', _this.page);\n\t\t_this.table = $('#myTable', _this.page).DataTable({\n\t\t\t\"serverSide\": false,\n\t\t\t\"paging\": false,\n\t\t\t\"searching\": false,\n\t\t\t\"scrollY\": scrollY,\n\t\t\t\"order\": [],\n\t\t\t\"data\": [],\n\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\n\t\t\t\"columns\": [{\n\t\t\t\t\"data\": \"keypartCode\",\n\t\t\t\t\"name\": \"keypartCode\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<span class=\"ipCollect-component-value\">' + row.keypartCode + '</span>';\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t\"className\": \"supplierCode\",\n\t\t\t\t\"data\": \"supplierCode\",\n\t\t\t\t\"name\": \"supplierCode\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-supplier-value ipCollect-open-picker\">' + (row.supplierCode || \"\") + '</a>';\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t\"className\": \"supplierCode\",\n\t\t\t\t\"data\": \"lotNum\",\n\t\t\t\t\"name\": \"lotNum\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render(data, type, row) {\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-batch-value  ipCollect-open-picker\">' + (row.lotNum || \"\") + '</a>';\n\t\t\t\t}\n\n\t\t\t}, {\n\t\t\t\t\"data\": \"keypartText\",\n\t\t\t\t\"name\": \"keypartText\",\n\t\t\t\t\"orderable\": false\n\n\t\t\t}, {\n\t\t\t\t\"data\": \"supplierText\",\n\t\t\t\t\"name\": \"supplierText\",\n\t\t\t\t\"orderable\": false\n\t\t\t}, {\n\t\t\t\t\"name\": \"remove\",\n\t\t\t\t\"orderable\": false,\n\t\t\t\t\"render\": function render() {\n\t\t\t\t\treturn \"<button class='cancel' >\" + i18next.t('KEYPART.B.REPEAL') + \"</button>\";\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"rowCallback\": function rowCallback(row, data) {\n\t\t\t\t$(row).find(\"td:last-child button\").on(\"click\", function (e) {\n\t\t\t\t\t_this.selectRow = _this.table.row(row);\n\t\t\t\t\tvar data = _this.selectRow.data();\n\t\t\t\t\tif (!$(row).hasClass('invalid')) {\n\t\t\t\t\t\tif ($(this).parent().parent().find(\"td:eq(1) a\").text() || $(this).parent().parent().find(\"td:eq(2) a\").text()) {\n\t\t\t\t\t\t\tdata[\"lotBarCode\"] = \"\";\n\t\t\t\t\t\t\tdata[\"lotNum\"] = \"\";\n\t\t\t\t\t\t\tdata[\"supplierCode\"] = \"\";\n\t\t\t\t\t\t\tdata[\"supplierText\"] = \"\";\n\t\t\t\t\t\t\t_this.table.row(row).data(data).draw();\n\t\t\t\t\t\t\tvar statusEcodeOld = data.statusEcode;\n\t\t\t\t\t\t\tdata.statusEcode = 0;\n\n\t\t\t\t\t\t\tvar rowIndex = _this.selectRow.index();\n\t\t\t\t\t\t\tvar tableRow = _this.table.data().toArray();\n\t\t\t\t\t\t\ttableRow.splice(rowIndex, 1);\n\n\t\t\t\t\t\t\tvar tableDataFirst = tableRow.length > 1 ? tableRow[0] : undefined;\n\t\t\t\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\t\t\t\ttableRow.splice(0, 1);\n\t\t\t\t\t\t\t\ttableRow.push(tableDataFirst);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttableRow.unshift(data);\n\n\t\t\t\t\t\t\t_this.table.clear();\n\n\t\t\t\t\t\t\t_this.undoCount++;\n\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t\t\t\t\t$(row).children().removeClass('error');\n\t\t\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\n\t\t\t\t\t\t\t_this.table.rows.add(tableRow).draw();\n\n\t\t\t\t\t\t\tvar countChange;\n\t\t\t\t\t\t\tif (statusEcodeOld > 0) {\n\t\t\t\t\t\t\t\tcountChange = -1;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcountChange = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\n\t\t\t\t\t\t\tif (_this.alternateRelation[keypartCode]) {\n\t\t\t\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\n\t\t\t\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\n\t\t\t\t\t\t\t\tvar invalidFlag;\n\t\t\t\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\t\t\t\tinvalidFlag = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tinvalidFlag = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\n\t\t\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\t\t\td.invalid = invalidFlag;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t});\n\t\t\t\tif (data.statusEcode == \"2\") {\n\t\t\t\t\t$(row).children().addClass('error');\n\t\t\t\t\t$(row).children('td').children('button').addClass('delBtn');\n\t\t\t\t} else {\n\t\t\t\t\t$(row).children().removeClass('error');\n\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\n\t\t\t\t}\n\n\t\t\t\tif (data.invalid == true) {\n\t\t\t\t\t$(row).addClass(\"invalid\");\n\t\t\t\t} else {\n\t\t\t\t\t$(row).removeClass(\"invalid\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$('#myTable').on('init.dt', function () {\n\t\t\t_this.pickerAndMaskedEvent();\n\t\t});\n\n\t\t$('.close-picker').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t});\n\n\t\t$(\"tbody\", _this.$table).on(\"click\", \"tr:not(.invalid)\", function () {\n\t\t\t_this.selectRow = _this.table.row(this);\n\t\t\tvar data = _this.selectRow.data();\n\t\t\t$(\"#ipCollect-component\", _this.page).val(data[\"keypartCode\"]);\n\t\t\t$(\"#ipCollect-batchNumber\", _this.page).val(data[\"lotNum\"]);\n\t\t\t$(\"#ipCollect-supplier\", _this.page).val(data[\"supplierCode\"]);\n\t\t\t_this.initData();\n\t\t\tmyApp.pickerModal($(\".picker-1\", _this.page));\n\t\t\t$('.masked').css('display', 'block');\n\t\t});\n\n\t\t$('.masked').on('click', function () {\n\t\t\t$(this).css('display', 'none');\n\t\t});\n\n\t\t$('.close-picker').on('click', function () {\n\t\t\t_this.pickermodalclose('#lotBarCodeInput');\n\t\t});\n\n\t\t$('.ipCollect-confirm').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t\tvar rowData = _this.selectRow.data();\n\t\t\tvar rowIndex = _this.selectRow.index();\n\t\t\tvar statusEcodeOld = rowData.statusEcode;\n\t\t\tvar statusEcodeNew;\n\t\t\tvar countChange;\n\t\t\trowData.supplierCode = $('input:radio[name=\"provider\"]:checked').val() || \"\";\n\t\t\trowData.lotNum = $(\"#ipCollect-batchNumber\").val().toUpperCase() || \"\";\n\t\t\trowData.supplierText = $('input:radio[name=\"provider\"]:checked').next().children('span').text() || \"\";\n\t\t\tvar materialSupplierCondition;\n\n\t\t\tif (rowData.subAssemblyFlag != 1 && rowData.supplierCode !== \"\") {\n\t\t\t\tvar judgeMaterialSupplierCondition = function judgeMaterialSupplierCondition(response) {\n\t\t\t\t\tif (response.data == true) {\n\t\t\t\t\t\tmaterialSupplierCondition = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmaterialSupplierCondition = false;\n\t\t\t\t\t}\n\t\t\t\t\tsaveToTable();\n\t\t\t\t};\n\n\t\t\t\tutil.service(\"restful/service/execute\", {\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART011\",\n\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\tmaterialCode: _this.selectRow.data().keypartCode,\n\t\t\t\t\tsupplierCode: rowData.supplierCode\n\t\t\t\t}).done(function (response) {\n\t\t\t\t\tutil.rightCode(response, judgeMaterialSupplierCondition);\n\t\t\t\t});\n\t\t\t} else if (rowData.subAssemblyFlag == 1 && rowData.supplierCode !== \"\") {\n\t\t\t\tmaterialSupplierCondition = true;\n\t\t\t\tsaveToTable();\n\t\t\t} else {\n\t\t\t\tmaterialSupplierCondition = false;\n\t\t\t\tsaveToTable();\n\t\t\t}\n\n\t\t\tfunction saveToTable() {\n\t\t\t\tif (rowData.supplierCode === \"\" && rowData.lotNum === \"\") {\n\t\t\t\t\tstatusEcodeNew = 0;\n\t\t\t\t} else if (rowData.supplierCode !== \"\" && materialSupplierCondition == true && rowData.lotNum !== \"\") {\n\t\t\t\t\tstatusEcodeNew = 1;\n\t\t\t\t} else {\n\t\t\t\t\tstatusEcodeNew = 2;\n\t\t\t\t}\n\n\t\t\t\tif ((statusEcodeOld == 0 || !statusEcodeOld || statusEcodeOld == \"\") && statusEcodeNew > 0) {\n\t\t\t\t\tcountChange = 1;\n\t\t\t\t} else if (statusEcodeOld > 0 && statusEcodeNew == 0) {\n\t\t\t\t\tcountChange = -1;\n\t\t\t\t} else {\n\t\t\t\t\tcountChange = 0;\n\t\t\t\t}\n\t\t\t\trowData.statusEcode = statusEcodeNew;\n\n\t\t\t\t_this.table.row(rowIndex).data(rowData).draw();\n\n\t\t\t\tvar tableData = _this.table.data().toArray();\n\t\t\t\ttableData.splice(rowIndex, 1);\n\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\ttableData.splice(0, 1);\n\t\t\t\t\ttableData.push(tableDataFirst);\n\t\t\t\t}\n\n\t\t\t\ttableData.unshift(rowData);\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(tableData).draw();\n\t\t\t\t_this.$table.parent().scrollTop(0);\n\n\t\t\t\t_this.undoCount -= countChange;\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\n\t\t\t\tvar keypartCode = rowData.keypartCode;\n\t\t\t\tif (_this.alternateRelation[keypartCode]) {\n\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\n\t\t\t\t\tvar invalidFlag;\n\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\tinvalidFlag = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinvalidFlag = false;\n\t\t\t\t\t}\n\t\t\t\t\t_this.table.rows(function (idx, data) {\n\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t}).every(function () {\n\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\td.invalid = invalidFlag;\n\t\t\t\t\t});\n\t\t\t\t\t_this.table.draw();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tvar $midInput = $('.midInput', _this.page);\n\t\t$midInput.keyup(function (event) {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t\tif (event.keyCode == 13) {\n\t\t\t\tevent.currentTarget.setAttribute('disabled', 'ture');\n\t\t\t\t$('.lotBarCodeInput', _this.page).focus();\n\t\t\t}\n\t\t});\n\t\tvar $ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\n\t\t$ipCollectBatchNumber.keyup(function () {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t});\n\t\t$(\"#select\").on('click', function () {\n\t\t\tmyApp.pickerModal($(\".picker-2\", _this.page));\n\t\t\t$('.masked').css('display', 'block');\n\t\t\tif (!_this.initTable) {\n\t\t\t\t_this.initTable = $('#selectTable', this.page).DataTable({\n\t\t\t\t\t\"serverSide\": false,\n\t\t\t\t\t\"paging\": false,\n\t\t\t\t\t\"searching\": false,\n\t\t\t\t\t\"sScrollY\": 256,\n\t\t\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\n\t\t\t\t\t\"columnDefs\": [{\n\t\t\t\t\t\t\"searchable\": false,\n\t\t\t\t\t\t\"orderable\": false,\n\t\t\t\t\t\t\"targets\": 0\n\t\t\t\t\t}],\n\t\t\t\t\t\"ordering\": false,\n\t\t\t\t\t\"columns\": [{\n\t\t\t\t\t\t\"name\": \"index\",\n\t\t\t\t\t\t\"render\": function render(data, type, row, meta) {\n\t\t\t\t\t\t\treturn parseInt(meta.row[0] || meta.row) + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"data\": \"productNum\",\n\t\t\t\t\t\t\"name\": \"productNum\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"data\": \"carTypeText\",\n\t\t\t\t\t\t\"name\": \"carTypeText\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\t\"name\": \"add\",\n\t\t\t\t\t\t\"orderable\": false,\n\t\t\t\t\t\t\"render\": function render() {\n\t\t\t\t\t\t\tvar html = \"<button class='cancel close-picker add' >\" + i18next.t('COMMON.B.ADD') + \"</button>\";\n\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t}\n\t\t\t\t\t}],\n\t\t\t\t\t\"data\": []\n\t\t\t\t});\n\t\t\t\t$('#selectTable', _this.page).on('click', '.add', function () {\n\t\t\t\t\t$('.masked').css('display', 'none');\n\n\t\t\t\t\t$('#productmark').val(_this.initTable.row($(this).parents('tr')).data().productNum);\n\n\t\t\t\t\tvar subAssemblyBarcodeSelected = _this.initTable.row($(this).parents('tr')).data().subAssemblyBarcode;\n\n\t\t\t\t\tif (subAssemblyBarcodeSelected) {\n\t\t\t\t\t\t_this.subAssemblyBarcodeShouldPrint = true;\n\t\t\t\t\t\t_this.$midInput.val(subAssemblyBarcodeSelected).attr(\"disabled\", \"disabled\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t_this.subAssemblyBarcodeShouldPrint = false;\n\t\t\t\t\t\t_this.$midInput.val(\"\").removeAttr(\"disabled\").focus();\n\t\t\t\t\t}\n\n\t\t\t\t\t_this.productmark();\n\t\t\t\t});\n\t\t\t}\n\t\t\tapp.request({\n\t\t\t\turl: \"restful/service/execute\",\n\t\t\t\tdata: {\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART004',\n\t\t\t\t\tsiteCode: security.getSiteCode(),\n\t\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\t\trowNum: \"500\"\n\t\t\t\t},\n\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\tutil.rightCode(response, createSelectTable);\n\t\t\t\t}\n\t\t\t});\n\t\t\tfunction createSelectTable(response) {\n\n\t\t\t\t$('.infinite-scroll-preloader').remove();\n\t\t\t\t$('#selectTable').removeClass('hidden');\n\n\t\t\t\t_this.initTable.clear();\n\t\t\t\t_this.initTable.rows.add(response.data).draw();\n\t\t\t}\n\t\t});\n\t},\n\tpickerAndMaskedEvent: function pickerAndMaskedEvent() {\n\t\t$('.close-picker').on('click', function () {\n\t\t\t$('.masked').css('display', 'none');\n\t\t});\n\n\t\t$('.masked').click(function () {\n\t\t\t$(this).css('display', 'none');\n\t\t});\n\t},\n\tproductmark: function productmark() {\n\t\tvar _this = this;\n\t\tvar $productmark = $(\"#productmark\", _this.page);\n\t\tvar productNum = $productmark.val();\n\t\tif (productNum) {\n\t\t\t$productmark.focus().select();\n\t\t\t_this.loadTableByProductNum();\n\t\t} else {\n\t\t\tutil.notify({\n\t\t\t\ttype: \"3\",\n\t\t\t\ttext: \"产品标识不能为空\"\n\t\t\t}, function () {\n\t\t\t\t$productmark.focus();\n\t\t\t});\n\t\t}\n\t},\n\tloadTableByProductNum: function loadTableByProductNum() {\n\t\tvar _this = this;\n\t\tutil.service('GMES-CLIENT-KEYPART012', {\n\t\t\tsiteCode: app.siteCode,\n\t\t\tstationCode: _this.station.stationCode,\n\t\t\tproductNum: _this.$productmark.val().toUpperCase()\n\t\t}).done(function (response) {\n\t\t\tutil.rightCode(response, createTable);\n\t\t});\n\n\t\tfunction createTable(response) {\n\t\t\t_this.First = response.data.first;\n\t\t\tvar data = response.data.list;\n\t\t\tvar dataLength = data.length;\n\n\t\t\tif (_this.First && dataLength <= 0) {\n\t\t\t\t_this.emptySave();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (dataLength <= 0) {\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_RECORDLIST_IS_EMPTY\")\n\t\t\t\t});\n\t\t\t\t_this.table.clear().draw();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (_this.First) {\n\t\t\t\tvar list = [];\n\t\t\t\tvar keypartCount = 0;\n\t\t\t\t_this.alternateRelation = {};\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tvar quantity = data[i].quantity;\n\t\t\t\t\tfor (var j = 0; j < quantity; j++) {\n\t\t\t\t\t\tvar keypart = {};\n\t\t\t\t\t\tkeypart = $.extend(keypart, data[i]);\n\t\t\t\t\t\tkeypart.supplierCode = \"\";\n\t\t\t\t\t\tkeypart.lotNum = \"\";\n\t\t\t\t\t\tlist.push(keypart);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data[i].alternateGroup) {\n\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = {\n\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].alternateGroup]) {\n\t\t\t\t\t\t\tif (quantity > _this.alternateRelation[data[i].alternateGroup].maxCount) {\n\t\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].maxCount = quantity;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\n\t\t\t\t\t\t\t\tisGroup: true,\n\t\t\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\t\t\tmaxCount: quantity\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tkeypartCount += parseInt(quantity);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var key in _this.alternateRelation) {\n\t\t\t\t\tif (_this.alternateRelation[key].isGroup) {\n\t\t\t\t\t\tkeypartCount += parseInt(_this.alternateRelation[key].maxCount);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$allCount.text(keypartCount);\n\t\t\t\t_this.$undoCount.text(keypartCount);\n\t\t\t\t_this.undoCount = keypartCount;\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(list).draw();\n\t\t\t} else {\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(data).draw();\n\t\t\t\tvar keypartCount = 0;\n\t\t\t\tvar validCount = 0;\n\t\t\t\t_this.alternateRelation = {};\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\n\t\t\t\t\t\tvalidCount++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data[i].alternateGroup) {\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].keypartCode]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode].maxCount += 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = {\n\t\t\t\t\t\t\t\tmaxCount: 1,\n\t\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].alternateGroup]) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\n\t\t\t\t\t\t\t\tisGroup: true,\n\t\t\t\t\t\t\t\tmaxCount: 0,\n\t\t\t\t\t\t\t\tcount: 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].count++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tkeypartCount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var key in _this.alternateRelation) {\n\t\t\t\t\tif (!_this.alternateRelation[key].isGroup) {\n\t\t\t\t\t\tvar alternateForGroup = _this.alternateRelation[key].alternateForGroup;\n\t\t\t\t\t\tif (_this.alternateRelation[key].maxCount > _this.alternateRelation[alternateForGroup].maxCount) {\n\t\t\t\t\t\t\t_this.alternateRelation[alternateForGroup].maxCount = _this.alternateRelation[key].maxCount;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (var key in _this.alternateRelation) {\n\t\t\t\t\tif (_this.alternateRelation[key].isGroup) {\n\t\t\t\t\t\tkeypartCount += _this.alternateRelation[key].maxCount;\n\n\t\t\t\t\t\tif (_this.alternateRelation[key].count >= _this.alternateRelation[key].maxCount) {\n\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\t\treturn data.alternateGroup === key && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t\t}).every(function () {\n\t\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\t\td.invalid = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$allCount.text(keypartCount);\n\t\t\t\t_this.undoCount = keypartCount - validCount;\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\t\t\t}\n\t\t\t_this.subAssemblyBarcodeShouldPrint && $('#lotBarCodeInput').focus();\n\t\t}\n\t},\n\tlotBarCodeInputEvent: function lotBarCodeInputEvent() {\n\t\tvar _this = this;\n\t\tvar $lotBarCodeInput = $(\"#lotBarCodeInput\", _this.page);\n\t\t$lotBarCodeInput.keyup(function (event) {\n\t\t\tvar reg = /[^\\w\\.\\/]/ig;\n\t\t\tif (reg.test(this.value)) {\n\t\t\t\tthis.value = this.value.replace(reg, '');\n\t\t\t}\n\t\t\tif (event.keyCode == 13) {\n\t\t\t\tvar lotBarCode = $lotBarCodeInput.val();\n\t\t\t\tif (lotBarCode) {\n\t\t\t\t\t$lotBarCodeInput.focus().select();\n\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\tresolveLotBarCode(lotBarCode);\n\t\t\t\t} else {\n\t\t\t\t\tutil.notify({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_NOT_BE_NULL\")\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\t$lotBarCodeInput.focus();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfunction resolveLotBarCode(code) {\n\t\t\tapp.request({\n\t\t\t\turl: 'restful/service/execute',\n\t\t\t\tdata: {\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART002',\n\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\tbarcode: code.toUpperCase()\n\t\t\t\t},\n\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\tutil.rightCode(response, dealKeypartCode);\n\t\t\t\t},\n\t\t\t\terror: function error() {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ERROR\", {\n\t\t\t\t\t\t\tlength: code.length\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction dealKeypartCode(response) {\n\t\t\tvar returnData = response.data;\n\t\t\tvar keypartCode = returnData.materialCode;\n\n\t\t\tvar keypartAlternateGroup;\n\t\t\tif (_this.alternateRelation[keypartCode]) {\n\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\n\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttype: \"3\",\n\t\t\t\t\t\ttext: \"组件数量已满！\"\n\t\t\t\t\t});\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar rowSelect = _this.table.row(function (idx, data, node) {\n\t\t\t\treturn data.keypartCode === keypartCode && data.invalid != true && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t});\n\n\t\t\tvar rowSelectMatch = _this.table.row(function (idx, data, node) {\n\t\t\t\treturn data.keypartCode === keypartCode && (data.statusEcode == 1 || data.statusEcode == 2) ? true : false;\n\t\t\t});\n\n\t\t\tvar rowData = rowSelect.data();\n\t\t\tvar rowMatchData = rowSelectMatch.data();\n\t\t\tif (rowData) {\n\t\t\t\trowData.supplierCode = returnData.supplierCode;\n\t\t\t\trowData.lotNum = returnData.lotNum;\n\t\t\t\trowData.supplierText = returnData.supplierText;\n\t\t\t\tif (returnData.valid) {\n\t\t\t\t\trowData.statusEcode = 1;\n\t\t\t\t} else {\n\t\t\t\t\trowData.statusEcode = 2;\n\t\t\t\t}\n\n\t\t\t\tvar rowIndex = rowSelect.index();\n\t\t\t\tvar tableData = _this.table.data().toArray();\n\t\t\t\ttableData.splice(rowIndex, 1);\n\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\n\t\t\t\t\ttableData.splice(0, 1);\n\t\t\t\t\ttableData.push(tableDataFirst);\n\t\t\t\t}\n\t\t\t\ttableData.unshift(rowData);\n\t\t\t\t_this.table.clear();\n\t\t\t\t_this.table.rows.add(tableData).draw();\n\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ANALYSE_SUCCESS\")\n\t\t\t\t});\n\n\t\t\t\t_this.undoCount--;\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\n\n\t\t\t\tif (keypartAlternateGroup) {\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count++;\n\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\n\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\n\t\t\t\t\t\t\treturn data.alternateGroup === keypartAlternateGroup && data.statusEcode != 1 && data.statusEcode != 2 ? true : false;\n\t\t\t\t\t\t}).every(function () {\n\t\t\t\t\t\t\tvar d = this.data();\n\t\t\t\t\t\t\td.invalid = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this.table.draw();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus();\n\t\t\t} else {\n\t\t\t\tvar contentMsg = i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\");\n\t\t\t\tif (rowMatchData) {\n\t\t\t\t\tcontentMsg = \"重复扫描！\";\n\t\t\t\t}\n\t\t\t\tnotie.alert({\n\t\t\t\t\ttype: \"3\",\n\t\t\t\t\ttext: contentMsg\n\t\t\t\t});\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t}\n\t\t}\n\t},\n\tinitData: function initData() {\n\t\tvar _this = this;\n\t\tvar rowData = _this.selectRow.data();\n\t\t$(\"#supplierListRender\", _this.page).on('click', '.content label', function () {\n\t\t\t$(\".batch-input\").focus();\n\t\t});\n\t\tapp.request({\n\t\t\turl: \"restful/service/execute\",\n\t\t\tdata: {\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART006\",\n\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\tmaterialCode: rowData.keypartCode\n\t\t\t},\n\t\t\tsuccess: function success(response) {\n\t\t\t\tutil.rightCode(response, ListRender);\n\t\t\t}\n\t\t});\n\n\t\tfunction ListRender(response) {\n\t\t\tvar renderData = {\n\t\t\t\tsupplierLabel: i18next.t(\"KEYPART.T.SUPPLIER\"),\n\t\t\t\tsupplierList: response.data\n\t\t\t};\n\t\t\tutil.tplManager(\"supplierListTpl\", renderData, \"supplierListRender\");\n\n\t\t\tvar fromSupplierCode = rowData.supplierCode;\n\t\t\tif (fromSupplierCode) {\n\t\t\t\t$(\"input[name='provider'][value=\" + fromSupplierCode + \"]\").attr(\"checked\", true);\n\t\t\t}\n\t\t};\n\t},\n\theaderEvent: function headerEvent() {\n\t\tvar _this = this;\n\t\t$('.head-confirm').on('click', function () {\n\t\t\tsaveDataToServer();\n\t\t\tfunction saveDataToServer() {\n\t\t\t\tvar tableData = _this.table.data();\n\t\t\t\tvar dataLength = tableData.length;\n\t\t\t\tif (dataLength <= 0) {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_NO_DATA_TO_SUBMIT\")\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar subAssemblyNum = $.trim(_this.$midInput.val());\n\t\t\t\tif (subAssemblyNum == \"\") {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_SUBASSEMBLY_BARCODE_NO_NOT_BE_NULL\")\n\t\t\t\t\t});\n\t\t\t\t\t_this.$midInput.focus();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar param = {\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART001\",\n\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\t\tproductNum: _this.$productmark.val().toUpperCase(),\n\t\t\t\t\tcreateUser: _this.userCode,\n\t\t\t\t\tmodifyUser: _this.userCode,\n\t\t\t\t\tsubAssemblyBarcode: _this.$midInput.val().toUpperCase(),\n\t\t\t\t\tsubAssemblyFlag: 1,\n\t\t\t\t\tstatusECode: \"10\"\n\t\t\t\t};\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\n\t\t\t\t\tvar tableDataI = tableData[i];\n\n\t\t\t\t\tif (tableDataI.notNullFlag == 1 && tableDataI.invalid != true && tableDataI.statusEcode != 1 && tableDataI.statusEcode != 2) {\n\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\ttype: \"3\",\n\n\t\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_HAVE_NOT_NULL_DATA_SUBMIT\", {\n\t\t\t\t\t\t\t\tkeypartCode: tableDataI.keypartCode\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var key in tableDataI) {\n\t\t\t\t\t\tif (tableDataI.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tif ([\"createDate\", \"createDateTime\", \"modifyDate\", \"modifyDateTime\", \"invalid\"].indexOf(key) < 0) {\n\t\t\t\t\t\t\t\tvar keyNew = \"items[\" + i + \"].\" + key;\n\t\t\t\t\t\t\t\tif (key == \"statusEcode\" && (tableDataI[key] == \"\" || tableDataI[key] == null || !tableDataI[key])) {\n\t\t\t\t\t\t\t\t\tparam[keyNew] = 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tparam[keyNew] = tableDataI[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (_this.undoCount > 0) {\n\t\t\t\t\tmyApp.confirm('数据录入不完整，确定要提交？', function () {\n\t\t\t\t\t\tsubmitConfirm();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsubmitConfirm();\n\t\t\t\t}\n\n\t\t\t\tfunction submitConfirm() {\n\t\t\t\t\tmyApp.showPreloader(\"数据保存中...\");\n\t\t\t\t\tapp.request({\n\t\t\t\t\t\turl: 'restful/service/execute',\n\t\t\t\t\t\tdata: param,\n\t\t\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\t\t\tutil.rightCode(response, saveDataSuccess);\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: function error() {\n\n\t\t\t\t\t\t\tmyApp.hidePreloader();\n\t\t\t\t\t\t\tmyApp.modal({\n\t\t\t\t\t\t\t\ttitle: 'iME',\n\t\t\t\t\t\t\t\ttext: '数据保存失败，选择操作',\n\t\t\t\t\t\t\t\tbuttons: [{\n\t\t\t\t\t\t\t\t\ttext: '扫下一个',\n\t\t\t\t\t\t\t\t\tonClick: function onClick() {\n\t\t\t\t\t\t\t\t\t\t_this.loadPageAgain();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\t\ttext: '继续修改',\n\t\t\t\t\t\t\t\t\tbold: true,\n\t\t\t\t\t\t\t\t\tonClick: function onClick() {\n\t\t\t\t\t\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tfunction printData() {\n\t\t\t\t\tif (_this.subAssemblyBarcodeShouldPrint) {\n\t\t\t\t\t\tapp.request({\n\t\t\t\t\t\t\turl: \"restful/service/execute\",\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART017\",\n\t\t\t\t\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\t\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\t\t\t\t\tkeyPartCode: subAssemblyNum.toUpperCase()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\t\t\t\tif (response.returnCode == \"0\") {\n\t\t\t\t\t\t\t\t\tconsole.log(subAssemblyNum + \" 打印成功！\");\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\t\t\t\ttype: \"3\",\n\t\t\t\t\t\t\t\t\t\ttext: \"打印失败\"\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\terror: function error() {\n\t\t\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\t\t\ttype: \"3\",\n\t\t\t\t\t\t\t\t\ttext: \"打印失败\"\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfunction saveDataSuccess() {\n\t\t\t\t\tprintData();\n\t\t\t\t\tmyApp.hidePreloader();\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_SUCCESS\")\n\t\t\t\t\t});\n\t\t\t\t\t_this.table.clear().draw();\n\t\t\t\t\t_this.$allCount.text(0);\n\t\t\t\t\t_this.$undoCount.text(0);\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\n\t\t\t\t\t_this.loadPageAgain();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\temptySave: function emptySave() {\n\t\tvar _this = this;\n\t\tmyApp.modal({\n\t\t\ttitle: 'iME',\n\t\t\ttext: '清单为空，跳过请标记：',\n\t\t\tbuttons: [{\n\t\t\t\ttext: '取消',\n\t\t\t\tonClick: function onClick() {\n\t\t\t\t\tSweet.mainView.router.loadPage(\"home.html\");\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\ttext: '异常',\n\t\t\t\tonClick: function onClick() {\n\t\t\t\t\t_this.emptyNormalFlag = \"30\";\n\t\t\t\t\temptySave();\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\ttext: '正常',\n\t\t\t\tbold: true,\n\t\t\t\tonClick: function onClick() {\n\t\t\t\t\t_this.emptyNormalFlag = \"20\";\n\t\t\t\t\temptySave();\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\n\t\tfunction emptySave() {\n\t\t\tvar param = {\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART001\",\n\t\t\t\tsiteCode: app.siteCode,\n\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\tproductNum: _this.$productmark.val().toUpperCase(),\n\t\t\t\tcreateUser: _this.userCode,\n\t\t\t\tmodifyUser: _this.userCode,\n\t\t\t\tsubAssemblyBarcode: _this.$midInput.val().toUpperCase(),\n\t\t\t\tsubAssemblyFlag: 1,\n\t\t\t\tstatusECode: _this.emptyNormalFlag };\n\t\t\tapp.request({\n\t\t\t\turl: \"restful/service/execute\",\n\t\t\t\tdata: param,\n\t\t\t\tsuccess: function success(response) {\n\t\t\t\t\tif (response.returnCode === \"0\") {\n\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\ttext: \"标记成功！\"\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\t\ttype: \"3\",\n\t\t\t\t\t\t\ttext: response.errorMessage\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t_this.table.clear().draw();\n\t\t\t\t\t_this.$allCount.text(0);\n\t\t\t\t\t_this.$undoCount.text(0);\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\n\t\t\t\t\t_this.loadPageAgain();\n\t\t\t\t},\n\t\t\t\terror: function error() {\n\t\t\t\t\tnotie.alert({\n\t\t\t\t\t\ttype: \"3\",\n\t\t\t\t\t\ttext: \"标记失败！\"\n\t\t\t\t\t});\n\t\t\t\t\t_this.table.clear().draw();\n\t\t\t\t\t_this.$allCount.text(0);\n\t\t\t\t\t_this.$undoCount.text(0);\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\n\t\t\t\t\t_this.loadPageAgain();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tpickermodalclose: function pickermodalclose(inputSelector) {\n\t\tinputSelector && document.querySelector(inputSelector) && document.querySelector(inputSelector).focus();\n\t}\n};\n\nmodule.exports = keyComponentsOfPackagingCollectionCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(37), __webpack_require__(77), __webpack_require__(36)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/pqs_keyComponentsOfPackagingCollection_4d86a75ce6cf8949286e.js","/*\r\n * @name: \\pqs\\keyComponentsOfPackagingCollection.js\r\n * @url: http://git.evun.cn/GMES/GMES_CLIENT_PAD\r\n * @author: EVUN前端组\r\n * @modify: kelichao\r\n * @update: 2017-06-13\r\n * @decript: 关重件分装采集\r\n */\r\n\r\nvar security = require(\"security\");\r\nvar util = require('util');\r\n\r\nvar keyComponentsOfPackagingCollectionCtrl = {\r\n\tselectRow: null,\r\n\tselectRowData: null,\r\n\tinitTable: null,\r\n\tpage: undefined,\r\n\ttable: null,\r\n\tuserCode: null,\r\n\tstationPage: undefined,\r\n\tsubAssemblyBarcodeShouldPrint: undefined,\r\n\tinit: function () {\r\n\t\tvar _this = this;\r\n\t\tif (_this.initTable) {\r\n\t\t\t_this.initTable = undefined;\r\n\t\t}\r\n\t\tutil.translate(_this.page);\r\n\t\tthis.lotBarCodeInputEvent();\r\n\t\tthis.headerEvent();\r\n\r\n\t\tthis.$undoCount = $(\"#currentNum\", this.page);\r\n\t\tthis.$allCount = $(\"#allNum\", this.page);\r\n\t\tthis.$productmark = $(\"#productmark\", this.page);\r\n\t\tthis.$lotBarCodeInput = $(\"#lotBarCodeInput\", this.page);\r\n\t\tthis.$midInput = $(\".midInput\", this.page);\r\n\t\tthis.$ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\r\n\r\n\t\t// 该数据已经有了的\r\n\t\tsecurity.isUniqueOperableStation(function (station) {\r\n\t\t\t_this.stationPage = station;\r\n\t\t\t_this.station = station;\r\n\t\t\t_this.loadPage();\r\n\t\t\tutil.setBreadcrumb([i18next.t(\"KEYPART.T.MENU_SUBASSEMBLY_COLLECT\") + \"(\" + _this.station.stationCode + \"\" + \")\"]);\r\n\t\t\t// 判断对应站点是否为关重件采集分装站点,不是则返回主页面\r\n\t\t\tutil.service(\"GMES-CLIENT-KEYPART014\",\r\n\t\t\t\t{\r\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART014\",\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\tstationCode: _this.station.stationCode\r\n\t\t\t\t})\r\n\t\t\t\t.done(function (response) {\r\n\t\t\t\t\tutil.rightCode(response, confirmStationType);\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\tfunction confirmStationType(response) {\r\n\t\t\t\tif (response.data != true) {\r\n\r\n\t\t\t\t\t//_this.initTableOne(); //初始化表格，data为空数组\r\n\t\t\t\t\t_this.$productmark.attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t_this.$midInput.attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t_this.$lotBarCodeInput.attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$('#select').attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$('.head-confirm').attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\tnotie.force({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_INVALID_PERMISSIONS\")// 请核对用户权限！\r\n\t\t\t\t\t}, function () {\r\n\t\t\t\t\t\tSweet.mainView.router.load({\r\n\t\t\t\t\t\t\turl: \"views/index.html\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_this.loadPageAgain();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tloadPageAgain: function () {\r\n\t\t//关重件分装产品标识号查询接口测试\r\n\t\tvar _this = this;\r\n\r\n\t\tutil.service('GMES-CLIENT-KEYPART005',\r\n\t\t\t{\r\n\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\tstationCode: _this.station.stationCode,\r\n\t\t\t\trowNum: \"500\"\r\n\t\t\t})\r\n\t\t\t.done(function (response) {\r\n\t\t\t\tutil.rightCode(response, dealProductNumAndsubCode);\r\n\t\t\t});\r\n\r\n\t\tfunction dealProductNumAndsubCode(response) {\r\n\t\t\tvar data = response.data;\r\n\r\n\t\t\t// 产品标识号根据返回的数据自动填充\r\n\t\t\tvar vin_six = data.productNum.substr(data.productNum.length - 6);\r\n\t\t\tvar productNum = data.productNum//data.productionControlNum + \"(\" + vin_six + \")\";\r\n\t\t\t_this.$productmark.val(productNum);\r\n\r\n\t\t\t// 根据产品标识号查询扫描清单\r\n\t\t\t// _this.loadTableByProductNum();\r\n\t\t\t// 分总成条码，如果返回的数据中有则自动填充不可修改，如果没有则置空可以修改\r\n\t\t\tif (data.subAssemblyBarcode) {\r\n\t\t\t\t_this.subAssemblyBarcodeShouldPrint = true;\r\n\t\t\t\t_this.$midInput.val(data.subAssemblyBarcode).attr(\"disabled\", \"disabled\");\r\n\t\t\t} else {\r\n\t\t\t\t_this.subAssemblyBarcodeShouldPrint = false;\r\n\t\t\t\t_this.$midInput.val(\"\").removeAttr(\"disabled\").focus();\r\n\t\t\t}\r\n\r\n\t\t\tif (!data.productNum || data.productNum === \"\") {\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\ttext: \"产品标识为空！\"\r\n\t\t\t\t});\r\n\t\t\t\t_this.$lotBarCodeInput.attr(\"disabled\", \"disabled\");\r\n\t\t\t} else {\r\n\t\t\t\t_this.$lotBarCodeInput.removeAttr(\"disabled\");\r\n\t\t\t\t// 根据产品标识号查询扫描清单\r\n\t\t\t\t_this.loadTableByProductNum();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\tloadPage: function () {\r\n\t\tvar _this = this;\r\n\t\t//初始化光标显示在产品标识中\r\n\t\t$('#productmark').focus();\r\n\t\t//表格加载\r\n\t\tvar scrollY = this.page.height - 158 - 53;\r\n\t\t_this.$table = $('.table-panel table', _this.page);\r\n\t\t_this.table = $('#myTable', _this.page).DataTable({\r\n\t\t\t\"serverSide\": false,\r\n\t\t\t\"paging\": false, //分页效果取消\r\n\t\t\t\"searching\": false, //查找效果取消\r\n\t\t\t\"scrollY\": scrollY, // 滚动高度为零\r\n\t\t\t\"order\": [],\r\n\t\t\t\"data\": [],\r\n\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\r\n\t\t\t\"columns\": [{\r\n\t\t\t\t\"data\": \"keypartCode\",\r\n\t\t\t\t\"name\": \"keypartCode\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function (data, type, row) {\r\n\t\t\t\t\treturn '<span class=\"ipCollect-component-value\">' + row.keypartCode + '</span>';\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t\"className\": \"supplierCode\",\r\n\t\t\t\t\"data\": \"supplierCode\",\r\n\t\t\t\t\"name\": \"supplierCode\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function (data, type, row) {\r\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-supplier-value ipCollect-open-picker\">' + (row.supplierCode || \"\") + '</a>';\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\t\"className\": \"supplierCode\",\r\n\t\t\t\t\"data\": \"lotNum\",\r\n\t\t\t\t\"name\": \"lotNum\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function (data, type, row) {\r\n\t\t\t\t\treturn '<a style=\"cursor:pointer;\" class=\"ipCollect-open-picker-batch-value  ipCollect-open-picker\">' + (row.lotNum || \"\") + '</a>';\r\n\t\t\t\t}\r\n\r\n\t\t\t}, {\r\n\t\t\t\t\"data\": \"keypartText\",\r\n\t\t\t\t\"name\": \"keypartText\",\r\n\t\t\t\t\"orderable\": false\r\n\r\n\t\t\t}, {\r\n\t\t\t\t\"data\": \"supplierText\",\r\n\t\t\t\t\"name\": \"supplierText\",\r\n\t\t\t\t\"orderable\": false\r\n\t\t\t}, {\r\n\t\t\t\t\"name\": \"remove\",\r\n\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\"render\": function () {\r\n\t\t\t\t\treturn \"<button class='cancel' >\" + i18next.t('KEYPART.B.REPEAL') + \"</button>\";\r\n\t\t\t\t}\r\n\t\t\t}],\r\n\t\t\t\"rowCallback\": function (row, data) {\r\n\t\t\t\t$(row).find(\"td:last-child button\").on(\"click\", function (e) {\r\n\t\t\t\t\t_this.selectRow = _this.table.row(row);\r\n\t\t\t\t\tvar data = _this.selectRow.data();\r\n\t\t\t\t\tif (!$(row).hasClass('invalid')) {\r\n\t\t\t\t\t\tif ($(this).parent().parent().find(\"td:eq(1) a\").text() || $(this).parent().parent().find(\"td:eq(2) a\").text()) {\r\n\t\t\t\t\t\t\tdata[\"lotBarCode\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"lotNum\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"supplierCode\"] = \"\";\r\n\t\t\t\t\t\t\tdata[\"supplierText\"] = \"\";\r\n\t\t\t\t\t\t\t_this.table.row(row).data(data).draw();\r\n\t\t\t\t\t\t\tvar statusEcodeOld = data.statusEcode;\r\n\t\t\t\t\t\t\tdata.statusEcode = 0;\r\n\t\t\t\t\t\t\t//填入最后一行\r\n\t\t\t\t\t\t\tvar rowIndex = _this.selectRow.index();\r\n\t\t\t\t\t\t\tvar tableRow = _this.table.data().toArray();\r\n\t\t\t\t\t\t\ttableRow.splice(rowIndex, 1);\r\n\t\t\t\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\t\t\t\tvar tableDataFirst = tableRow.length > 1 ? tableRow[0] : undefined;\r\n\t\t\t\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\t\t\t\ttableRow.splice(0, 1);\r\n\t\t\t\t\t\t\t\ttableRow.push(tableDataFirst);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttableRow.unshift(data);\r\n\t\t\t\t\t\t\t// tableRow.push(data);\r\n\t\t\t\t\t\t\t_this.table.clear();\r\n\r\n\t\t\t\t\t\t\t_this.undoCount++;\r\n\t\t\t\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t\t\t\t$(row).children().removeClass('error');\r\n\t\t\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn'); //加类判断删除条目\r\n\t\t\t\t\t\t\t_this.table.rows.add(tableRow).draw();\r\n\r\n\t\t\t\t\t\t\t// 已采数量改变标记\r\n\t\t\t\t\t\t\tvar countChange;\r\n\t\t\t\t\t\t\tif (statusEcodeOld > 0) {\r\n\t\t\t\t\t\t\t\tcountChange = -1;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcountChange = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar keypartCode = data.keypartCode;\r\n\t\t\t\t\t\t\tif (_this.alternateRelation[keypartCode]) {\r\n\t\t\t\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\r\n\t\t\t\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\r\n\t\t\t\t\t\t\t\tvar invalidFlag;\r\n\t\t\t\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\t\t\t\tinvalidFlag = true;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinvalidFlag = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\r\n\t\t\t\t\t\t\t\t\treturn (data.alternateGroup === keypartAlternateGroup) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t\t\t}).every(function (rowIdx, tableLoop, rowLoop) {\r\n\t\t\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\t\t\td.invalid = invalidFlag;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t});\r\n\t\t\t\tif (data.statusEcode == \"2\") {\r\n\t\t\t\t\t$(row).children().addClass('error');\r\n\t\t\t\t\t$(row).children('td').children('button').addClass('delBtn');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(row).children().removeClass('error');\r\n\t\t\t\t\t$(row).children('td').children('button').removeClass('delBtn');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (data.invalid == true) {\r\n\t\t\t\t\t$(row).addClass(\"invalid\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(row).removeClass(\"invalid\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#myTable').on('init.dt', function () {\r\n\t\t\t_this.pickerAndMaskedEvent();\r\n\t\t});\r\n\r\n\t\t//确认隐藏遮罩层\r\n\t\t$('.close-picker').on('click', function () {\r\n\t\t\t$('.masked').css('display', 'none');\r\n\t\t});\r\n\r\n\t\t// 点击一行，从下侧弹出可修改的弹出框\r\n\t\t$(\"tbody\", _this.$table).on(\"click\", \"tr:not(.invalid)\", function () {\r\n\t\t\t_this.selectRow = _this.table.row(this);\r\n\t\t\tvar data = _this.selectRow.data();\r\n\t\t\t$(\"#ipCollect-component\", _this.page).val(data[\"keypartCode\"]);\r\n\t\t\t$(\"#ipCollect-batchNumber\", _this.page).val(data[\"lotNum\"]);\r\n\t\t\t$(\"#ipCollect-supplier\", _this.page).val(data[\"supplierCode\"]);\r\n\t\t\t_this.initData();\r\n\t\t\tmyApp.pickerModal($(\".picker-1\", _this.page));\r\n\t\t\t$('.masked').css('display', 'block'); //确认按钮隐藏遮罩层\r\n\t\t});\r\n\r\n\t\t//点击罩层触发\r\n\t\t$('.masked').on('click', function () {\r\n\t\t\t$(this).css('display', 'none');\r\n\t\t});\r\n\r\n\t\t$('.close-picker').on('click', function () {\r\n\t\t\t_this.pickermodalclose('#lotBarCodeInput');\r\n\t\t});\r\n\r\n\t\t//确认按钮\r\n\t\t$('.ipCollect-confirm').on('click', function () {\r\n\t\t\t$('.masked').css('display', 'none'); //确认按钮隐藏遮罩层\r\n\t\t\tvar rowData = _this.selectRow.data();\r\n\t\t\tvar rowIndex = _this.selectRow.index();\r\n\t\t\tvar statusEcodeOld = rowData.statusEcode;\r\n\t\t\tvar statusEcodeNew;\r\n\t\t\tvar countChange; //已采数量改变标记\r\n\t\t\trowData.supplierCode = $('input:radio[name=\"provider\"]:checked').val() || \"\";\r\n\t\t\trowData.lotNum = $(\"#ipCollect-batchNumber\").val().toUpperCase() || \"\";\r\n\t\t\trowData.supplierText = $('input:radio[name=\"provider\"]:checked').next().children('span').text() || \"\";\r\n\t\t\tvar materialSupplierCondition;\r\n\r\n\t\t\t// 分装标识为0，且供应商不为空\r\n\t\t\tif (rowData.subAssemblyFlag != 1 && rowData.supplierCode !== \"\") {\r\n\r\n\t\t\t\tutil.service(\"restful/service/execute\",\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART011\",\r\n\t\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\t\tmaterialCode: _this.selectRow.data().keypartCode,\r\n\t\t\t\t\t\tsupplierCode: rowData.supplierCode\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.done(function (response) {\r\n\t\t\t\t\t\tutil.rightCode(response, judgeMaterialSupplierCondition);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\tfunction judgeMaterialSupplierCondition(response) {\r\n\t\t\t\t\tif (response.data == true) {\r\n\t\t\t\t\t\tmaterialSupplierCondition = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tmaterialSupplierCondition = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsaveToTable();\r\n\t\t\t\t}\r\n\t\t\t} else if (rowData.subAssemblyFlag == 1 && rowData.supplierCode !== \"\") {\r\n\t\t\t\tmaterialSupplierCondition = true;\r\n\t\t\t\tsaveToTable();\r\n\t\t\t} else {\r\n\t\t\t\tmaterialSupplierCondition = false;\r\n\t\t\t\tsaveToTable();\r\n\t\t\t}\r\n\r\n\t\t\tfunction saveToTable() {\r\n\t\t\t\t// 供应商和批次条码都为空，为未采，状态0\r\n\t\t\t\tif (rowData.supplierCode === \"\" && rowData.lotNum === \"\") {\r\n\t\t\t\t\tstatusEcodeNew = 0;\r\n\t\t\t\t} else if (rowData.supplierCode !== \"\" && materialSupplierCondition == true && rowData.lotNum !== \"\") { //供应商和批次条码都不为空，为已采正常，状态1\r\n\t\t\t\t\tstatusEcodeNew = 1;\r\n\r\n\t\t\t\t\t//供应商和批次条码有一个为空，为已采异常，状态2\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstatusEcodeNew = 2;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ((statusEcodeOld == 0 || !statusEcodeOld || statusEcodeOld == \"\") && statusEcodeNew > 0) {\r\n\t\t\t\t\tcountChange = 1;\r\n\t\t\t\t} else if (statusEcodeOld > 0 && statusEcodeNew == 0) {\r\n\t\t\t\t\tcountChange = -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcountChange = 0;\r\n\t\t\t\t}\r\n\t\t\t\trowData.statusEcode = statusEcodeNew;\r\n\r\n\t\t\t\t_this.table.row(rowIndex).data(rowData).draw();\r\n\r\n\t\t\t\t//填充的行换到第一行\r\n\t\t\t\tvar tableData = _this.table.data().toArray();\r\n\t\t\t\ttableData.splice(rowIndex, 1);\r\n\r\n\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\r\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\ttableData.splice(0, 1);\r\n\t\t\t\t\ttableData.push(tableDataFirst);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttableData.unshift(rowData);\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(tableData).draw();\r\n\t\t\t\t_this.$table.parent().scrollTop(0);\r\n\r\n\t\t\t\t_this.undoCount -= countChange;\r\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\r\n\t\t\t\tvar keypartCode = rowData.keypartCode;\r\n\t\t\t\tif (_this.alternateRelation[keypartCode]) {\r\n\t\t\t\t\tvar keypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\r\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count += countChange;\r\n\t\t\t\t\tvar invalidFlag;\r\n\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\tinvalidFlag = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tinvalidFlag = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_this.table.rows(function (idx, data) {\r\n\t\t\t\t\t\treturn (data.alternateGroup === keypartAlternateGroup) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t}).every(function () {\r\n\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\td.invalid = invalidFlag;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.table.draw();\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar $midInput = $('.midInput', _this.page);\r\n\t\t$midInput.keyup(function (event) {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif (reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t\tif (event.keyCode == 13) {\r\n\t\t\t\tevent.currentTarget.setAttribute('disabled', 'ture');\r\n\t\t\t\t$('.lotBarCodeInput', _this.page).focus();\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar $ipCollectBatchNumber = $(\"#ipCollect-batchNumber\", this.page);\r\n\t\t$ipCollectBatchNumber.keyup(function () {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif (reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t});\r\n\t\t$(\"#select\").on('click', function () {\r\n\t\t\tmyApp.pickerModal($(\".picker-2\", _this.page));\r\n\t\t\t$('.masked').css('display', 'block');\r\n\t\t\tif (!_this.initTable) {\r\n\t\t\t\t_this.initTable = $('#selectTable', this.page).DataTable({\r\n\t\t\t\t\t\"serverSide\": false,\r\n\t\t\t\t\t\"paging\": false, //分页效果取消\r\n\t\t\t\t\t\"searching\": false, //查找效果取消\r\n\t\t\t\t\t\"sScrollY\": 256, // 滚动高度为零\r\n\t\t\t\t\t\"dom\": \"<'row'<'col-50'f>><'row'<'col-100'tr>><'row'<'col-50'p>>\",\r\n\t\t\t\t\t\"columnDefs\": [{\r\n\t\t\t\t\t\t\"searchable\": false,\r\n\t\t\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\t\t\"targets\": 0\r\n\t\t\t\t\t}],\r\n\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\"columns\": [{\r\n\t\t\t\t\t\t\"name\": \"index\",\r\n\t\t\t\t\t\t\"render\": function (data, type, row, meta) {\r\n\t\t\t\t\t\t\treturn parseInt(meta.row[0] || meta.row) + 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"data\": \"productNum\",\r\n\t\t\t\t\t\t\"name\": \"productNum\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"data\": \"carTypeText\",\r\n\t\t\t\t\t\t\"name\": \"carTypeText\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"name\": \"add\",\r\n\t\t\t\t\t\t\"orderable\": false,\r\n\t\t\t\t\t\t\"render\": function () {\r\n\t\t\t\t\t\t\tvar html = \"<button class='cancel close-picker add' >\" + i18next.t('COMMON.B.ADD') + \"</button>\";\r\n\t\t\t\t\t\t\treturn html;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}],\r\n\t\t\t\t\t\"data\": []\r\n\t\t\t\t});\r\n\t\t\t\t$('#selectTable', _this.page).on('click', '.add', function () {\r\n\t\t\t\t\t$('.masked').css('display', 'none');\r\n\t\t\t\t\t//取选中行赋值给VIN框\r\n\t\t\t\t\t$('#productmark').val(_this.initTable.row($(this).parents('tr')).data().productNum);\r\n\r\n\t\t\t\t\tvar subAssemblyBarcodeSelected = _this.initTable.row($(this).parents('tr')).data().subAssemblyBarcode;\r\n\t\t\t\t\t// 分总成条码，如果返回的数据中有则自动填充不可修改，如果没有则置空可以修改\r\n\t\t\t\t\tif (subAssemblyBarcodeSelected) {\r\n\t\t\t\t\t\t_this.subAssemblyBarcodeShouldPrint = true;\r\n\t\t\t\t\t\t_this.$midInput.val(subAssemblyBarcodeSelected).attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t_this.subAssemblyBarcodeShouldPrint = false;\r\n\t\t\t\t\t\t_this.$midInput.val(\"\").removeAttr(\"disabled\").focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// $('#productmark').val($('#selectTable').DataTable().row($(this).parents('tr')).data().productNum);\r\n\t\t\t\t\t// $('.midInput').val($('#selectTable').DataTable().row($(this).parents('tr')).data().subAssemblyBarcode);\r\n\t\t\t\t\t_this.productmark();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tapp.request({\r\n\t\t\t\turl: \"restful/service/execute\",\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART004',\r\n\t\t\t\t\tsiteCode: security.getSiteCode(),\r\n\t\t\t\t\tstationCode: _this.station.stationCode,\r\n\t\t\t\t\trowNum: \"500\"\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\tutil.rightCode(response, createSelectTable);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tfunction createSelectTable(response) {\r\n\t\t\t\t//document.querySelector('.infinite-scroll-preloader')\r\n\r\n\t\t\t\t//document.querySelector('#selectTable').dataList.remove('hidden')\r\n\r\n\t\t\t\t$('.infinite-scroll-preloader').remove();\r\n\t\t\t\t$('#selectTable').removeClass('hidden');\r\n\r\n\t\t\t\t_this.initTable.clear();\r\n\t\t\t\t_this.initTable.rows.add(response.data).draw();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tpickerAndMaskedEvent: function () {\r\n\t\t//确认隐藏遮罩层\r\n\t\t$('.close-picker').on('click', function () {\r\n\t\t\t$('.masked').css('display', 'none');\r\n\t\t});\r\n\t\t//确认事件逻辑\r\n\t\t$('.masked').click(function () {\r\n\t\t\t$(this).css('display', 'none');\r\n\t\t});\r\n\t},\r\n\tproductmark: function () {\r\n\t\tvar _this = this;\r\n\t\tvar $productmark = $(\"#productmark\", _this.page);\r\n\t\tvar productNum = $productmark.val();\r\n\t\tif (productNum) {\r\n\t\t\t$productmark.focus().select();\r\n\t\t\t_this.loadTableByProductNum();\r\n\t\t} else {\r\n\t\t\tutil.notify({\r\n\t\t\t\ttype: \"3\",\r\n\t\t\t\ttext: \"产品标识不能为空\"\r\n\t\t\t}, function () {\r\n\t\t\t\t$productmark.focus();\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tloadTableByProductNum: function () {\r\n\t\tvar _this = this;\r\n\t\tutil.service('GMES-CLIENT-KEYPART012',{\r\n\t\t\tsiteCode: app.siteCode,\r\n\t\t\tstationCode: _this.station.stationCode,\r\n\t\t\tproductNum: _this.$productmark.val().toUpperCase()\r\n\t\t})\r\n\t\t.done(function (response) {\r\n\t\t\tutil.rightCode(response, createTable);\r\n\t\t});\r\n\r\n\r\n\t\tfunction createTable(response) {\r\n\t\t\t_this.First = response.data.first;\r\n\t\t\tvar data = response.data.list;\r\n\t\t\tvar dataLength = data.length;\r\n\t\t\t// 如果首次采集，并且扫描清单为空，弹出是否正常跳过\r\n\t\t\tif (_this.First && dataLength <= 0) {\r\n\t\t\t\t_this.emptySave();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (dataLength <= 0) {\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t// text: \"扫描清单为空！\"\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_RECORDLIST_IS_EMPTY\")\r\n\t\t\t\t});\r\n\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif (_this.First) { //首次采集\r\n\t\t\t\tvar list = [];\r\n\t\t\t\tvar keypartCount = 0;\r\n\t\t\t\t_this.alternateRelation = {}; //加载数据时，初始化一个空的替代组关系对象，\r\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\tvar quantity = data[i].quantity;\r\n\t\t\t\t\tfor (var j = 0; j < quantity; j++) {\r\n\t\t\t\t\t\tvar keypart = {};\r\n\t\t\t\t\t\tkeypart = $.extend(keypart, data[i]);\r\n\t\t\t\t\t\tkeypart.supplierCode = \"\";\r\n\t\t\t\t\t\tkeypart.lotNum = \"\";\r\n\t\t\t\t\t\tlist.push(keypart);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//如果此关重件有替代组，进行\r\n\t\t\t\t\tif (data[i].alternateGroup) {\r\n\t\t\t\t\t\t// 替代关系数量对象示例见页末\r\n\t\t\t\t\t\t// 有替代组的组件在替代组关系中维护关系对象，扫描数量中替代组只计算最大的一个，所以等维护好替代组关系之后再计算\r\n\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = { //替代组关系中，维护一个关重件对象\r\n\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t// 如果已有关重件替代组，其数量取其中关重件数量最大的一个\r\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].alternateGroup]) {\r\n\t\t\t\t\t\t\tif (quantity > _this.alternateRelation[data[i].alternateGroup].maxCount) {\r\n\t\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].maxCount = quantity;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else { // 如果没有关重件替代组，则新维护一个替代组对象\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\r\n\t\t\t\t\t\t\t\tisGroup: true,\r\n\t\t\t\t\t\t\t\tcount: 0,\r\n\t\t\t\t\t\t\t\tmaxCount: quantity\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 没有替代组的组件直接计算在扫描数量中\r\n\t\t\t\t\t\tkeypartCount += parseInt(quantity);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 关重件替代组数量加到扫描清单数量中去\r\n\t\t\t\tfor (var key in _this.alternateRelation) {\r\n\t\t\t\t\tif (_this.alternateRelation[key].isGroup) {\r\n\t\t\t\t\t\tkeypartCount += parseInt(_this.alternateRelation[key].maxCount);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$allCount.text(keypartCount);\r\n\t\t\t\t_this.$undoCount.text(keypartCount);\r\n\t\t\t\t_this.undoCount = keypartCount;\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(list).draw();\r\n\t\t\t} else { // 非首次采集\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(data).draw();\r\n\t\t\t\tvar keypartCount = 0;\r\n\t\t\t\tvar validCount = 0; //扫描清单已扫数量\r\n\t\t\t\t_this.alternateRelation = {}; //加载数据时，初始化一个空的替代组关系对象，\r\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\t// 扫描清单已扫数量计数\r\n\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\r\n\t\t\t\t\t\tvalidCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//如果此关重件有替代组，进行\r\n\t\t\t\t\tif (data[i].alternateGroup) {\r\n\t\t\t\t\t\t// 替代关系数量对象示例见页末\r\n\t\t\t\t\t\t// 有替代组的组件在替代组关系中维护关系对象，扫描数量中替代组只计算最大的一个，所以等维护好替代组关系之后再计算\r\n\r\n\t\t\t\t\t\t// 替代组关系中已有此关重件对象则计数统计\r\n\t\t\t\t\t\tif (_this.alternateRelation[data[i].keypartCode]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode].maxCount += 1;\r\n\t\t\t\t\t\t} else { //替代组关系中没有此关重件对象则新维护一个关重件对象\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].keypartCode] = {\r\n\t\t\t\t\t\t\t\tmaxCount: 1,\r\n\t\t\t\t\t\t\t\talternateForGroup: data[i].alternateGroup\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 如果没有关重件替代组，则新维护一个替代组对象，此最大数量取其中关重件数量中最大的一个，所以需要到维护好关重件对象再比较赋值\r\n\t\t\t\t\t\tif (!_this.alternateRelation[data[i].alternateGroup]) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup] = {\r\n\t\t\t\t\t\t\t\tisGroup: true,\r\n\t\t\t\t\t\t\t\tmaxCount: 0,\r\n\t\t\t\t\t\t\t\tcount: 0\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 替代组中已扫数量统计\r\n\t\t\t\t\t\tif (data[i].statusEcode == 1 || data[i].statusEcode == 2) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[data[i].alternateGroup].count++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 没有替代组的组件直接计算在扫描数量中\r\n\t\t\t\t\t\tkeypartCount++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 遍历替代组关系中关重件对象，设置关重件对象中数量最大值为替代组对象数量\r\n\t\t\t\tfor (var key in _this.alternateRelation) {\r\n\t\t\t\t\tif (!_this.alternateRelation[key].isGroup) {\r\n\t\t\t\t\t\tvar alternateForGroup = _this.alternateRelation[key].alternateForGroup;\r\n\t\t\t\t\t\tif (_this.alternateRelation[key].maxCount > _this.alternateRelation[alternateForGroup].maxCount) {\r\n\t\t\t\t\t\t\t_this.alternateRelation[alternateForGroup].maxCount = _this.alternateRelation[key].maxCount;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var key in _this.alternateRelation) {\r\n\t\t\t\t\tif (_this.alternateRelation[key].isGroup) {\r\n\t\t\t\t\t\t// 关重件替代组数量加到扫描清单数量中去\r\n\t\t\t\t\t\tkeypartCount += _this.alternateRelation[key].maxCount;\r\n\t\t\t\t\t\t// 如果该替代组数量已满，则将表格中其他未扫的关重件及替代组的扫描清单处置为灰色\r\n\t\t\t\t\t\tif (_this.alternateRelation[key].count >= _this.alternateRelation[key].maxCount) {\r\n\t\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\r\n\t\t\t\t\t\t\t\treturn (data.alternateGroup === key) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t\t}).every(function () {\r\n\t\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\t\td.invalid = true;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$allCount.text(keypartCount);\r\n\t\t\t\t_this.undoCount = keypartCount - validCount;\r\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t}\r\n\t\t\t_this.subAssemblyBarcodeShouldPrint && $('#lotBarCodeInput').focus();\r\n\t\t}\r\n\r\n\t},\r\n\tlotBarCodeInputEvent: function () {\r\n\t\tvar _this = this;\r\n\t\tvar $lotBarCodeInput = $(\"#lotBarCodeInput\", _this.page);\r\n\t\t$lotBarCodeInput.keyup(function (event) {\r\n\t\t\tvar reg = /[^\\w\\.\\/]/ig; //只能输入英文字母和数字,不能输入中文\r\n\t\t\tif (reg.test(this.value)) {\r\n\t\t\t\tthis.value = this.value.replace(reg, '');\r\n\t\t\t}\r\n\t\t\tif (event.keyCode == 13) {\r\n\t\t\t\tvar lotBarCode = $lotBarCodeInput.val();\r\n\t\t\t\tif (lotBarCode) {\r\n\t\t\t\t\t$lotBarCodeInput.focus().select();\r\n\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\tresolveLotBarCode(lotBarCode);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutil.notify({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"批次条码不能为空\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_NOT_BE_NULL\")\r\n\t\t\t\t\t}, function () {\r\n\t\t\t\t\t\t$lotBarCodeInput.focus();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction resolveLotBarCode(code) {\r\n\t\t\tapp.request({\r\n\t\t\t\turl: 'restful/service/execute',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserviceCode: 'GMES-CLIENT-KEYPART002',\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\tbarcode: code.toUpperCase()\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\tutil.rightCode(response, dealKeypartCode);\r\n\t\t\t\t},\r\n\t\t\t\terror: function () {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"批次条码没有按照{{length}}位的规则解析！\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ERROR\", {\r\n\t\t\t\t\t\t\tlength: code.length\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t// 根据返回的条码解析结果进行处理-数据填充，表格滚动，采集信息栏更新\r\n\t\tfunction dealKeypartCode(response) {\r\n\t\t\t// 根据条码解析结果进行处理\r\n\t\t\tvar returnData = response.data;\r\n\t\t\tvar keypartCode = returnData.materialCode;\r\n\t\t\t// 如果是有替代组的关重件或者替代组，则标记，并检查有替代组的关重件的已扫的关重件和替代组的数量已满，则提示，并退出\r\n\t\t\tvar keypartAlternateGroup;\r\n\t\t\tif (_this.alternateRelation[keypartCode]) {\r\n\t\t\t\tkeypartAlternateGroup = _this.alternateRelation[keypartCode].alternateForGroup;\r\n\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\ttext: \"组件数量已满！\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 根据返回的关重件物料编码选到对应的关重件\r\n\t\t\tvar rowSelect = _this.table.row(function (idx, data, node) {\r\n\t\t\t\treturn data.keypartCode === keypartCode && data.invalid != true && data.statusEcode != 1 && data.statusEcode != 2 ?\r\n\t\t\t\t\ttrue : false;\r\n\t\t\t});\r\n\r\n\t\t\tvar rowSelectMatch = _this.table.row(function (idx, data, node) {\r\n\t\t\t\treturn data.keypartCode === keypartCode && (data.statusEcode == 1 || data.statusEcode == 2) ?\r\n\t\t\t\t\ttrue : false;\r\n\t\t\t});\r\n\r\n\t\t\tvar rowData = rowSelect.data();\r\n\t\t\tvar rowMatchData = rowSelectMatch.data();\r\n\t\t\tif (rowData) {\r\n\t\t\t\t// 将对应的关重件的供应商和批次进行填充\r\n\t\t\t\trowData.supplierCode = returnData.supplierCode;\r\n\t\t\t\trowData.lotNum = returnData.lotNum;\r\n\t\t\t\trowData.supplierText = returnData.supplierText;\r\n\t\t\t\tif (returnData.valid) {\r\n\t\t\t\t\trowData.statusEcode = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trowData.statusEcode = 2;\r\n\t\t\t\t}\r\n\t\t\t\t// 将表格滚到刚填充的栏的位置\r\n\t\t\t\tvar rowIndex = rowSelect.index();\r\n\t\t\t\tvar tableData = _this.table.data().toArray();\r\n\t\t\t\ttableData.splice(rowIndex, 1);\r\n\t\t\t\t// 已扫的放到最后面\r\n\t\t\t\tvar tableDataFirst = tableData.length > 1 ? tableData[0] : undefined;\r\n\t\t\t\tif (tableDataFirst && (tableDataFirst.statusEcode == 1 || tableDataFirst.statusEcode == 2)) {\r\n\t\t\t\t\ttableData.splice(0, 1);\r\n\t\t\t\t\ttableData.push(tableDataFirst);\r\n\t\t\t\t}\r\n\t\t\t\ttableData.unshift(rowData);\r\n\t\t\t\t_this.table.clear();\r\n\t\t\t\t_this.table.rows.add(tableData).draw();\r\n\t\t\t\t// 扫描成功的提示扫描数据成功\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\t// text: \"扫描数据成功\"\r\n\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_BATCH_NO_ANALYSE_SUCCESS\")\r\n\t\t\t\t});\r\n\t\t\t\t// _this.$table.parent().scrollTop(0);\r\n\t\t\t\t// 当前采集信息栏数据进行更新\r\n\t\t\t\t_this.undoCount--;\r\n\t\t\t\t_this.$undoCount.text(_this.undoCount);\r\n\t\t\t\t// 如果是替代组或有替代组的关重件，则增加替代组关系表中关重件的已扫计数，如果数量已满，则将表格中其他未扫的关重件及替代组的扫描清单处置为灰色\r\n\t\t\t\tif (keypartAlternateGroup) {\r\n\t\t\t\t\t_this.alternateRelation[keypartAlternateGroup].count++;\r\n\t\t\t\t\tif (_this.alternateRelation[keypartAlternateGroup].count >= _this.alternateRelation[keypartAlternateGroup].maxCount) {\r\n\t\t\t\t\t\t_this.table.rows(function (idx, data, node) {\r\n\t\t\t\t\t\t\treturn (data.alternateGroup === keypartAlternateGroup) && (data.statusEcode != 1) && (data.statusEcode != 2) ?\r\n\t\t\t\t\t\t\t\ttrue : false;\r\n\t\t\t\t\t\t}).every(function () {\r\n\t\t\t\t\t\t\tvar d = this.data();\r\n\t\t\t\t\t\t\td.invalid = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_this.table.draw();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t_this.$lotBarCodeInput.val(\"\").focus();\r\n\t\t\t} else {\r\n\t\t\t\tvar contentMsg = i18next.t(\"KEYPART.T.MSG_NO_DATA_MATCH\");\r\n\t\t\t\tif (rowMatchData) {\r\n\t\t\t\t\tcontentMsg = \"重复扫描！\";\r\n\t\t\t\t}\r\n\t\t\t\tnotie.alert({\r\n\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\ttext: contentMsg\r\n\t\t\t\t});\r\n\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tinitData: function () {\r\n\t\tvar _this = this;\r\n\t\tvar rowData = _this.selectRow.data();\r\n\t\t$(\"#supplierListRender\", _this.page).on('click', '.content label', function () {\r\n\t\t\t$(\".batch-input\").focus();\r\n\t\t});\r\n\t\tapp.request({\r\n\t\t\turl: \"restful/service/execute\",\r\n\t\t\tdata: {\r\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART006\",\r\n\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\tmaterialCode: rowData.keypartCode\r\n\t\t\t},\r\n\t\t\tsuccess: function (response) {\r\n\t\t\t\tutil.rightCode(response, ListRender);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction ListRender(response) {\r\n\t\t\tvar renderData = {\r\n\t\t\t\tsupplierLabel: i18next.t(\"KEYPART.T.SUPPLIER\"),\r\n\t\t\t\tsupplierList: response.data\r\n\t\t\t};\r\n\t\t\tutil.tplManager(\"supplierListTpl\", renderData, \"supplierListRender\");\r\n\t\t\t// 如果供应商列表中有上个页面传过来的供应商，则该供应商默认选中\r\n\t\t\tvar fromSupplierCode = rowData.supplierCode;\r\n\t\t\tif (fromSupplierCode) {\r\n\t\t\t\t$(\"input[name='provider'][value=\" + fromSupplierCode + \"]\").attr(\"checked\", true);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t},\r\n\theaderEvent: function () {\r\n\t\tvar _this = this;\r\n\t\t$('.head-confirm').on('click', function () {\r\n\t\t\tsaveDataToServer();\r\n\t\t\tfunction saveDataToServer() {\r\n\t\t\t\tvar tableData = _this.table.data();\r\n\t\t\t\tvar dataLength = tableData.length;\r\n\t\t\t\tif (dataLength <= 0) {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"无提交数据！\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_NO_DATA_TO_SUBMIT\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// _this.$productmark.val(\"\").focus();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 保存提交时分总成条码不能为空\r\n\t\t\t\tvar subAssemblyNum = $.trim(_this.$midInput.val());\r\n\t\t\t\tif (subAssemblyNum == \"\") {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t// text: \"分总成条码不能为空\"\r\n\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_SUBASSEMBLY_BARCODE_NO_NOT_BE_NULL\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.$midInput.focus();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// 按接口格式生成需要的参数\r\n\t\t\t\tvar param = {\r\n\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART001\",\r\n\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\tstationCode: _this.station.stationCode,\r\n\t\t\t\t\tproductNum: _this.$productmark.val().toUpperCase(),\r\n\t\t\t\t\tcreateUser: _this.userCode,\r\n\t\t\t\t\tmodifyUser: _this.userCode,\r\n\t\t\t\t\tsubAssemblyBarcode: _this.$midInput.val().toUpperCase(),\r\n\t\t\t\t\tsubAssemblyFlag: 1,\r\n\t\t\t\t\tstatusECode: \"10\"\r\n\t\t\t\t};\r\n\t\t\t\tfor (var i = 0; i < dataLength; i++) {\r\n\t\t\t\t\tvar tableDataI = tableData[i];\r\n\t\t\t\t\t// if(tableDataI.notNullFlag == 1 && tableDataI.invalid != true && (tableDataI.statusEcode == \"\" || tableDataI.statusEcode == null || !(tableDataI.statusEcode))) {\r\n\t\t\t\t\tif ((tableDataI.notNullFlag == 1) && (tableDataI.invalid != true) && (tableDataI.statusEcode != 1) && (tableDataI.statusEcode != 2)) {\r\n\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t\t// text: \"XXX 数据不能为空\"\r\n\t\t\t\t\t\t\ttext: i18next.t(\"KEYPART.T.MSG_HAVE_NOT_NULL_DATA_SUBMIT\", {\r\n\t\t\t\t\t\t\t\tkeypartCode: tableDataI.keypartCode\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (var key in tableDataI) {\r\n\t\t\t\t\t\tif (tableDataI.hasOwnProperty(key)) {\r\n\t\t\t\t\t\t\tif ([\"createDate\", \"createDateTime\", \"modifyDate\", \"modifyDateTime\", \"invalid\"].indexOf(key) < 0) {\r\n\t\t\t\t\t\t\t\tvar keyNew = \"items[\" + i + \"].\" + key;\r\n\t\t\t\t\t\t\t\tif (key == \"statusEcode\" && (tableDataI[key] == \"\" || tableDataI[key] == null || !(tableDataI[key]))) {\r\n\t\t\t\t\t\t\t\t\tparam[keyNew] = 0;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tparam[keyNew] = tableDataI[key];\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (_this.undoCount > 0) {\r\n\t\t\t\t\tmyApp.confirm('数据录入不完整，确定要提交？', function () {\r\n\t\t\t\t\t\tsubmitConfirm();\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsubmitConfirm();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction submitConfirm() {\r\n\t\t\t\t\t// 如果分总成条码是由后台带出的，则打印分总成条码\r\n\r\n\t\t\t\t\t// 接入数据\r\n\t\t\t\t\tmyApp.showPreloader(\"数据保存中...\");\r\n\t\t\t\t\tapp.request({\r\n\t\t\t\t\t\turl: 'restful/service/execute',\r\n\t\t\t\t\t\tdata: param,\r\n\t\t\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\t\t\tutil.rightCode(response, saveDataSuccess);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function () {\r\n\t\t\t\t\t\t\t/*notie.alert({\r\n//\t\t\t\t\t\t\t\ttext: \"保存数据失败\"\r\n\t\t\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_FAILURE\")\r\n\t\t\t\t\t\t\t});*/\r\n\r\n\t\t\t\t\t\t\tmyApp.hidePreloader();\r\n\t\t\t\t\t\t\tmyApp.modal({\r\n\t\t\t\t\t\t\t\ttitle: 'iME',\r\n\t\t\t\t\t\t\t\ttext: '数据保存失败，选择操作',\r\n\t\t\t\t\t\t\t\tbuttons: [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttext: '扫下一个',\r\n\t\t\t\t\t\t\t\t\t\tonClick: function () {\r\n\t\t\t\t\t\t\t\t\t\t\t_this.loadPageAgain();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttext: '继续修改',\r\n\t\t\t\t\t\t\t\t\t\tbold: true,\r\n\t\t\t\t\t\t\t\t\t\tonClick: function () {\r\n\t\t\t\t\t\t\t\t\t\t\t_this.$lotBarCodeInput.focus().select();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tfunction printData() {\r\n\t\t\t\t\tif (_this.subAssemblyBarcodeShouldPrint) {\r\n\t\t\t\t\t\tapp.request({\r\n\t\t\t\t\t\t\turl: \"restful/service/execute\",\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART017\",\r\n\t\t\t\t\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\t\t\t\t\tstationCode: _this.station.stationCode,\r\n\t\t\t\t\t\t\t\tkeyPartCode: subAssemblyNum.toUpperCase()\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\t\t\t\tif (response.returnCode == \"0\") {\r\n\t\t\t\t\t\t\t\t\tconsole.log(subAssemblyNum + \" 打印成功！\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// console.log(subAssemblyNum + \" 打印失败！\");\r\n\t\t\t\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t\t\t\t\ttext: \"打印失败\"\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror: function () {\r\n\t\t\t\t\t\t\t\t// console.log(subAssemblyNum + \" 打印失败！\");\r\n\t\t\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t\t\t\ttext: \"打印失败\"\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfunction saveDataSuccess() {\r\n\t\t\t\t\tprintData();\r\n\t\t\t\t\tmyApp.hidePreloader();\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t// text: \"保存数据成功\"\r\n\t\t\t\t\t\ttext: i18next.t(\"COMMON.T.MSG_SAVE_DATA_SUCCESS\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\t\t_this.$allCount.text(0);\r\n\t\t\t\t\t_this.$undoCount.text(0);\r\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\r\n\t\t\t\t\t_this.loadPageAgain();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t},\r\n\temptySave: function () {\r\n\t\tvar _this = this;\r\n\t\tmyApp.modal({\r\n\t\t\ttitle: 'iME',\r\n\t\t\ttext: '清单为空，跳过请标记：',\r\n\t\t\tbuttons: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: '取消',\r\n\t\t\t\t\tonClick: function () {\r\n\t\t\t\t\t\tSweet.mainView.router.loadPage(\"home.html\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: '异常',\r\n\t\t\t\t\tonClick: function () {\r\n\t\t\t\t\t\t_this.emptyNormalFlag = \"30\";\r\n\t\t\t\t\t\temptySave();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttext: '正常',\r\n\t\t\t\t\tbold: true,\r\n\t\t\t\t\tonClick: function () {\r\n\t\t\t\t\t\t_this.emptyNormalFlag = \"20\";\r\n\t\t\t\t\t\temptySave();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t]\r\n\t\t});\r\n\t\t// 空表保存\r\n\t\tfunction emptySave() {\r\n\t\t\tvar param = {\r\n\t\t\t\tserviceCode: \"GMES-CLIENT-KEYPART001\",\r\n\t\t\t\tsiteCode: app.siteCode,\r\n\t\t\t\tstationCode: _this.station.stationCode,\r\n\t\t\t\tproductNum: _this.$productmark.val().toUpperCase(),\r\n\t\t\t\tcreateUser: _this.userCode,\r\n\t\t\t\tmodifyUser: _this.userCode,\r\n\t\t\t\tsubAssemblyBarcode: _this.$midInput.val().toUpperCase(),\r\n\t\t\t\tsubAssemblyFlag: 1,\r\n\t\t\t\tstatusECode: _this.emptyNormalFlag      // 跳过标识\r\n\t\t\t};\r\n\t\t\tapp.request({\r\n\t\t\t\turl: \"restful/service/execute\",\r\n\t\t\t\tdata: param,\r\n\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\tif (response.returnCode === \"0\") {\r\n\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\ttext: \"标记成功！\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\t\ttext: response.errorMessage\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\t\t_this.$allCount.text(0);\r\n\t\t\t\t\t_this.$undoCount.text(0);\r\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\r\n\t\t\t\t\t_this.loadPageAgain();\r\n\t\t\t\t},\r\n\t\t\t\terror: function () {\r\n\t\t\t\t\tnotie.alert({\r\n\t\t\t\t\t\ttype: \"3\",\r\n\t\t\t\t\t\ttext: \"标记失败！\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\t_this.table.clear().draw();\r\n\t\t\t\t\t_this.$allCount.text(0);\r\n\t\t\t\t\t_this.$undoCount.text(0);\r\n\t\t\t\t\t_this.$lotBarCodeInput.val(\"\");\r\n\t\t\t\t\t_this.loadPageAgain();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tpickermodalclose: function (inputSelector) {\r\n\t\tinputSelector && document.querySelector(inputSelector) && document.querySelector(inputSelector).focus();\r\n\t}\r\n};\r\n\r\nmodule.exports = keyComponentsOfPackagingCollectionCtrl;\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/pqs/keyComponentsOfPackagingCollection.js"],"sourceRoot":""}