webpackJsonp([21],{640:function(e,t,n){"use strict";(function(t){var o=n(35),i=n(34),r=n(53),a=n(78),s={intervalCont:null,noDataInterCont:null,stationCode:"",$timeEl:void 0,pages:void 0,page:void 0,$page:void 0,moduleConfig:void 0,data:{productNum:"--",productId:"--",carDescription:"--",remainingQuantity:"--",remark:"--",productionSeqNum:"--",workSteps:[]},noStep:{workSteps:[{stepText:"--",duration:"--",detailText:"--",attensionText:"--",variableFormula:"--"}]},init:function(){this.flag=t(".main-sop").length,this.setBeforeRemove(),this.$page=t(this.page),i.setZoom(this.page),this.$timeEl=t(".time span",this.$page),i.translate(this.$page),this.initData()},setBeforeRemove:function(){var e=this;myApp.onPageBeforeRemove("pcs_sopWorkInstruction",function(){e.clear()})},clear:function(){clearTimeout(this.intervalCont),clearTimeout(this.noDataInterCont)},subscribeNotify:function(){var e=this,t=this,n="subassembly/"+o.getSiteCode()+"/"+t.moduleConfig.onlineStationCode;this.flag&&(n="productStationConfirm/6321/"+t.moduleConfig.onlineStationCode),t.topic=n,r.subscribe(n,"pcs_sopWorkInstruction"),r.registerMessageHandler(n,"pcs_sopWorkInstruction.pcs_sopWorkInstruction",function(){e.clear(),e.getDataAndRenderScreen()})},initData:function(){var e=this,t="SOP_WORK_INSTRUCT";this.flag&&(t="MAIN_SOP_WORK_INSTRUCTION"),o.getSysModuleConfig("PCS",t).done(function(t){i.proConfig(t,function(t){e.moduleConfig=t,e.getDataAndRenderScreen(),e.subscribeNotify()})})},allRender:function(e){i.tplManager("sopWorkInsTpl",e,"sopWorkInstrRender"),this.bottomRenfer(e)},getDataAndRenderScreen:function(){var e=this,t="GMES-CLIENT-PCS0010";this.flag&&(t="GMES-CLIENT-PCS0009"),i.service(t,{rowNum:e.moduleConfig.rowNum||0,assemblyStationCode:e.moduleConfig.assemblyStationCode,stationCode:e.moduleConfig.stationCode,onlineStationCode:e.moduleConfig.onlineStationCode},"正在加载中").done(function(t){a.triggerSuccessEvun({response:t,haveData:function(){e.allRender(t.data)},noData:function(){e.allRender(e.data)}})})},increaseStep:function(e,n){return t(".now-step").html(e),t(".step-total").html(n),++e},reduceSecond:function(e){return t(".time_cont").html(e),--e},renderFn:function(e){return i.tplManager("sopWorkInsTpl_bt",e,"sopWorkInstr_btRender"),e.duration},renderNoData:function(){this.renderFn(this.noStep),this.increaseStep("--","--"),this.reduceSecond("--")},bottomRenfer:function(e){var t,n=this,o=e.workSteps||[],i=o.length,r=1,a=function(){t=n.renderFn(o[r-1]),r=n.increaseStep(r,i),t=n.reduceSecond(t)};if(0===i)return void n.renderNoData();a(),n.intervalCont=setInterval(function(){t>=0?t=n.reduceSecond(t):r<=i?a():(clearInterval(n.intervalCont),n.getDataAndRenderScreen())},1e3)}};e.exports=s}).call(t,n(4))}});
//# sourceMappingURL=pcs_sopWorkInstruction_ac6b10f9b005f1557bf3.js.map