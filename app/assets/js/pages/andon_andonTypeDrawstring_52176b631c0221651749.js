webpackJsonp([33],{623:function(t,a,n){"use strict";(function(a,e,s){var o=n(35),d=n(80),i=n(53),r=n(34),u={STATE_TOUCH:1,STATE_NORMAL:3,page:null,station:void 0,init:function(){var t=this;o.isUniqueOperableStation(function(n){r.setBreadcrumb([a.t("ANDON.T.MENU_ANDONCONTROL")+"/"+n.stationText]),r.translate('.page[data-page="andonTypeDrawstringPage"]'),t.station=n,t.loadPage(n)})},subscribeMessageTopic:function(t){var a=this,n="business/andon/statusChange/"+o.getSiteCode()+"/"+t.stationCode;i.subscribe(n,"andonTypeDrawstring"),i.registerMessageHandler(n,"andonStatusChangeMessageHandler",function(t){var n=t.payloadString?e.parseJSON(t.payloadString):{};a.andonTypeStatusSync(n.messageContent)})},event:function(){var t=this;e("a[name='andon-drawstring-button']").on("click",function(n){var s="andon"==e(n.target).attr("type")?e(n.target):e(n.target).parents("a[type='andon']"),o=s.attr("statusECode"),d=s.attr("andonTypeCode");r.showNotify({type:"success",content:a.t("ANDON.T.MSG_OPER_SYCN_TO_MI")}),r.service("GMES-CLIENT-ANDON013",{stationCode:t.station.stationCode,andonTypeCode:d,statusECode:o},null).done(function(t){r.showNotify({type:"success",content:a.t("ANDON.T.MSG_WAIT_OPER_SYCN_RESULT")})})}),e("a[type='andon'][name!='andon-drawstring-button']",this.page).on("click",function(n){var s="andon"==e(n.target).attr("type")?e(n.target):e(n.target).parents("a[type='andon']");if(s.hasClass("andon-status-disabled")){var o=(!!e(t.page).find("div.page-content").hasClass("andon-bg-blink")&&e(t.page).find("a[type='andon'][statusECode='1']").length,a.t("ANDON.T.MSG_DRAWSTRING_UNTRIGGER"));return e(t.page).find("a[type='andon'][statusECode='1']").length>0&&(o=a.t("ANDON.T.MSG_ANDON_TRIGGERED",{andonType:e(e(t.page).find("a[type='andon'][statusECode='1']")[0]).attr("typeText")})),void r.showNotify({type:"error",content:o})}var d=s.attr("statusECode"),i=s.attr("andonTypeCode");r.showNotify({type:"success",content:a.t("ANDON.T.MSG_OPER_SYCN_TO_MI")}),r.service("GMES-CLIENT-ANDON013",{stationCode:t.station.stationCode,andonTypeCode:i,statusECode:d},null).done(function(t){r.showNotify({type:"success",content:a.t("ANDON.T.MSG_WAIT_OPER_SYCN_RESULT")})})}),e("button.simple",this.page).on("click",function(a){e.each(e("a[type='andon']",t.page),function(t,a){e(e(a).parents(".andon-drawstring-item-detail")[0]).removeClass("andon-drawstring-item-detail").addClass("andon-drawstring-item-simple")}),e("button.simple",t.page).addClass("active"),e("button.detail",t.page).removeClass("active")}),e("button.detail",this.page).on("click",function(a){e.each(e("a[type='andon']",t.page),function(t,a){e(e(a).parents(".andon-drawstring-item-simple")[0]).removeClass("andon-drawstring-item-simple").addClass("andon-drawstring-item-detail")}),e("button.detail",t.page).addClass("active"),e("button.simple",t.page).removeClass("active")}),d.register({group:"andonTypeDrawstring",name:"andonTypeStatusSync",intervalTime:1e3,fun:function(){t.andonStatusDisplay()},replace:!0})},loadPage:function(t){var n=this;r.service("GMES-CLIENT-ANDON001",{stationCode:t.stationCode},a.t("ANDON.T.MSG_ANDON_LOADING")).done(function(a){var s=a.data,o=[];e.each(s,function(t,a){a.lastTriggerTime&&(a.lastTriggerTimePart=a.lastTriggerTime.split(" ")[1]),"LSANDON"!=a.andonType.andonTypeCode?o.push(a):e("a[name='andon-drawstring-button']",n.page).attr("statusECode",a.lastTriggerTime?n.STATE_TOUCH:n.STATE_NORMAL).attr("switchOnDateTime",a.lastTriggerTime).attr("accumulatedTime",a.accumulatedTime).attr("touchColor",a.andonType.touchColor).attr("normalColor",a.andonType.normalColor)});var d=n.group(o,6);r.tplManager("andonControlSwiperTpl",d,"andonControlSwiperRender"),n.event(),n.andonStatusDisplay(),n.subscribeMessageTopic(t)})},group:function(t,a){for(var n=0,e={groupAndons:[]};n<t.length;)e.groupAndons.push(t.slice(n,n+=a));return e},andonTypeStatusSync:function(t){var n=this,s=t,o=void 0,d=s.lastTriggerTime?n.STATE_TOUCH:n.STATE_NORMAL;n.isDrawstringAndon(s.andonType)?(o=e("a[andonTypeCode='LSANDON']"),o.attr("statusECode")!=d&&(n.isTouched(d)?(o.attr("switchOnDateTime",s.lastTriggerTime),r.showNotify({type:"success",content:a.t("ANDON.T.MSG_TOUCH_SUCCESS",{andonText:a.t("ANDON.B.DRAWSTRING")})})):(o.attr("switchOnDateTime",""),r.showNotify({type:"success",content:a.t("ANDON.T.MSG_CLOSE_SUCCESS",{andonText:a.t("ANDON.B.DRAWSTRING")})})))):(o=e("a[type='andon'][andonTypeCode='"+s.andonType.andonTypeCode+"']"),o.attr("statusECode")!=d&&(n.isTouched(d)?(o.attr("switchOnDateTime",s.lastTriggerTime),o.parents("div.andon-drawstring-item-button").parent().find("dd[name='lastTriggerTimePart']").text(s.lastTriggerTime.split(" ")[1]),o.parents("div.andon-drawstring-item-button").parent().find("dd[name='triggerCount']").text(parseInt(s.triggerCount)),r.showNotify({type:"success",content:a.t("ANDON.T.MSG_TOUCH_SUCCESS",{andonText:s.andonType.typeText})})):(o.attr("switchOnDateTime",""),o.find(".andon-drawstring-touch-time").text(""),o.parents("div.andon-drawstring-item-button").parent().find("dd[name='lastTriggerTimePart']").text(""),r.showNotify({type:"success",content:a.t("ANDON.T.MSG_CLOSE_SUCCESS",{andonText:s.andonType.typeText})})))),o.attr("statusECode",d),n.andonStatusDisplay()},isDrawstringAndon:function(t){return"LSANDON"==t.andonTypeCode},isTouched:function(t){return t==this.STATE_TOUCH},andonStatusDisplay:function(){var t=this,a=e("a[type='andon']",this.page),n=e("a[type='andon'][statusECode='1'][andonTypeCode!='LSANDON']",this.page),d=e(e("a[andonTypeCode='LSANDON']",this.page)[0]),i=0==n.length&&!this.isTouched(d.attr("statusECode")),r=0==n.length&&this.isTouched(d.attr("statusECode")),u=!i&&!r;i?e(this.page).find("div.page-content").removeClass("andon-bg-blink"):e(this.page).find("div.page-content").addClass("andon-bg-blink"),e.each(a,function(a,n){var d=e(n),c="LSANDON"==d.attr("andonTypeCode");if(r?d.addClass("andon-status-enable").removeClass("andon-status-disabled").removeClass("andon-status-touch"):i&&(c?d.addClass("andon-status-enable").removeClass("andon-status-touch"):d.addClass("andon-status-disabled").removeClass("andon-status-enable").removeClass("andon-status-touch")),t.isTouched(d.attr("statusECode"))){d.addClass("andon-status-touch").removeClass("andon-status-enable").removeClass("andon-status-disabled");var T=s(o.getServerDateTime()),l=T.diff(d.attr("switchOnDateTime")||T);l=l<0?0:l,l<=1e4?d.css("background","linear-gradient(to bottom, #f4b664, #e9822d)"):d.css("background",d.attr("touchColor")),"andon-drawstring-button"==d.attr("name")?d.find(".andon-drawstring-touch-time").text(t.calTimeForDrawstringAndon(l)):d.find(".andon-drawstring-touch-time").text(t.calTime(l)),d.parents(".andon-drawstring-item-button").parent().find("dd[name='accumulatedTime']").text(t.calTime(1e3*(d.attr("accumulatedTime")||0)+l))}else u&&!c&&d.addClass("andon-status-disabled").removeClass("andon-status-enable").removeClass("andon-status-touch"),d.find(".andon-drawstring-touch-time").text(""),d.css("background",d.attr("normalColor")),d.parents(".andon-drawstring-item-button").parent().find("dd[name='accumulatedTime']").text(t.calTime(1e3*(d.attr("accumulatedTime")||0)))})},warningDisplay:function(){e("a[type='andon'][statusECode='1']",this.page).length>0||e("a[andonTypeCode='LSANDON'][statusECode='1']",this.page).length>0?e(this.page).find("div.page-content").addClass("andon-bg-blink"):e(this.page).find("div.page-content").removeClass("andon-bg-blink")},calTime:function(t){var n=Math.floor(t/6e4);n=0!=n?a.t("COMMON.T.MINUTE",{minute:n}):"";var e=t%6e4,s=Math.round(e/1e3);return s=0!=s?a.t("COMMON.T.SECOND",{second:s}):"",n+s},calTimeForDrawstringAndon:function(t){var a=Math.floor(t/36e5);a=a>=10?a:"0"+a;var n=t%36e5,e=Math.floor(n/6e4);e=e>=10?e:"0"+e,n=t%6e4;var s=Math.round(n/1e3);return s=s>=10?s:"0"+s,a+":"+e+":"+s}};t.exports=u}).call(a,n(37),n(4),n(30))}});
//# sourceMappingURL=andon_andonTypeDrawstring_52176b631c0221651749.js.map