{"version":3,"sources":["webpack:///assets/js/pages/andon_andonControlPanel_4471d572f0adadb2657c.js","webpack:///./src/js/pages/andon/andonControlPanel.js"],"names":["webpackJsonp","616","module","exports","__webpack_require__","i18next","$","moment","security","timerManager","andonControlPanelView","STATE_TOUCH","STATE_NORMAL","page","undefined","station","init","_this","this","clearSchedule","isUniqueOperableStation","util","setBreadcrumb","t","stationText","loadPage","remove","event","each","index","item","changeAndonDispay","on","e","andonItem","target","attr","parents","statusECode","andonTypeCode","service","stationCode","response","data","isTouched","parent","find","text","split","parseInt","showNotify","type","content","andonText","setTimeout","warningDisplay","$parent","$this","removeClass","fadeOut","addClass","fadeIn","andonTypes","_","andonType","push","groupAndons","group","tplManager","array","groupLength","newArray","length","slice","syncAndonStatus","currentStatus","lastTriggerTime","accumulatedTime","el","date","getServerDataTime","diffValue","diff","css","calTime","Math","floor","timeLong","minutes","minute","leave3","seconds","round","second","F7","onPageInit","document","off","container","translate","onPageBeforeRemove","call"],"mappings":"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","file":"assets/js/pages/andon_andonControlPanel_4471d572f0adadb2657c.js","sourcesContent":["webpackJsonp([39],{\n\n/***/ 616:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(i18next, $, moment) {\n\nvar security = __webpack_require__(35);\nvar timerManager = __webpack_require__(80);\nvar andonControlPanelView = {\n\tSTATE_TOUCH: 1,\n\tSTATE_NORMAL: 3,\n\tpage: undefined,\n\tstation: undefined,\n\tinit: function init(page) {\n\t\tvar _this = this;\n\t\tthis.page = page;\n\t\tthis.clearSchedule();\n\t\tsecurity.isUniqueOperableStation(function (station) {\n\t\t\tutil.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONCONTROL\") + \"/\" + station.stationText]);\n\t\t\t_this.station = station;\n\t\t\t_this.loadPage(station);\n\t\t});\n\t},\n\tclearSchedule: function clearSchedule() {\n\t\ttimerManager.remove(\"andonTypeStatusSync\");\n\t},\n\tevent: function event() {\n\t\tvar _this = this;\n\t\t$.each($(\"a[type='andon']\", this.page), function (index, item) {\n\t\t\t_this.changeAndonDispay(item);\n\t\t});\n\n\t\t$(\"a[type='andon']\", this.page).on(\"click\", function (e) {\n\t\t\tvar andonItem = $(e.target).attr(\"type\") == \"andon\" ? $(e.target) : $(e.target).parents(\"a[type='andon']\");\n\t\t\tvar statusECode = andonItem.attr(\"statusECode\");\n\t\t\tvar andonTypeCode = andonItem.attr(\"andonTypeCode\");\n\n\t\t\tutil.service('GMES-CLIENT-ANDON007', {\n\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\tandonTypeCode: andonTypeCode,\n\t\t\t\tstatusECode: statusECode\n\t\t\t}, null, function (response) {\n\t\t\t\tvar data = response.data;\n\t\t\t\tif (!data) {\n\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\tcontent: \"\"\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tandonItem.attr(\"statusECode\", data.statusECode);\n\t\t\t\t\tif (_this.isTouched(data.statusECode)) {\n\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\", data[\"switchOnDateTime\"]);\n\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(data[\"switchOnDateTime\"].split(\" \")[1]);\n\t\t\t\t\t\tandonItem.parent().find(\"dd[name='triggerCount']\").text(parseInt(andonItem.parent().find(\"dd[name='triggerCount']\").text()) + 1);\n\t\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\", {\n\t\t\t\t\t\t\t\tandonText: andonItem.attr(\"typeText\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\t\t}, 5000);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\", '');\n\t\t\t\t\t\tandonItem.find(\".touch-time\").text('');\n\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(\"\");\n\t\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\", {\n\t\t\t\t\t\t\t\tandonText: andonItem.attr(\"typeText\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\t\t}, 5000);\n\t\t\t\t\t}\n\n\t\t\t\t\t_this.changeAndonDispay(andonItem);\n\t\t\t\t\t_this.warningDisplay();\n\t\t\t\t}\n\t\t\t\tvar toChangeStatusECode = _this.STATE_TOUCH == statusECode ? _this.STATE_NORMAL : _this.STATE_TOUCH;\n\t\t\t});\n\t\t});\n\n\t\t$(\"button.simple\", this.page).on('click', function (e) {\n\t\t\t$.each($(\"a[type='andon']\", _this.page), function (index, item) {\n\t\t\t\t$parent = $(item).parent();\n\t\t\t\t$this = $(item);\n\t\t\t\t$parent.removeClass(\"andon-list-item-detail\");\n\t\t\t\t$parent.find(\".andon-list-item-info\").fadeOut(100);\n\t\t\t});\n\t\t\t$(\"button.simple\", _this.page).addClass(\"active\");\n\t\t\t$(\"button.detail\", _this.page).removeClass(\"active\");\n\t\t});\n\n\t\t$(\"button.detail\", this.page).on('click', function (e) {\n\t\t\t$.each($(\"a[type='andon']\", _this.page), function (index, item) {\n\t\t\t\t$parent = $(item).parent();\n\t\t\t\t$this = $(item);\n\t\t\t\t$parent.addClass(\"andon-list-item-detail\");\n\t\t\t\t$parent.find(\".andon-list-item-info\").fadeIn(100);\n\t\t\t});\n\t\t\t$(\"button.detail\", _this.page).addClass(\"active\");\n\t\t\t$(\"button.simple\", _this.page).removeClass(\"active\");\n\t\t});\n\t},\n\tloadPage: function loadPage(station) {\n\t\tvar _this = this;\n\t\tutil.service('GMES-CLIENT-ANDON001', {\n\t\t\tstationCode: station.stationCode\n\t\t}, i18next.t(\"ANDON.T.MSG_ANDON_LOADING\"), function (response) {\n\t\t\tvar data = response.data;\n\t\t\tvar andonTypes = [];\n\t\t\t$.each(data, function (_, item) {\n\t\t\t\tif (item[\"lastTriggerTime\"]) {\n\t\t\t\t\titem[\"lastTriggerTimePart\"] = item[\"lastTriggerTime\"].split(\" \")[1];\n\t\t\t\t}\n\t\t\t\tif (item.andonType.andonTypeCode != \"LSANDON\") {\n\t\t\t\t\tandonTypes.push(item);\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar groupAndons = _this.group(andonTypes, 6);\n\t\t\tutil.tplManager(\"andonControlSwiperTpl\", groupAndons, \"andonControlSwiperRender\");\n\t\t\t_this.event();\n\t\t\t_this.warningDisplay();\n\t\t});\n\t},\n\tgroup: function group(array, groupLength) {\n\t\tvar index = 0;\n\t\tvar newArray = { \"groupAndons\": [] };\n\t\twhile (index < array.length) {\n\t\t\tnewArray.groupAndons.push(array.slice(index, index += groupLength));\n\t\t}\n\t\treturn newArray;\n\t},\n\tsyncAndonStatus: function syncAndonStatus() {\n\t\tvar _this = this;\n\t\tif ($(\"div.view-main .pages div.page:last-child\").attr(\"data-page\") != \"andonControlPanel\") {\n\t\t\treturn;\n\t\t}\n\n\t\tutil.service('GMES-CLIENT-ANDON001', {\n\t\t\tstationCode: _this.station.stationCode\n\t\t}, null, function (response) {\n\t\t\tvar data = response.data;\n\t\t\t$.each(data, function (_, item) {\n\t\t\t\tvar currentStatus = item.lastTriggerTime ? 1 : 3;\n\t\t\t\tvar andonItem = $(\"a[type='andon'][andonTypeCode='\" + item.andonType.andonTypeCode + \"']\");\n\t\t\t\tandonItem.attr(\"accumulatedTime\", item.accumulatedTime || 0);\n\t\t\t\tif (andonItem.attr(\"statusECode\") != currentStatus) {\n\t\t\t\t\tif (item[\"lastTriggerTime\"]) {\n\t\t\t\t\t\titem[\"lastTriggerTimePart\"] = item[\"lastTriggerTime\"].split(\" \")[1];\n\t\t\t\t\t}\n\t\t\t\t\tandonItem.attr(\"statusECode\", currentStatus);\n\t\t\t\t\tif (_this.isTouched(currentStatus)) {\n\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\", item[\"lastTriggerTime\"]);\n\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(item[\"lastTriggerTime\"].split(\" \")[1]);\n\t\t\t\t\t\tandonItem.parent().find(\"dd[name='triggerCount']\").text(parseInt(item[\"triggerCount\"]));\n\t\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_ANDON_TOUCH_STATUS_SYNC\", {\n\t\t\t\t\t\t\t\tandonText: andonItem.attr(\"typeText\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\t\t}, 5000);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\", '');\n\t\t\t\t\t\tandonItem.find(\".touch-time\").text('');\n\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(\"\");\n\t\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_ANDON_CLOSE_STATUS_SYNC\", {\n\t\t\t\t\t\t\t\tandonText: andonItem.attr(\"typeText\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t$(\"div.notify\").remove();\n\t\t\t\t\t\t}, 5000);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_this.changeAndonDispay(andonItem);\n\t\t\t});\n\t\t\t_this.warningDisplay();\n\t\t});\n\t},\n\tisTouched: function isTouched(statusECode) {\n\t\treturn statusECode == this.STATE_TOUCH;\n\t},\n\tchangeAndonDispay: function changeAndonDispay(andonItem) {\n\t\tvar el = $(andonItem);\n\t\tif (el.attr(\"statusECode\") == this.STATE_TOUCH) {\n\t\t\tvar date = moment(security.getServerDataTime());\n\t\t\tvar diffValue = date.diff(el.attr(\"switchOnDateTime\") || date);\n\t\t\tdiffValue = diffValue < 0 ? 0 : diffValue;\n\t\t\tif (diffValue <= 10000) {\n\t\t\t\tel.css(\"background\", \"linear-gradient(to bottom, #f4b664, #e9822d)\");\n\t\t\t} else {\n\t\t\t\tel.css(\"background\", el.attr(\"touchColor\"));\n\t\t\t}\n\t\t\tel.find(\".touch-time\").text(this.calTime(diffValue));\n\t\t\tel.parent().find(\"dd[name='accumulatedTime']\").text(this.calTime((el.attr(\"accumulatedTime\") || 0) * 1000 + Math.floor(diffValue / 1000)));\n\t\t} else {\n\t\t\tel.css(\"background\", el.attr(\"normalColor\"));\n\t\t\tel.parent().find(\"dd[name='accumulatedTime']\").text(this.calTime((el.attr(\"accumulatedTime\") || 0) * 1000));\n\t\t}\n\t},\n\n\twarningDisplay: function warningDisplay() {\n\n\t\tif ($(\"a[type='andon'][statusECode='1']\", this.page).length > 0) {\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\n\t\t} else {\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\n\t\t}\n\t},\n\tcalTime: function calTime(timeLong) {\n\t\tvar minutes = Math.floor(timeLong / (60 * 1000));\n\t\tif (minutes != 0) minutes = i18next.t(\"COMMON.T.MINUTE\", {\n\t\t\tminute: minutes\n\t\t});else minutes = \"\";\n\n\t\tvar leave3 = timeLong % (60 * 1000);\n\t\tvar seconds = Math.round(leave3 / 1000);\n\t\tif (seconds != 0) seconds = i18next.t(\"COMMON.T.SECOND\", {\n\t\t\tsecond: seconds\n\t\t});else seconds = \"\";\n\t\treturn minutes + seconds;\n\t}\n\n};\n\nF7.onPageInit('andonControlPanel', function (page) {\n\t$(document).off(\"keydown\");\n\tandonControlPanelView.init($(page.container));\n\tutil.translate('.page[data-page=\"andonControlPanel\"]');\n});\n\nF7.onPageBeforeRemove('andonControlPanel', function (page) {\n\tandonControlPanelView.clearSchedule();\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(37), __webpack_require__(4), __webpack_require__(30)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/andon_andonControlPanel_4471d572f0adadb2657c.js","var security = require(\"security\");\r\nvar timerManager = require(\"timerManager\");\r\nvar andonControlPanelView = {\r\n\tSTATE_TOUCH : 1,\r\n\tSTATE_NORMAL : 3,\r\n\tpage : undefined,\r\n\tstation : undefined,\r\n\tinit: function(page) {\r\n\t\tvar _this = this;\r\n\t\tthis.page = page;\r\n\t\tthis.clearSchedule();\r\n\t\tsecurity.isUniqueOperableStation(function(station){\r\n\t\t\tutil.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONCONTROL\")+\"/\"+station.stationText]);\r\n\t\t\t_this.station = station;\r\n\t\t\t_this.loadPage(station);\r\n\t\t})\r\n\t},\r\n\tclearSchedule : function(){\r\n\t\ttimerManager.remove(\"andonTypeStatusSync\");\r\n\t},   \r\n\tevent : function(){\r\n\t\tvar _this = this;\r\n\t\t$.each($(\"a[type='andon']\",this.page),function(index,item){\r\n\t\t\t_this.changeAndonDispay(item);\r\n\t\t});    \r\n\r\n\t\t$(\"a[type='andon']\",this.page).on(\"click\",function(e){\r\n\t\t\tvar andonItem = $(e.target).attr(\"type\") == \"andon\"? $(e.target) : $(e.target).parents(\"a[type='andon']\");\r\n\t\t\tvar statusECode = andonItem.attr(\"statusECode\");\r\n\t\t\tvar andonTypeCode = andonItem.attr(\"andonTypeCode\");\r\n\t\t\t//触发服务接口\r\n\t\t\tutil.service('GMES-CLIENT-ANDON007',{\r\n\t\t\t\t\tstationCode : _this.station.stationCode,\r\n\t\t\t\t\tandonTypeCode : andonTypeCode,\r\n\t\t\t\t\tstatusECode : statusECode\r\n\t\t\t\t},null,function(response){\r\n\t\t\t\t\tvar data = response.data;\r\n\t\t\t\t\tif(!data){\r\n\t\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\t\ttype : \"error\",\r\n\t\t\t\t\t\t\tcontent : \"\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tandonItem.attr(\"statusECode\",data.statusECode);\r\n\t\t\t\t\t\tif(_this.isTouched(data.statusECode)){\r\n\t\t\t\t\t\t\t//触发状态添加时间\r\n\t\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\",data[\"switchOnDateTime\"]);\r\n\t\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(data[\"switchOnDateTime\"].split(\" \")[1]);\r\n\t\t\t\t\t\t\tandonItem.parent().find(\"dd[name='triggerCount']\").text(parseInt(andonItem.parent().find(\"dd[name='triggerCount']\").text())+1);\r\n\t\t\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\",{\r\n\t\t\t\t\t\t\t\t\tandonText : andonItem.attr(\"typeText\")\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\t\t\t}, 5000);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t//复位状态删除时间\r\n\t\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\",'');\r\n\t\t\t\t\t\t\tandonItem.find(\".touch-time\").text('');\r\n\t\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(\"\");\r\n\t\t\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\",{\r\n\t\t\t\t\t\t\t\t\tandonText : andonItem.attr(\"typeText\")\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\t\t\t}, 5000);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t_this.changeAndonDispay(andonItem);\r\n\t\t\t\t\t\t_this.warningDisplay();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar toChangeStatusECode = _this.STATE_TOUCH == statusECode?_this.STATE_NORMAL:_this.STATE_TOUCH;\r\n\t\t\t\t})\r\n\t\t\t\r\n\t\t});\r\n\r\n\t\t$(\"button.simple\",this.page).on('click',function(e){\r\n\t\t\t//简易模式\r\n\t\t\t$.each($(\"a[type='andon']\",_this.page),function(index,item){\r\n\t\t\t\t$parent = $(item).parent();\r\n\t\t\t\t$this = $(item);\r\n\t\t\t\t$parent.removeClass(\"andon-list-item-detail\");\r\n\t\t\t\t$parent.find(\".andon-list-item-info\").fadeOut(100);\r\n\t\t\t});\r\n\t\t\t$(\"button.simple\",_this.page).addClass(\"active\");\r\n\t\t\t$(\"button.detail\",_this.page).removeClass(\"active\");\r\n\t\t});            \r\n\r\n\t\t$(\"button.detail\",this.page).on('click',function(e){\r\n\t\t\t//详情模式\r\n\t\t\t$.each($(\"a[type='andon']\",_this.page),function(index,item){\r\n\t\t\t\t$parent = $(item).parent();\r\n\t\t\t\t$this = $(item);\r\n\t\t\t\t$parent.addClass(\"andon-list-item-detail\");\r\n\t\t\t\t$parent.find(\".andon-list-item-info\").fadeIn(100);\r\n\t\t\t});\r\n\t\t\t$(\"button.detail\",_this.page).addClass(\"active\");\r\n\t\t\t$(\"button.simple\",_this.page).removeClass(\"active\");\r\n\t\t});\r\n\r\n\t\t/*\r\n\t\ttimerManager.register(\"andonTypeStatusSync\",1000,function(){\r\n\t\t\t_this.syncAndonStatus();\r\n\t\t})\r\n\t\t*/\r\n\r\n\r\n\t\t/*\r\n\t\tif(!this.andonStatusSyncTimer){\r\n\t\t\tthis.andonStatusSyncTimer = setInterval(function(){\r\n\t\t\t\t_this.syncAndonStatus();\r\n\t\t\t},1000);\r\n\t\t}\r\n\t\t*/\r\n\r\n\r\n\t},  \r\n\tloadPage: function(station) {\r\n\t\tvar _this = this;\r\n\t\tutil.service('GMES-CLIENT-ANDON001',{\r\n\t\t\t\tstationCode : station.stationCode\r\n\t\t\t},i18next.t(\"ANDON.T.MSG_ANDON_LOADING\"),function(response){\r\n\t\t\t\tvar data = response.data;\r\n\t\t\t\tvar andonTypes = [];\r\n\t\t\t\t$.each(data,function(_,item){\r\n\t\t\t\t\tif(item[\"lastTriggerTime\"]){\r\n\t\t\t\t\t\titem[\"lastTriggerTimePart\"] = item[\"lastTriggerTime\"].split(\" \")[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(item.andonType.andonTypeCode!=\"LSANDON\"){\r\n\t\t\t\t\t\t//非拉绳andon\r\n\t\t\t\t\t\tandonTypes.push(item);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tvar groupAndons = _this.group(andonTypes, 6);\r\n\t\t\t\tutil.tplManager(\"andonControlSwiperTpl\", groupAndons, \"andonControlSwiperRender\");\r\n\t\t\t\t_this.event();\r\n\t\t\t\t_this.warningDisplay();\r\n\t\t});\r\n\r\n\t},\r\n\tgroup : function(array, groupLength) {\r\n    \tvar index = 0;\r\n    \tvar newArray = {\"groupAndons\":[]};\r\n    \twhile(index < array.length) {\r\n    \t\tnewArray.groupAndons.push(array.slice(index, index += groupLength));\r\n    \t}\r\n    \treturn newArray;    \r\n    },\r\n    syncAndonStatus : function(){\r\n    \tvar _this = this;\r\n    \tif($(\"div.view-main .pages div.page:last-child\").attr(\"data-page\") != \"andonControlPanel\"){\r\n    \t\treturn;\r\n    \t}\r\n\r\n    \tutil.service('GMES-CLIENT-ANDON001',{\r\n\t\t\t\tstationCode : _this.station.stationCode\r\n\t\t\t},null, function(response){\r\n\t\t\t\tvar data = response.data;\r\n\t\t\t\t$.each(data,function(_,item){\r\n\t\t\t\t\tvar currentStatus = item.lastTriggerTime ? 1 : 3;\r\n\t\t\t\t\tvar andonItem = $(\"a[type='andon'][andonTypeCode='\"+item.andonType.andonTypeCode+\"']\");\r\n\t\t\t\t\tandonItem.attr(\"accumulatedTime\",item.accumulatedTime||0);\r\n\t\t\t\t\tif(andonItem.attr(\"statusECode\") != currentStatus) {\r\n\t\t\t\t\t\t//状态不一致\r\n\t\t\t\t\t\tif(item[\"lastTriggerTime\"]){\r\n\t\t\t\t\t\t\titem[\"lastTriggerTimePart\"] = item[\"lastTriggerTime\"].split(\" \")[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tandonItem.attr(\"statusECode\",currentStatus);\r\n\t\t\t\t\t\tif(_this.isTouched(currentStatus)){\r\n\t\t\t\t\t\t\t//触发状态添加时间\r\n\t\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\",item[\"lastTriggerTime\"]);\r\n\t\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(item[\"lastTriggerTime\"].split(\" \")[1]);\r\n\t\t\t\t\t\t\tandonItem.parent().find(\"dd[name='triggerCount']\").text(parseInt(item[\"triggerCount\"]));\r\n\t\t\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_ANDON_TOUCH_STATUS_SYNC\",{\r\n\t\t\t\t\t\t\t\t\tandonText : andonItem.attr(\"typeText\")\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\t\t\t}, 5000);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t//复位状态删除时间\r\n\t\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\",'');\r\n\t\t\t\t\t\t\tandonItem.find(\".touch-time\").text('');\r\n\t\t\t\t\t\t\tandonItem.parent().find(\"dd[name='lastTriggerTimePart']\").text(\"\");\r\n\t\t\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_ANDON_CLOSE_STATUS_SYNC\",{\r\n\t\t\t\t\t\t\t\t\tandonText : andonItem.attr(\"typeText\")\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t$(\"div.notify\").remove();\r\n\t\t\t\t\t\t\t}, 5000);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_this.changeAndonDispay(andonItem);\r\n\t\t\t\t})\r\n\t\t\t\t_this.warningDisplay();\r\n\t\t\t});\r\n    },\r\n    isTouched : function(statusECode){\r\n    \treturn statusECode == this.STATE_TOUCH;\r\n    },\r\n    changeAndonDispay : function(andonItem){\r\n    \tvar el = $(andonItem);\r\n\t\tif(el.attr(\"statusECode\") == this.STATE_TOUCH){//触发状态\r\n\t\t\tvar date = moment(security.getServerDataTime());\r\n\t\t\tvar diffValue = date.diff(el.attr(\"switchOnDateTime\")||date);\r\n\t\t\tdiffValue = diffValue < 0? 0 : diffValue;\r\n\t\t\tif(diffValue <= 10000){\r\n\t\t\t\tel.css(\"background\",\"linear-gradient(to bottom, #f4b664, #e9822d)\");//黄\r\n\t\t\t}else{\r\n\t\t\t\tel.css(\"background\",el.attr(\"touchColor\"));//红\r\n\t\t\t}\r\n\t\t\tel.find(\".touch-time\").text(this.calTime(diffValue));\r\n\t\t\tel.parent().find(\"dd[name='accumulatedTime']\").text(this.calTime((el.attr(\"accumulatedTime\")||0)*1000+Math.floor(diffValue/1000)));\r\n\t\t}else{//未触发\r\n\t\t\tel.css(\"background\",el.attr(\"normalColor\"));\r\n\t\t\tel.parent().find(\"dd[name='accumulatedTime']\").text(this.calTime((el.attr(\"accumulatedTime\")||0)*1000));\r\n\t\t}\r\n\t},\r\n\t/**\r\n\t * 告警显示\r\n\t **/\r\n\twarningDisplay : function(){\r\n\r\n\t\tif($(\"a[type='andon'][statusECode='1']\",this.page).length > 0){\r\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\r\n\t\t}else{\r\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\r\n\t\t}\r\n\t},\r\n\tcalTime : function(timeLong){\r\n\t\tvar minutes=Math.floor(timeLong/(60*1000))\r\n\t\tif(minutes!=0)\r\n\t\t\tminutes=i18next.t(\"COMMON.T.MINUTE\",{\r\n\t\t\t\tminute : minutes\r\n\t\t\t});\r\n\t\telse\r\n\t\t\tminutes=\"\";\r\n\t\t//计算相差秒数\r\n\t\tvar leave3=timeLong%(60*1000)      //计算分钟数后剩余的毫秒数\r\n\t\tvar seconds=Math.round(leave3/1000)\r\n\t\tif(seconds!=0)\r\n\t\t\tseconds=i18next.t(\"COMMON.T.SECOND\",{\r\n\t\t\t\tsecond : seconds\r\n\t\t\t});\r\n\t\telse\r\n\t\t\tseconds=\"\";\r\n\t\treturn minutes + seconds ;\r\n\t}\r\n\r\n}\r\n\r\nF7.onPageInit('andonControlPanel', function(page) {\r\n    $(document).off(\"keydown\");\t\t// 别的页面去除主页的菜单快捷键\r\n\tandonControlPanelView.init($(page.container));\r\n\tutil.translate('.page[data-page=\"andonControlPanel\"]');\r\n});\r\n\r\nF7.onPageBeforeRemove('andonControlPanel', function(page) {\r\n   andonControlPanelView.clearSchedule();\r\n});\r\n      \n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/andon/andonControlPanel.js"],"sourceRoot":""}