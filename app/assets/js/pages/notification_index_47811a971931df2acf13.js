webpackJsonp([30],{627:function(e,a,s){"use strict";(function(a,t,n){var o=s(35),d=s(34),r={page:void 0,userCode:void 0,msgTpl:void 0,listLoadProcess:void 0,readShowFlag:void 0,init:function(){d.setBreadcrumb([a.t("COMMON.B.MESSAGE")]);var e=this,s=o.getUserProfile();s?e.initFn(s):o.loginUserDataReload(function(){e.initFn(o.getUserProfile())})},initFn:function(e){this.userCode=e.userCode;var a=t("#msgTpl",this.page).html();this.msgTpl=Template7.compile(a),this.listLoadProcess={all:{loading:!1,pageNum:1,numPerPage:10,messageTypeEcodes:"",renderId:"#msgRednder1",full:!1},normal:{loading:!1,pageNum:1,numPerPage:10,messageTypeEcodes:"NORMAL",renderId:"#msgRednder2",full:!1},popup:{loading:!1,pageNum:1,numPerPage:10,messageTypeEcodes:"POPUP",renderId:"#msgRednder3",full:!1}},this.readShowFlag={active:!1,state:0},this.loadPage(),this.loadMoreEvent(),this.expandBtnEvent(),this.readFlagFilterEvent()},loadPage:function(){this._loadDataAndRenderList("all"),this._loadDataAndRenderList("normal"),this._loadDataAndRenderList("popup")},readFlagFilterEvent:function(){var e=this;t(".readFlagBtns",e.page).on("click","button",function(){var a=t(this);a.siblings().removeClass("buttonActive"),a.addClass("buttonActive"),a.hasClass("readShowBtn")?(t(".tabs",e.page).removeClass("unreadShow").addClass("readShow"),e.readShowFlag.active=!0,e.readShowFlag.state=1):a.hasClass("unreadShowBtn")?(t(".tabs",e.page).removeClass("readShow").addClass("unreadShow"),e.readShowFlag.active=!0,e.readShowFlag.state=0):(t(".tabs",e.page).removeClass("readShow").removeClass("unreadShow"),e.readShowFlag.active=!1)})},loadMoreEvent:function(){var e=this;t("#tab1").on("infinite",function(){e.listLoadProcess.all.full||e._loadDataAndRenderList("all")}),t("#tab2").on("infinite",function(){e.listLoadProcess.normal.full||e._loadDataAndRenderList("normal")}),t("#tab3").on("infinite",function(){e.listLoadProcess.popup.full||e._loadDataAndRenderList("popup")})},_loadDataAndRenderList:function(e){function a(e){o.loading=!1;var a=e.data.data,n=a.length;if(!(n>0))return o.full=!0,void t(o.renderId,s.page).next().show();o.pageNum+=1;for(var d=0;d<n;d++)"0"===a[d].readFlag?a[d].extClass="un-read":a[d].extClass="","NORMAL"===a[d].messageTypeEcode?a[d].messageType="普通消息":"SCROLL"===a[d].messageTypeEcode?a[d].messageType="滚屏消息":"POPUP"===a[d].messageTypeEcode?a[d].messageType="弹出公告":a[d].messageType="全部",a[d].receivedTime&&(a[d].messageTime=function(e){function a(e){return parseInt(e)<10&&(e="0"+e),e}var s=new Date(e),t=s.getFullYear(),n=s.getMonth()+1,o=s.getDate(),d=s.getHours(),r=s.getMinutes(),i=s.getSeconds();return t+"-"+a(n)+"-"+a(o)+" "+a(d)+":"+a(r)+":"+a(i)}(a[d].receivedTime));var r={list:a},i=s.msgTpl(r);t(o.renderId,s.page).append(i)}var s=this,o=s.listLoadProcess[e];if(!o.loading){o.loading=!0;var r={serviceCode:"GMES-CLIENT-MSG0003",siteCode:n.siteCode,userCode:this.userCode,numPerPage:o.numPerPage,pageNum:o.pageNum,messageTypeEcodes:o.messageTypeEcodes};s.readShowFlag.active&&(r.readFlag=s.readShowFlag.state),n.request({url:"restful/service/execute",data:r,success:function(e){d.rightCode(e,a)}})}},expandBtnEvent:function(){t(".tabs-swipeable-wrap",this.page).on("click",".expandBtn",function(){var e=t(this),a=e.parents("li.inf-brief");if(a.hasClass("txt-expand")?(a.removeClass("txt-expand"),t("a",e).html("展开")):(a.addClass("txt-expand"),t("a",e).html("收起")),a.hasClass("un-read")){a.removeClass("un-read");var s=a.attr("messageId");n.request({url:"restful/service/execute",data:{serviceCode:"GMES-CLIENT-MSG0005",siteCode:n.siteCode,messageId:s},success:function(e){d.rightCode(e,function(){console.log(s+" 标记已读成功")})}})}})}};e.exports=r}).call(a,s(37),s(4),s(77))}});
//# sourceMappingURL=notification_index_47811a971931df2acf13.js.map