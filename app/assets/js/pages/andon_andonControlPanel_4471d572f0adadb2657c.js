webpackJsonp([39],{616:function(t,e,n){"use strict";(function(t,e,a){var i=n(35),o=n(80),r={STATE_TOUCH:1,STATE_NORMAL:3,page:void 0,station:void 0,init:function(e){var n=this;this.page=e,this.clearSchedule(),i.isUniqueOperableStation(function(e){util.setBreadcrumb([t.t("ANDON.T.MENU_ANDONCONTROL")+"/"+e.stationText]),n.station=e,n.loadPage(e)})},clearSchedule:function(){o.remove("andonTypeStatusSync")},event:function(){var n=this;e.each(e("a[type='andon']",this.page),function(t,e){n.changeAndonDispay(e)}),e("a[type='andon']",this.page).on("click",function(a){var i="andon"==e(a.target).attr("type")?e(a.target):e(a.target).parents("a[type='andon']"),o=i.attr("statusECode"),r=i.attr("andonTypeCode");util.service("GMES-CLIENT-ANDON007",{stationCode:n.station.stationCode,andonTypeCode:r,statusECode:o},null,function(a){var r=a.data;r?(i.attr("statusECode",r.statusECode),n.isTouched(r.statusECode)?(i.attr("switchOnDateTime",r.switchOnDateTime),i.parent().find("dd[name='lastTriggerTimePart']").text(r.switchOnDateTime.split(" ")[1]),i.parent().find("dd[name='triggerCount']").text(parseInt(i.parent().find("dd[name='triggerCount']").text())+1),util.showNotify({type:"success",content:t.t("ANDON.T.MSG_TOUCH_SUCCESS",{andonText:i.attr("typeText")})}),setTimeout(function(){e("div.notify").remove()},5e3)):(i.attr("switchOnDateTime",""),i.find(".touch-time").text(""),i.parent().find("dd[name='lastTriggerTimePart']").text(""),util.showNotify({type:"success",content:t.t("ANDON.T.MSG_CLOSE_SUCCESS",{andonText:i.attr("typeText")})}),setTimeout(function(){e("div.notify").remove()},5e3)),n.changeAndonDispay(i),n.warningDisplay()):util.showNotify({type:"error",content:""});n.STATE_TOUCH==o?n.STATE_NORMAL:n.STATE_TOUCH})}),e("button.simple",this.page).on("click",function(t){e.each(e("a[type='andon']",n.page),function(t,n){$parent=e(n).parent(),$this=e(n),$parent.removeClass("andon-list-item-detail"),$parent.find(".andon-list-item-info").fadeOut(100)}),e("button.simple",n.page).addClass("active"),e("button.detail",n.page).removeClass("active")}),e("button.detail",this.page).on("click",function(t){e.each(e("a[type='andon']",n.page),function(t,n){$parent=e(n).parent(),$this=e(n),$parent.addClass("andon-list-item-detail"),$parent.find(".andon-list-item-info").fadeIn(100)}),e("button.detail",n.page).addClass("active"),e("button.simple",n.page).removeClass("active")})},loadPage:function(n){var a=this;util.service("GMES-CLIENT-ANDON001",{stationCode:n.stationCode},t.t("ANDON.T.MSG_ANDON_LOADING"),function(t){var n=t.data,i=[];e.each(n,function(t,e){e.lastTriggerTime&&(e.lastTriggerTimePart=e.lastTriggerTime.split(" ")[1]),"LSANDON"!=e.andonType.andonTypeCode&&i.push(e)});var o=a.group(i,6);util.tplManager("andonControlSwiperTpl",o,"andonControlSwiperRender"),a.event(),a.warningDisplay()})},group:function(t,e){for(var n=0,a={groupAndons:[]};n<t.length;)a.groupAndons.push(t.slice(n,n+=e));return a},syncAndonStatus:function(){var n=this;"andonControlPanel"==e("div.view-main .pages div.page:last-child").attr("data-page")&&util.service("GMES-CLIENT-ANDON001",{stationCode:n.station.stationCode},null,function(a){var i=a.data;e.each(i,function(a,i){var o=i.lastTriggerTime?1:3,r=e("a[type='andon'][andonTypeCode='"+i.andonType.andonTypeCode+"']");r.attr("accumulatedTime",i.accumulatedTime||0),r.attr("statusECode")!=o&&(i.lastTriggerTime&&(i.lastTriggerTimePart=i.lastTriggerTime.split(" ")[1]),r.attr("statusECode",o),n.isTouched(o)?(r.attr("switchOnDateTime",i.lastTriggerTime),r.parent().find("dd[name='lastTriggerTimePart']").text(i.lastTriggerTime.split(" ")[1]),r.parent().find("dd[name='triggerCount']").text(parseInt(i.triggerCount)),util.showNotify({type:"success",content:t.t("ANDON.T.MSG_ANDON_TOUCH_STATUS_SYNC",{andonText:r.attr("typeText")})}),setTimeout(function(){e("div.notify").remove()},5e3)):(r.attr("switchOnDateTime",""),r.find(".touch-time").text(""),r.parent().find("dd[name='lastTriggerTimePart']").text(""),util.showNotify({type:"success",content:t.t("ANDON.T.MSG_ANDON_CLOSE_STATUS_SYNC",{andonText:r.attr("typeText")})}),setTimeout(function(){e("div.notify").remove()},5e3))),n.changeAndonDispay(r)}),n.warningDisplay()})},isTouched:function(t){return t==this.STATE_TOUCH},changeAndonDispay:function(t){var n=e(t);if(n.attr("statusECode")==this.STATE_TOUCH){var o=a(i.getServerDataTime()),r=o.diff(n.attr("switchOnDateTime")||o);r=r<0?0:r,r<=1e4?n.css("background","linear-gradient(to bottom, #f4b664, #e9822d)"):n.css("background",n.attr("touchColor")),n.find(".touch-time").text(this.calTime(r)),n.parent().find("dd[name='accumulatedTime']").text(this.calTime(1e3*(n.attr("accumulatedTime")||0)+Math.floor(r/1e3)))}else n.css("background",n.attr("normalColor")),n.parent().find("dd[name='accumulatedTime']").text(this.calTime(1e3*(n.attr("accumulatedTime")||0)))},warningDisplay:function(){e("a[type='andon'][statusECode='1']",this.page).length>0?e(this.page).find("div.page-content").addClass("andon-bg-blink"):e(this.page).find("div.page-content").removeClass("andon-bg-blink")},calTime:function(e){var n=Math.floor(e/6e4);n=0!=n?t.t("COMMON.T.MINUTE",{minute:n}):"";var a=e%6e4,i=Math.round(a/1e3);return i=0!=i?t.t("COMMON.T.SECOND",{second:i}):"",n+i}};F7.onPageInit("andonControlPanel",function(t){e(document).off("keydown"),r.init(e(t.container)),util.translate('.page[data-page="andonControlPanel"]')}),F7.onPageBeforeRemove("andonControlPanel",function(t){r.clearSchedule()})}).call(e,n(37),n(4),n(30))}});
//# sourceMappingURL=andon_andonControlPanel_4471d572f0adadb2657c.js.map