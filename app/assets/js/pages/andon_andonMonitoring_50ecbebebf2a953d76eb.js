webpackJsonp([35],{620:function(e,n,t){"use strict";(function(n,a){var r=t(35),o=t(53),i=t(34),s={STATE_TOUCH:1,STATE_NORMAL:3,page:void 0,station:void 0,timer:void 0,andonTypeCode:null,allAndons:null,dataTable:void 0,queryParam:{serviceCode:"GMES-CLIENT-ANDON005",statusECode:"1",typeCode:""},init:function(){n(document).off("keydown"),i.translate('.page[data-page="andonMonitoring"]');var e=this;i.setBreadcrumb([a.t("ANDON.T.MENU_ANDONMONITORING")]),e.loadPage(),e.subscribeMessageTopic()},subscribeMessageTopic:function(){var e="business/andon/status/"+r.getSiteCode()+"/+";o.subscribe(e),o.registerMessageHandler(e,"andonMonitoring.andonMonitoringMessageHandler",function(e){Sweet.mainView.router.refreshPage()})},loadPage:function(e){var t=this;i.service("GMES-CLIENT-ANDON011",{},null,function(e){var r=e.data,o=[],s=0;n.each(r,function(e,n){s+=n.triggerCount,"LSANDON"!=n.andonType.andonTypeCode&&o.push(n)});var d=t.group(o,3),u={statusECode:0==s?t.STATE_NORMAL:t.STATE_TOUCH,triggerCount:s,normalColor:"linear-gradient(to bottom, #00FF00, #13a834)",touchColor:"#ed5565",typeText:a.t("ANDON.T.ALL")};i.tplManager("andonTotalTpl",u,"andonTotalRender"),i.tplManager("andonMonitoringTypeSwiperTpl",d,"andonMonitoringTypeSwiperRender");myApp.swiper(n(".swiper-container",t.page),{pagination:n(".swiper-pagination",t.page),nextButton:n(".swiper-button-next",t.page),prevButton:n(".swiper-button-prev",t.page)});t.event()});var o=this.page.height-220-43-53;this.dataTable=i.dataTable(n(".table-panel table",this.page),{scrollY:o,order:[],ajax:{serviceCode:"GMES-CLIENT-ANDON005",param:function(){return t.queryParam}},columns:[{data:"id",orderable:!1,render:function(e,n,t,a){return a.settings._iDisplayStart+a.row+1}},{data:"workCenterText",name:"workCenterText"},{data:"stationText",name:"stationText"},{data:"typeText",name:"typeText"},{name:"statusECode",width:"55px",render:function(e,n,t){var r,o;switch(t.statusECode){case"1":r=a.t("ANDON.T.STATUS_TOUCH"),o="#ef5362";break;case"3":r=a.t("ANDON.T.STATUS_CLOSE"),o="#ffce54";break;default:r="确认",o="#27c24c"}return'<span style="padding:5px 15px;color:#fff;background:'+o+';border-radius:15px;">'+r+"</span>"}},{name:"triggerTime",orderable:!1,render:function(e,n,t){var o=Math.abs(r.getServerDateTime()-t.switchOnDateTime)/1e3;return function(e){var n=parseInt(e),t=0,r=0;return n>60&&(t=parseInt(n/60),n=parseInt(n%60),t>60&&(r=parseInt(t/60),t=parseInt(t%60))),a.t("COMMON.T.TIME",{hour:parseInt(r),minute:parseInt(t),second:parseInt(n)})}(o)}},{data:"switchOnDateTime",name:"switchOnDateTime",render:function(e,n,t){return function(e){function n(e){return parseInt(e)<10&&(e="0"+e),e}var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),i=t.getHours(),s=t.getMinutes(),d=t.getSeconds();return a+"-"+n(r)+"-"+n(o)+" "+n(i)+":"+n(s)+":"+n(d)}(e)}},{data:"switchOnUser",name:"switchOnUser"},{data:"memo",name:"memo"}]})},event:function(){var e=this;n("a[type='andonType']",this.page).on("click",function(t){var a=n(t.target);"A"!=t.target.tagName&&(a=a.parents("a")),e.queryParam.typeCode=n(a).attr("andonTypeCode"),e.dataTable.ajax.reload()})},andonTriggerTimeSync:function(){},render:function(e){},group:function(e,n){for(var t=0,a={groupAndons:[]};t<e.length;)a.groupAndons.push(e.slice(t,t+=n));return a},calTypeOnNums:function(e){var t=[{andonTypeCode:null,typeText:"总",num:0,colWidth:null}];n.each(e,function(){if(this.andonTypeCode){t[0].num++;for(var e=!1,n=0;n<t.length;n++)if(t[n].andonTypeCode==this.andonTypeCode){t[n].num++,e=!0;break}e||t.push({andonTypeCode:this.andonTypeCode,typeText:this.typeText,num:1,colWidth:null})}});var a=Math.floor(100/t.length);return n.each(t,function(){this.colWidth=a}),t},groupAndonsByType:function(e,t){var a=[];return n.each(e,function(){this.andonTypeCode==t&&a.push(this)}),a}};e.exports=s}).call(n,t(4),t(37))}});
//# sourceMappingURL=andon_andonMonitoring_50ecbebebf2a953d76eb.js.map