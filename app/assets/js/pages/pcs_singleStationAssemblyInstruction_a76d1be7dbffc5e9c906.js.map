{"version":3,"sources":["webpack:///assets/js/pages/pcs_singleStationAssemblyInstruction_a76d1be7dbffc5e9c906.js","webpack:///./src/js/pages/pcs/singleStationAssemblyInstruction.js"],"names":["webpackJsonp","639","module","exports","__webpack_require__","$","notie","security","mqttLib","util","singleStationAssemblyInstructionCtrl","$timeEl","undefined","pages","page","$page","moduleConfig","topic","init","this","flag","length","setZoom","translate","initData","_this","config","getSysModuleConfig","done","response","proConfig","getDataAndRenderScreen","subscribeNotify","getSiteCode","subscribe","registerMessageHandler","url","service","onlineStationCode","assemblyStationCode","stationCode","rowNum","returnCode","alert","text","errorMessage","data","processData","thresholdValue","warnShineFlag","remainingQuantity","tplManager","call"],"mappings":"AAAAA,cAAc,KAERC,IACA,SAAUC,EAAQC,EAASC,GAEjC,cAC4B,SAASC,EAAGC,GCGxC,GAAIC,GAAWH,EAAQ,IACnBI,EAAUJ,EAAQ,IAClBK,EAAOL,EAAQ,IAEfM,GACAC,YAASC,GACTC,UAAOD,GACPE,SAAMF,GACNG,UAAOH,GACPI,iBAAcJ,GACdK,UAAOL,GAEPM,KAAM,WACFC,KAAKC,KAAOf,EAAE,iBAAiBgB,OAC/BF,KAAKJ,MAAQV,EAAEc,KAAKL,MACpBK,KAAKR,QAAUN,EAAE,aAAcc,KAAKJ,OACpCN,EAAKa,QAAQH,KAAKL,MAClBL,EAAKc,UAAUJ,KAAKJ,OACpBI,KAAKK,YAGTA,SAAU,WACN,GAAIC,GAAQN,KACRO,EAAS,qCACZP,MAAKC,OACXM,EAAS,mCAEJnB,EAASoB,mBAAmB,MAAOD,GAAQE,KAAK,SAAUC,GAEtDpB,EAAKqB,UAAUD,EAAU,SAASb,GAC7BS,EAAMT,aAAeA,EACtBS,EAAMM,yBACNN,EAAMO,uBAMlBA,gBAAiB,WACb,GAAIP,GAAQN,KACRF,EAAQ,eAAiBV,EAAS0B,cAAgB,IAAMR,EAAMT,aAAN,iBAExDG,MAAKC,OACdH,EAAQ,0BAAoCQ,EAAMT,aAAN,mBAEvCS,EAAMR,MAAQA,EACdT,EAAQ0B,UAAUjB,EAAO,oCAEzBT,EAAQ2B,uBAAuBlB,EAAO,oEAAqE,WACtGQ,EAAMM,4BAIfA,uBAAwB,WACpB,GAAIN,GAAQN,KACRiB,EAAM,qBACNjB,MAAKC,OACLgB,EAAM,uBAGV3B,EAAK4B,QAAQD,GACTE,kBAAqBb,EAAMT,aAAN,kBACrBuB,oBAAuBd,EAAMT,aAAN,oBACvBwB,YAAef,EAAMT,aAAN,YACfyB,OAAUhB,EAAMT,aAAN,QAAgC,GAC3C,SAASY,KAAK,SAAUC,GAEvB,GAA4B,MAAxBA,EAASa,WAET,WADApC,GAAMqC,OAAOC,KAAMf,EAASgB,cAIhC,IAAIC,GAAOjB,EAASiB,IACpB,KAAKA,EAED,WADAxC,GAAMqC,OAAOC,KAAM,SAIvBE,GAAOrC,EAAKsC,YAAYtB,EAAMT,aAAc8B,EAE5C,IAAIE,GAAiBvB,EAAMT,aAAN,gBAAwC,CAC7D8B,GAAKG,eAAgB,EACjBH,EAAKI,mBAAqBJ,EAAKI,mBAAqBF,IACpDF,EAAKG,eAAgB,GAEzBxC,EAAK0C,WAAW,yBAA0BL,EAAM,kCAK5D5C,GAAOC,QAAUO,IDFY0C,KAAKjD,EAASC,EAAoB,GAAIA,EAAoB","file":"assets/js/pages/pcs_singleStationAssemblyInstruction_a76d1be7dbffc5e9c906.js","sourcesContent":["webpackJsonp([22],{\n\n/***/ 639:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, notie) {\n\nvar security = __webpack_require__(35);\nvar mqttLib = __webpack_require__(53);\nvar util = __webpack_require__(34);\n\nvar singleStationAssemblyInstructionCtrl = {\n    $timeEl: undefined,\n    pages: undefined,\n    page: undefined,\n    $page: undefined,\n    moduleConfig: undefined,\n    topic: undefined,\n    init: function init() {\n        this.flag = $(\".main-station\").length;\n        this.$page = $(this.page);\n        this.$timeEl = $(\".time span\", this.$page);\n        util.setZoom(this.page);\n        util.translate(this.$page);\n        this.initData();\n    },\n\n    initData: function initData() {\n        var _this = this;\n        var config = \"SINGLE_STATION_ASSEMBLY_INSTRUCTION\";\n        if (this.flag) {\n            config = \"SINGLE_MAIN_STATION_INSTRUCTION\";\n        }\n        security.getSysModuleConfig(\"PCS\", config).done(function (response) {\n\n            util.proConfig(response, function (moduleConfig) {\n                _this.moduleConfig = moduleConfig;\n                _this.getDataAndRenderScreen();\n                _this.subscribeNotify();\n            });\n        });\n    },\n\n    subscribeNotify: function subscribeNotify() {\n        var _this = this;\n        var topic = \"subassembly/\" + security.getSiteCode() + \"/\" + _this.moduleConfig[\"onlineStationCode\"];\n\n        if (this.flag) {\n            topic = \"productionConfirm/\" + 6321 + \"/\" + _this.moduleConfig[\"onlineStationCode\"];\n        }\n        _this.topic = topic;\n        mqttLib.subscribe(topic, \"singleStationAssemblyInstruction\");\n\n        mqttLib.registerMessageHandler(topic, \"singleStationAssemblyInstruction.singleStationAssemblyInstruction\", function () {\n            _this.getDataAndRenderScreen();\n        });\n    },\n\n    getDataAndRenderScreen: function getDataAndRenderScreen() {\n        var _this = this;\n        var url = \"GMES-CLIENT-PCS0005\";\n        if (this.flag) {\n            url = \"GMES-CLIENT-PCS0006\";\n        }\n\n        util.service(url, {\n            \"onlineStationCode\": _this.moduleConfig[\"onlineStationCode\"],\n            \"assemblyStationCode\": _this.moduleConfig[\"assemblyStationCode\"],\n            \"stationCode\": _this.moduleConfig[\"stationCode\"],\n            \"rowNum\": _this.moduleConfig[\"rowNum\"] || 0\n        }, \"正在加载中\").done(function (response) {\n\n            if (response.returnCode !== \"0\") {\n                notie.alert({ text: response.errorMessage });\n                return;\n            }\n\n            var data = response.data;\n            if (!data) {\n                notie.alert({ text: \"站点无数据\" });\n                return;\n            }\n\n            data = util.processData(_this.moduleConfig, data);\n\n            var thresholdValue = _this.moduleConfig[\"thresholdValue\"] || 3;\n            data.warnShineFlag = false;\n            if (data.remainingQuantity && data.remainingQuantity <= thresholdValue) {\n                data.warnShineFlag = true;\n            }\n            util.tplManager(\"singleStationAssInsTpl\", data, \"singleStationAssInstrRender\");\n        });\n    }\n};\n\nmodule.exports = singleStationAssemblyInstructionCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(36)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/pcs_singleStationAssemblyInstruction_a76d1be7dbffc5e9c906.js","/*\r\n * @name: \\pcs\\singleStationAssemblyInstruction.js\r\n * @author: EVUN前端组\r\n * @modify: kelichao\r\n * @update: 2017-06-13\r\n * @decript: 装配指示（单）\r\n * @url: http://git.evun.cn/GMES/GMES_CLIENT_PAD\r\n */\r\n\r\nvar security = require(\"security\");\r\nvar mqttLib = require(\"mqttLib\");\r\nvar util = require(\"util\");\r\n\r\nvar singleStationAssemblyInstructionCtrl = {\r\n    $timeEl: undefined,// 时间显示容器\r\n    pages: undefined,// 在sweet内部已经定义,对象\r\n    page: undefined,// 页面容器\r\n    $page: undefined,// 页面容器（jquery对象）\r\n    moduleConfig: undefined,// 模块配置\r\n    topic: undefined,// 主题\r\n    // 初始化\r\n    init: function () {\r\n        this.flag = $(\".main-station\").length;\r\n        this.$page = $(this.page);\r\n        this.$timeEl = $(\".time span\", this.$page);\r\n        util.setZoom(this.page);\r\n        util.translate(this.$page);\r\n        this.initData();// 初始化数据时，获取站点配置信息，首次加载并渲染本页面数据\r\n    },\r\n    // 初始化页面数据\r\n    initData: function () {\r\n        var _this = this;\r\n        var config = \"SINGLE_STATION_ASSEMBLY_INSTRUCTION\";\r\n    \tif (this.flag) {\r\n\t\t\tconfig = \"SINGLE_MAIN_STATION_INSTRUCTION\";\r\n\t\t}\r\n        security.getSysModuleConfig(\"PCS\", config).done(function (response) {\r\n\r\n            util.proConfig(response, function(moduleConfig) {\r\n                 _this.moduleConfig = moduleConfig;\r\n                _this.getDataAndRenderScreen();     // 首次获取数据并且渲染\r\n                _this.subscribeNotify();        // 订阅通知\r\n            });\r\n        });\r\n    },\r\n    // 订阅站点上件通知，收到通知，则重新获取页面数据并刷新页面\r\n    // webSocket通知\r\n    subscribeNotify: function () {\r\n        var _this = this;\r\n        var topic = \"subassembly/\" + security.getSiteCode() + \"/\" + _this.moduleConfig[\"onlineStationCode\"]; //主题 subassembly/1310/IP\r\n\r\n        if (this.flag) {\r\n\t\t\ttopic = \"productionConfirm/\" + 6321 + \"/\" + _this.moduleConfig[\"onlineStationCode\"]; //主线\r\n\t\t}\r\n        _this.topic = topic;\r\n        mqttLib.subscribe(topic, \"singleStationAssemblyInstruction\");\r\n\r\n        mqttLib.registerMessageHandler(topic, \"singleStationAssemblyInstruction.singleStationAssemblyInstruction\", function () {\r\n             _this.getDataAndRenderScreen();\r\n        });\r\n    },\r\n    // 获取页面数据并刷新页面\r\n    getDataAndRenderScreen: function () {\r\n        var _this = this;\r\n        var url = \"GMES-CLIENT-PCS0005\";\r\n        if (this.flag) {\r\n            url = \"GMES-CLIENT-PCS0006\";\r\n        }\r\n\r\n        util.service(url, {\r\n            \"onlineStationCode\": _this.moduleConfig[\"onlineStationCode\"],\r\n            \"assemblyStationCode\": _this.moduleConfig[\"assemblyStationCode\"],\r\n            \"stationCode\": _this.moduleConfig[\"stationCode\"],// 主线专用\r\n            \"rowNum\": _this.moduleConfig[\"rowNum\"] || 0\r\n        }, \"正在加载中\").done(function (response) {\r\n\r\n            if (response.returnCode !== \"0\") {\r\n                notie.alert({text: response.errorMessage});\r\n                return;\r\n            }\r\n\r\n            var data = response.data;\r\n            if (!data) {\r\n                notie.alert({text: \"站点无数据\"});\r\n                return;\r\n            }\r\n\r\n            data = util.processData(_this.moduleConfig, data);\r\n\r\n            var thresholdValue = _this.moduleConfig[\"thresholdValue\"] || 3;\r\n            data.warnShineFlag = false;\r\n            if (data.remainingQuantity && data.remainingQuantity <= thresholdValue) {\r\n                data.warnShineFlag = true;\r\n            }\r\n            util.tplManager(\"singleStationAssInsTpl\", data, \"singleStationAssInstrRender\");\r\n        });\r\n    }\r\n};\r\n\r\nmodule.exports = singleStationAssemblyInstructionCtrl;\r\n\r\n// F7.onPageBeforeRemove('singleStationAssemblyInstruction', function(page) {\r\n//     singleStationAssemblyInstructionView.cancelSubscribe();\r\n// });\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/pcs/singleStationAssemblyInstruction.js"],"sourceRoot":""}