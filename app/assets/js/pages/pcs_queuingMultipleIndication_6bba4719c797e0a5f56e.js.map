{"version":3,"sources":["webpack:///assets/js/pages/pcs_queuingMultipleIndication_6bba4719c797e0a5f56e.js","webpack:///./src/js/pages/pcs/queuingMultipleIndication.js"],"names":["webpackJsonp","638","module","exports","__webpack_require__","$","notie","_stringify","_stringify2","obj","__esModule","default","kit","util","security","siteCode","getSiteCode","sure","options","moduleConfig","configCodes","rowNum","stationCode","title","queuingMultipleIndicationCtrl","config","pageNum","getNum","urlDetail","urlHistory","urlSure","data","productionQueues","configEnums","productNum","productId","carDescription","remarkremark","dln","lsn","send","configCode","configText","valueText","fileName","init","this","translate","page","setZoom","initData","initEvent","remoteKey","_this","View","initialize","current","events",".u-quePage a:eq(0)",".u-quePage a:eq(1)",".u-refresh",".u-queuingSure:not(.u-queue-disabled)",".m-product-table tbody tr:has(input[type=checkbox])","eventsFunction","selectTr","event","$this","$checkbox","find","addClass","siblings","removeClass","is","attr","setSureStatus","prevPage","setPageAndRender","nextPage","refresh","arr","params","extend","aims","getCheckedArr","each","index","value","total","push","subassemblyOnlinesJson","service","done","selectItem","number","length","final","eq","codeConfig","38","40","37","throttle","trigger","39","13","document","on","keyCode","parents","setPageNum","enter","html","getTableData","then","getSysModuleConfig","response","proConfig","url","ext","stNum","num","ajaxSucc","setTotalAndHis","isNumeric","triggerSuccessEvun","haveData","dataArray","container","map","item","canCheckFlag","tplManager","noData","alert","type","text","errorMessage","call"],"mappings":"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","file":"assets/js/pages/pcs_queuingMultipleIndication_6bba4719c797e0a5f56e.js","sourcesContent":["webpackJsonp([23],{\n\n/***/ 638:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, notie) {\n\nvar _stringify = __webpack_require__(38);\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar kit = __webpack_require__(78);\nvar util = __webpack_require__(34);\nvar security = __webpack_require__(35);\nvar siteCode = security.getSiteCode();\n\nvar productionQueues = \"subassemblyOnlineDTOs\";\nvar productId = \"productionSeqNum\";\nvar selected = \".u-selected\";\nvar sure = \".u-queuingSure\";\n\nvar options = {\n\tmoduleConfig: {\n\t\tconfigCodes: [],\n\t\trowNum: \"\",\n\t\tstationCode: \"\",\n\t\ttitle: \"\" }\n};\n\nvar queuingMultipleIndicationCtrl = {\n\tconfig: {\n\t\tsiteCode: siteCode,\n\t\tpageNum: 0,\n\t\tgetNum: 8,\n\t\turlDetail: \"GMES-CLIENT-PCS0011\",\n\t\turlHistory: \"GMES-CLIENT-PCS0012\",\n\t\turlSure: \"GMES-CLIENT-PCS0013\" },\n\n\tdata: {\n\t\tproductionQueues: [{\n\t\t\tconfigEnums: [],\n\t\t\tproductNum: \"--\",\n\t\t\tproductId: \"--\",\n\t\t\tcarDescription: \"--\",\n\t\t\tremarkremark: \"--\" }],\n\t\tdln: \"--\",\n\t\tlsn: \"--\" },\n\tsend: {\n\t\tconfigEnums: [{\n\t\t\tconfigCode: \"YB\",\n\t\t\tconfigText: \"\",\n\t\t\tvalueText: \"\",\n\t\t\tfileName: \"\" }, {\n\t\t\tconfigCode: \"ZYB\",\n\t\t\tconfigText: \"\",\n\t\t\tvalueText: \"\",\n\t\t\tfileName: \"\" }] },\n\n\tinit: function init() {\n\t\tthis.config.pageNum = 0;\n\n\t\tutil.translate(this.page);\n\t\tutil.setZoom(this.page);\n\t\tthis.initData();\n\t\tthis.initEvent();\n\t\tthis.remoteKey();\n\t},\n\tinitEvent: function initEvent() {\n\t\tvar _this = this;\n\t\tnew kit.View({\n\t\t\tinitialize: function initialize() {},\n\t\t\tcurrent: $(\"#queuingMultipleIndication\"),\n\t\t\tevents: {\n\t\t\t\t\".u-quePage a:eq(0)\": \"prevPage\",\n\t\t\t\t\".u-quePage a:eq(1)\": \"nextPage\",\n\t\t\t\t\".u-refresh\": \"refresh\",\n\t\t\t\t\".u-queuingSure:not(.u-queue-disabled)\": \"sure\",\n\t\t\t\t\".m-product-table tbody tr:has(input[type=checkbox])\": \"selectTr\" },\n\t\t\teventsFunction: {\n\t\t\t\tselectTr: function selectTr(event) {\n\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\tvar $checkbox = $this.find(\"input[type=checkbox]\");\n\t\t\t\t\tvar className = \"u-selected\";\n\n\t\t\t\t\t$this.addClass(className).siblings().removeClass(className);\n\n\t\t\t\t\t$(\".m-sure-cont a\").removeClass(className);\n\n\t\t\t\t\tif ($checkbox.is(\":checked\") === true) {\n\t\t\t\t\t\t$checkbox.attr(\"checked\", false);\n\t\t\t\t\t\t$this.removeClass(\"checked-tr\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$checkbox.attr(\"checked\", true);\n\t\t\t\t\t\t$this.addClass(\"checked-tr\");\n\t\t\t\t\t}\n\n\t\t\t\t\t_this.setSureStatus();\n\t\t\t\t},\n\t\t\t\tprevPage: function prevPage() {\n\t\t\t\t\t_this.setPageAndRender(-1);\n\t\t\t\t},\n\t\t\t\tnextPage: function nextPage() {\n\t\t\t\t\t_this.setPageAndRender(1);\n\t\t\t\t},\n\t\t\t\trefresh: function refresh() {\n\t\t\t\t\t_this.setPageAndRender(true);\n\t\t\t\t},\n\t\t\t\tsure: function sure() {\n\t\t\t\t\tvar arr = [];\n\t\t\t\t\tvar data;\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\tsiteCode: _this.config.siteCode,\n\t\t\t\t\t\tproductNum: \"\" };\n\n\t\t\t\t\t$.extend(params, options.moduleConfig);\n\n\t\t\t\t\tvar aims = _this.getCheckedArr();\n\t\t\t\t\t$.each(aims, function (index, value) {\n\t\t\t\t\t\tvar total = $.extend({}, params);\n\n\t\t\t\t\t\ttotal.productNum = $(value).find(\".productNum\").attr(\"data\");\n\t\t\t\t\t\ttotal[productId] = $(value).find(\".productId\").attr(\"data\");\n\n\t\t\t\t\t\tarr.push(total);\n\t\t\t\t\t});\n\n\t\t\t\t\tdata = { subassemblyOnlinesJson: (0, _stringify2.default)(arr) };\n\n\t\t\t\t\tutil.service(_this.config.urlSure, data, \"正在确认...\").done(function () {\n\t\t\t\t\t\t_this.initData();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tselectItem: function selectItem(number) {\n\t\tvar index = $(selected).index(\".can-select\");\n\t\tvar length = $(\".can-select\").length;\n\t\tvar final = index + number;\n\n\t\tif (final >= length) {\n\t\t\tfinal = 0;\n\t\t}\n\t\t$(selected).removeClass(\"u-selected\");\n\t\t$(\".can-select\").eq(final).addClass(\"u-selected\");\n\t},\n\tremoteKey: function remoteKey() {\n\t\tvar _this = this;\n\n\t\tvar codeConfig = {\n\t\t\t\"38\": function _() {\n\t\t\t\t_this.selectItem(-1);\n\t\t\t},\n\t\t\t\"40\": function _() {\n\t\t\t\t_this.selectItem(1);\n\t\t\t},\n\t\t\t\"37\": function () {\n\t\t\t\treturn kit.throttle(function () {\n\t\t\t\t\t$(\".u-quePage a:eq(0)\").trigger(\"click\");\n\t\t\t\t});\n\t\t\t}(),\n\t\t\t\"39\": function () {\n\t\t\t\treturn kit.throttle(function () {\n\t\t\t\t\t$(\".u-quePage a:eq(1)\").trigger(\"click\");\n\t\t\t\t});\n\t\t\t}(),\n\t\t\t\"13\": function _() {\n\t\t\t\t$(selected).trigger(\"click\");\n\t\t\t}\n\t\t};\n\n\t\t$(document).on(\"keydown\", function (event) {\n\t\t\tif (codeConfig[event.keyCode]) {\n\t\t\t\tcodeConfig[event.keyCode]();\n\t\t\t}\n\t\t});\n\t},\n\tsetSureStatus: function setSureStatus() {\n\t\tvar arr = this.getCheckedArr();\n\t\tif (arr.length > 0) {\n\t\t\t$(sure).removeClass(\"u-queue-disabled\");\n\t\t} else {\n\t\t\t$(sure).addClass(\"u-queue-disabled\");\n\t\t}\n\t},\n\tgetCheckedArr: function getCheckedArr() {\n\t\treturn $(\".m-product-table tr input[type=checkbox]:checked\").parents(\"tr\");\n\t},\n\tsetPageNum: function setPageNum(enter) {\n\t\tif (enter === true) {\n\t\t\tthis.config.pageNum = 0;\n\t\t} else {\n\t\t\tthis.config.pageNum += enter;\n\t\t}\n\n\t\t$(\".u-queue-now\").html(this.config.pageNum);\n\t},\n\tsetPageAndRender: function setPageAndRender(enter) {\n\t\tvar _this = this;\n\n\t\tthis.setPageNum(enter);\n\t\tthis.getTableData(options.moduleConfig).then(function () {\n\t\t\t_this.setSureStatus();\n\t\t});\n\n\t\t$(\".can-select\").removeClass(\"u-selected\");\n\t\t$(\".u-refresh\").addClass(\"u-selected\");\n\t},\n\n\tinitData: function initData() {\n\t\tvar _this = this;\n\n\t\tsecurity.getSysModuleConfig(\"PCS\", \"QUEUING_MULTIPLE_INDICATION\").done(function (response) {\n\n\t\t\tutil.proConfig(response, function (moduleConfig) {\n\t\t\t\toptions.moduleConfig = moduleConfig;\n\t\t\t\t_this.setPageAndRender(0);\n\t\t\t});\n\t\t});\n\t},\n\tgetTableData: function getTableData(params) {\n\t\tvar _this = this;\n\n\t\tvar url = this.config.pageNum >= 0 ? this.config.urlDetail : this.config.urlHistory;\n\n\t\tvar ext = {\n\t\t\tpageNum: this.config.pageNum,\n\t\t\tgetNum: this.config.getNum,\n\t\t\tsiteCode: this.config.siteCode,\n\t\t\tstNum: 2,\n\t\t\tnum: options.moduleConfig.rowNum };\n\n\t\tparams = $.extend(params, ext);\n\n\t\treturn util.service(url, params, \"正在加载中\").done(function (response) {\n\t\t\t_this.ajaxSucc(response);\n\t\t});\n\t},\n\tsetTotalAndHis: function setTotalAndHis(data) {\n\t\tvar dln = data.dln;\n\t\tvar lsn = data.lsn;\n\t\tvar flag = $.isNumeric(dln);\n\n\t\tif (flag) {\n\t\t\tif (dln > 0) {\n\t\t\t\tdln--;\n\t\t\t}\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\t$(\".u-queue-total\").html(dln);\n\t\t$(\".u-queue-history\").html(-lsn);\n\t},\n\tajaxSucc: function ajaxSucc(response) {\n\t\tvar _this = this;\n\n\t\tkit.triggerSuccessEvun({\n\t\t\tresponse: response,\n\n\t\t\thaveData: function haveData(data) {\n\t\t\t\tvar dataArray = data.productionQueues || data[productionQueues];\n\n\t\t\t\tif (dataArray.length !== 0) {\n\t\t\t\t\tvar container = {};\n\n\t\t\t\t\tdataArray = dataArray.map(function (value) {\n\t\t\t\t\t\tvalue.productId = value.productId || value[productId];\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t});\n\n\t\t\t\t\t_this.setTotalAndHis(data);\n\n\t\t\t\t\tcontainer.item = dataArray;\n\t\t\t\t\tcontainer.canCheckFlag = _this.config.pageNum === 0 ? true : false;\n\n\t\t\t\t\tutil.tplManager(\"queuingMultipleTpl\", container, \"m-product-tobdy\");\n\t\t\t\t} else {\n\t\t\t\t\t_this.setTotalAndHis(data);\n\t\t\t\t\t$(\".m-product-table tbody\").html(\"<tr><td colspan='4'>暂无数据</td></tr>\");\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tnoData: function noData() {\n\t\t\t\tnotie.alert({ type: \"1\", text: \"请求错误 \" + response.errorMessage });\n\t\t\t}\n\t\t});\n\t}\n};\n\nmodule.exports = queuingMultipleIndicationCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(36)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/pcs_queuingMultipleIndication_6bba4719c797e0a5f56e.js","/*\r\n * @name: pages\\pcs\\queuingMultipleIndication.js\r\n * @author: EVUN前端组\r\n * @modify: kelichao \r\n * @update: 2017-07-06\r\n * @decript: 上件指示（批量版）\r\n * @url: http://git.evun.cn/GMES/GMES_CLIENT_PAD\r\n */\r\n\r\nvar kit = require(\"kit\");\r\nvar util = require(\"util\");\r\nvar security = require(\"security\");// 用于获取请求参数的封装体\r\nvar siteCode = security.getSiteCode();\r\n\r\n// 键值消歧\r\nvar productionQueues = \"subassemblyOnlineDTOs\";\r\nvar productId = \"productionSeqNum\";// 生产管理号。历史数据productionSeqNum\r\nvar selected = \".u-selected\";\r\nvar sure = \".u-queuingSure\";\r\n\r\nvar options = {\r\n\t// 模块站点配置\r\n\tmoduleConfig: {\r\n\t\tconfigCodes:[],\r\n\t\trowNum:\"\",// 队列长度过滤量，影响当前列队数量\r\n\t\tstationCode:\"\",// 站点代码\r\n\t\ttitle:\"\"// 仪表上件指示\r\n\t}\r\n};\r\n\r\nvar queuingMultipleIndicationCtrl = {\r\n\t// 数据配置项\r\n\tconfig: {\r\n\t\tsiteCode: siteCode,// 站点信息 \"1310\"\r\n\t\tpageNum: 0,// 当前页码\r\n\t\tgetNum: 8,// 每页数量\r\n\t\turlDetail: \"GMES-CLIENT-PCS0011\",// 当前列队标识\r\n\t\turlHistory: \"GMES-CLIENT-PCS0012\",// 历史标识\r\n\t\turlSure: \"GMES-CLIENT-PCS0013\"// 确认按钮\r\n\t},\r\n\t// 数据初始化\r\n    data: {\r\n\t\t// 当前列队数据[0,1,2,3,4,5,6,7]\r\n\t\tproductionQueues: [\t\t// 历史数据subassemblyOnlineDTOs\r\n\t\t\t{\r\n\t\t\t\tconfigEnums:[],\r\n\t\t\t\tproductNum: \"--\",// 产品标识号\r\n\t\t\t\tproductId: \"--\",// 生产管理号。历史数据productionSeqNum\r\n\t\t\t\tcarDescription: \"--\",// 产品规格\r\n\t\t\t\tremarkremark: \"--\",// 备注\r\n\t\t\t}\r\n\t\t],\r\n\t\tdln: \"--\",// 列队总页数\r\n\t\tlsn: \"--\"// 历史总列数\r\n    },\r\n\tsend: {\r\n\t\tconfigEnums: [{\r\n\t\t\tconfigCode:\"YB\",// 配置编号 \r\n\t\t\tconfigText: \"\",// 配置描述\r\n\t\t\tvalueText: \"\",//配置详情描述\r\n\t\t\tfileName: \"\"// 图片文件名\r\n\t\t},{\r\n\t\t\tconfigCode:\"ZYB\",// 配置编号 \r\n\t\t\tconfigText: \"\",// 配置描述\r\n\t\t\tvalueText: \"\",// 配置详情描述\r\n\t\t\t fileName: \"\"// 图片文件名\r\n\t\t}]// 特性列表\r\n\t},\r\n\t// 初始化\r\n\tinit: function() {\r\n\r\n\t\t// 初始化页码\r\n\t\tthis.config.pageNum = 0;\r\n\r\n\t\tutil.translate(this.page);\r\n\t\tutil.setZoom(this.page);\r\n\t\tthis.initData();\r\n\t\tthis.initEvent();\r\n\t\tthis.remoteKey();\r\n\t},\r\n\tinitEvent: function() {\r\n\t\tvar _this = this;\r\n\t\tnew kit.View({\r\n\t\t\tinitialize: function() {\r\n\t\t\t},\r\n\t\t\tcurrent: $(\"#queuingMultipleIndication\"),\r\n\t\t\tevents: {\r\n\t\t\t\t\".u-quePage a:eq(0)\": \"prevPage\",// 前一页\r\n\t\t\t\t\".u-quePage a:eq(1)\": \"nextPage\",// 后一页\r\n\t\t\t\t\".u-refresh\": \"refresh\",// 刷新\r\n\t\t\t\t\".u-queuingSure:not(.u-queue-disabled)\": \"sure\",// 确认装配\r\n\t\t\t\t\".m-product-table tbody tr:has(input[type=checkbox])\": \"selectTr\"// 选择行\r\n\t\t\t},\r\n\t\t\teventsFunction: {\r\n\t\t\t\tselectTr: function(event) {\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tvar $checkbox = $this.find(\"input[type=checkbox]\");\r\n\t\t\t\t\tvar className = \"u-selected\";\r\n\r\n\t\t\t\t\t$this.addClass(className)\r\n\t\t\t\t\t\t.siblings()\r\n\t\t\t\t\t\t.removeClass(className);\r\n\r\n\t\t\t\t\t$(\".m-sure-cont a\").removeClass(className);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 给当前行添加 / 移除背景色\r\n\t\t\t\t\tif ($checkbox.is(\":checked\") === true) {\r\n\t\t\t\t\t\t$checkbox.attr(\"checked\", false);\r\n\t\t\t\t\t\t$this.removeClass(\"checked-tr\");\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$checkbox.attr(\"checked\", true);\r\n\t\t\t\t\t\t$this.addClass(\"checked-tr\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 判断是否可以点击确认\r\n\t\t\t\t\t_this.setSureStatus();\r\n\t\t\t\t},\r\n\t\t\t\tprevPage: function() {\r\n\t\t\t\t\t_this.setPageAndRender(-1);\r\n\t\t\t\t},\r\n\t\t\t\tnextPage: function() {\r\n\t\t\t\t\t_this.setPageAndRender(1);\r\n\t\t\t\t},\r\n\t\t\t\trefresh: function() {\r\n\t\t\t\t\t_this.setPageAndRender(true);\r\n\t\t\t\t},\r\n\t\t\t\tsure: function() {\r\n\t\t\t\t\tvar arr = [];\r\n\t\t\t\t\tvar data;\r\n\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\tsiteCode: _this.config.siteCode,// 站点信息\r\n\t\t\t\t\t\tproductNum: \"\",// 产品标识号\r\n\t\t\t\t\t\t// productTrackNum: \"\",// 产品跟踪号  先空\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// 添加模块配置,params要附加到arr数组中的每一项\r\n\t\t\t\t\t$.extend(params, options.moduleConfig);\r\n\r\n\t\t\t\t\tvar aims =  _this.getCheckedArr();\r\n\t\t\t\t\t$.each(aims, function(index, value) {\r\n\t\t\t\t\t\tvar total = $.extend({}, params);\r\n\r\n\t\t\t\t\t\t// 把缓存的确认要传的数据添加上productNum, productionSeqNum\r\n\t\t\t\t\t\ttotal.productNum = $(value).find(\".productNum\").attr(\"data\");\r\n\t\t\t\t\t\ttotal[productId] = $(value).find(\".productId\").attr(\"data\");\r\n\r\n\t\t\t\t\t\tarr.push(total);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdata = {subassemblyOnlinesJson: JSON.stringify(arr)};\r\n\r\n\t\t\t\t\t// 上线确认按钮\r\n\t\t\t\t\tutil.service(_this.config.urlSure, data, \"正在确认...\")\r\n\t\t\t\t\t\t.done(function(){_this.initData();});\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tselectItem: function(number) {\r\n\t\tvar index = $(selected).index(\".can-select\");\r\n\t\tvar length= $(\".can-select\").length;\r\n\t\tvar final = index + number;\r\n\r\n\t\tif (final >= length) {\r\n\t\t\tfinal = 0;\r\n\t\t}\r\n\t\t$(selected).removeClass(\"u-selected\");\r\n\t\t$(\".can-select\").eq(final).addClass(\"u-selected\");\r\n\t},\r\n\tremoteKey: function() {\r\n\t\tvar _this = this;\r\n\r\n\t\t// 一个个独立的配置项\r\n\t\tvar codeConfig = {\r\n\t\t\t\"38\": function() {// 向上\r\n\t\t\t\t_this.selectItem(-1);\r\n\t\t\t},\r\n\t\t\t\"40\": function() {// 向下\r\n\t\t\t\t_this.selectItem(1);\r\n\t\t\t},\r\n\t\t\t\"37\": (function() {// 向左\r\n\t\t\t\treturn kit.throttle(function(){\r\n\t\t\t\t\t$(\".u-quePage a:eq(0)\").trigger(\"click\");\r\n\t\t\t\t});\r\n\t\t\t})(),\r\n\t\t\t\"39\": (function() {// 向左\r\n\t\t\t\treturn kit.throttle(function(){\r\n\t\t\t\t\t$(\".u-quePage a:eq(1)\").trigger(\"click\");\r\n\t\t\t\t});\r\n\t\t\t})(),\r\n\t\t\t\"13\": function() {// 回车\r\n\t\t\t\t$(selected).trigger(\"click\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 这部分不需要改动，只需要改动配置项\r\n\t\t$(document).on(\"keydown\", function(event) {\r\n\t\t\tif (codeConfig[event.keyCode]) {\r\n\t\t\t\tcodeConfig[event.keyCode]();\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tsetSureStatus: function() {\r\n\t\tvar arr = this.getCheckedArr();\r\n\t\tif(arr.length > 0) {\r\n\t\t\t$(sure).removeClass(\"u-queue-disabled\");\r\n\t\t} else {\r\n\t\t\t$(sure).addClass(\"u-queue-disabled\");\r\n\t\t}\r\n\t},\r\n\tgetCheckedArr: function() {\r\n\t\treturn $(\".m-product-table tr input[type=checkbox]:checked\").parents(\"tr\");\r\n\t},\r\n\tsetPageNum: function(enter) {\r\n\r\n\t\t// ture则重置\r\n\t\tif (enter === true) {\r\n\t\t\tthis.config.pageNum = 0;\r\n\t\t} else {\r\n\t\t\tthis.config.pageNum += enter;\r\n\t\t}\r\n\r\n\t\t$(\".u-queue-now\").html(this.config.pageNum);\r\n\t},\r\n\tsetPageAndRender: function(enter) {\r\n\t\tvar _this = this;\r\n\r\n\t\tthis.setPageNum(enter);\r\n\t\tthis.getTableData(options.moduleConfig)\r\n\t\t\t.then(function(){_this.setSureStatus();});\r\n\t\t\r\n\t\t$(\".can-select\").removeClass(\"u-selected\");\r\n\t\t$(\".u-refresh\").addClass(\"u-selected\");\r\n\t},\r\n\t// 初始化表格数据\r\n\tinitData: function() {\r\n\t\tvar _this = this;\r\n\t\t// 这个请求需要做成异步\r\n\t\tsecurity.getSysModuleConfig(\"PCS\",\"QUEUING_MULTIPLE_INDICATION\") // QUEUING_MULTIPLE_INDICATION || DOUBLE_ONLINE_INDICATION\r\n\t\t\t.done(function(response) {\r\n\r\n\t\t\t\tutil.proConfig(response,function(moduleConfig){\r\n\t\t\t\t\toptions.moduleConfig = moduleConfig;\r\n\t\t\t\t\t_this.setPageAndRender(0);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t},\r\n\tgetTableData: function(params) {\r\n\t\tvar _this = this;\r\n\t\t// 这里需要区分历史与当前列队\r\n\t\tvar url = this.config.pageNum >= 0\r\n\t\t\t? this.config.urlDetail \r\n\t\t\t: this.config.urlHistory;\r\n\r\n\t\tvar ext = {\r\n\t\t\tpageNum: this.config.pageNum,// 当前页码\r\n\t\t\tgetNum: this.config.getNum,// 每页数量\r\n\t\t\tsiteCode: this.config.siteCode,// 站点信息\r\n\t\t\t// apiOperUser: \"aaa\"\r\n\t\t\t// 新增参数\r\n\t\t\tstNum: 2,// 新增参数 初始位置\r\n\t\t\tnum: options.moduleConfig.rowNum// 新增参数 列队最大数量\r\n    \t};\r\n\r\n\t\tparams = $.extend(params, ext);\r\n\r\n    \treturn util.service(url, params, \"正在加载中\")\r\n    \t\t.done(function(response){_this.ajaxSucc(response);});\r\n\t},\r\n\tsetTotalAndHis: function(data) {\r\n\t\tvar dln = data.dln;\r\n\t\tvar lsn = data.lsn;\r\n\t\tvar flag = $.isNumeric(dln);\r\n\r\n\t\tif (flag) {\r\n\t\t\tif (dln > 0) {\r\n\t\t\t\tdln--;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$(\".u-queue-total\").html(dln);\r\n\t\t$(\".u-queue-history\").html(-lsn);\r\n\t},\r\n\tajaxSucc: function(response) {\r\n\t\tvar _this = this;\r\n\r\n\t\tkit.triggerSuccessEvun({\r\n\t\t\tresponse: response,\r\n\t\t\t// 请求返回码正常\r\n\t\t\thaveData: function(data) {\r\n\t\t\t\t// 由于接口列队与历史字段名不一致，消歧\r\n\t\t\t\tvar dataArray = data.productionQueues || data[productionQueues];\r\n\r\n\t\t\t\tif (dataArray.length !== 0) {\r\n\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t// 生产管理号不一样，消歧。productId历史数据productionSeqNum\r\n\t\t\t\t\tdataArray = dataArray.map(function(value) {\r\n\t\t\t\t\t\tvalue.productId = value.productId || value[productId];\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// 渲染页码\r\n\t\t\t\t\t_this.setTotalAndHis(data);\r\n\r\n\t\t\t\t\t// 构造模板数据源\r\n\t\t\t\t\tcontainer.item = dataArray;\r\n\t\t\t\t\tcontainer.canCheckFlag = _this.config.pageNum === 0 ? true : false;\r\n\r\n\t\t\t\t\tutil.tplManager(\"queuingMultipleTpl\", container, \"m-product-tobdy\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_this.setTotalAndHis(data);\r\n\t\t\t\t\t$(\".m-product-table tbody\").html(\"<tr><td colspan='4'>暂无数据</td></tr>\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 请求返回码不正常\r\n\t\t\tnoData: function() {\r\n\t\t\t\tnotie.alert({type: \"1\",text: \"请求错误 \" + response.errorMessage});\r\n\r\n      \t\t\t// _this.render(_this.data);// 正常渲染无数据\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n};\r\n\r\nmodule.exports = queuingMultipleIndicationCtrl;\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/pcs/queuingMultipleIndication.js"],"sourceRoot":""}