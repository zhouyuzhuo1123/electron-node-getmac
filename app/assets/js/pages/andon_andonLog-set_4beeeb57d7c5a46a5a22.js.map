{"version":3,"sources":["webpack:///assets/js/pages/andon_andonLog-set_4beeeb57d7c5a46a5a22.js","webpack:///./src/js/pages/andon/andonLog.js","webpack:///./src/js/pages/andon/andonLog-set.js"],"names":["webpackJsonp","614","module","exports","__webpack_require__","$","i18next","security","util","andonLogCtrl","page","undefined","datatableApi","queryParam","serviceCode","workCenterCode","stationCode","typeCode","statusECode","minSwitchOnDateTime","maxSwitchOnDateTime","init","document","off","setBreadcrumb","t","this","loadPage","translate","event","on","e","Sweet","rightPanelView","router","myApp","openPanel","_this","scrollY","height","dataTable","ordering","order","ajax","param","columns","data","render","type","row","meta","name","width","statusText","bgColor","time","Math","abs","switchOffDateTime","getServerDateTime","switchOnDateTime","value","theTime","parseInt","theTimeMinute","theTimeHour","hour","minute","second","getzf","num","tmpDate","Date","year","getFullYear","mathon","getMonth","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","reloadDatatableByParam","extend","reload","call","619","app","andonLogSetCtrl","retrunBtn","searchBtn","initWorkCenterData","renderTimePicker","renderAndonStatus","initStationSlect","renderAndonType","top","window","innerHeight","css","closePanel","formData","formToJSON","searchParam","console","log","join","SwitchOnDateTime","split","minSwitchOffDateTime","SwitchOffDateTime","maxSwitchOffDateTime","service","response","renderData","allWorkCenterList","tplManager","dropkick","change","val","reInitStationSlect","datetimeRender","checkboxRender","stationListData","stationList","empty","html","renderAndonTypeByArray","length","i","typeText","substring","groupNum","allTypeGroup","temp","showLabel","datalength","TypeGroup","splice","push","done"],"mappings":"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","file":"assets/js/pages/andon_andonLog-set_4beeeb57d7c5a46a5a22.js","sourcesContent":["webpackJsonp([10,36],{\n\n/***/ 614:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, i18next) {\n\nvar security = __webpack_require__(35);\nvar util = __webpack_require__(34);\n\nvar andonLogCtrl = {\n    page: undefined,\n    datatableApi: undefined,\n    queryParam: {\n        serviceCode: \"GMES-CLIENT-ANDON005\",\n        workCenterCode: \"\",\n        stationCode: \"\",\n        typeCode: \"\",\n        statusECode: \"\",\n        minSwitchOnDateTime: \"\",\n        maxSwitchOnDateTime: \"\"\n    },\n    init: function init() {\n        $(document).off(\"keydown\");\n        util.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONRUNLOG\")]);\n        this.loadPage();\n        util.translate('.page[data-page=\"andonLog\"]');\n        this.event();\n    },\n    event: function event() {\n        $(\".toggle-right-btn\").on(\"click\", function (e) {\n            Sweet.rightPanelView.router.loadPage('views/andon/andonLog-set.html');\n            myApp.openPanel('right');\n        });\n    },\n\n    loadPage: function loadPage() {\n        var _this = this;\n        var scrollY = this.page.height - 126;\n\n        this.datatableApi = util.dataTable($('.table-panel table', this.page), {\n            \"scrollY\": scrollY,\n            \"ordering\": false,\n            \"order\": [],\n            \"ajax\": {\n                serviceCode: \"GMES-CLIENT-ANDON005\",\n                param: function param() {\n                    return _this.queryParam;\n                }\n            },\n            \"columns\": [{\n                \"data\": \"id\",\n                \"render\": function render(data, type, row, meta) {\n                    return meta[\"settings\"][\"_iDisplayStart\"] + meta.row + 1;\n                }\n            }, {\n                \"data\": \"workCenterText\",\n                \"name\": \"workCenterText\"\n            }, {\n                \"data\": \"stationText\",\n                \"name\": \"stationText\"\n            }, {\n                \"data\": \"typeText\",\n                \"name\": \"typeText\"\n            }, {\n                \"name\": \"statusECode\",\n                \"width\": \"65px\",\n                \"render\": function render(data, type, row) {\n                    var statusText;\n                    var bgColor;\n                    switch (row.statusECode) {\n                        case \"1\":\n                            {\n                                statusText = i18next.t(\"ANDON.T.STATUS_TOUCH\");\n                                bgColor = \"#ef5362\";\n                                break;\n                            }\n                        case \"3\":\n                            {\n                                statusText = i18next.t(\"ANDON.T.STATUS_CLOSE\");\n                                bgColor = \"#ffce54\";\n                                break;\n                            }\n                        default:\n                            statusText = \"确认\";\n                            bgColor = \"#27c24c\";\n                    }\n                    return '<span style=\"padding:5px 15px;background:' + bgColor + ';border-radius:15px;\">' + statusText + '</span>';\n                }\n            }, {\n                \"name\": \"triggerTime\",\n                \"render\": function render(data, type, row) {\n                    var time = Math.abs((row.switchOffDateTime || security.getServerDateTime()) - row.switchOnDateTime) / 1000;\n                    return formatSeconds(time);\n\n                    function formatSeconds(value) {\n                        var theTime = parseInt(value);\n                        var theTimeMinute = 0;\n                        var theTimeHour = 0;\n                        if (theTime > 60) {\n                            theTimeMinute = parseInt(theTime / 60);\n                            theTime = parseInt(theTime % 60);\n                            if (theTimeMinute > 60) {\n                                theTimeHour = parseInt(theTimeMinute / 60);\n                                theTimeMinute = parseInt(theTimeMinute % 60);\n                            }\n                        }\n                        var result = i18next.t(\"COMMON.T.TIME\", {\n                            hour: parseInt(theTimeHour),\n                            minute: parseInt(theTimeMinute),\n                            second: parseInt(theTime)\n                        });\n                        return result;\n                    }\n                }\n            }, {\n                \"data\": \"switchOnDateTime\",\n                \"name\": \"switchOnDateTime\",\n                \"render\": function render(data, type, row) {\n                    return formatDate(data);\n\n                    function formatDate(time) {\n                        var tmpDate = new Date(time);\n                        var year = tmpDate.getFullYear();\n                        var mathon = tmpDate.getMonth() + 1;\n                        var day = tmpDate.getDate();\n                        var hours = tmpDate.getHours();\n                        var minutes = tmpDate.getMinutes();\n                        var seconds = tmpDate.getSeconds();\n                        return year + '-' + getzf(mathon) + '-' + getzf(day) + ' ' + getzf(hours) + ':' + getzf(minutes) + ':' + getzf(seconds);\n\n                        function getzf(num) {\n                            if (parseInt(num) < 10) {\n                                num = '0' + num;\n                            }\n                            return num;\n                        }\n                    }\n                }\n            }, {\n                \"data\": \"switchOnUser\",\n                \"name\": \"switchOnUser\"\n            }, {\n                \"data\": \"memo\",\n                \"name\": \"memo\"\n            }]\n        });\n    },\n\n    reloadDatatableByParam: function reloadDatatableByParam(param) {\n        this.queryParam = $.extend({}, this.queryParam, param);\n        this.datatableApi.ajax.reload();\n    }\n};\n\nmodule.exports = andonLogCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(37)))\n\n/***/ }),\n\n/***/ 619:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, app) {\n\nvar util = __webpack_require__(34);\nvar andonLogCtrl = __webpack_require__(614);\n\nvar andonLogSetCtrl = {\n    init: function init() {\n        $(document).off(\"keydown\");\n\n        this.event();\n        this.retrunBtn();\n        this.searchBtn();\n        this.initWorkCenterData();\n        this.renderTimePicker();\n        this.renderAndonStatus();\n\n        this.initStationSlect();\n        this.renderAndonType();\n        util.translate('.page[data-page=\"andonLogSet\"]');\n    },\n    event: function event() {\n        var top = (window.innerHeight - 50 - 70) / 2 + 50 + \"px\";\n        $(\".toggle-right-btn\", this.page).css(\"top\", top).on(\"click\", function (e) {\n            myApp.closePanel('right');\n        });\n    },\n\n    retrunBtn: function retrunBtn() {\n        $(\".btn-return\", this.page).on('click', function () {\n            myApp.closePanel('right');\n        });\n    },\n\n    searchBtn: function searchBtn() {\n        $(\"[name='btnSearch']\", this.page).on('click', function () {\n            var formData = myApp.formToJSON('#andonSetForm');\n            var searchParam = {};\n            console.log(formData);\n            searchParam.workCenterCode = formData.workCenterCode;\n            searchParam.stationCode = formData.stationCode;\n            if (formData.typeCode) {\n                searchParam.typeCode = formData.typeCode.join(\",\");\n            }\n            searchParam.statusECode = formData.statusECode.join(\",\");\n\n            searchParam.minSwitchOnDateTime = formData.SwitchOnDateTime.split(\" - \")[0];\n            searchParam.maxSwitchOnDateTime = formData.SwitchOnDateTime.split(\" - \")[1];\n            searchParam.minSwitchOffDateTime = formData.SwitchOffDateTime.split(\" - \")[0];\n            searchParam.maxSwitchOffDateTime = formData.SwitchOffDateTime.split(\" - \")[1];\n            myApp.closePanel('right');\n            andonLogCtrl.reloadDatatableByParam(searchParam);\n        });\n    },\n\n    initWorkCenterData: function initWorkCenterData() {\n        var _this = this;\n        util.service('GMES-CLIENT-ANDON002', {}, null, function (response) {\n            var renderData = { allWorkCenterList: response.data };\n            util.tplManager(\"allWorkCenterListTpl\", renderData, \"allWorkCenterListRender\");\n            $(\"#allWorkCenterListRender\", _this.page).dropkick({\n                change: function change() {\n                    var value = $(\"#allWorkCenterListRender option:selected\", _this.page).val();\n                    _this.reInitStationSlect(value);\n                }\n            });\n        });\n    },\n\n    renderTimePicker: function renderTimePicker() {\n        app.datetimeRender(\"input.datetime\", this.page);\n    },\n\n    renderAndonStatus: function renderAndonStatus() {\n        app.checkboxRender(\"input[name='statusECode']\", this.page);\n    },\n\n    initStationSlect: function initStationSlect() {\n        $(\"#stationListRender\", this.page).dropkick({\n            change: function change() {}\n        });\n    },\n\n    reInitStationSlect: function reInitStationSlect(workCenterCode) {\n        var _this = this;\n        util.service('GMES-CLIENT-ANDON003', {\n            workCenterCode: workCenterCode\n        }, null, function (response) {\n            var stationListData = response.data;\n            var renderData = { stationList: stationListData };\n            $(\"#stationListContainer\", _this.page).empty();\n            $(\"#stationListContainer\", _this.page).html('<select class=\"form-select-control\" id=\"stationListRender\" name=\"stationCode\"><option value=\"\"></option></select>');\n            util.tplManager(\"stationListTpl\", renderData, \"stationListRender\");\n            $(\"#stationListRender\", _this.page).dropkick({\n                change: function change() {\n                    var value = $(\"#stationListRender option:selected\", _this.page).val();\n                    _this.renderAndonType(value);\n                }\n            });\n        });\n    },\n\n    renderAndonType: function renderAndonType(stationCode) {\n        var _this = this;\n        util.service('GMES-CLIENT-ANDON004', {}, null).done(function (response) {\n            var andonTypeArray = response.data;\n            renderAndonTypeByArray(andonTypeArray);\n        });\n\n        function renderAndonTypeByArray(data) {\n            $(\"#andonTypeRender\").empty();\n\n            var length = data.length;\n            for (var i = 0; i < length; i++) {\n                data[i].typeText = data[i].typeText.substring(0, 2);\n            }\n            var groupNum = 0;\n            var allTypeGroup = [];\n            do {\n                var temp = {};\n                if (groupNum == 0) {\n                    temp.showLabel = true;\n                }\n                var datalength = data.length;\n                if (data.length > 3) {\n                    temp.TypeGroup = data.splice(0, 3);\n                } else {\n                    temp.TypeGroup = data.splice(0, datalength);\n                }\n                groupNum++;\n                allTypeGroup.push(temp);\n            } while (data.length > 0);\n            var renderData = {\n                allTypeGroup: allTypeGroup\n            };\n\n            util.tplManager(\"andonTypeTpl\", renderData, \"andonTypeRender\");\n\n            app.checkboxRender(\"input[name='typeCode']\", _this.page);\n        }\n    }\n};\n\nmodule.exports = andonLogSetCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(77)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/andon_andonLog-set_4beeeb57d7c5a46a5a22.js","// andon台账\r\nvar security = require(\"security\");\r\nvar util = require('util');\r\n\r\nvar andonLogCtrl = {\r\n\tpage : undefined,\r\n    datatableApi : undefined,\r\n    queryParam : {\r\n        serviceCode : \"GMES-CLIENT-ANDON005\",\r\n        workCenterCode : \"\",\r\n        stationCode : \"\",\r\n        typeCode : \"\",\r\n        statusECode : \"\",\r\n        minSwitchOnDateTime : \"\",\r\n        maxSwitchOnDateTime : \"\"\r\n    },\r\n\tinit: function() {\r\n        $(document).off(\"keydown\");\r\n\t\tutil.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONRUNLOG\")]);\r\n\t\tthis.loadPage();\r\n        util.translate('.page[data-page=\"andonLog\"]');\r\n\t\tthis.event();\r\n\t},\r\n\tevent: function(){\r\n        // 点击右侧按钮可弹出右侧查询栏\r\n\t\t$(\".toggle-right-btn\").on(\"click\",function(e){\r\n\t\t\tSweet.rightPanelView.router.loadPage('views/andon/andonLog-set.html');\r\n\t\t\tmyApp.openPanel('right');\r\n\t\t})\r\n\t},\r\n    // 默认加载图表\r\n\tloadPage : function(){\r\n        var _this = this;\r\n        var scrollY = (this.page.height-126);\r\n//      require(\"widget\");\r\n//      require(\"recordTable\");\r\n        // 调用封装好的dataTable实例化方法\r\n        this.datatableApi = util.dataTable($('.table-panel table',this.page),{\r\n//       $('.table-panel table',this.page).recordTable({\r\n            \"scrollY\": scrollY,\r\n            \"ordering\": false,\r\n            \"order\" : [],\r\n            \"ajax\" : {\r\n                serviceCode : \"GMES-CLIENT-ANDON005\",\r\n                param : function(){\r\n                    return  _this.queryParam;\r\n                }\r\n            },\r\n            \"columns\": [\r\n                {\r\n                    \"data\": \"id\",\r\n                    \"render\": function ( data, type, row,meta  ) {\r\n                        return meta[\"settings\"][\"_iDisplayStart\"] + meta.row+1\r\n                    }\r\n                },\r\n                {\r\n                    \"data\": \"workCenterText\",\r\n                    \"name\": \"workCenterText\"\r\n                },\r\n                {\r\n                    \"data\": \"stationText\",\r\n                    \"name\": \"stationText\"\r\n                },\r\n                {\r\n                    \"data\": \"typeText\",\r\n                    \"name\": \"typeText\"\r\n                },\r\n                {\r\n                    \"name\": \"statusECode\",\r\n                    \"width\" : \"65px\",\r\n                    \"render\": function ( data, type, row ) {\r\n                        var statusText;\r\n                        var bgColor;\r\n                        switch(row.statusECode){\r\n                            case \"1\":{\r\n                                statusText = i18next.t(\"ANDON.T.STATUS_TOUCH\");\r\n                                bgColor = \"#ef5362\";\r\n                                break;\r\n                            }\r\n                            case \"3\":{\r\n                                statusText = i18next.t(\"ANDON.T.STATUS_CLOSE\");\r\n                                bgColor = \"#ffce54\";\r\n                                break;\r\n                            }\r\n                            default:\r\n                                statusText = \"确认\";\r\n                                bgColor = \"#27c24c\";\r\n                        }\r\n                        return  '<span style=\"padding:5px 15px;background:' + bgColor + ';border-radius:15px;\">' + statusText + '</span>';\r\n                    }\r\n                },\r\n                {\r\n                    \"name\": \"triggerTime\",\r\n                    \"render\": function ( data, type, row ) {\r\n                        var time = Math.abs((row.switchOffDateTime || security.getServerDateTime()) - row.switchOnDateTime)/1000;\r\n                        return formatSeconds(time);\r\n                        //将秒数换成时分秒格式\r\n                        function formatSeconds(value) {\r\n                            var theTime = parseInt(value);// 秒\r\n                            var theTimeMinute = 0;// 分\r\n                            var theTimeHour = 0;// 小时\r\n                            if(theTime > 60) {\r\n                                theTimeMinute = parseInt(theTime/60);\r\n                                theTime = parseInt(theTime%60);\r\n                                if(theTimeMinute > 60) {\r\n                                    theTimeHour = parseInt(theTimeMinute/60);\r\n                                    theTimeMinute = parseInt(theTimeMinute%60);\r\n                                }\r\n                            }\r\n                            var result = i18next.t(\"COMMON.T.TIME\",{\r\n                                hour : parseInt(theTimeHour),\r\n                                minute : parseInt(theTimeMinute),\r\n                                second : parseInt(theTime)\r\n                            })\r\n                            return result;\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    \"data\": \"switchOnDateTime\",\r\n                    \"name\": \"switchOnDateTime\",\r\n                    \"render\": function ( data, type, row ) {\r\n                        return formatDate(data);\r\n                        //将秒数换成日期格式 YY-MM-DD hh:mm:ss\r\n                        function formatDate(time) {\r\n                            var tmpDate=new Date(time);\r\n                            var year = tmpDate.getFullYear();\r\n                            var mathon = tmpDate.getMonth() + 1;\r\n                            var day = tmpDate.getDate();\r\n                            var hours = tmpDate.getHours();\r\n                            var minutes = tmpDate.getMinutes();\r\n                            var seconds = tmpDate.getSeconds();\r\n                            return year + '-' + getzf(mathon) + '-' + getzf(day) + ' ' + getzf(hours) + ':' + getzf(minutes) + ':' +getzf(seconds);\r\n                            //补0操作\r\n                            function getzf(num){\r\n                                if(parseInt(num) < 10){\r\n                                    num = '0'+num;\r\n                                }\r\n                                return num;\r\n                            }\r\n                        }\r\n                    },\r\n                },\r\n                {\r\n                    \"data\": \"switchOnUser\",\r\n                    \"name\": \"switchOnUser\"\r\n                },\r\n                {\r\n                    \"data\": \"memo\",\r\n                    \"name\": \"memo\"\r\n                }\r\n            ]\r\n        })\r\n\t},\r\n    // 根据查询栏输入的查询参数重新加载图表\r\n    reloadDatatableByParam: function(param) {\r\n        this.queryParam = $.extend({},this.queryParam,param);\r\n        this.datatableApi.ajax.reload();\r\n    }\r\n};\r\n\r\nmodule.exports = andonLogCtrl\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/andon/andonLog.js","// andon台账查询\r\nvar util = require('util');\r\nvar andonLogCtrl = require('./andonLog');\r\n\r\nvar andonLogSetCtrl = {\r\n    // 初始化\r\n\tinit: function(){\r\n        $(document).off(\"keydown\");\r\n        \r\n        this.event();\r\n\t\tthis.retrunBtn();   //返回按钮\r\n        this.searchBtn();   //查询按钮\r\n        this.initWorkCenterData();  //渲染工作中心选择下拉框\r\n        this.renderTimePicker();  //渲染时间选择按钮输入框\r\n        this.renderAndonStatus();   //渲染andon状态多选按钮\r\n\r\n        this.initStationSlect();    //渲染站点选择下拉框--初始化时，渲染空的下拉框\r\n        this.renderAndonType();     //渲染andon类型多选按钮--初始化时，查询渲染所有\r\n        util.translate('.page[data-page=\"andonLogSet\"]');\r\n\t},\r\n    event: function () {\r\n        var top = ((window.innerHeight - 50 -70 )/2 + 50) + \"px\";\r\n        $(\".toggle-right-btn\",this.page).css(\"top\",top).on(\"click\",function(e){\r\n            myApp.closePanel('right');\r\n        });\r\n    },\r\n    //返回按钮\r\n\tretrunBtn: function(){\r\n        // 点击返回按钮，因此侧边栏\r\n\t\t$(\".btn-return\",this.page).on('click',function(){\r\n\t\t\tmyApp.closePanel('right');\r\n\t\t});\r\n\t},\r\n    //查询按钮\r\n    searchBtn: function(){\r\n        // 点击查询按钮，取得表单的输入值，然后调用andon台账重新渲染的方法\r\n        $(\"[name='btnSearch']\",this.page).on('click',function(){\r\n            var formData = myApp.formToJSON('#andonSetForm');\r\n            var searchParam = {};\r\n            console.log(formData)\r\n            searchParam.workCenterCode = formData.workCenterCode;\r\n            searchParam.stationCode = formData.stationCode;\r\n            if(formData.typeCode){\r\n                searchParam.typeCode = formData.typeCode.join(\",\");\r\n            } \r\n            searchParam.statusECode = formData.statusECode.join(\",\");\r\n            //searchParam.workCenterCode = \"\";\r\n            //searchParam.stationCode = \"\";\r\n            //searchParam.typeText = \"\";\r\n            //searchParam.statusECode = \"\";\r\n            searchParam.minSwitchOnDateTime = formData.SwitchOnDateTime.split(\" - \")[0];\r\n            searchParam.maxSwitchOnDateTime = formData.SwitchOnDateTime.split(\" - \")[1];\r\n            searchParam.minSwitchOffDateTime = formData.SwitchOffDateTime.split(\" - \")[0];\r\n            searchParam.maxSwitchOffDateTime = formData.SwitchOffDateTime.split(\" - \")[1];\r\n            myApp.closePanel('right');\r\n            andonLogCtrl.reloadDatatableByParam(searchParam);\r\n        });\r\n    },\r\n    //渲染工作中心选择下拉框\r\n    initWorkCenterData: function(){\r\n        var _this = this;\r\n        util.service('GMES-CLIENT-ANDON002',{\r\n            },null,function(response){\r\n                var renderData = { allWorkCenterList : response.data };\r\n                util.tplManager(\"allWorkCenterListTpl\", renderData, \"allWorkCenterListRender\");\r\n                $(\"#allWorkCenterListRender\",_this.page).dropkick({\r\n                    // 根据新选择的工作中心，查询站点\r\n                    change : function () {\r\n                        var value = $(\"#allWorkCenterListRender option:selected\",_this.page).val();\r\n                        _this.reInitStationSlect(value);\r\n                    }\r\n                });\r\n            });\r\n    },\r\n    //渲染时间选择按钮输入框\r\n    renderTimePicker: function(){\r\n        app.datetimeRender(\"input.datetime\",this.page);\r\n    },\r\n    // 渲染andon状态多选按钮\r\n    renderAndonStatus: function () {\r\n        app.checkboxRender(\"input[name='statusECode']\",this.page);\r\n    },\r\n    //渲染站点选择下拉框--初始化时，渲染空的下拉框\r\n    initStationSlect: function () {\r\n        $(\"#stationListRender\",this.page).dropkick({\r\n            change : function () {}\r\n        });\r\n    },\r\n    //重新渲染站点选择下拉框--根据工作中心查询\r\n    reInitStationSlect: function (workCenterCode) {\r\n        var _this = this;\r\n        util.service('GMES-CLIENT-ANDON003',{\r\n                workCenterCode: workCenterCode\r\n            },null,function(response){\r\n                var stationListData = response.data;\r\n                var renderData = { stationList : stationListData };\r\n                $(\"#stationListContainer\",_this.page).empty();\r\n                $(\"#stationListContainer\",_this.page).html('<select class=\"form-select-control\" id=\"stationListRender\" name=\"stationCode\"><option value=\"\"></option></select>');\r\n                util.tplManager(\"stationListTpl\", renderData, \"stationListRender\");\r\n                $(\"#stationListRender\",_this.page).dropkick({\r\n                    change : function () {\r\n                        var value = $(\"#stationListRender option:selected\",_this.page).val();\r\n                        _this.renderAndonType(value);\r\n                    }\r\n                });\r\n            });\r\n    },\r\n    // 渲染andon类型多选按钮--初始化时无stationCode，查询渲染所有，后根据选择的站点查询然后渲染\r\n    renderAndonType: function (stationCode) {\r\n        var _this = this;\r\n        util.service('GMES-CLIENT-ANDON004',{\r\n            },null).done(function(response){\r\n                var andonTypeArray = response.data;\r\n                renderAndonTypeByArray(andonTypeArray);\r\n            });\r\n        // 将andon类型3个分组，第一组有label标签，然后渲染\r\n        function renderAndonTypeByArray(data){\r\n            $(\"#andonTypeRender\").empty();\r\n            // 将andon类型数组处理成渲染模板需要的格式\r\n            var length = data.length;\r\n            for(var i = 0; i<length; i++){\r\n                data[i].typeText = data[i].typeText.substring(0,2);\r\n            }\r\n            var groupNum = 0;\r\n            var allTypeGroup = [];\r\n            do{\r\n                var temp = {};\r\n                if(groupNum == 0){\r\n                    temp.showLabel = true;\r\n                }\r\n                var datalength = data.length;\r\n                if(data.length > 3){\r\n                    temp.TypeGroup = data.splice(0,3);\r\n                }else{\r\n                    temp.TypeGroup = data.splice(0,datalength);\r\n                }\r\n                groupNum++;\r\n                allTypeGroup.push(temp);\r\n            }while(data.length > 0)\r\n            var renderData = {\r\n                allTypeGroup :allTypeGroup\r\n            };\r\n\r\n            util.tplManager(\"andonTypeTpl\", renderData, \"andonTypeRender\");\r\n\r\n            app.checkboxRender(\"input[name='typeCode']\",_this.page);\r\n        }\r\n    }\r\n};\r\n\r\nmodule.exports = andonLogSetCtrl\r\n/*myApp.onPageInit('andonLogSet', function (page) {\r\n    $(document).off(\"keydown\");\r\n\tandonLogSetView.init($(page.container));\r\n    util.translate('.page[data-page=\"andonLogSet\"]');\r\n});*/\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/andon/andonLog-set.js"],"sourceRoot":""}