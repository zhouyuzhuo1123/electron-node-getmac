{"version":3,"sources":["webpack:///assets/js/pages/andon_andonTypeDrawstring_52176b631c0221651749.js","webpack:///./src/js/pages/andon/andonTypeDrawstring.js"],"names":["webpackJsonp","623","module","exports","__webpack_require__","i18next","$","moment","security","timerManager","mqttLib","util","andonTypeDrawstringViewCtrl","STATE_TOUCH","STATE_NORMAL","page","station","undefined","init","_this","this","isUniqueOperableStation","setBreadcrumb","t","stationText","translate","loadPage","subscribeMessageTopic","topic","getSiteCode","stationCode","subscribe","registerMessageHandler","message","messageDetail","payloadString","parseJSON","andonTypeStatusSync","messageContent","event","on","e","$el","target","attr","parents","statusECode","andonTypeCode","showNotify","type","content","service","done","response","$andonItem","hasClass","find","length","andonType","each","index","item","removeClass","addClass","register","group","name","intervalTime","fun","andonStatusDisplay","replace","data","andonTypes","_","split","push","lastTriggerTime","accumulatedTime","touchColor","normalColor","groupAndons","tplManager","array","groupLength","newArray","slice","currentStatus","isDrawstringAndon","isTouched","andonText","parent","text","parseInt","typeText","$andons","$triggerAndons","$drawStringAndon","unTriggered","drawstringTriggered","allTriggered","date","getServerDateTime","diffValue","diff","css","calTimeForDrawstringAndon","calTime","warningDisplay","timeLong","minutes","Math","floor","minute","leave3","seconds","round","second","hour","leave","call"],"mappings":"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","file":"assets/js/pages/andon_andonTypeDrawstring_52176b631c0221651749.js","sourcesContent":["webpackJsonp([33],{\n\n/***/ 623:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(i18next, $, moment) {\n\nvar security = __webpack_require__(35);\nvar timerManager = __webpack_require__(80);\nvar mqttLib = __webpack_require__(53);\nvar util = __webpack_require__(34);\n\nvar andonTypeDrawstringViewCtrl = {\n\tSTATE_TOUCH: 1,\n\tSTATE_NORMAL: 3,\n\tpage: null,\n\tstation: undefined,\n\tinit: function init() {\n\n\t\tvar _this = this;\n\t\tsecurity.isUniqueOperableStation(function (station) {\n\t\t\tutil.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONCONTROL\") + \"/\" + station.stationText]);\n\t\t\tutil.translate('.page[data-page=\"andonTypeDrawstringPage\"]');\n\n\t\t\t_this.station = station;\n\t\t\t_this.loadPage(station);\n\t\t});\n\t},\n\tsubscribeMessageTopic: function subscribeMessageTopic(station) {\n\t\tvar _this = this;\n\t\tvar topic = \"business/andon/statusChange/\" + security.getSiteCode() + \"/\" + station.stationCode;\n\t\tmqttLib.subscribe(topic, \"andonTypeDrawstring\");\n\t\tmqttLib.registerMessageHandler(topic, \"andonStatusChangeMessageHandler\", function (message) {\n\t\t\tvar messageDetail = message.payloadString ? $.parseJSON(message.payloadString) : {};\n\t\t\t_this.andonTypeStatusSync(messageDetail.messageContent);\n\t\t});\n\t},\n\tevent: function event() {\n\t\tvar _this = this;\n\n\t\t$(\"a[name='andon-drawstring-button']\").on(\"click\", function (e) {\n\t\t\tvar $el = $(e.target).attr(\"type\") == \"andon\" ? $(e.target) : $(e.target).parents(\"a[type='andon']\");;\n\t\t\tvar statusECode = $el.attr(\"statusECode\");\n\t\t\tvar andonTypeCode = $el.attr(\"andonTypeCode\");\n\n\t\t\tutil.showNotify({\n\t\t\t\ttype: \"success\",\n\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_OPER_SYCN_TO_MI\")\n\t\t\t});\n\t\t\tutil.service('GMES-CLIENT-ANDON013', {\n\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\tandonTypeCode: andonTypeCode,\n\t\t\t\tstatusECode: statusECode\n\t\t\t}, null).done(function (response) {\n\t\t\t\tutil.showNotify({\n\t\t\t\t\ttype: \"success\",\n\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_WAIT_OPER_SYCN_RESULT\")\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$(\"a[type='andon'][name!='andon-drawstring-button']\", this.page).on(\"click\", function (e) {\n\t\t\tvar $andonItem = $(e.target).attr(\"type\") == \"andon\" ? $(e.target) : $(e.target).parents(\"a[type='andon']\");\n\t\t\tif ($andonItem.hasClass(\"andon-status-disabled\")) {\n\t\t\t\tvar touched = $(_this.page).find(\"div.page-content\").hasClass(\"andon-bg-blink\") ? $(_this.page).find(\"a[type='andon'][statusECode='1']\").length > 0 ? true : false : false;\n\t\t\t\tvar message = i18next.t(\"ANDON.T.MSG_DRAWSTRING_UNTRIGGER\");\n\t\t\t\tif ($(_this.page).find(\"a[type='andon'][statusECode='1']\").length > 0) {\n\t\t\t\t\tmessage = i18next.t(\"ANDON.T.MSG_ANDON_TRIGGERED\", {\n\t\t\t\t\t\tandonType: $($(_this.page).find(\"a[type='andon'][statusECode='1']\")[0]).attr(\"typeText\")\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tutil.showNotify({\n\t\t\t\t\ttype: \"error\",\n\t\t\t\t\tcontent: message\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar statusECode = $andonItem.attr(\"statusECode\");\n\t\t\tvar andonTypeCode = $andonItem.attr(\"andonTypeCode\");\n\t\t\tutil.showNotify({\n\t\t\t\ttype: \"success\",\n\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_OPER_SYCN_TO_MI\")\n\t\t\t});\n\n\t\t\tutil.service('GMES-CLIENT-ANDON013', {\n\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\tandonTypeCode: andonTypeCode,\n\t\t\t\tstatusECode: statusECode\n\t\t\t}, null).done(function (response) {\n\t\t\t\tutil.showNotify({\n\t\t\t\t\ttype: \"success\",\n\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_WAIT_OPER_SYCN_RESULT\")\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$(\"button.simple\", this.page).on('click', function (e) {\n\t\t\t$.each($(\"a[type='andon']\", _this.page), function (index, item) {\n\t\t\t\tvar $parent = $($(item).parents(\".andon-drawstring-item-detail\")[0]);\n\t\t\t\t$parent.removeClass(\"andon-drawstring-item-detail\").addClass(\"andon-drawstring-item-simple\");\n\t\t\t});\n\t\t\t$(\"button.simple\", _this.page).addClass(\"active\");\n\t\t\t$(\"button.detail\", _this.page).removeClass(\"active\");\n\t\t});\n\n\t\t$(\"button.detail\", this.page).on('click', function (e) {\n\t\t\t$.each($(\"a[type='andon']\", _this.page), function (index, item) {\n\t\t\t\tvar $parent = $($(item).parents(\".andon-drawstring-item-simple\")[0]);\n\t\t\t\t$parent.removeClass(\"andon-drawstring-item-simple\").addClass(\"andon-drawstring-item-detail\");\n\t\t\t});\n\t\t\t$(\"button.detail\", _this.page).addClass(\"active\");\n\t\t\t$(\"button.simple\", _this.page).removeClass(\"active\");\n\t\t});\n\n\t\ttimerManager.register({\n\t\t\t\"group\": \"andonTypeDrawstring\",\n\t\t\t\"name\": \"andonTypeStatusSync\",\n\t\t\t\"intervalTime\": 1000,\n\t\t\t\"fun\": function fun() {\n\t\t\t\t_this.andonStatusDisplay();\n\t\t\t},\n\t\t\t\"replace\": true\n\t\t});\n\t},\n\n\tloadPage: function loadPage(station) {\n\t\tvar _this = this;\n\t\tutil.service('GMES-CLIENT-ANDON001', {\n\t\t\tstationCode: station.stationCode\n\t\t}, i18next.t(\"ANDON.T.MSG_ANDON_LOADING\")).done(function (response) {\n\t\t\tvar data = response.data;\n\t\t\tvar andonTypes = [];\n\t\t\t$.each(data, function (_, item) {\n\n\t\t\t\tif (item[\"lastTriggerTime\"]) {\n\t\t\t\t\titem[\"lastTriggerTimePart\"] = item[\"lastTriggerTime\"].split(\" \")[1];\n\t\t\t\t}\n\t\t\t\tif (item.andonType.andonTypeCode != \"LSANDON\") {\n\t\t\t\t\tandonTypes.push(item);\n\t\t\t\t} else {\n\t\t\t\t\t$(\"a[name='andon-drawstring-button']\", _this.page).attr(\"statusECode\", item.lastTriggerTime ? _this.STATE_TOUCH : _this.STATE_NORMAL).attr(\"switchOnDateTime\", item.lastTriggerTime).attr(\"accumulatedTime\", item.accumulatedTime).attr(\"touchColor\", item.andonType.touchColor).attr(\"normalColor\", item.andonType.normalColor);\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar groupAndons = _this.group(andonTypes, 6);\n\t\t\tutil.tplManager(\"andonControlSwiperTpl\", groupAndons, \"andonControlSwiperRender\");\n\t\t\t_this.event();\n\t\t\t_this.andonStatusDisplay();\n\t\t\t_this.subscribeMessageTopic(station);\n\t\t});\n\t},\n\n\tgroup: function group(array, groupLength) {\n\t\tvar index = 0;\n\t\tvar newArray = { \"groupAndons\": [] };\n\t\twhile (index < array.length) {\n\t\t\tnewArray.groupAndons.push(array.slice(index, index += groupLength));\n\t\t}\n\t\treturn newArray;\n\t},\n\tandonTypeStatusSync: function andonTypeStatusSync(messageContent) {\n\t\tvar _this = this;\n\n\t\tvar item = messageContent,\n\t\t    $andonItem = undefined;\n\t\tvar currentStatus = item.lastTriggerTime ? _this.STATE_TOUCH : _this.STATE_NORMAL;\n\t\tif (_this.isDrawstringAndon(item.andonType)) {\n\t\t\t$andonItem = $(\"a[andonTypeCode='LSANDON']\");\n\t\t\tif ($andonItem.attr(\"statusECode\") != currentStatus) {\n\t\t\t\tif (_this.isTouched(currentStatus)) {\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\", item[\"lastTriggerTime\"]);\n\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\", {\n\t\t\t\t\t\t\tandonText: i18next.t(\"ANDON.B.DRAWSTRING\")\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\", '');\n\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\", {\n\t\t\t\t\t\t\tandonText: i18next.t(\"ANDON.B.DRAWSTRING\")\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t$andonItem = $(\"a[type='andon'][andonTypeCode='\" + item.andonType.andonTypeCode + \"']\");\n\t\t\tif ($andonItem.attr(\"statusECode\") != currentStatus) {\n\t\t\t\tif (_this.isTouched(currentStatus)) {\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\", item[\"lastTriggerTime\"]);\n\t\t\t\t\t$andonItem.parents(\"div.andon-drawstring-item-button\").parent().find(\"dd[name='lastTriggerTimePart']\").text(item[\"lastTriggerTime\"].split(\" \")[1]);\n\t\t\t\t\t$andonItem.parents(\"div.andon-drawstring-item-button\").parent().find(\"dd[name='triggerCount']\").text(parseInt(item[\"triggerCount\"]));\n\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\", {\n\t\t\t\t\t\t\tandonText: item.andonType.typeText\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\", '');\n\t\t\t\t\t$andonItem.find(\".andon-drawstring-touch-time\").text('');\n\t\t\t\t\t$andonItem.parents(\"div.andon-drawstring-item-button\").parent().find(\"dd[name='lastTriggerTimePart']\").text(\"\");\n\n\t\t\t\t\tutil.showNotify({\n\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\", {\n\t\t\t\t\t\t\tandonText: item.andonType.typeText\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$andonItem.attr(\"statusECode\", currentStatus);\n\t\t_this.andonStatusDisplay();\n\t},\n\tisDrawstringAndon: function isDrawstringAndon(andonType) {\n\t\treturn \"LSANDON\" == andonType.andonTypeCode;\n\t},\n\tisTouched: function isTouched(statusECode) {\n\t\treturn statusECode == this.STATE_TOUCH;\n\t},\n\tandonStatusDisplay: function andonStatusDisplay() {\n\t\tvar _this = this;\n\t\tvar $andons = $(\"a[type='andon']\", this.page);\n\t\tvar $triggerAndons = $(\"a[type='andon'][statusECode='1'][andonTypeCode!='LSANDON']\", this.page);\n\t\tvar $drawStringAndon = $($(\"a[andonTypeCode='LSANDON']\", this.page)[0]);\n\t\tvar unTriggered = $triggerAndons.length == 0 && !this.isTouched($drawStringAndon.attr(\"statusECode\"));\n\t\tvar drawstringTriggered = $triggerAndons.length == 0 && this.isTouched($drawStringAndon.attr(\"statusECode\"));\n\t\tvar allTriggered = !unTriggered && !drawstringTriggered;\n\n\t\tif (unTriggered) {\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\n\t\t} else {\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\n\t\t}\n\n\t\t$.each($andons, function (_, item) {\n\t\t\tvar $el = $(item);\n\t\t\tvar isDrawstringAndon = $el.attr(\"andonTypeCode\") == \"LSANDON\";\n\t\t\tif (drawstringTriggered) {\n\t\t\t\t$el.addClass(\"andon-status-enable\").removeClass(\"andon-status-disabled\").removeClass(\"andon-status-touch\");\n\t\t\t} else if (unTriggered) {\n\t\t\t\tif (isDrawstringAndon) {\n\t\t\t\t\t$el.addClass(\"andon-status-enable\").removeClass(\"andon-status-touch\");\n\t\t\t\t} else {\n\t\t\t\t\t$el.addClass(\"andon-status-disabled\").removeClass(\"andon-status-enable\").removeClass(\"andon-status-touch\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (_this.isTouched($el.attr(\"statusECode\"))) {\n\t\t\t\t$el.addClass(\"andon-status-touch\").removeClass(\"andon-status-enable\").removeClass(\"andon-status-disabled\");\n\t\t\t\tvar date = moment(security.getServerDateTime());\n\n\t\t\t\tvar diffValue = date.diff($el.attr(\"switchOnDateTime\") || date);\n\t\t\t\tdiffValue = diffValue < 0 ? 0 : diffValue;\n\t\t\t\tif (diffValue <= 10000) {\n\t\t\t\t\t$el.css(\"background\", \"linear-gradient(to bottom, #f4b664, #e9822d)\");\n\t\t\t\t} else {\n\t\t\t\t\t$el.css(\"background\", $el.attr(\"touchColor\"));\n\t\t\t\t}\n\n\t\t\t\tif ($el.attr(\"name\") == 'andon-drawstring-button') {\n\t\t\t\t\t$el.find(\".andon-drawstring-touch-time\").text(_this.calTimeForDrawstringAndon(diffValue));\n\t\t\t\t} else {\n\t\t\t\t\t$el.find(\".andon-drawstring-touch-time\").text(_this.calTime(diffValue));\n\t\t\t\t}\n\n\t\t\t\t$el.parents(\".andon-drawstring-item-button\").parent().find(\"dd[name='accumulatedTime']\").text(_this.calTime(($el.attr(\"accumulatedTime\") || 0) * 1000 + diffValue));\n\t\t\t} else {\n\t\t\t\tif (allTriggered && !isDrawstringAndon) {\n\t\t\t\t\t$el.addClass(\"andon-status-disabled\").removeClass(\"andon-status-enable\").removeClass(\"andon-status-touch\");\n\t\t\t\t}\n\t\t\t\t$el.find(\".andon-drawstring-touch-time\").text(\"\");\n\t\t\t\t$el.css(\"background\", $el.attr(\"normalColor\"));\n\t\t\t\t$el.parents(\".andon-drawstring-item-button\").parent().find(\"dd[name='accumulatedTime']\").text(_this.calTime(($el.attr(\"accumulatedTime\") || 0) * 1000));\n\t\t\t}\n\t\t});\n\t},\n\n\twarningDisplay: function warningDisplay() {\n\t\tif ($(\"a[type='andon'][statusECode='1']\", this.page).length > 0 || $(\"a[andonTypeCode='LSANDON'][statusECode='1']\", this.page).length > 0) {\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\n\t\t} else {\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\n\t\t}\n\t},\n\tcalTime: function calTime(timeLong) {\n\t\tvar minutes = Math.floor(timeLong / (60 * 1000));\n\t\tif (minutes != 0) minutes = i18next.t(\"COMMON.T.MINUTE\", {\n\t\t\tminute: minutes\n\t\t});else minutes = \"\";\n\n\t\tvar leave3 = timeLong % (60 * 1000);\n\t\tvar seconds = Math.round(leave3 / 1000);\n\t\tif (seconds != 0) seconds = i18next.t(\"COMMON.T.SECOND\", {\n\t\t\tsecond: seconds\n\t\t});else seconds = \"\";\n\t\treturn minutes + seconds;\n\t},\n\tcalTimeForDrawstringAndon: function calTimeForDrawstringAndon(timeLong) {\n\t\tvar hour = Math.floor(timeLong / (60 * 60 * 1000));\n\t\thour = hour >= 10 ? hour : \"0\" + hour;\n\t\tvar leave = timeLong % (60 * 60 * 1000);\n\t\tvar minute = Math.floor(leave / (60 * 1000));\n\t\tminute = minute >= 10 ? minute : \"0\" + minute;\n\n\t\tleave = timeLong % (60 * 1000);\n\t\tvar second = Math.round(leave / 1000);\n\t\tsecond = second >= 10 ? second : \"0\" + second;\n\t\treturn hour + \":\" + minute + \":\" + second;\n\t}\n\n};\n\nmodule.exports = andonTypeDrawstringViewCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(37), __webpack_require__(4), __webpack_require__(30)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/andon_andonTypeDrawstring_52176b631c0221651749.js","/*\r\n * @name: js\\utils\\andonTypeDrawstring.js\r\n * @author: EVUN前端组\r\n * @modify: kelichao\r\n * @update: 2017-06-13\r\n * @decript: 拉绳安灯功能\r\n * @url: http://git.evun.cn/GMES/GMES_CLIENT_PAD\r\n */\r\n\r\nvar security = require(\"security\");\r\nvar timerManager = require(\"timerManager\");\r\nvar mqttLib = require(\"mqttLib\");\r\nvar util = require('util');\r\n\r\nvar andonTypeDrawstringViewCtrl = {\r\n\tSTATE_TOUCH : 1,\r\n\tSTATE_NORMAL : 3,\r\n\tpage : null,\r\n\tstation : undefined,\r\n\tinit: function() {\r\n\r\n\t\tvar _this = this;\r\n\t\tsecurity.isUniqueOperableStation(function(station){\r\n\t\t\tutil.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONCONTROL\")+\"/\"+station.stationText]);\r\n\t\t\tutil.translate('.page[data-page=\"andonTypeDrawstringPage\"]');\r\n\r\n\t\t\t_this.station = station;\r\n\t\t\t_this.loadPage(station);\r\n\t\t});\r\n\r\n\t},\r\n\tsubscribeMessageTopic : function(station){\r\n\t\tvar _this = this;\r\n\t\tvar topic = \"business/andon/statusChange/\"+security.getSiteCode()+\"/\"+station.stationCode;\r\n        mqttLib.subscribe(topic,\"andonTypeDrawstring\");\r\n        mqttLib.registerMessageHandler(topic,\"andonStatusChangeMessageHandler\",function(message){\r\n           var\tmessageDetail = message.payloadString ? $.parseJSON(message.payloadString) : {};\r\n           _this.andonTypeStatusSync(messageDetail.messageContent);\r\n        });\r\n\t},   \r\n\tevent : function(){\r\n\t\tvar _this = this;\r\n\r\n\t\t$(\"a[name='andon-drawstring-button']\").on(\"click\",function(e){\r\n\t\t\tvar $el =$(e.target).attr(\"type\") == \"andon\"? $(e.target) : $(e.target).parents(\"a[type='andon']\");;\r\n\t\t\tvar statusECode = $el.attr(\"statusECode\");\r\n\t\t\tvar andonTypeCode = $el.attr(\"andonTypeCode\");\r\n\r\n\t\t\tutil.showNotify({\r\n\t\t\t\ttype : \"success\",\r\n\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_OPER_SYCN_TO_MI\")\r\n\t\t\t})\r\n\t\t\tutil.service('GMES-CLIENT-ANDON013',{\r\n\t\t\t\t\tstationCode : _this.station.stationCode,\r\n\t\t\t\t\tandonTypeCode : andonTypeCode,\r\n\t\t\t\t\tstatusECode : statusECode\r\n\t\t\t\t},null).done(function(response){\r\n\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_WAIT_OPER_SYCN_RESULT\")\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t});\r\n\r\n\t\t$(\"a[type='andon'][name!='andon-drawstring-button']\",this.page).on(\"click\",function(e){\r\n\t\t\tvar $andonItem = $(e.target).attr(\"type\") == \"andon\"? $(e.target) : $(e.target).parents(\"a[type='andon']\");\r\n\t\t\tif($andonItem.hasClass(\"andon-status-disabled\")){\r\n\t\t\t\tvar touched = $(_this.page).find(\"div.page-content\").hasClass(\"andon-bg-blink\") ? ($(_this.page).find(\"a[type='andon'][statusECode='1']\").length > 0 ? true : false) :false;\r\n\t\t\t\tvar message =  i18next.t(\"ANDON.T.MSG_DRAWSTRING_UNTRIGGER\");\r\n\t\t\t\tif($(_this.page).find(\"a[type='andon'][statusECode='1']\").length > 0){\r\n\t\t\t\t\tmessage = i18next.t(\"ANDON.T.MSG_ANDON_TRIGGERED\",{\r\n\t\t\t\t\t\tandonType : $($(_this.page).find(\"a[type='andon'][statusECode='1']\")[0]).attr(\"typeText\")\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\ttype : \"error\",\r\n\t\t\t\t\t\tcontent : message\r\n\t\t\t\t\t})\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar statusECode = $andonItem.attr(\"statusECode\");\r\n\t\t\tvar andonTypeCode = $andonItem.attr(\"andonTypeCode\");\r\n\t\t\tutil.showNotify({\r\n\t\t\t\ttype : \"success\",\r\n\t\t\t\tcontent :i18next.t(\"ANDON.T.MSG_OPER_SYCN_TO_MI\")\r\n\t\t\t})\r\n\t\t\t//触发服务接口\r\n\t\t\tutil.service('GMES-CLIENT-ANDON013',{\r\n\t\t\t\t\tstationCode : _this.station.stationCode,\r\n\t\t\t\t\tandonTypeCode : andonTypeCode,\r\n\t\t\t\t\tstatusECode : statusECode\r\n\t\t\t\t},null).done(function(response){\r\n\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_WAIT_OPER_SYCN_RESULT\")\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\r\n\t\t});\r\n\r\n\t\t$(\"button.simple\",this.page).on('click',function(e){\r\n\t\t\t//简易模式\r\n\t\t\t$.each($(\"a[type='andon']\",_this.page),function(index,item){\r\n\t\t\t\tvar $parent = $($(item).parents(\".andon-drawstring-item-detail\")[0]);\r\n\t\t\t\t$parent.removeClass(\"andon-drawstring-item-detail\").addClass(\"andon-drawstring-item-simple\");\r\n\t\t\t});\r\n\t\t\t$(\"button.simple\",_this.page).addClass(\"active\");\r\n\t\t\t$(\"button.detail\",_this.page).removeClass(\"active\");\r\n\t\t});            \r\n\r\n\t\t$(\"button.detail\",this.page).on('click',function(e){\r\n\t\t\t//详情模式\r\n\t\t\t$.each($(\"a[type='andon']\",_this.page),function(index,item){\r\n\t\t\t\tvar $parent = $($(item).parents(\".andon-drawstring-item-simple\")[0]);\r\n\t\t\t\t$parent.removeClass(\"andon-drawstring-item-simple\").addClass(\"andon-drawstring-item-detail\");\r\n\t\t\t});\r\n\t\t\t$(\"button.detail\",_this.page).addClass(\"active\");\r\n\t\t\t$(\"button.simple\",_this.page).removeClass(\"active\");\r\n\t\t});\r\n\r\n\t\t\r\n\t\t\ttimerManager.register({\r\n\t\t\t\t\"group\" : \"andonTypeDrawstring\",\r\n\t\t\t\t\"name\" : \"andonTypeStatusSync\",\r\n\t\t\t\t\"intervalTime\" : 1000,\r\n\t\t\t\t\"fun\" : function(){\r\n\t\t\t\t\t_this.andonStatusDisplay();\r\n\t\t\t\t},\r\n\t\t\t\t\"replace\" : true\r\n\t\t\t})\r\n\t\r\n\r\n\r\n\t\t/*\r\n\t\tif(!this.andonStatusSyncTimer){\r\n\t\t\tthis.andonStatusSyncTimer = setInterval(function(){\r\n\t\t\t\t_this.syncAndonStatus();\r\n\t\t\t},1000);\r\n\t\t}\r\n\t\t*/\r\n\r\n\r\n\t},  \r\n\t/**\r\n\t * 加载页面\r\n\t **/\r\n\tloadPage: function(station) {\r\n\t\tvar _this = this;\r\n\t\tutil.service('GMES-CLIENT-ANDON001',{\r\n\t\t\t\tstationCode : station.stationCode\r\n\t\t\t},i18next.t(\"ANDON.T.MSG_ANDON_LOADING\")).done(function(response){\r\n\t\t\t\tvar data = response.data;\r\n\t\t\t\tvar andonTypes = [];\r\n\t\t\t\t$.each(data,function(_,item){\r\n\r\n\t\t\t\t\tif(item[\"lastTriggerTime\"]){\r\n\t\t\t\t\t\titem[\"lastTriggerTimePart\"] = item[\"lastTriggerTime\"].split(\" \")[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(item.andonType.andonTypeCode!=\"LSANDON\"){\r\n\t\t\t\t\t\t//非拉绳andon\r\n\t\t\t\t\t\tandonTypes.push(item);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t//拉绳andon\r\n\t\t\t\t\t\t$(\"a[name='andon-drawstring-button']\", _this.page).attr(\"statusECode\", item.lastTriggerTime ? _this.STATE_TOUCH : _this\r\n\t\t\t\t\t\t    .STATE_NORMAL).attr(\"switchOnDateTime\", item.lastTriggerTime).attr(\"accumulatedTime\", item.accumulatedTime).attr(\r\n\t\t\t\t\t\t    \"touchColor\", item.andonType.touchColor).attr(\"normalColor\", item.andonType.normalColor);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tvar groupAndons = _this.group(andonTypes, 6);\r\n\t\t\t\tutil.tplManager(\"andonControlSwiperTpl\", groupAndons, \"andonControlSwiperRender\");\r\n\t\t\t\t_this.event();\r\n\t\t\t\t_this.andonStatusDisplay();\r\n\t\t\t\t_this.subscribeMessageTopic(station);\r\n\t\t\t\t//_this.warningDisplay();\r\n\t\t});\r\n\r\n\t},\r\n\t/**\r\n\t * 将ANDON数组分割成6个一组\r\n\t **/\r\n\tgroup : function(array, groupLength) {\r\n    \tvar index = 0;\r\n    \tvar newArray = {\"groupAndons\":[]};\r\n    \twhile(index < array.length) {\r\n    \t\tnewArray.groupAndons.push(array.slice(index, index += groupLength));\r\n    \t}\r\n    \treturn newArray;    \r\n    },\r\n    andonTypeStatusSync : function(messageContent){\r\n    \tvar _this = this;\r\n    \t\r\n    \tvar item = messageContent,$andonItem = undefined;\r\n    \tvar currentStatus = item.lastTriggerTime ? _this.STATE_TOUCH : _this.STATE_NORMAL;\r\n    \tif(_this.isDrawstringAndon(item.andonType)){\r\n\t\t\t//拉绳andon\r\n\t\t\t$andonItem = $(\"a[andonTypeCode='LSANDON']\");\r\n\t\t\tif($andonItem.attr(\"statusECode\") != currentStatus) {\r\n\t\t\t\t//状态不一致\r\n\t\t\t\tif(_this.isTouched(currentStatus)){\r\n\t\t\t\t\t//触发状态添加时间\r\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\",item[\"lastTriggerTime\"]);\r\n\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\",{\r\n\t\t\t\t\t\t\tandonText : i18next.t(\"ANDON.B.DRAWSTRING\")\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\",'');\r\n\t\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\",{\r\n\t\t\t\t\t\t\t\tandonText :  i18next.t(\"ANDON.B.DRAWSTRING\")\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t//非拉绳andon\r\n\t\t\t$andonItem = $(\"a[type='andon'][andonTypeCode='\"+item.andonType.andonTypeCode+\"']\");\r\n\t\t\tif($andonItem.attr(\"statusECode\") != currentStatus) {\r\n\t\t\t\t//状态不一致\r\n\t\t\t\tif(_this.isTouched(currentStatus)){\r\n\t\t\t\t\t//触发状态添加时间\r\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\",item[\"lastTriggerTime\"]);\r\n\t\t\t\t\t$andonItem.parents(\"div.andon-drawstring-item-button\").parent().find(\"dd[name='lastTriggerTimePart']\").text(item[\"lastTriggerTime\"].split(\" \")[1]);\r\n\t\t\t\t\t$andonItem.parents(\"div.andon-drawstring-item-button\").parent().find(\"dd[name='triggerCount']\").text(parseInt(item[\"triggerCount\"]));\r\n\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\",{\r\n\t\t\t\t\t\t\tandonText : item.andonType.typeText\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$andonItem.attr(\"switchOnDateTime\",'');\r\n\t\t\t\t\t$andonItem.find(\".andon-drawstring-touch-time\").text('');\r\n\t\t\t\t\t$andonItem.parents(\"div.andon-drawstring-item-button\").parent().find(\"dd[name='lastTriggerTimePart']\").text(\"\");\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tutil.showNotify({\r\n\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\",{\r\n\t\t\t\t\t\t\tandonText :  item.andonType.typeText\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t$andonItem.attr(\"statusECode\",currentStatus);\r\n\t\t_this.andonStatusDisplay();\r\n    },\r\n    isDrawstringAndon : function(andonType){\r\n    \treturn \"LSANDON\" == andonType.andonTypeCode;\r\n    },\r\n    isTouched : function(statusECode){\r\n    \treturn statusECode == this.STATE_TOUCH;\r\n    },\r\n    andonStatusDisplay : function(){\r\n    \tvar _this = this;\r\n    \tvar $andons = $(\"a[type='andon']\",this.page);\r\n    \tvar $triggerAndons = $(\"a[type='andon'][statusECode='1'][andonTypeCode!='LSANDON']\",this.page);\r\n    \tvar $drawStringAndon = $($(\"a[andonTypeCode='LSANDON']\",this.page)[0]);\r\n    \tvar unTriggered = $triggerAndons.length == 0 && !this.isTouched($drawStringAndon.attr(\"statusECode\"));\r\n    \tvar drawstringTriggered = $triggerAndons.length == 0 && this.isTouched($drawStringAndon.attr(\"statusECode\"));\r\n    \tvar allTriggered = !unTriggered && !drawstringTriggered;\r\n    \t\r\n    \tif(unTriggered){\r\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\r\n\t\t}else{\r\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\r\n\t\t}\r\n\r\n\t\t$.each($andons,function(_,item){\r\n    \t\tvar $el = $(item);\r\n    \t\tvar isDrawstringAndon = $el.attr(\"andonTypeCode\") == \"LSANDON\";\r\n    \t\tif(drawstringTriggered){\r\n    \t\t\t//如果拉绳触发，则将andon设置为可用\r\n    \t\t\t$el.addClass(\"andon-status-enable\").removeClass(\"andon-status-disabled\").removeClass(\"andon-status-touch\");\r\n    \t\t}else if(unTriggered){\r\n    \t\t\tif(isDrawstringAndon){\r\n    \t\t\t\t$el.addClass(\"andon-status-enable\").removeClass(\"andon-status-touch\");\r\n    \t\t\t}else{\r\n    \t\t\t\t$el.addClass(\"andon-status-disabled\").removeClass(\"andon-status-enable\").removeClass(\"andon-status-touch\");\r\n    \t\t\t}\r\n    \t\t\t\r\n    \t\t}\r\n\r\n    \t\tif(_this.isTouched($el.attr(\"statusECode\"))){//触发状态\r\n    \t\t\t$el.addClass(\"andon-status-touch\").removeClass(\"andon-status-enable\").removeClass(\"andon-status-disabled\");\r\n\t\t\t\tvar date = moment(security.getServerDateTime());\r\n\r\n\t\t\t\tvar diffValue = date.diff($el.attr(\"switchOnDateTime\")||date);\r\n\t\t\t\tdiffValue = diffValue < 0? 0 : diffValue;\r\n\t\t\t\tif(diffValue <= 10000){\r\n\t\t\t\t\t$el.css(\"background\",\"linear-gradient(to bottom, #f4b664, #e9822d)\");//黄\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$el.css(\"background\",$el.attr(\"touchColor\"));//红\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif($el.attr(\"name\")=='andon-drawstring-button'){\r\n\t\t\t\t\t$el.find(\".andon-drawstring-touch-time\").text(_this.calTimeForDrawstringAndon(diffValue));\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$el.find(\".andon-drawstring-touch-time\").text(_this.calTime(diffValue));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$el.parents(\".andon-drawstring-item-button\").parent().find(\"dd[name='accumulatedTime']\").text(_this.calTime(($el.attr(\"accumulatedTime\")||0)*1000+diffValue));\r\n\t\t\t}else{\r\n\t\t\t\t//未触发\r\n\t\t\t\tif(allTriggered && !isDrawstringAndon){\r\n\t\t\t\t\t$el.addClass(\"andon-status-disabled\").removeClass(\"andon-status-enable\").removeClass(\"andon-status-touch\");\r\n\t\t\t\t}\r\n\t\t\t\t$el.find(\".andon-drawstring-touch-time\").text(\"\");\r\n\t\t\t\t$el.css(\"background\",$el.attr(\"normalColor\"));\r\n\t\t\t\t$el.parents(\".andon-drawstring-item-button\").parent().find(\"dd[name='accumulatedTime']\").text(_this.calTime(($el.attr(\"accumulatedTime\")||0)*1000));\r\n\t\t\t}\r\n    \t})\r\n    },\r\n\t/**\r\n\t * 告警显示\r\n\t **/\r\n\twarningDisplay : function(){\r\n\t\tif($(\"a[type='andon'][statusECode='1']\",this.page).length > 0 || $(\"a[andonTypeCode='LSANDON'][statusECode='1']\",this.page).length > 0){\r\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\r\n\t\t}else{\r\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\r\n\t\t}\r\n\t},\r\n\tcalTime : function(timeLong){\r\n\t\tvar minutes=Math.floor(timeLong/(60*1000))\r\n\t\tif(minutes!=0)\r\n\t\t\tminutes=i18next.t(\"COMMON.T.MINUTE\",{\r\n\t\t\t\tminute : minutes\r\n\t\t\t});\r\n\t\telse\r\n\t\t\tminutes=\"\";\r\n\t\t//计算相差秒数\r\n\t\tvar leave3=timeLong%(60*1000)      //计算分钟数后剩余的毫秒数\r\n\t\tvar seconds=Math.round(leave3/1000)\r\n\t\tif(seconds!=0)\r\n\t\t\tseconds=i18next.t(\"COMMON.T.SECOND\",{\r\n\t\t\t\tsecond : seconds\r\n\t\t\t});\r\n\t\telse\r\n\t\t\tseconds=\"\";\r\n\t\treturn minutes + seconds ;\r\n\t},\r\n\tcalTimeForDrawstringAndon : function(timeLong){\r\n\t\tvar hour=Math.floor(timeLong/(60*60*1000));\r\n\t\thour = hour >= 10? hour : \"0\"+hour;\r\n\t\tvar leave=timeLong%(60*60*1000) ;\r\n\t\tvar minute=Math.floor(leave/(60*1000))\r\n\t\tminute = minute >= 10? minute : \"0\"+minute;\r\n\t\t//计算相差秒数\r\n\t\tleave=timeLong%(60*1000)      //计算分钟数后剩余的毫秒数\r\n\t\tvar second=Math.round(leave/1000)\r\n\t\tsecond = second >= 10? second : \"0\"+second;\r\n\t\treturn hour + \":\" +minute + \":\" +second ;\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = andonTypeDrawstringViewCtrl;\r\n\r\n      \n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/andon/andonTypeDrawstring.js"],"sourceRoot":""}