{"version":3,"sources":["webpack:///assets/js/pages/andon_andonQuality_940460adab9fdca7830f.js","webpack:///./src/js/pages/andon/andonQuality.js"],"names":["webpackJsonp","622","module","exports","__webpack_require__","$","i18next","app","moment","security","timerManager","util","andonQualityViewCtrl","STATE_TOUCH","STATE_NORMAL","page","undefined","station","init","document","off","translate","_this","this","clearSchedule","isUniqueOperableStation","setBreadcrumb","t","stationText","loadPage","myApp","onPageBeforeRemove","andonQualityView","remove","event","each","index","item","changeAndonDispay","on","e","andonItem","target","attr","parents","statusECode","andonCode","service","stationCode","response","data","isTouched","notify","type","content","andonText","find","text","warningDisplay","andonTypeCode","andons","groupAndons","group","tplManager","length","F7","swiper","pagination","nextButton","prevButton","el","date","getServerDataTime","diffValue","diff","css","calTime","addClass","removeClass","render","config","array","groupLength","newArray","push","slice","timeLong","minutes","Math","floor","minute","leave3","seconds","round","second","call"],"mappings":"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","file":"assets/js/pages/andon_andonQuality_940460adab9fdca7830f.js","sourcesContent":["webpackJsonp([34],{\n\n/***/ 622:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, i18next, app, moment) {\n\nvar security = __webpack_require__(35);\nvar timerManager = __webpack_require__(80);\nvar util = __webpack_require__(34);\n\nvar andonQualityViewCtrl = {\n\tSTATE_TOUCH: 1,\n\tSTATE_NORMAL: 3,\n\tpage: undefined,\n\tstation: undefined,\n\tinit: function init() {\n\t\t$(document).off(\"keydown\");\n\t\tutil.translate('.page[data-page=\"andonQuality\"]');\n\t\tvar _this = this;\n\t\tthis.clearSchedule();\n\t\tsecurity.isUniqueOperableStation(function (station) {\n\t\t\tutil.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONQUALITY\") + \"/\" + station.stationText]);\n\t\t\t_this.station = station;\n\t\t\t_this.loadPage();\n\t\t});\n\t\tmyApp.onPageBeforeRemove('andonQuality', function (page) {\n\t\t\tandonQualityView.clearSchedule();\n\t\t});\n\t},\n\tclearSchedule: function clearSchedule() {\n\t\ttimerManager.remove(\"andonStatusSync\");\n\t},\n\tevent: function event() {\n\t\tvar _this = this;\n\t\t$.each($(\"a[type='andon']\", this.page), function (index, item) {\n\t\t\t_this.changeAndonDispay(item);\n\t\t});\n\n\t\t$(\"a[type='andon']\").on(\"click\", function (e) {\n\n\t\t\tvar andonItem = $(e.target).attr(\"type\") == \"andon\" ? $(e.target) : $(e.target).parents(\"a[type='andon']\");\n\t\t\tvar statusECode = andonItem.attr(\"statusECode\");\n\t\t\tvar andonCode = andonItem.attr(\"andonCode\");\n\n\t\t\tutil.service('GMES-CLIENT-ANDON009', {\n\t\t\t\tstationCode: _this.station.stationCode,\n\t\t\t\tandonCode: andonCode,\n\t\t\t\tstatusECode: statusECode\n\t\t\t}, null, function (response) {\n\t\t\t\tvar data = response.data;\n\t\t\t\tif (!data) {} else {\n\t\t\t\t\tandonItem.attr(\"statusECode\", data.statusECode);\n\t\t\t\t\tif (_this.isTouched(data.statusECode)) {\n\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\", data[\"switchOnDateTime\"]);\n\t\t\t\t\t\tapp.notify({\n\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\", {\n\t\t\t\t\t\t\t\tandonText: andonItem.attr(\"andonText\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\", '');\n\t\t\t\t\t\tandonItem.find(\".touch-time\").text('');\n\t\t\t\t\t\tapp.notify({\n\t\t\t\t\t\t\ttype: \"success\",\n\t\t\t\t\t\t\tcontent: i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\", {\n\t\t\t\t\t\t\t\tandonText: andonItem.attr(\"andonText\")\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t_this.changeAndonDispay(andonItem);\n\t\t\t\t\t_this.warningDisplay();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tloadPage: function loadPage() {\n\t\tvar _this = this;\n\t\tutil.service('GMES-CLIENT-ANDON008', {\n\t\t\tstationCode: _this.station.stationCode,\n\t\t\tandonTypeCode: 'ZLANDON'\n\t\t}, i18next.t(\"ANDON.T.MSG_ANDON_LOADING\"), function (response) {\n\t\t\tvar andons = response.data;\n\t\t\tvar groupAndons = _this.group(andons, 6);\n\t\t\tutil.tplManager(\"andonQualitySwiperTpl\", groupAndons, \"andonQualitySwiperRender\");\n\t\t\tif (andons.length > 6) {\n\t\t\t\tvar andonSwiper = F7.swiper($('.swiper-container', _this.page), {\n\t\t\t\t\tpagination: $('.swiper-pagination', _this.page),\n\t\t\t\t\tnextButton: $('.swiper-button-next', _this.page),\n\t\t\t\t\tprevButton: $('.swiper-button-prev', _this.page)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t_this.event();\n\t\t\t_this.warningDisplay();\n\t\t});\n\t},\n\tchangeAndonDispay: function changeAndonDispay(andonItem) {\n\t\tvar el = $(andonItem);\n\t\tif (el.attr(\"statusECode\") == this.STATE_TOUCH) {\n\t\t\tvar date = moment(security.getServerDataTime());\n\t\t\tvar diffValue = date.diff(el.attr(\"switchOnDateTime\"));\n\t\t\tif (diffValue <= 10000) {\n\t\t\t\tel.css(\"background\", \"linear-gradient(to bottom, #f4b664, #e9822d)\");\n\t\t\t} else {\n\t\t\t\tel.css(\"background\", el.attr(\"touchColor\"));\n\t\t\t}\n\t\t\tel.find(\".touch-time\").text(this.calTime(diffValue));\n\t\t} else {\n\t\t\tel.css(\"background\", el.attr(\"normalColor\"));\n\t\t}\n\t},\n\n\twarningDisplay: function warningDisplay() {\n\n\t\tif ($(\"a[type='andon'][statusECode='1']\", this.page).length > 0) {\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\n\t\t} else {\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\n\t\t}\n\t},\n\trender: function render(config) {},\n\tisTouched: function isTouched(statusECode) {\n\t\treturn statusECode == this.STATE_TOUCH;\n\t},\n\tgroup: function group(array, groupLength) {\n\t\tvar index = 0;\n\t\tvar newArray = { \"groupAndons\": [] };\n\t\twhile (index < array.length) {\n\t\t\tnewArray.groupAndons.push(array.slice(index, index += groupLength));\n\t\t}\n\t\treturn newArray;\n\t},\n\tcalTime: function calTime(timeLong) {\n\t\tvar minutes = Math.floor(timeLong / (60 * 1000));\n\t\tif (minutes != 0) minutes = i18next.t(\"COMMON.T.MINUTE\", {\n\t\t\tminute: minutes\n\t\t});else minutes = \"\";\n\n\t\tvar leave3 = timeLong % (60 * 1000);\n\t\tvar seconds = Math.round(leave3 / 1000);\n\t\tif (seconds != 0) seconds = i18next.t(\"COMMON.T.SECOND\", {\n\t\t\tsecond: seconds\n\t\t});else seconds = \"\";\n\t\treturn minutes + seconds;\n\t}\n};\n\nmodule.exports = andonQualityViewCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(37), __webpack_require__(77), __webpack_require__(30)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/andon_andonQuality_940460adab9fdca7830f.js","var security     = require(\"security\");\r\nvar timerManager = require(\"timerManager\");\r\nvar util = require('util');\r\n\r\nvar andonQualityViewCtrl = {\r\n\tSTATE_TOUCH : 1,\r\n\tSTATE_NORMAL : 3,\r\n\tpage : undefined,\r\n\tstation : undefined,\r\n\tinit: function() {\r\n\t\t$(document).off(\"keydown\");\t\t// 别的页面去除主页的菜单快捷键\r\n\t\tutil.translate('.page[data-page=\"andonQuality\"]');\r\n\t\tvar _this = this;\r\n\t\tthis.clearSchedule();\r\n\t\tsecurity.isUniqueOperableStation(function(station){\r\n\t\t\tutil.setBreadcrumb([i18next.t(\"ANDON.T.MENU_ANDONQUALITY\")+\"/\"+station.stationText]);\r\n\t\t\t_this.station = station;\r\n\t\t\t_this.loadPage();\r\n\t\t});\r\n\t\tmyApp.onPageBeforeRemove('andonQuality', function(page) {\r\n\t\t   andonQualityView.clearSchedule();\r\n\t\t});\r\n\t},\r\n\tclearSchedule : function(){\r\n\t\ttimerManager.remove(\"andonStatusSync\");\r\n\t},\r\n\tevent: function() {\r\n\t\tvar _this = this;\r\n\t\t$.each($(\"a[type='andon']\",this.page),function(index,item){\r\n\t\t\t_this.changeAndonDispay(item);\r\n\t\t});\r\n\r\n\t\t$(\"a[type='andon']\").on(\"click\",function(e){\r\n\r\n\t\t\tvar andonItem = $(e.target).attr(\"type\") == \"andon\"? $(e.target) : $(e.target).parents(\"a[type='andon']\");\r\n\t\t\tvar statusECode = andonItem.attr(\"statusECode\");\r\n\t\t\tvar andonCode = andonItem.attr(\"andonCode\");\r\n\t\t\t//触发服务接口\r\n\t\t\tutil.service('GMES-CLIENT-ANDON009',{\r\n\t\t\t\t\tstationCode : _this.station.stationCode,\r\n\t\t\t\t\tandonCode : andonCode,\r\n\t\t\t\t\tstatusECode : statusECode\r\n\t\t\t\t},null, function(response){\r\n\t\t\t\t\tvar data = response.data;\r\n\t\t\t\t\tif(!data){\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tandonItem.attr(\"statusECode\",data.statusECode);\r\n\t\t\t\t\t\tif(_this.isTouched(data.statusECode)){\r\n\t\t\t\t\t\t\t//触发状态添加时间\r\n\t\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\",data[\"switchOnDateTime\"]);\r\n\t\t\t\t\t\t\tapp.notify({\r\n\t\t\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_TOUCH_SUCCESS\",{\r\n\t\t\t\t\t\t\t\t\tandonText : andonItem.attr(\"andonText\")\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t//复位状态删除时间\r\n\t\t\t\t\t\t\tandonItem.attr(\"switchOnDateTime\",'');\r\n\t\t\t\t\t\t\tandonItem.find(\".touch-time\").text('');\r\n\t\t\t\t\t\t\tapp.notify({\r\n\t\t\t\t\t\t\t\ttype : \"success\",\r\n\t\t\t\t\t\t\t\tcontent : i18next.t(\"ANDON.T.MSG_CLOSE_SUCCESS\",{\r\n\t\t\t\t\t\t\t\t\tandonText : andonItem.attr(\"andonText\")\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t_this.changeAndonDispay(andonItem);\r\n\t\t\t\t\t\t_this.warningDisplay();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t});\r\n\t\t\r\n\r\n\t\t//所有状态为2的格子时间每秒+1\r\n\t\t/*\r\n\t\tif(!this.timer){\r\n\t\t\tthis.timer = setInterval(function(){\r\n\t\t\t\t$.each($(\"a[type='andon']\",_this.page),function(index,item){\r\n\t\t\t\t\t_this.changeAndonDispay(item);\r\n\t\t\t\t});\r\n\t\t\t},1000);\r\n\t\t}*/\r\n\t},\r\n\tloadPage:function(){\r\n\t\tvar _this = this;\r\n\t\tutil.service('GMES-CLIENT-ANDON008',{\r\n\t\t\t\tstationCode : _this.station.stationCode,\r\n\t\t\t\tandonTypeCode : 'ZLANDON'\r\n\t\t\t},i18next.t(\"ANDON.T.MSG_ANDON_LOADING\"),function (response) {\r\n\t\t\t\tvar andons = response.data;\r\n\t\t\t\tvar groupAndons = _this.group(andons, 6);\r\n\t\t\t\tutil.tplManager(\"andonQualitySwiperTpl\", groupAndons, \"andonQualitySwiperRender\");\r\n\t\t\t\tif(andons.length > 6){\r\n\t\t\t\t\tvar andonSwiper = F7.swiper($('.swiper-container',_this.page), {\r\n\t\t\t\t\t\tpagination: $('.swiper-pagination',_this.page),\r\n\t\t\t\t\t\tnextButton: $('.swiper-button-next',_this.page),\r\n\t\t        \t\tprevButton: $('.swiper-button-prev',_this.page),\r\n\t\t\t\t\t}); \r\n\t\t\t\t}\r\n\r\n\t\t\t\t_this.event();\r\n\t\t\t\t_this.warningDisplay();\r\n\t\t\t});\r\n    },\r\n    changeAndonDispay : function(andonItem){\r\n    \tvar el = $(andonItem);\r\n\t\tif(el.attr(\"statusECode\") == this.STATE_TOUCH){//触发状态\r\n\t\t\tvar date = moment(security.getServerDataTime());\r\n\t\t\tvar diffValue = date.diff(el.attr(\"switchOnDateTime\"));\r\n\t\t\tif(diffValue <= 10000){\r\n\t\t\t\tel.css(\"background\",\"linear-gradient(to bottom, #f4b664, #e9822d)\");//黄\r\n\t\t\t}else{\r\n\t\t\t\tel.css(\"background\",el.attr(\"touchColor\"));//红\r\n\t\t\t}\r\n\t\t\tel.find(\".touch-time\").text(this.calTime(diffValue));\r\n\t\t}else{//未触发\r\n\t\t\tel.css(\"background\",el.attr(\"normalColor\"));\r\n\t\t}\r\n\t},\r\n\t/**\r\n\t * 告警显示\r\n\t **/\r\n\twarningDisplay : function(){\r\n\r\n\t\tif($(\"a[type='andon'][statusECode='1']\",this.page).length > 0){\r\n\t\t\t$(this.page).find(\"div.page-content\").addClass(\"andon-bg-blink\");\r\n\t\t}else{\r\n\t\t\t$(this.page).find(\"div.page-content\").removeClass(\"andon-bg-blink\");\r\n\t\t}\r\n\t},\r\n    render : function(config){\r\n\r\n\r\n    },\r\n    isTouched : function(statusECode){\r\n    \treturn statusECode == this.STATE_TOUCH;\r\n    },\r\n    group : function(array, groupLength) {\r\n    \tvar index = 0;\r\n    \tvar newArray = {\"groupAndons\":[]};\r\n    \twhile(index < array.length) {\r\n    \t\tnewArray.groupAndons.push(array.slice(index, index += groupLength));\r\n    \t}\r\n    \treturn newArray;\r\n    },\r\n\tcalTime : function(timeLong){\r\n\t\tvar minutes=Math.floor(timeLong/(60*1000))\r\n\t\tif(minutes!=0)\r\n\t\t\tminutes=i18next.t(\"COMMON.T.MINUTE\",{\r\n\t\t\t\tminute : minutes\r\n\t\t\t});\r\n\t\telse\r\n\t\t\tminutes=\"\";\r\n\t\t//计算相差秒数\r\n\t\tvar leave3=timeLong%(60*1000)      //计算分钟数后剩余的毫秒数\r\n\t\tvar seconds=Math.round(leave3/1000)\r\n\t\tif(seconds!=0)\r\n\t\t\tseconds=i18next.t(\"COMMON.T.SECOND\",{\r\n\t\t\t\tsecond : seconds\r\n\t\t\t});\r\n\t\telse\r\n\t\t\tseconds=\"\";\r\n\t\treturn minutes + seconds ;\r\n\t}\r\n}\r\n\r\n/*F7.onPageInit('andonQuality', function (page) {\r\n\t$(document).off(\"keydown\");\t\t// 别的页面去除主页的菜单快捷键\r\n\tandonQualityView.init($(page.container));\r\n\tutil.translate('.page[data-page=\"andonQuality\"]');\r\n});*/\r\n\r\nmodule.exports = andonQualityViewCtrl\r\n\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/andon/andonQuality.js"],"sourceRoot":""}