{"version":3,"sources":["webpack:///assets/js/pages/pcs_multistationAssemblyInstruction_e698222f77410b9c3a75.js","webpack:///./src/js/pages/pcs/multistationAssemblyInstruction.js"],"names":["webpackJsonp","632","module","exports","__webpack_require__","$","notie","security","mqttLib","util","multistationAssemblyInstructionCtrl","moduleConfig","undefined","pages","page","$page","init","this","setZoom","translate","fullScreenEvent","initData","_this","getSysModuleConfig","done","response","proConfig","getDataAndRenderScreenLeft","subscribeNotifyLeft","getDataAndRenderScreenRight","subscribeNotifyRight","leftModuleConfig","topic","getSiteCode","subscribe","registerMessageHandler","rightModuleConfig","service","onlineStationCode","assemblyStationCode","rowNum","returnCode","alert","text","errorMessage","data","processData","leftStationAssemblyInstruction","thresholdValue","warnShineFlag","remainingQuantity","tplManager","rightStationAssemblyInstruction","fail","launchIntoFullscreen","document","body","call"],"mappings":"AAAAA,cAAc,KAERC,IACA,SAAUC,EAAQC,EAASC,GAEjC,cAC4B,SAASC,EAAGC,GCExC,GAAIC,GAAWH,EAAQ,IACnBI,EAAUJ,EAAQ,IAClBK,EAAOL,EAAQ,IAEfM,GACAC,iBAAcC,GACdC,UAAOD,GACPE,SAAMF,GACNG,UAAOH,GAEPI,KAAM,WACFC,KAAKF,MAAQV,EAAEY,KAAKH,MACpBL,EAAKS,QAAQD,KAAKH,MAClBL,EAAKU,UAAUF,KAAKF,OACpBE,KAAKG,kBACLH,KAAKI,YAETA,SAAU,WACN,GAAIC,GAAQL,IACZV,GAASgB,mBAAmB,MAAO,qCAAqCC,KAAK,SAAUC,GAEnFhB,EAAKiB,UAAUD,EAAU,SAASd,GAI9BW,EAAMX,aAAeA,EACjBA,EAAA,iCACAW,EAAMK,6BACNL,EAAMM,uBAENjB,EAAA,kCACAW,EAAMO,8BACNP,EAAMQ,6BAMtBF,oBAAqB,WACjB,GAAIN,GAAQL,KACRc,EAAmBT,EAAMX,aAAN,+BACnBqB,EAAQ,eAAiBzB,EAAS0B,cAAgB,IAAMF,EAAA,iBAE5DvB,GAAQ0B,UAAUF,EAAO,mCACzBxB,EAAQ2B,uBAAuBH,EAAO,sEAAuE,WACzGV,EAAMK,gCAIdG,qBAAsB,WAClB,GAAIR,GAAQL,KACRmB,EAAoBd,EAAMX,aAAN,gCACpBqB,EAAQ,eAAiBzB,EAAS0B,cAAgB,IAAMG,EAAA,iBAE5D5B,GAAQ0B,UAAUF,EAAO,mCACzBxB,EAAQ2B,uBAAuBH,EAAO,uEAAwE,WACtGV,EAAMO,iCAIlBF,2BAA4B,WACxB,GAAIL,GAAQL,KAERc,EAAmBT,EAAMX,aAAN,8BACvBF,GAAK4B,QAAQ,uBACTC,kBAAqBP,EAAA,kBACrBQ,oBAAuBR,EAAA,oBACvBS,OAAUT,EAAA,QAA8B,GACzC,SAASP,KAAK,SAAUC,GAEvB,GAA4B,MAAxBA,EAASgB,WAET,WADAnC,GAAMoC,OAAOC,KAAMlB,EAASmB,cAIhC,IAAIC,GAAOpB,EAASoB,IACpB,KAAKA,EAED,WADAvC,GAAMoC,OAAOC,KAAM,UAIvBE,GAAOpC,EAAKqC,YAAYxB,EAAMX,aAAaoC,+BAAgCF,EAE3E,IAAIG,GAAiBjB,EAAA,gBAAsC,CAC3Dc,GAAKI,eAAgB,EACjBJ,EAAKK,mBAAqBL,EAAKK,mBAAqBF,IACpDH,EAAKI,eAAgB,GAEzBxC,EAAK0C,WAAW,wBAAyBN,EAAM,8BAIvDhB,4BAA6B,WACzB,GAAIP,GAAQL,KAERmB,EAAoBd,EAAMX,aAAN,+BACxBF,GAAK4B,QAAQ,uBACTC,kBAAqBF,EAAA,kBACrBG,oBAAuBH,EAAA,oBACvBI,OAAUJ,EAAA,QAA+B,GAC1C,MAAMZ,KAAK,SAAUC,GACpB,GAA4B,MAAxBA,EAASgB,WAET,WADAnC,GAAMoC,OAAOC,KAAMlB,EAASmB,cAGhC,IAAIC,GAAOpB,EAASoB,IACpB,KAAKA,EAED,WADAvC,GAAMoC,OAAOC,KAAM,UAIvBE,GAAOpC,EAAKqC,YAAYxB,EAAMX,aAAayC,gCAAiCP,EAE5E,IAAIG,GAAiBZ,EAAA,gBAAuC,CAC5DS,GAAKI,eAAgB,EACjBJ,EAAKK,mBAAqBL,EAAKK,mBAAqBF,IACpDH,EAAKI,eAAgB,GAEzBxC,EAAK0C,WAAW,wBAAyBN,EAAM,8BAChDQ,KAAK,WACJ/C,EAAMoC,OAAOC,KAAM,iBAI3BvB,gBAAiB,WAEbX,EAAK6C,qBAAqBC,SAASC,OAI3CtD,GAAOC,QAAUO,IDLY+C,KAAKtD,EAASC,EAAoB,GAAIA,EAAoB","file":"assets/js/pages/pcs_multistationAssemblyInstruction_e698222f77410b9c3a75.js","sourcesContent":["webpackJsonp([28],{\n\n/***/ 632:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, notie) {\n\nvar security = __webpack_require__(35);\nvar mqttLib = __webpack_require__(53);\nvar util = __webpack_require__(34);\n\nvar multistationAssemblyInstructionCtrl = {\n    moduleConfig: undefined,\n    pages: undefined,\n    page: undefined,\n    $page: undefined,\n    init: function init() {\n        this.$page = $(this.page);\n        util.setZoom(this.page);\n        util.translate(this.$page);\n        this.fullScreenEvent();\n        this.initData();\n    },\n    initData: function initData() {\n        var _this = this;\n        security.getSysModuleConfig(\"PCS\", \"MULTISTATION_ASSEMBLY_INSTRUCTION\").done(function (response) {\n\n            util.proConfig(response, function (moduleConfig) {\n\n                _this.moduleConfig = moduleConfig;\n                if (moduleConfig[\"leftStationAssemblyInstruction\"]) {\n                    _this.getDataAndRenderScreenLeft();\n                    _this.subscribeNotifyLeft();\n                }\n                if (moduleConfig[\"rightStationAssemblyInstruction\"]) {\n                    _this.getDataAndRenderScreenRight();\n                    _this.subscribeNotifyRight();\n                }\n            });\n        });\n    },\n\n    subscribeNotifyLeft: function subscribeNotifyLeft() {\n        var _this = this;\n        var leftModuleConfig = _this.moduleConfig[\"leftStationAssemblyInstruction\"];\n        var topic = \"subassembly/\" + security.getSiteCode() + \"/\" + leftModuleConfig[\"onlineStationCode\"];\n\n        mqttLib.subscribe(topic, \"multistationAssemblyInstruction\");\n        mqttLib.registerMessageHandler(topic, \"multistationAssemblyInstruction.multiStationAssemblyInstructionLeft\", function () {\n            _this.getDataAndRenderScreenLeft();\n        });\n    },\n\n    subscribeNotifyRight: function subscribeNotifyRight() {\n        var _this = this;\n        var rightModuleConfig = _this.moduleConfig[\"rightStationAssemblyInstruction\"];\n        var topic = \"subassembly/\" + security.getSiteCode() + \"/\" + rightModuleConfig[\"onlineStationCode\"];\n\n        mqttLib.subscribe(topic, \"multistationAssemblyInstruction\");\n        mqttLib.registerMessageHandler(topic, \"multistationAssemblyInstruction.multiStationAssemblyInstructionRight\", function () {\n            _this.getDataAndRenderScreenRight();\n        });\n    },\n\n    getDataAndRenderScreenLeft: function getDataAndRenderScreenLeft() {\n        var _this = this;\n\n        var leftModuleConfig = _this.moduleConfig[\"leftStationAssemblyInstruction\"];\n        util.service(\"GMES-CLIENT-PCS0005\", {\n            \"onlineStationCode\": leftModuleConfig[\"onlineStationCode\"],\n            \"assemblyStationCode\": leftModuleConfig[\"assemblyStationCode\"],\n            \"rowNum\": leftModuleConfig[\"rowNum\"] || 0 }, \"正在加载中\").done(function (response) {\n\n            if (response.returnCode !== \"0\") {\n                notie.alert({ text: response.errorMessage });\n                return;\n            }\n\n            var data = response.data;\n            if (!data) {\n                notie.alert({ text: \"左工位无数据\" });\n                return;\n            }\n\n            data = util.processData(_this.moduleConfig.leftStationAssemblyInstruction, data);\n\n            var thresholdValue = leftModuleConfig[\"thresholdValue\"] || 3;\n            data.warnShineFlag = false;\n            if (data.remainingQuantity && data.remainingQuantity <= thresholdValue) {\n                data.warnShineFlag = true;\n            }\n            util.tplManager(\"multiStationAssInsTpl\", data, \"leftStationAssInsRender\");\n        });\n    },\n\n    getDataAndRenderScreenRight: function getDataAndRenderScreenRight() {\n        var _this = this;\n\n        var rightModuleConfig = _this.moduleConfig[\"rightStationAssemblyInstruction\"];\n        util.service(\"GMES-CLIENT-PCS0005\", {\n            \"onlineStationCode\": rightModuleConfig[\"onlineStationCode\"],\n            \"assemblyStationCode\": rightModuleConfig[\"assemblyStationCode\"],\n            \"rowNum\": rightModuleConfig[\"rowNum\"] || 0 }, null).done(function (response) {\n            if (response.returnCode !== \"0\") {\n                notie.alert({ text: response.errorMessage });\n                return;\n            }\n            var data = response.data;\n            if (!data) {\n                notie.alert({ text: \"右工位无数据\" });\n                return;\n            }\n\n            data = util.processData(_this.moduleConfig.rightStationAssemblyInstruction, data);\n\n            var thresholdValue = rightModuleConfig[\"thresholdValue\"] || 3;\n            data.warnShineFlag = false;\n            if (data.remainingQuantity && data.remainingQuantity <= thresholdValue) {\n                data.warnShineFlag = true;\n            }\n            util.tplManager(\"multiStationAssInsTpl\", data, \"rightStationAssInsRender\");\n        }).fail(function () {\n            notie.alert({ text: \"右工位未获取到数据\" });\n        });\n    },\n\n    fullScreenEvent: function fullScreenEvent() {\n        util.launchIntoFullscreen(document.body);\n    }\n};\n\nmodule.exports = multistationAssemblyInstructionCtrl;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4), __webpack_require__(36)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// assets/js/pages/pcs_multistationAssemblyInstruction_e698222f77410b9c3a75.js","/*\r\n * @name: \\pcs\\multistationAssemblyInstruction.js\r\n * @url: http://git.evun.cn/GMES/GMES_CLIENT_PAD\r\n * @author: EVUN前端组\r\n * @modify: kelichao\r\n * @update: 2017-06-13\r\n * @decript: 装配指示（双）\r\n */\r\nvar security = require(\"security\");\r\nvar mqttLib = require(\"mqttLib\");\r\nvar util = require(\"util\");\r\n\r\nvar multistationAssemblyInstructionCtrl = {\r\n    moduleConfig: undefined,// 模块配置\r\n    pages: undefined,// 在sweet内部已经定义,对象\r\n    page: undefined,// 页面容器\r\n    $page: undefined,// 页面容器（jquery对象）\r\n    // 初始化\r\n    init: function () {\r\n        this.$page = $(this.page);\r\n        util.setZoom(this.page);\r\n        util.translate(this.$page);\r\n        this.fullScreenEvent();// 全屏控制\r\n        this.initData();// 初始化数据时，获取站点配置信息，首次加载并渲染本页面数据\r\n    },\r\n    initData: function () {\r\n        var _this = this;\r\n        security.getSysModuleConfig(\"PCS\", \"MULTISTATION_ASSEMBLY_INSTRUCTION\").done(function (response) {\r\n\r\n            util.proConfig(response, function(moduleConfig) {\r\n                // var stationText = moduleConfig[\"title\"] + moduleConfig[\"leftStationAssemblyInstruction\"][\"assemblyStationCode\"]  + moduleConfig[\"rightStationAssemblyInstruction\"][\"assemblyStationCode\"] ;\r\n                // $(\".title\", _this.$page).text(stationText);\r\n\r\n                _this.moduleConfig = moduleConfig;\r\n                if (moduleConfig[\"leftStationAssemblyInstruction\"]) {\r\n                    _this.getDataAndRenderScreenLeft();\r\n                    _this.subscribeNotifyLeft();\r\n                }\r\n                if (moduleConfig[\"rightStationAssemblyInstruction\"]) {\r\n                    _this.getDataAndRenderScreenRight();\r\n                    _this.subscribeNotifyRight();\r\n                }\r\n            });\r\n        });\r\n    },\r\n    // 订阅站点上件通知，收到通知，则重新获取页面数据并刷新页面-左\r\n    subscribeNotifyLeft: function () {\r\n        var _this = this;\r\n        var leftModuleConfig = _this.moduleConfig[\"leftStationAssemblyInstruction\"];\r\n        var topic = \"subassembly/\" + security.getSiteCode() + \"/\" + leftModuleConfig[\"onlineStationCode\"];\r\n        // _this.topics[left] = topic;\r\n        mqttLib.subscribe(topic, \"multistationAssemblyInstruction\");\r\n        mqttLib.registerMessageHandler(topic, \"multistationAssemblyInstruction.multiStationAssemblyInstructionLeft\", function () {\r\n            _this.getDataAndRenderScreenLeft();\r\n        });\r\n    },\r\n    // 订阅站点上件通知，收到通知，则重新获取页面数据并刷新页面-右\r\n    subscribeNotifyRight: function () {\r\n        var _this = this;\r\n        var rightModuleConfig = _this.moduleConfig[\"rightStationAssemblyInstruction\"];\r\n        var topic = \"subassembly/\" + security.getSiteCode() + \"/\" + rightModuleConfig[\"onlineStationCode\"];\r\n        // _this.topics[right] = topic;\r\n        mqttLib.subscribe(topic, \"multistationAssemblyInstruction\");\r\n        mqttLib.registerMessageHandler(topic, \"multistationAssemblyInstruction.multiStationAssemblyInstructionRight\", function () {\r\n                _this.getDataAndRenderScreenRight();\r\n        });\r\n    },\r\n    // 获取页面数据并刷新页面-左\r\n    getDataAndRenderScreenLeft: function () {\r\n        var _this = this;\r\n        //左边装配指示\r\n        var leftModuleConfig = _this.moduleConfig[\"leftStationAssemblyInstruction\"];\r\n        util.service(\"GMES-CLIENT-PCS0005\", {\r\n            \"onlineStationCode\": leftModuleConfig[\"onlineStationCode\"],// 上件工位\r\n            \"assemblyStationCode\": leftModuleConfig[\"assemblyStationCode\"],// 当前工位（无效参数，还未验证）\r\n            \"rowNum\": leftModuleConfig[\"rowNum\"] || 0 // 当前工位向前推进数量\r\n        }, \"正在加载中\").done(function (response) {\r\n\r\n            if (response.returnCode !== \"0\") {\r\n                notie.alert({text: response.errorMessage});\r\n                return;\r\n            }\r\n\r\n            var data = response.data;\r\n            if (!data) {\r\n                notie.alert({text: \"左工位无数据\"});\r\n                return;\r\n            }\r\n\r\n            data = util.processData(_this.moduleConfig.leftStationAssemblyInstruction, data);\r\n \r\n            var thresholdValue = leftModuleConfig[\"thresholdValue\"] || 3;\r\n            data.warnShineFlag = false;\r\n            if (data.remainingQuantity && data.remainingQuantity <= thresholdValue) {\r\n                data.warnShineFlag = true;\r\n            }\r\n            util.tplManager(\"multiStationAssInsTpl\", data, \"leftStationAssInsRender\");\r\n        });\r\n    },\r\n    // 获取页面数据并刷新页面-右\r\n    getDataAndRenderScreenRight: function () {\r\n        var _this = this;\r\n        //右边装配指示\r\n        var rightModuleConfig = _this.moduleConfig[\"rightStationAssemblyInstruction\"];\r\n        util.service(\"GMES-CLIENT-PCS0005\", {\r\n            \"onlineStationCode\": rightModuleConfig[\"onlineStationCode\"],// 上件工位\r\n            \"assemblyStationCode\": rightModuleConfig[\"assemblyStationCode\"],// 当前工位（无效参数，还未验证）\r\n            \"rowNum\": rightModuleConfig[\"rowNum\"] || 0 // 当前工位向前推进数量\r\n        }, null).done(function (response) {\r\n            if (response.returnCode !== \"0\") {\r\n                notie.alert({text: response.errorMessage});\r\n                return;\r\n            }\r\n            var data = response.data;\r\n            if (!data) {\r\n                notie.alert({text: \"右工位无数据\"});\r\n                return;\r\n            }\r\n\r\n            data = util.processData(_this.moduleConfig.rightStationAssemblyInstruction, data);\r\n\r\n            var thresholdValue = rightModuleConfig[\"thresholdValue\"] || 3;\r\n            data.warnShineFlag = false;\r\n            if (data.remainingQuantity && data.remainingQuantity <= thresholdValue) {\r\n                data.warnShineFlag = true;\r\n            }\r\n            util.tplManager(\"multiStationAssInsTpl\", data, \"rightStationAssInsRender\");\r\n        }).fail(function () {\r\n            notie.alert({text: \"右工位未获取到数据\"});\r\n        });\r\n    },\r\n    // 全屏控制\r\n    fullScreenEvent: function () {\r\n        // 这个API只能通过点击触发\r\n        util.launchIntoFullscreen(document.body);\r\n    }\r\n};\r\n\r\nmodule.exports = multistationAssemblyInstructionCtrl;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/pages/pcs/multistationAssemblyInstruction.js"],"sourceRoot":""}